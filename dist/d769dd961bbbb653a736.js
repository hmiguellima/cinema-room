/*! For license information please see d769dd961bbbb653a736.js.LICENSE.txt */
(()=>{var e={123:(e,t,n)=>{!function(){var e="undefined"!=typeof window?window:n.g,i={};for(var r in function(e,t,n){var i;function r(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var a="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},o=function(n){n=["object"==typeof globalThis&&globalThis,n,"object"==typeof e&&e,"object"==typeof self&&self,"object"==typeof t&&t];for(var i=0;i<n.length;++i){var r=n[i];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function s(e,t){if(t)e:{for(var n=o,i=e.split("."),r=0;r<i.length-1;r++){var s=i[r];if(!(s in n))break e;n=n[s]}(s=t(r=n[i=i[i.length-1]]))!=r&&null!=s&&a(n,i,{configurable:!0,writable:!0,value:s})}}function l(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function u(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:r(e)}}function c(e){if(!(e instanceof Array)){e=u(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}s("Symbol",(function(e){function t(e,t){this.g=e,a(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.g};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",i=0;return function e(r){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(r||"")+"_"+i++,r)}})),s("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),n=0;n<t.length;n++){var i=o[t[n]];"function"==typeof i&&"function"!=typeof i.prototype[e]&&a(i.prototype,e,{configurable:!0,writable:!0,value:function(){return l(r(this))}})}return e}));var h,d="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)h=Object.setPrototypeOf;else{var p;e:{var f={};try{f.__proto__={a:!0},p=f.a;break e}catch(e){}p=!1}h=p?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var m=h;function g(e,t){if(e.prototype=d(t.prototype),e.prototype.constructor=e,m)m(e,t);else for(var n in t)if("prototype"!=n)if(Object.defineProperties){var i=Object.getOwnPropertyDescriptor(t,n);i&&Object.defineProperty(e,n,i)}else e[n]=t[n];e.Eg=t.prototype}function v(){this.s=!1,this.l=null,this.h=void 0,this.g=1,this.j=this.m=0,this.D=this.i=null}function y(e){if(e.s)throw new TypeError("Generator is already running");e.s=!0}function x(e,t){e.i={$d:t,fe:!0},e.g=e.m||e.j}function b(e,t,n){return e.g=n,{value:t}}function w(e){e.g=0}function M(e,t,n){e.m=t,null!=n&&(e.j=n)}function _(e){e.m=0,e.j=2}function S(e,t){e.g=t,e.m=0}function T(e){e.m=0;var t=e.i.$d;return e.i=null,t}function E(e){e.D=[e.i],e.m=0,e.j=0}function A(e,t){var n=e.D.splice(0)[0];(n=e.i=e.i||n)?n.fe?e.g=e.m||e.j:null!=n.v&&e.j<n.v?(e.g=n.v,e.i=null):e.g=e.j:e.g=t}function C(e){this.g=new v,this.h=e}function R(e,t,n,i){try{var r=t.call(e.g.l,n);if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");if(!r.done)return e.g.s=!1,r;var a=r.value}catch(t){return e.g.l=null,x(e.g,t),L(e)}return e.g.l=null,i.call(e.g,a),L(e)}function L(e){for(;e.g.g;)try{var t=e.h(e.g);if(t)return e.g.s=!1,{value:t.value,done:!1}}catch(t){e.g.h=void 0,x(e.g,t)}if(e.g.s=!1,e.g.i){if(t=e.g.i,e.g.i=null,t.fe)throw t.$d;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function I(e){this.next=function(t){return y(e.g),e.g.l?t=R(e,e.g.l.next,t,e.g.u):(e.g.u(t),t=L(e)),t},this.throw=function(t){return y(e.g),e.g.l?t=R(e,e.g.l.throw,t,e.g.u):(x(e.g,t),t=L(e)),t},this.return=function(t){return function(e,t){y(e.g);var n=e.g.l;return n?R(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),L(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function P(e,t){var n=new I(new C(t));return m&&e.prototype&&m(n,e.prototype),n}function D(e){return function(e){function t(t){return e.next(t)}function n(t){return e.throw(t)}return new Promise((function(i,r){!function e(a){a.done?i(a.value):Promise.resolve(a.value).then(t,n).then(e,r)}(e.next())}))}(new I(new C(e)))}function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function k(e,t,n){e instanceof String&&(e=String(e));for(var i=e.length,r=0;r<i;r++){var a=e[r];if(t.call(n,a,r,e))return{ha:r,ze:a}}return{ha:-1,ze:void 0}}function O(e,t,n){if(null==e)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(t instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return e+""}function U(e,t){e instanceof String&&(e+="");var n=0,i=!1,r={next:function(){if(!i&&n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return i=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}v.prototype.u=function(e){this.h=e},v.prototype.return=function(e){this.i={return:e},this.g=this.j},v.prototype.v=function(e){this.g=e},s("Promise",(function(e){function t(e){this.h=0,this.i=void 0,this.g=[],this.s=!1;var t=this.j();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}}function n(){this.g=null}function i(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;n.prototype.h=function(e){if(null==this.g){this.g=[];var t=this;this.i((function(){t.l()}))}this.g.push(e)};var r=o.setTimeout;n.prototype.i=function(e){r(e,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var e=this.g;this.g=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(e){this.j(e)}}}this.g=null},n.prototype.j=function(e){this.i((function(){throw e}))},t.prototype.j=function(){function e(e){return function(i){n||(n=!0,e.call(t,i))}}var t=this,n=!1;return{resolve:e(this.J),reject:e(this.l)}},t.prototype.J=function(e){if(e===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.N(e);else{e:switch(typeof e){case"object":var n=null!=e;break e;case"function":n=!0;break e;default:n=!1}n?this.H(e):this.m(e)}},t.prototype.H=function(e){var t=void 0;try{t=e.then}catch(e){return void this.l(e)}"function"==typeof t?this.T(t,e):this.m(e)},t.prototype.l=function(e){this.u(2,e)},t.prototype.m=function(e){this.u(1,e)},t.prototype.u=function(e,t){if(0!=this.h)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.h);this.h=e,this.i=t,2===this.h&&this.L(),this.D()},t.prototype.L=function(){var e=this;r((function(){if(e.F()){var t=o.console;void 0!==t&&t.error(e.i)}}),1)},t.prototype.F=function(){if(this.s)return!1;var e=o.CustomEvent,t=o.Event,n=o.dispatchEvent;return void 0===n||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=o.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.i,n(e))},t.prototype.D=function(){if(null!=this.g){for(var e=0;e<this.g.length;++e)a.h(this.g[e]);this.g=null}};var a=new n;return t.prototype.N=function(e){var t=this.j();e.tc(t.resolve,t.reject)},t.prototype.T=function(e,t){var n=this.j();try{e.call(t,n.resolve,n.reject)}catch(e){n.reject(e)}},t.prototype.then=function(e,n){function i(e,t){return"function"==typeof e?function(t){try{r(e(t))}catch(e){a(e)}}:t}var r,a,o=new t((function(e,t){r=e,a=t}));return this.tc(i(e,r),i(n,a)),o},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.tc=function(e,t){function n(){switch(i.h){case 1:e(i.i);break;case 2:t(i.i);break;default:throw Error("Unexpected state: "+i.h)}}var i=this;null==this.g?a.h(n):this.g.push(n),this.s=!0},t.resolve=i,t.reject=function(e){return new t((function(t,n){n(e)}))},t.race=function(e){return new t((function(t,n){for(var r=u(e),a=r.next();!a.done;a=r.next())i(a.value).tc(t,n)}))},t.all=function(e){var n=u(e),r=n.next();return r.done?i([]):new t((function(e,t){function a(t){return function(n){o[t]=n,0==--s&&e(o)}}var o=[],s=0;do{o.push(void 0),s++,i(r.value).tc(a(o.length-1),t),r=n.next()}while(!r.done)}))},t})),s("WeakMap",(function(e){function t(e){if(this.g=(l+=Math.random()+1).toString(),e){e=u(e);for(var t;!(t=e.next()).done;)t=t.value,this.set(t[0],t[1])}}function n(){}function i(e){var t=typeof e;return"object"===t&&null!==e||"function"===t}function r(e){if(!N(e,s)){var t=new n;a(e,s,{value:t})}}function o(e){var t=Object[e];t&&(Object[e]=function(e){return e instanceof n?e:(Object.isExtensible(e)&&r(e),t(e))})}if(function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),n=Object.seal({}),i=new e([[t,2],[n,3]]);return 2==i.get(t)&&3==i.get(n)&&(i.delete(t),i.set(n,4),!i.has(t)&&4==i.get(n))}catch(e){return!1}}())return e;var s="$jscomp_hidden_"+Math.random();o("freeze"),o("preventExtensions"),o("seal");var l=0;return t.prototype.set=function(e,t){if(!i(e))throw Error("Invalid WeakMap key");if(r(e),!N(e,s))throw Error("WeakMap key fail: "+e);return e[s][this.g]=t,this},t.prototype.get=function(e){return i(e)&&N(e,s)?e[s][this.g]:void 0},t.prototype.has=function(e){return i(e)&&N(e,s)&&N(e[s],this.g)},t.prototype.delete=function(e){return!!(i(e)&&N(e,s)&&N(e[s],this.g))&&delete e[s][this.g]},t})),s("Map",(function(e){function t(){var e={};return e.Sa=e.next=e.head=e}function n(e,t){var n=e.g;return l((function(){if(n){for(;n.head!=e.g;)n=n.Sa;for(;n.next!=n.head;)return n=n.next,{done:!1,value:t(n)};n=null}return{done:!0,value:void 0}}))}function i(e,t){var n=t&&typeof t;"object"==n||"function"==n?a.has(t)?n=a.get(t):(n=""+ ++o,a.set(t,n)):n="p_"+t;var i=e.h[n];if(i&&N(e.h,n))for(var r=0;r<i.length;r++){var s=i[r];if(t!=t&&s.key!=s.key||t===s.key)return{id:n,list:i,index:r,ga:s}}return{id:n,list:i,index:-1,ga:void 0}}function r(e){if(this.h={},this.g=t(),this.size=0,e){e=u(e);for(var n;!(n=e.next()).done;)n=n.value,this.set(n[0],n[1])}}if(function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e(u([[t,"s"]]));if("s"!=n.get(t)||1!=n.size||n.get({x:4})||n.set({x:4},"t")!=n||2!=n.size)return!1;var i=n.entries(),r=i.next();return!r.done&&r.value[0]==t&&"s"==r.value[1]&&!((r=i.next()).done||4!=r.value[0].x||"t"!=r.value[1]||!i.next().done)}catch(e){return!1}}())return e;var a=new WeakMap;r.prototype.set=function(e,t){var n=i(this,e=0===e?0:e);return n.list||(n.list=this.h[n.id]=[]),n.ga?n.ga.value=t:(n.ga={next:this.g,Sa:this.g.Sa,head:this.g,key:e,value:t},n.list.push(n.ga),this.g.Sa.next=n.ga,this.g.Sa=n.ga,this.size++),this},r.prototype.delete=function(e){return!(!(e=i(this,e)).ga||!e.list||(e.list.splice(e.index,1),e.list.length||delete this.h[e.id],e.ga.Sa.next=e.ga.next,e.ga.next.Sa=e.ga.Sa,e.ga.head=null,this.size--,0))},r.prototype.clear=function(){this.h={},this.g=this.g.Sa=t(),this.size=0},r.prototype.has=function(e){return!!i(this,e).ga},r.prototype.get=function(e){return(e=i(this,e).ga)&&e.value},r.prototype.entries=function(){return n(this,(function(e){return[e.key,e.value]}))},r.prototype.keys=function(){return n(this,(function(e){return e.key}))},r.prototype.values=function(){return n(this,(function(e){return e.value}))},r.prototype.forEach=function(e,t){for(var n,i=this.entries();!(n=i.next()).done;)n=n.value,e.call(t,n[1],n[0],this)},r.prototype[Symbol.iterator]=r.prototype.entries;var o=0;return r})),s("Set",(function(e){function t(e){if(this.g=new Map,e){e=u(e);for(var t;!(t=e.next()).done;)this.add(t.value)}this.size=this.g.size}return function(){if(!e||"function"!=typeof e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var t=Object.seal({x:4}),n=new e(u([t]));if(!n.has(t)||1!=n.size||n.add(t)!=n||1!=n.size||n.add({x:4})!=n||2!=n.size)return!1;var i=n.entries(),r=i.next();return!r.done&&r.value[0]==t&&r.value[1]==t&&!(r=i.next()).done&&r.value[0]!=t&&4==r.value[0].x&&r.value[1]==r.value[0]&&i.next().done}catch(e){return!1}}()?e:(t.prototype.add=function(e){return e=0===e?0:e,this.g.set(e,e),this.size=this.g.size,this},t.prototype.delete=function(e){return e=this.g.delete(e),this.size=this.g.size,e},t.prototype.clear=function(){this.g.clear(),this.size=0},t.prototype.has=function(e){return this.g.has(e)},t.prototype.entries=function(){return this.g.entries()},t.prototype.values=function(){return this.g.values()},t.prototype.keys=t.prototype.values,t.prototype[Symbol.iterator]=t.prototype.values,t.prototype.forEach=function(e,t){var n=this;this.g.forEach((function(i){return e.call(t,i,i,n)}))},t)})),s("Array.prototype.findIndex",(function(e){return e||function(e,t){return k(this,e,t).ha}})),s("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),s("Array.prototype.includes",(function(e){return e||function(e,t){var n=this;n instanceof String&&(n=String(n));var i=n.length,r=t||0;for(0>r&&(r=Math.max(r+i,0));r<i;r++){var a=n[r];if(a===e||Object.is(a,e))return!0}return!1}})),s("String.prototype.includes",(function(e){return e||function(e,t){return-1!==O(this,e,"includes").indexOf(e,t||0)}})),s("Array.prototype.find",(function(e){return e||function(e,t){return k(this,e,t).ze}})),s("String.prototype.startsWith",(function(e){return e||function(e,t){for(var n=O(this,e,"startsWith"),i=n.length,r=e.length,a=Math.max(0,Math.min(0|t,n.length)),o=0;o<r&&a<i;)if(n[a++]!=e[o++])return!1;return o>=r}})),s("Array.prototype.keys",(function(e){return e||function(){return U(this,(function(e){return e}))}}));var F="function"==typeof Object.assign?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)N(i,r)&&(e[r]=i[r])}return e};s("Object.assign",(function(e){return e||F})),s("Array.from",(function(e){return e||function(e,t,n){t=null!=t?t:function(e){return e};var i=[],r="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];if("function"==typeof r){e=r.call(e);for(var a=0;!(r=e.next()).done;)i.push(t.call(n,r.value,a++))}else for(r=e.length,a=0;a<r;a++)i.push(t.call(n,e[a],a));return i}})),s("Array.prototype.values",(function(e){return e||function(){return U(this,(function(e,t){return t}))}})),s("Promise.prototype.finally",(function(e){return e||function(e){return this.then((function(t){return Promise.resolve(e()).then((function(){return t}))}),(function(t){return Promise.resolve(e()).then((function(){throw t}))}))}})),s("Array.prototype.entries",(function(e){return e||function(){return U(this,(function(e,t){return[e,t]}))}})),s("String.prototype.repeat",(function(e){return e||function(e){var t=O(this,null,"repeat");if(0>e||1342177279<e)throw new RangeError("Invalid count value");e|=0;for(var n="";e;)1&e&&(n+=t),(e>>>=1)&&(t+=t);return n}})),s("Object.values",(function(e){return e||function(e){var t,n=[];for(t in e)N(e,t)&&n.push(e[t]);return n}})),s("Math.log2",(function(e){return e||function(e){return Math.log(e)/Math.LN2}})),s("Object.entries",(function(e){return e||function(e){var t,n=[];for(t in e)N(e,t)&&n.push([t,e[t]]);return n}}));var B=this||self;function z(e,t){var n,i=e.split("."),r=B;i[0]in r||void 0===r.execScript||r.execScript("var "+i[0]);for(;i.length&&(n=i.shift());)i.length||void 0===t?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=t}function H(e){this.i=Math.exp(Math.log(.5)/e),this.h=this.g=0}function G(e,t,n){var i=Math.pow(e.i,t);n=n*(1-i)+i*e.g,isNaN(n)||(e.g=n,e.h+=t)}function j(e){return e.g/(1-Math.pow(e.i,e.h))}function V(){this.h=new H(2),this.i=new H(5),this.g=0}function W(){}function q(){}function X(){}function K(e,t){for(var n=[],i=1;i<arguments.length;++i)n[i-1]=arguments[i];J.has(e)||(J.add(e),X.apply(W,c(n)))}function Y(){}V.prototype.getBandwidthEstimate=function(e){return 128e3>this.g?e:Math.min(j(this.h),j(this.i))};var J=new Set;if(e.console&&e.console.log.bind){var Z={},$=(Z[1]=console.error.bind(console),Z[2]=console.warn.bind(console),Z[3]=console.info.bind(console),Z[4]=console.log.bind(console),Z[5]=console.debug.bind(console),Z[6]=console.debug.bind(console),Z);X=$[2],q=$[1]}function Q(e,t){for(var n=[],i=u(e),r=i.next();!r.done;r=i.next())n.push(t(r.value));return n}var ee=function e(t){var n;return P(e,(function(e){return 1==e.g&&(n=0),3!=e.g?n<t?b(e,n,3):e.v(0):(n++,e.v(2))}))},te=function e(t){var n,i,r,a,o,s;return P(e,(function(e){return 1==e.g&&(n=-1,r=i=void 0,a=u(t),o=a.next()),5!=e.g?o.done?-1==n?e.v(0):b(e,{ha:n,Df:i,item:r,next:void 0},0):(s=o.value,0<=n?b(e,{ha:n,item:r,Df:i,next:s},5):e.v(5)):(n++,i=r,r=s,o=a.next(),e.v(2))}))};function ne(e,t){return!("number"!=typeof e||"number"!=typeof t||!isNaN(e)||!isNaN(t))||e===t}function ie(e,t){var n=e.indexOf(t);-1<n&&e.splice(n,1)}function re(e,t,n){if(n||(n=ne),e.length!=t.length)return!1;t=t.slice();for(var i={},r=(e=u(e)).next();!r.done;i={Tc:i.Tc},r=e.next()){if(i.Tc=r.value,-1==(r=t.findIndex(function(e){return function(t){return n(e.Tc,t)}}(i))))return!1;t[r]=t[t.length-1],t.pop()}return 0==t.length}function ae(e,t,n){if(n||(n=ne),e.length!=t.length)return!1;for(var i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}function oe(e,t,n){this.startTime=e,this.direction=pe,this.endTime=t,this.payload=n,this.region=new _e,this.position=null,this.positionAlign=le,this.size=0,this.textAlign=ue,this.writingMode=fe,this.lineInterpretation=me,this.line=null,this.lineHeight="",this.lineAlign=ge,this.displayAlign=he,this.fontSize=this.border=this.backgroundImage=this.backgroundColor=this.color="",this.fontWeight=be,this.fontStyle=we,this.linePadding=this.letterSpacing=this.fontFamily="",this.opacity=1,this.textDecoration=[],this.wrapLine=!0,this.id="",this.nestedCues=[],this.spacer=this.lineBreak=!1,this.cellResolution={columns:32,rows:15}}function se(e,t){if(e.startTime!=t.startTime||e.endTime!=t.endTime||e.payload!=t.payload)return!1;for(var n in e)if("startTime"!=n&&"endTime"!=n&&"payload"!=n)if("nestedCues"==n){if(!ae(e.nestedCues,t.nestedCues,se))return!1}else if("region"==n||"cellResolution"==n){for(var i in e[n])if(e[n][i]!=t[n][i])return!1}else if(Array.isArray(e[n])){if(!ae(e[n],t[n]))return!1}else if(e[n]!=t[n])return!1;return!0}oe.prototype.clone=function(){var e,t=new oe(0,0,"");for(e in this)t[e]=this[e],t[e]&&t[e].constructor==Array&&(t[e]=t[e].slice());return t},z("shaka.text.Cue",oe);var le="auto";oe.positionAlign={LEFT:"line-left",RIGHT:"line-right",CENTER:"center",AUTO:le};var ue="center",ce={LEFT:"left",RIGHT:"right",CENTER:ue,START:"start",END:"end"};oe.textAlign=ce;var he="after",de={BEFORE:"before",CENTER:"center",AFTER:he};oe.displayAlign=de;var pe="ltr";oe.direction={HORIZONTAL_LEFT_TO_RIGHT:pe,HORIZONTAL_RIGHT_TO_LEFT:"rtl"};var fe="horizontal-tb";oe.writingMode={HORIZONTAL_TOP_TO_BOTTOM:fe,VERTICAL_LEFT_TO_RIGHT:"vertical-lr",VERTICAL_RIGHT_TO_LEFT:"vertical-rl"};var me=0;oe.lineInterpretation={LINE_NUMBER:me,PERCENTAGE:1};var ge="start",ve={CENTER:"center",START:ge,END:"end"};oe.lineAlign=ve;var ye={white:"#FFF",lime:"#0F0",cyan:"#0FF",red:"#F00",yellow:"#FF0",magenta:"#F0F",blue:"#00F",black:"#000"};oe.defaultTextColor=ye;var xe={bg_white:"#FFF",bg_lime:"#0F0",bg_cyan:"#0FF",bg_red:"#F00",bg_yellow:"#FF0",bg_magenta:"#F0F",bg_blue:"#00F",bg_black:"#000"};oe.defaultTextBackgroundColor=xe;var be=400;oe.fontWeight={NORMAL:be,BOLD:700};var we="normal",Me={NORMAL:we,ITALIC:"italic",OBLIQUE:"oblique"};function _e(){this.id="",this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0,this.height=this.width=100,this.viewportAnchorUnits=this.widthUnits=this.heightUnits=Se,this.scroll=Te}oe.fontStyle=Me,oe.textDecoration={UNDERLINE:"underline",LINE_THROUGH:"lineThrough",OVERLINE:"overline"},z("shaka.text.CueRegion",_e);var Se=1;_e.units={PX:0,PERCENTAGE:Se,LINES:2};var Te="";function Ee(){}function Ae(e,t){if(!e&&!t)return!0;if(!e||!t||e.byteLength!=t.byteLength)return!1;if(Ce(e)==Ce(t)&&(e.byteOffset||0)==(t.byteOffset||0))return!0;for(var n=Le(e),i=Le(t),r=u(ee(e.byteLength)),a=r.next();!a.done;a=r.next())if(n[a=a.value]!=i[a])return!1;return!0}function Ce(e){return e instanceof ArrayBuffer?e:e.buffer}function Re(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}function Le(e,t,n){return Pe(e,void 0===t?0:t,n=void 0===n?1/0:n,Uint8Array)}function Ie(e,t,n){return Pe(e,void 0===t?0:t,n=void 0===n?1/0:n,DataView)}function Pe(e,t,n,i){var r=(e.byteOffset||0)+e.byteLength;return t=Math.max(0,Math.min((e.byteOffset||0)+t,r)),new i(Ce(e),t,Math.min(t+Math.max(n,0),r)-t)}function De(e,t){this.g=e,this.h=t}function Ne(e,t){var n=new De(4,0),i=Ue,r=i.g,a=n.h-r.h;(0<(n.g-r.g||a)?i.i:i.h)(i.g,n,e,t)}function ke(e,t,n,i){X([n,"has been deprecated and will be removed in",t,". We are currently at version",e,". Additional information:",i].join(" "))}function Oe(e,t,n,i){q([n,"has been deprecated and has been removed in",t,". We are now at version",e,". Additional information:",i].join(""))}_e.scrollMode={NONE:Te,UP:"up"},z("shaka.util.BufferUtils",Ee),Ee.toDataView=Ie,Ee.toUint8=Le,Ee.toArrayBuffer=Re,Ee.equal=Ae,De.prototype.toString=function(){return"v"+this.g+"."+this.h};var Ue=null;function Fe(e,t){return e.concat(t)}function Be(){}function ze(e){return null!=e}function He(e){var t=Object.create(e.prototype||Object.prototype);try{var n=e.call(t);n||(Ne("Factories requiring new","Factories should be plain functions"),n=t)}catch(t){Ne("Factories requiring new","Factories should be plain functions"),n=new e}return n}function Ge(){}z("shaka.dependencies",Ge),Ge.has=function(e){return Ve.has(e)},Ge.add=function(e,t){if(!je[e])throw Error(e+" is not supported");Ve.set(e,(function(){return t}))};var je={muxjs:"muxjs"};Ge.Allowed=je;var Ve=new Map([["muxjs",function(){return e.muxjs}]]);function We(e,t,n,i){for(var r=[],a=3;a<arguments.length;++a)r[a-3]=arguments[a];this.severity=e,this.category=t,this.code=n,this.data=r,this.handled=!1}We.prototype.toString=function(){return"shaka.util.Error "+JSON.stringify(this,null,"  ")},z("shaka.util.Error",We),We.Severity={RECOVERABLE:1,CRITICAL:2},We.Category={NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9,ADS:10},We.Code={UNSUPPORTED_SCHEME:1e3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,ATTEMPTS_EXHAUSTED:1010,INVALID_TEXT_HEADER:2e3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,INVALID_MP4_CEA:2010,TEXT_COULD_NOT_GUESS_MIME_TYPE:2011,CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS:2012,TEXT_ONLY_WEBVTT_SRC_EQUALS:2013,MISSING_TEXT_PLUGIN:2014,BUFFER_READ_OUT_OF_BOUNDS:3e3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,CONTENT_TRANSFORMATION_FAILED:3019,UNABLE_TO_GUESS_MANIFEST_TYPE:4e3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,RESTRICTIONS_CANNOT_BE_MET:4012,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,HLS_INTERNAL_SKIP_STREAM:4035,NO_VARIANTS:4036,PERIOD_FLATTENING_FAILED:4037,INCONSISTENT_DRM_ACROSS_PERIODS:4038,HLS_VARIABLE_NOT_FOUND:4039,STREAMING_ENGINE_STARTUP_INVALID_STATE:5006,NO_RECOGNIZED_KEY_SYSTEMS:6e3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,SERVER_CERTIFICATE_REQUIRED:6015,INIT_DATA_TRANSFORM_ERROR:6016,SERVER_CERTIFICATE_REQUEST_FAILED:6017,LOAD_INTERRUPTED:7e3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,OBJECT_DESTROYED:7003,CONTENT_NOT_LOADED:7004,CAST_API_UNAVAILABLE:8e3,NO_CAST_RECEIVERS:8001,ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9e3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013,STORAGE_LIMIT_REACHED:9014,DOWNLOAD_SIZE_CALLBACK_ERROR:9015,CS_IMA_SDK_MISSING:1e4,CS_AD_MANAGER_NOT_INITIALIZED:10001,SS_IMA_SDK_MISSING:10002,SS_AD_MANAGER_NOT_INITIALIZED:10003,CURRENT_DAI_REQUEST_NOT_FINISHED:10004};var qe=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function Xe(e){var t;e instanceof Xe?(Ke(this,e.Da),this.qb=e.qb,this.Ga=e.Ga,Ye(this,e.Eb),this.xa=e.xa,Je(this,e.g.clone()),this.fb=e.fb):e&&(t=String(e).match(qe))?(Ke(this,t[1]||"",!0),this.qb=Ze(t[2]||""),this.Ga=Ze(t[3]||"",!0),Ye(this,t[4]),this.xa=Ze(t[5]||"",!0),Je(this,t[6]||"",!0),this.fb=Ze(t[7]||"")):this.g=new at(null)}function Ke(e,t,n){e.Da=n?Ze(t,!0):t,e.Da&&(e.Da=e.Da.replace(/:$/,""))}function Ye(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.Eb=t}else e.Eb=null}function Je(e,t,n){t instanceof at?e.g=t:(n||(t=$e(t,it)),e.g=new at(t))}function Ze(e,t){return e?t?decodeURI(e):decodeURIComponent(e):""}function $e(e,t,n){return null!=e?(e=encodeURI(e).replace(t,Qe),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Qe(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}(i=Xe.prototype).Da="",i.qb="",i.Ga="",i.Eb=null,i.xa="",i.fb="",i.toString=function(){var e=[],t=this.Da;if(t&&e.push($e(t,et,!0),":"),t=this.Ga){e.push("//");var n=this.qb;n&&e.push($e(n,et,!0),"@"),e.push(encodeURIComponent(t).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.Eb)&&e.push(":",String(t))}return(t=this.xa)&&(this.Ga&&"/"!=t.charAt(0)&&e.push("/"),e.push($e(t,"/"==t.charAt(0)?nt:tt,!0))),(t=this.g.toString())&&e.push("?",t),(t=this.fb)&&e.push("#",$e(t,rt)),e.join("")},i.resolve=function(e){var t=this.clone();"data"===t.Da&&(t=new Xe);var n=!!e.Da;n?Ke(t,e.Da):n=!!e.qb,n?t.qb=e.qb:n=!!e.Ga,n?t.Ga=e.Ga:n=null!=e.Eb;var i=e.xa;if(n)Ye(t,e.Eb);else if(n=!!e.xa){if("/"!=i.charAt(0))if(this.Ga&&!this.xa)i="/"+i;else{var r=t.xa.lastIndexOf("/");-1!=r&&(i=t.xa.substr(0,r+1)+i)}if(".."==i||"."==i)i="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var a=[],o=0;o<i.length;){var s=i[o++];"."==s?r&&o==i.length&&a.push(""):".."==s?((1<a.length||1==a.length&&""!=a[0])&&a.pop(),r&&o==i.length&&a.push("")):(a.push(s),r=!0)}i=a.join("/")}}return n?t.xa=i:n=""!==e.g.toString(),n?Je(t,e.g.clone()):n=!!e.fb,n&&(t.fb=e.fb),t},i.clone=function(){return new Xe(this)};var et=/[#\/\?@]/g,tt=/[#\?:]/g,nt=/[#\?]/g,it=/[#\?@]/g,rt=/#/g;function at(e){this.g=e||null}function ot(e,t){if(0==t.length)return e;var n=t.map((function(e){return new Xe(e)}));return e.map((function(e){return new Xe(e)})).map((function(e){return n.map((function(t){return e.resolve(t)}))})).reduce(Fe,[]).map((function(e){return e.toString()}))}function st(e,t){return{keySystem:e,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:t||[],keyIds:new Set}}function lt(e,t){if(1==t.length)return t[0];var n=ut(e,t);if(null!=n)return n;throw new We(2,4,4025,t)}function ut(e,t){for(var n=u(dt[e]),i=n.next();!i.done;i=n.next()){i=i.value;for(var r=u(t),a=r.next();!a.done;a=r.next())if(a=a.value,i.test(a.trim()))return a.trim()}return e==ct?"":null}(i=at.prototype).ua=null,i.vc=null,i.add=function(e,t){if(!this.ua&&(this.ua={},this.vc=0,this.g))for(var n=this.g.split("&"),i=0;i<n.length;i++){var r=n[i].indexOf("="),a=null;if(0<=r){var o=n[i].substring(0,r);a=n[i].substring(r+1)}else o=n[i];o=decodeURIComponent(o.replace(/\+/g," ")),a=a||"",this.add(o,decodeURIComponent(a.replace(/\+/g," ")))}return this.g=null,(n=this.ua.hasOwnProperty(e)&&this.ua[e])||(this.ua[e]=n=[]),n.push(t),this.vc++,this},i.toString=function(){if(this.g)return this.g;if(!this.ua)return"";var e,t=[];for(e in this.ua)for(var n=encodeURIComponent(e),i=this.ua[e],r=0;r<i.length;r++){var a=n;""!==i[r]&&(a+="="+encodeURIComponent(i[r])),t.push(a)}return this.g=t.join("&")},i.clone=function(){var e=new at;if(e.g=this.g,this.ua){var t,n={};for(t in this.ua)n[t]=this.ua[t].concat();e.ua=n,e.vc=this.vc}return e};var ct="text",ht={Na:"video",bb:"audio",aa:ct,Mb:"image",$f:"application"},dt={audio:[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/]};function pt(){var e,t,n=new Promise((function(n,i){e=n,t=i}));return n.resolve=e,n.reject=t,n}function ft(e){this.h=e,this.g=void 0}function mt(){}function gt(e){return e?(239==(e=Le(e))[0]&&187==e[1]&&191==e[2]&&(e=e.subarray(3)),(e=(new TextDecoder).decode(e)).includes("ï¿½")&&q('Decoded string contains an "unknown character" codepoint.  That probably means the UTF8 encoding was incorrect!'),e):""}function vt(e,t,n){if(!e)return"";if(!n&&0!=e.byteLength%2)throw new We(2,2,2004);var i=Math.floor(e.byteLength/2);n=new Uint16Array(i),e=Ie(e);for(var r=(i=u(ee(i))).next();!r.done;r=i.next())n[r=r.value]=e.getUint16(2*r,t);return wt.value()(n)}function yt(e){function t(e){return n.byteLength<=e||32<=n[e]&&126>=n[e]}if(!e)return"";var n=Le(e);if(239==n[0]&&187==n[1]&&191==n[2])return gt(n);if(254==n[0]&&255==n[1])return vt(n.subarray(2),!1);if(255==n[0]&&254==n[1])return vt(n.subarray(2),!0);if(0==n[0]&&0==n[2])return vt(e,!1);if(0==n[1]&&0==n[3])return vt(e,!0);if(t(0)&&t(1)&&t(2)&&t(3))return gt(e);throw new We(2,2,2003)}function xt(e){return Re((new TextEncoder).encode(e))}function bt(e,t){for(var n=new ArrayBuffer(2*e.length),i=new DataView(n),r=u(te(e)),a=r.next();!a.done;a=r.next())a=a.value,i.setUint16(2*a.ha,a.item.charCodeAt(0),t);return n}pt.prototype.resolve=function(){},pt.prototype.reject=function(){},ft.prototype.value=function(){return null==this.g&&(this.g=this.h()),this.g},z("shaka.util.StringUtils",mt),mt.resetFromCharCode=function(){wt.g=void 0},mt.toUTF16=bt,mt.toUTF8=xt,mt.fromBytesAutoDetect=yt,mt.fromUTF16=vt,mt.fromUTF8=gt;var wt=new ft((function(){function e(e){try{var t=new Uint8Array(e);return 0<String.fromCharCode.apply(null,t).length}catch(e){return!1}}for(var t={Ua:65536};0<t.Ua;(t={Ua:t.Ua}).Ua/=2)if(e(t.Ua))return function(e){return function(t){for(var n="",i=0;i<t.length;i+=e.Ua)n+=String.fromCharCode.apply(null,t.subarray(i,i+e.Ua));return n}}(t);return null}));function Mt(){}function _t(e){return e=Le(e),e=wt.value()(e),btoa(e)}function St(e,t){t=null==t||t;var n=_t(e).replace(/\+/g,"-").replace(/\//g,"_");return t?n:n.replace(/[=]*$/,"")}function Tt(t){var n=e.atob(t.replace(/-/g,"+").replace(/_/g,"/"));t=new Uint8Array(n.length);for(var i=(n=u(te(n))).next();!i.done;i=n.next())t[(i=i.value).ha]=i.item.charCodeAt(0);return t}function Et(t){for(var n=t.length/2,i=new Uint8Array(n),r=(n=u(ee(n))).next();!r.done;r=n.next())i[r=r.value]=e.parseInt(t.substr(2*r,2),16);return i}function At(e){var t=Le(e);e="";for(var n=(t=u(t)).next();!n.done;n=t.next())1==(n=(n=n.value).toString(16)).length&&(n="0"+n),e+=n;return e}function Ct(e){for(var t=[],n=0;n<arguments.length;++n)t[n]=arguments[n];var i=0,r=u(t);for(n=r.next();!n.done;n=r.next())i+=n.value.byteLength;for(i=new Uint8Array(i),r=0,n=(t=u(t)).next();!n.done;n=t.next())n=n.value,i.set(Le(n),r),r+=n.byteLength;return i}function Rt(){var e=this;this.s=Ve.get("muxjs")(),this.g=new this.s.mp4.Transmuxer({keepOriginalTimestamps:!0}),this.h=null,this.m=[],this.j=[],this.i=[],this.l=!1,this.g.on("data",(function(t){e.j=t.captions,e.i=t.metadata,e.m.push(Ct(t.initSegment,t.data))})),this.g.on("done",(function(){var t={data:Ct.apply(Mt,c(e.m)),captions:e.j,metadata:e.i};e.h.resolve(t),e.l=!1}))}function Lt(e,t){if(!Ve.get("muxjs")()||!It(e))return!1;if(t)return MediaSource.isTypeSupported(Pt(t,e));var n=Pt("audio",e),i=Pt("video",e);return MediaSource.isTypeSupported(n)||MediaSource.isTypeSupported(i)}function It(e){return"mp2t"==e.toLowerCase().split(";")[0].split("/")[1]}function Pt(e,t){var n=t.replace(/mp2t/i,"mp4");"audio"==e&&(n=n.replace("video","audio"));var i=/avc1\.(66|77|100)\.(\d+)/.exec(n);if(i){var r="avc1.",a=i[1],o=Number(i[2]);r=("66"==a?r+"4200":"77"==a?r+"4d00":r+"6400")+(o>>4).toString(16),r+=(15&o).toString(16),n=n.replace(i[0],r)}return n}function Dt(e,t){var n=e;return t&&(n+='; codecs="'+t+'"'),n}function Nt(e,t,n){return e=Dt(e,t),Ve.get("muxjs")()&&It(e)?Pt(n,e):e}function kt(e){var t=(e=e.split("."))[0];return e.pop(),t}function Ot(e){return(e=e.split(/ *; */)).shift(),(e=e.find((function(e){return e.startsWith("codecs=")})))?e.split("=")[1].replace(/^"|"$/g,""):""}function Ut(e){this.s=null,this.i=e,this.j=this.D=0,this.l=1/0,this.h=this.g=null,this.u="",this.m=new Map}function Ft(e){return!(!Ht[e]&&"application/cea-608"!=e&&"application/cea-708"!=e)}function Bt(e,t,n){if(e.u=t,t=e.m.get(t))for(var i=u(t.keys()),r=i.next();!r.done;r=i.next())(r=t.get(r.value).filter((function(e){return e.endTime<=n})))&&e.i.append(r)}function zt(e,t,n,i,r){for(var a=n+" "+i,o=new Map,s=(t=u(t)).next();!s.done;s=t.next()){var l=s.value;s=l.stream,l=l.cue,o.has(s)||o.set(s,new Map),o.get(s).has(a)||o.get(s).set(a,[]),l.startTime+=r,l.endTime+=r,l.startTime>=e.j&&l.startTime<e.l&&(o.get(s).get(a).push(l),s==e.u&&e.i.append([l]))}for(a=(r=u(o.keys())).next();!a.done;a=r.next())for(a=a.value,e.m.has(a)||e.m.set(a,new Map),s=(t=u(o.get(a).keys())).next();!s.done;s=t.next())s=s.value,l=o.get(a).get(s),e.m.get(a).set(s,l);e.g=null==e.g?Math.max(n,e.j):Math.min(e.g,Math.max(n,e.j)),e.h=Math.max(e.h,Math.min(i,e.l))}z("shaka.util.Uint8ArrayUtils",Mt),Mt.concat=Ct,Mt.toHex=At,Mt.fromHex=Et,Mt.fromBase64=Tt,Mt.toBase64=St,Mt.toStandardBase64=_t,Mt.equal=function(e,t){return Ne("shaka.util.Uint8ArrayUtils.equal","Please use shaka.util.BufferUtils.equal instead."),Ae(e,t)},Rt.prototype.destroy=function(){return this.g.dispose(),this.g=null,Promise.resolve()},(new Map).set("codecs","codecs").set("frameRate","framerate").set("bandwidth","bitrate").set("width","width").set("height","height").set("channelsCount","channels"),Ut.prototype.destroy=function(){return this.i=this.s=null,this.m.clear(),Promise.resolve()},Ut.prototype.remove=function(e,t){var n=this;return D((function(i){if(1==i.g)return b(i,Promise.resolve(),2);!n.i||!n.i.remove(e,t)||null==n.g||t<=n.g||e>=n.h||(e<=n.g&&t>=n.h?n.g=n.h=null:e<=n.g&&t<n.h?n.g=t:e>n.g&&t>=n.h&&(n.h=e)),w(i)}))},z("shaka.text.TextEngine",Ut),Ut.prototype.destroy=Ut.prototype.destroy,Ut.findParser=function(e){return Ht[e]},Ut.unregisterParser=function(e){delete Ht[e]},Ut.registerParser=function(e,t){Ht[e]=t};var Ht={};function Gt(e,t){return e=Wt(e),t=Wt(t),e.split("-")[0]==t.split("-")[0]}function jt(e,t){e=Wt(e),t=Wt(t);var n=e.split("-"),i=t.split("-");return n[0]==i[0]&&1==n.length&&2==i.length}function Vt(e,t){e=Wt(e),t=Wt(t);var n=e.split("-"),i=t.split("-");return 2==n.length&&2==i.length&&n[0]==i[0]}function Wt(e){var t=e.split("-");return e=t[0]||"",t=t[1]||"",e=e.toLowerCase(),e=Yt.get(e)||e,(t=t.toUpperCase())?e+"-"+t:e}function qt(e,t){return e=Wt(e),(t=Wt(t))==e?4:jt(t,e)?3:Vt(t,e)?2:jt(e,t)?1:0}function Xt(e){return e.language?Wt(e.language):e.audio&&e.audio.language?Wt(e.audio.language):e.video&&e.video.language?Wt(e.video.language):"und"}function Kt(e,t){for(var n=Wt(e),i=new Set,r=u(t),a=r.next();!a.done;a=r.next())i.add(Wt(a.value));for(a=(r=u(i)).next();!a.done;a=r.next())if((a=a.value)==n)return a;for(a=(r=u(i)).next();!a.done;a=r.next())if(jt(a=a.value,n))return a;for(a=(r=u(i)).next();!a.done;a=r.next())if(Vt(a=a.value,n))return a;for(a=(i=u(i)).next();!a.done;a=i.next())if(jt(n,a=a.value))return a;return null}var Yt=new Map([["aar","aa"],["abk","ab"],["afr","af"],["aka","ak"],["alb","sq"],["amh","am"],["ara","ar"],["arg","an"],["arm","hy"],["asm","as"],["ava","av"],["ave","ae"],["aym","ay"],["aze","az"],["bak","ba"],["bam","bm"],["baq","eu"],["bel","be"],["ben","bn"],["bih","bh"],["bis","bi"],["bod","bo"],["bos","bs"],["bre","br"],["bul","bg"],["bur","my"],["cat","ca"],["ces","cs"],["cha","ch"],["che","ce"],["chi","zh"],["chu","cu"],["chv","cv"],["cor","kw"],["cos","co"],["cre","cr"],["cym","cy"],["cze","cs"],["dan","da"],["deu","de"],["div","dv"],["dut","nl"],["dzo","dz"],["ell","el"],["eng","en"],["epo","eo"],["est","et"],["eus","eu"],["ewe","ee"],["fao","fo"],["fas","fa"],["fij","fj"],["fin","fi"],["fra","fr"],["fre","fr"],["fry","fy"],["ful","ff"],["geo","ka"],["ger","de"],["gla","gd"],["gle","ga"],["glg","gl"],["glv","gv"],["gre","el"],["grn","gn"],["guj","gu"],["hat","ht"],["hau","ha"],["heb","he"],["her","hz"],["hin","hi"],["hmo","ho"],["hrv","hr"],["hun","hu"],["hye","hy"],["ibo","ig"],["ice","is"],["ido","io"],["iii","ii"],["iku","iu"],["ile","ie"],["ina","ia"],["ind","id"],["ipk","ik"],["isl","is"],["ita","it"],["jav","jv"],["jpn","ja"],["kal","kl"],["kan","kn"],["kas","ks"],["kat","ka"],["kau","kr"],["kaz","kk"],["khm","km"],["kik","ki"],["kin","rw"],["kir","ky"],["kom","kv"],["kon","kg"],["kor","ko"],["kua","kj"],["kur","ku"],["lao","lo"],["lat","la"],["lav","lv"],["lim","li"],["lin","ln"],["lit","lt"],["ltz","lb"],["lub","lu"],["lug","lg"],["mac","mk"],["mah","mh"],["mal","ml"],["mao","mi"],["mar","mr"],["may","ms"],["mkd","mk"],["mlg","mg"],["mlt","mt"],["mon","mn"],["mri","mi"],["msa","ms"],["mya","my"],["nau","na"],["nav","nv"],["nbl","nr"],["nde","nd"],["ndo","ng"],["nep","ne"],["nld","nl"],["nno","nn"],["nob","nb"],["nor","no"],["nya","ny"],["oci","oc"],["oji","oj"],["ori","or"],["orm","om"],["oss","os"],["pan","pa"],["per","fa"],["pli","pi"],["pol","pl"],["por","pt"],["pus","ps"],["que","qu"],["roh","rm"],["ron","ro"],["rum","ro"],["run","rn"],["rus","ru"],["sag","sg"],["san","sa"],["sin","si"],["slk","sk"],["slo","sk"],["slv","sl"],["sme","se"],["smo","sm"],["sna","sn"],["snd","sd"],["som","so"],["sot","st"],["spa","es"],["sqi","sq"],["srd","sc"],["srp","sr"],["ssw","ss"],["sun","su"],["swa","sw"],["swe","sv"],["tah","ty"],["tam","ta"],["tat","tt"],["tel","te"],["tgk","tg"],["tgl","tl"],["tha","th"],["tib","bo"],["tir","ti"],["ton","to"],["tsn","tn"],["tso","ts"],["tuk","tk"],["tur","tr"],["twi","tw"],["uig","ug"],["ukr","uk"],["urd","ur"],["uzb","uz"],["ven","ve"],["vie","vi"],["vol","vo"],["wel","cy"],["wln","wa"],["wol","wo"],["xho","xh"],["yid","yi"],["yor","yo"],["zha","za"],["zho","zh"],["zul","zu"]]);function Jt(){this.g={}}function Zt(e,t){for(var n in e.g)t(n,e.g[n])}function $t(e){this.h=e,this.g=null}function Qt(e){this.h=e,this.g=null}function en(){return!(!e.MediaSource||!MediaSource.isTypeSupported)}function tn(e){return""!=ln().canPlayType(e)}function nn(){return sn("Tizen")}function rn(){return sn("CrKey")}function an(){return!!navigator.vendor&&navigator.vendor.includes("Apple")&&!nn()}function on(){if(!an())return null;var e=navigator.userAgent.match(/Version\/(\d+)/);return e||(e=navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))?parseInt(e[1],10):null}function sn(e){return(navigator.userAgent||"").includes(e)}function ln(){return cn||(un||(un=new Qt((function(){cn=null}))),(cn=document.getElementsByTagName("video")[0]||document.getElementsByTagName("audio")[0])||(cn=document.createElement("video")),un.S(1),cn)}(i=Jt.prototype).push=function(e,t){this.g.hasOwnProperty(e)?this.g[e].push(t):this.g[e]=[t]},i.get=function(e){return(e=this.g[e])?e.slice():null},i.remove=function(e,t){e in this.g&&(this.g[e]=this.g[e].filter((function(e){return e!=t})),0==this.g[e].length&&delete this.g[e])},i.size=function(){return Object.keys(this.g).length},i.keys=function(){return Object.keys(this.g)},$t.prototype.S=function(t){var n=this;this.stop();var i=!0,r=null;return this.g=function(){e.clearTimeout(r),i=!1},r=e.setTimeout((function(){i&&n.h()}),1e3*t),this},$t.prototype.stop=function(){this.g&&(this.g(),this.g=null)},Qt.prototype.Hb=function(){return this.stop(),this.h(),this},Qt.prototype.S=function(e){var t=this;return this.stop(),this.g=new $t((function(){t.h()})).S(e),this},Qt.prototype.Ba=function(e){var t=this;return this.stop(),this.g=new $t((function(){t.g.S(e),t.h()})).S(e),this},Qt.prototype.stop=function(){this.g&&(this.g.stop(),this.g=null)},z("shaka.util.Timer",Qt),Qt.prototype.stop=Qt.prototype.stop,Qt.prototype.tickEvery=Qt.prototype.Ba,Qt.prototype.tickAfter=Qt.prototype.S,Qt.prototype.tickNow=Qt.prototype.Hb;var un=null,cn=null;function hn(e,t,n,i,r){var a=e.variants;(t.length||n.length)&&(a=function(e,t,n){for(var i={},r=(t=u(t)).next();!r.done;i={ed:i.ed},r=t.next())if(i.ed=r.value,(r=e.filter(function(e){return function(t){return t.video&&t.video.codecs.startsWith(e.ed)}}(i))).length){e=r;break}for(i={},t=(n=u(n)).next();!t.done;i={Qc:i.Qc},t=n.next())if(i.Qc=t.value,(t=e.filter(function(e){return function(t){return t.audio&&t.audio.codecs.startsWith(e.Qc)}}(i))).length){e=t;break}return e}(a,t,n));var o=function(e,t){for(var n=u(t),i=n.next();!i.done;i=n.next())if((i=i.value)==Nn||i==kn){if(1==(e=dn(e,i)).size())return e.keys()[0]}else if(i==On)break;return function(e){var t="",n=1/0;return Zt(e,(function(e,i){for(var r=0,a=0,o=u(i),s=o.next();!s.done;s=o.next())r+=s.value.bandwidth||0,++a;(r/=a)<n&&(t=e,n=r)})),t}(e)}(t=function(e){var t=0,n=new Map,i=e.size();return Zt(e,(function(e,r){for(var a=u(r),o=a.next();!o.done;o=a.next()){var s=(o=o.value).video;if(s&&s.width&&s.height){s=s.width*s.height*(s.frameRate||1),n.has(s)||n.set(s,new Jt);var l=n.get(s);l.push(e,o),l.size()===i&&(t=Math.max(t,s))}}})),t?n.get(t):e}(t=function(e){for(var t=new Jt,n=(e=u(e)).next();!n.done;n=e.next()){var i=pn(n=n.value);t.push(i,n)}return t}(a=Cn(a,i))),r);e.variants=e.variants.filter((function(e){return pn(e)==o}))}function dn(e,t){var n=0,i=new Jt;return Zt(e,(function(e,r){for(var a=0,o=0,s=u(r),l=s.next();!l.done;l=s.next())(l=l.value).decodingInfos.length&&(a+=l.decodingInfos[0][t]?1:0,o++);(a/=o)>n?(i.g={},i.push(e,r),n=a):a==n&&i.push(e,r)})),i}function pn(e){var t="";e.video&&(t=kt(e.video.codecs));var n="";return e.audio&&(n=kt(e.audio.codecs)),t+"-"+n}function fn(e,t,n){function i(e,t,n){return e>=t&&e<=n}var r=e.video;return!(r&&r.width&&r.height&&(!i(r.width,t.minWidth,Math.min(t.maxWidth,n.width))||!i(r.height,t.minHeight,Math.min(t.maxHeight,n.height))||!i(r.width*r.height,t.minPixels,t.maxPixels))||e&&e.video&&e.video.frameRate&&!i(e.video.frameRate,t.minFrameRate,t.maxFrameRate)||!i(e.bandwidth,t.minBandwidth,t.maxBandwidth))}function mn(e,t){return D((function(n){if(1==n.g)return b(n,gn(e.variants,t),2);e.variants=e.variants.filter((function(e){var t=e.video;return sn("Xbox One")&&t&&(t.width&&1920<t.width||t.height&&1080<t.height)&&t.codecs.includes("avc1.")?(In(e),!1):((t=e.decodingInfos.some((function(e){return e.supported})))||In(e),t)})),w(n)}))}function gn(e,t){var n,i,r,a,o,s,l,c,h,d;return D((function(p){if(e.some((function(e){return e.decodingInfos.length})))return p.return();for(n=navigator.mediaCapabilities,i=[],r=function(e,t){var i;return D((function(r){return 1==r.g?(M(r,2),b(r,n.decodingInfo(t),4)):2!=r.g?(i=r.h,e.decodingInfos.push(i),S(r,0)):(T(r),JSON.stringify(t),void w(r))}))},a=u(e),o=a.next();!o.done;o=a.next())for(s=o.value,l=vn(s,t),c=u(l),h=c.next();!h.done;h=c.next())d=h.value,i.push(r(s,d));return b(p,Promise.all(i),0)}))}function vn(e,t){var n=e.audio,i=e.video,r={type:"media-source"};if(i){var a=i.codecs;if(i.codecs.includes(",")){var o=i.codecs.split(",");a="vp9"==(a=lt("video",o))?"vp09.00.10.08":a,o=lt("audio",o),o=Nt(i.mimeType,o,"audio"),r.audio={contentType:o,channels:2,bitrate:e.bandwidth||1,samplerate:1,spatialRendering:!1}}a=Nt(i.mimeType,"vp9"==a?"vp09.00.10.08":a,"video"),r.video={contentType:a,width:i.width||1,height:i.height||1,bitrate:i.bandwidth||e.bandwidth||1,framerate:i.frameRate||1}}n&&(a="ac-3"==n.codecs.toLowerCase()&&nn()?"ec-3":n.codecs,a=Nt(n.mimeType,a,"audio"),r.audio={contentType:a,channels:n.channelsCount||2,bitrate:n.bandwidth||e.bandwidth||1,samplerate:n.audioSamplingRate||1,spatialRendering:n.spatialAudio});var s=(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[]);if(!s.length)return[r];a=[],o=new Map;for(var l=(s=u(s)).next();!l.done;l=s.next()){var c=l.value;o.get(c.keySystem)||o.set(c.keySystem,[]),o.get(c.keySystem).push(c)}s=t?"required":"optional",c=t?["persistent-license"]:["temporary"];for(var h=u(o.keys()),d=h.next();!d.done;d=h.next()){var p=d.value;d=Object.assign({},r);var f=o.get(p);for(p={keySystem:p,initDataType:"cenc",persistentState:s,distinctiveIdentifier:"optional",sessionTypes:c},l=(f=u(f)).next();!l.done;l=f.next()){if((l=l.value).initData&&l.initData.length){for(var m=new Set,g=u(l.initData),v=g.next();!v.done;v=g.next())m.add(v.value.initDataType);p.initDataType=l.initData[0].initDataType}l.distinctiveIdentifierRequired&&(p.distinctiveIdentifier="required"),l.persistentStateRequired&&(p.persistentState="required"),l.sessionType&&(p.sessionTypes=[l.sessionType]),n&&(p.audio?p.audio.robustness=p.audio.robustness||l.audioRobustness:p.audio={robustness:l.audioRobustness}),i&&(p.video?p.video.robustness=p.video.robustness||l.videoRobustness:p.video={robustness:l.videoRobustness})}d.keySystemConfiguration=p,a.push(d)}return a}function yn(e,t){t.variants=t.variants.filter((function(t){var n=t.audio;return t=t.video,!(n&&e&&e.audio&&!xn(n,e.audio)||t&&e&&e.video&&!xn(t,e.video))}))}function xn(e,t){return e.mimeType==t.mimeType&&e.codecs.split(".")[0]==t.codecs.split(".")[0]}function bn(e){var t=e.audio,n=e.video,i=t?t.codecs:null,r=n?n.codecs:null,a=[];r&&a.push(r),i&&a.push(i);var o=[];n&&o.push(n.mimeType),t&&o.push(t.mimeType),o=o[0]||null;var s=[];t&&s.push(t.kind),n&&s.push(n.kind),s=s[0]||null;var l=new Set;if(t)for(var c=u(t.roles),h=c.next();!h.done;h=c.next())l.add(h.value);if(n)for(h=(c=u(n.roles)).next();!h.done;h=c.next())l.add(h.value);return e={id:e.id,active:!1,type:"variant",bandwidth:e.bandwidth,language:e.language,label:null,kind:s,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:o,codecs:a.join(", "),audioCodec:i,videoCodec:r,primary:e.primary,roles:Array.from(l),audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null},n&&(e.videoId=n.id,e.originalVideoId=n.originalId,e.width=n.width||null,e.height=n.height||null,e.frameRate=n.frameRate||null,e.pixelAspectRatio=n.pixelAspectRatio||null,e.videoBandwidth=n.bandwidth||null),t&&(e.audioId=t.id,e.originalAudioId=t.originalId,e.channelsCount=t.channelsCount,e.audioSamplingRate=t.audioSamplingRate,e.audioBandwidth=t.bandwidth||null,e.label=t.label,e.audioRoles=t.roles),e}function wn(e){return{id:e.id,active:!1,type:ct,bandwidth:0,language:e.language,label:e.label,kind:e.kind||null,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:e.mimeType,codecs:e.codecs||null,audioCodec:null,videoCodec:null,primary:e.primary,roles:e.roles,audioRoles:null,forced:e.forced,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:e.originalId,originalImageId:null}}function Mn(e){return{id:e.id,active:!1,type:"image",bandwidth:e.bandwidth||0,language:"",label:null,kind:null,width:e.width||null,height:e.height||null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:e.mimeType,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,forced:!1,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:e.tilesLayout||null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:e.originalId}}function _n(e){return e.__shaka_id||(e.__shaka_id=Dn++),e.__shaka_id}function Sn(e){var t=En(e);return t.active="disabled"!=e.mode,t.type="text",t.originalTextId=e.id,"captions"==e.kind&&(t.mimeType="application/cea-608"),e.kind&&(t.roles=[e.kind]),"forced"==e.kind&&(t.forced=!0),t}function Tn(e){var t=En(e);return t.active=e.enabled,t.type="variant",t.originalAudioId=e.id,"main"==e.kind&&(t.primary=!0),e.kind&&(t.roles=[e.kind],t.audioRoles=[e.kind],t.label=e.label),t}function En(e){return{id:_n(e),active:!1,type:"",bandwidth:0,language:Wt(e.language),label:e.label,kind:e.kind,width:null,height:null,frameRate:null,pixelAspectRatio:null,hdr:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],forced:!1,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,tilesLayout:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,originalImageId:null}}function An(e){return e.allowedByApplication&&e.allowedByKeySystem}function Cn(e,t){for(var n=e.filter((function(e){return e.audio&&e.audio.channelsCount})),i=new Map,r=(n=u(n)).next();!r.done;r=n.next()){var a=(r=r.value).audio.channelsCount;i.has(a)||i.set(a,[]),i.get(a).push(r)}return 0==(n=Array.from(i.keys())).length?e:(r=n.filter((function(e){return e<=t}))).length?i.get(Math.max.apply(Math,c(r))):i.get(Math.min.apply(Math,c(n)))}function Rn(e,t,n,i){var r=e,a=e.filter((function(e){return e.primary}));a.length&&(r=a);var o=r.length?r[0].language:"";if(r=r.filter((function(e){return e.language==o})),t){var s=Kt(Wt(t),e.map((function(e){return e.language})));s&&(r=e.filter((function(e){return Wt(e.language)==s})))}if(r=r.filter((function(e){return e.forced==i})),n){if((e=Ln(r,n)).length)return e}else if((e=r.filter((function(e){return 0==e.roles.length}))).length)return e;return(e=r.map((function(e){return e.roles})).reduce(Fe,[])).length?Ln(r,e[0]):r}function Ln(e,t){return e.filter((function(e){return e.roles.includes(t)}))}function In(e){var t=[];return e.audio&&t.push(Pn(e.audio)),e.video&&t.push(Pn(e.video)),t.join(", ")}function Pn(e){return"audio"==e.type?"type=audio codecs="+e.codecs+" bandwidth="+e.bandwidth+" channelsCount="+e.channelsCount+" audioSamplingRate="+e.audioSamplingRate:"video"==e.type?"type=video codecs="+e.codecs+" bandwidth="+e.bandwidth+" frameRate="+e.frameRate+" width="+e.width+" height="+e.height:"unexpected stream type"}var Dn=0,Nn="smooth",kn="powerEfficient",On="bandwidth";function Un(){var e=this;this.j=null,this.i=!1,this.g=new V,navigator.connection&&navigator.connection.addEventListener("change",(function(){if(e.o.useNetworkInformation&&e.i){e.g=new V;var t=e.chooseVariant();t&&e.j(t)}})),this.h=[],this.m=1,this.s=!1,this.o=this.l=null}function Fn(e){var t=e.o.defaultBandwidthEstimate;return navigator.connection&&navigator.connection.downlink&&e.o.useNetworkInformation&&(t=1e6*navigator.connection.downlink),t}function Bn(e,t){return e&&(t=t.filter((function(t){return fn(t,e,{width:1/0,height:1/0})}))),t.sort((function(e,t){return e.bandwidth-t.bandwidth}))}function zn(e,t){this.h=e,this.g=new Set([e]);for(var n=u(t=t||[]),i=n.next();!i.done;i=n.next())this.add(i.value)}function Hn(e,t){var n;if(!(n=!!e.audio!=!!t.audio||!!e.video!=!!t.video||e.language!=t.language)&&(n=e.audio&&t.audio)){n=e.audio;var i=t.audio;n=!((!(!n.channelsCount||!i.channelsCount||2<n.channelsCount||2<i.channelsCount)||n.channelsCount==i.channelsCount)&&Gn(n,i)&&jn(n.roles,i.roles))}return!n&&(n=e.video&&t.video)&&(n=!(Gn(n=e.video,i=t.video)&&jn(n.roles,i.roles))),!n}function Gn(e,t){if(e.mimeType!=t.mimeType)return!1;var n=e.codecs.split(",").map((function(e){return kt(e)})),i=t.codecs.split(",").map((function(e){return kt(e)}));if(n.length!=i.length)return!1;n.sort(),i.sort();for(var r=u(ee(n.length)),a=r.next();!a.done;a=r.next())if(n[a=a.value]!=i[a])return!1;return!0}function jn(e,t){var n=new Set(e),i=new Set(t);if(n.delete("main"),i.delete("main"),n.size!=i.size)return!1;for(var r=(n=u(n)).next();!r.done;r=n.next())if(!i.has(r.value))return!1;return!0}function Vn(e){this.g=e,this.h=new Wn(e.language,"",e.audio&&e.audio.channelsCount?e.audio.channelsCount:0,"")}function Wn(e,t,n,i){this.i=e,this.j=t,this.g=n,this.h=void 0===i?"":i}function qn(){this.g=Yn,this.h=(new Map).set(Yn,2).set(Kn,1)}function Xn(e,t,n){e.h.set(Yn,n).set(Kn,t)}(i=Un.prototype).stop=function(){this.j=null,this.i=!1,this.h=[],this.m=1,this.l=null},i.init=function(e){this.j=e},i.chooseVariant=function(){var e=Bn(this.o.restrictions,this.h),t=this.g.getBandwidthEstimate(Fn(this));this.h.length&&!e.length&&(e=[(e=Bn(null,this.h))[0]]);for(var n=e[0]||null,i=(e=u(te(e))).next();!i.done;i=e.next()){var r=i.value;i=r.item;var a=isNaN(this.m)?1:Math.abs(this.m);r=a*(r.next||{bandwidth:1/0}).bandwidth/this.o.bandwidthUpgradeTarget,t>=a*i.bandwidth/this.o.bandwidthDowngradeTarget&&t<=r&&(n=i)}return this.l=Date.now(),n},i.enable=function(){this.i=!0},i.disable=function(){this.i=!1},i.segmentDownloaded=function(e,t){var n=this.g;if(!(16e3>t)){var i=8e3*t/e,r=e/1e3;n.g+=t,G(n.h,r,i),G(n.i,r,i)}if(null!=this.l&&this.i)e:{if(this.s){if(Date.now()-this.l<1e3*this.o.switchInterval)break e}else{if(!(128e3<=this.g.g))break e;this.s=!0}n=this.chooseVariant(),this.g.getBandwidthEstimate(Fn(this)),n&&this.j(n)}},i.getBandwidthEstimate=function(){return this.g.getBandwidthEstimate(this.o.defaultBandwidthEstimate)},i.setVariants=function(e){this.h=e},i.playbackRateChanged=function(e){this.m=e},i.configure=function(e){this.o=e},z("shaka.abr.SimpleAbrManager",Un),Un.prototype.configure=Un.prototype.configure,Un.prototype.playbackRateChanged=Un.prototype.playbackRateChanged,Un.prototype.setVariants=Un.prototype.setVariants,Un.prototype.getBandwidthEstimate=Un.prototype.getBandwidthEstimate,Un.prototype.segmentDownloaded=Un.prototype.segmentDownloaded,Un.prototype.disable=Un.prototype.disable,Un.prototype.enable=Un.prototype.enable,Un.prototype.chooseVariant=Un.prototype.chooseVariant,Un.prototype.init=Un.prototype.init,Un.prototype.stop=Un.prototype.stop,zn.prototype.add=function(e){return!!Hn(this.h,e)&&(this.g.add(e),!0)},zn.prototype.values=function(){return this.g.values()},Vn.prototype.create=function(e){var t=this,n=e.filter((function(e){return Hn(t.g,e)}));return n.length?new zn(n[0],n):this.h.create(e)},Wn.prototype.create=function(e){var t=[];t=function(e,t){var n=Kt(Wt(t),e.map((function(e){return Xt(e)})));return n?e.filter((function(e){return n==Xt(e)})):[]}(e,this.i);var n=e.filter((function(e){return e.primary}));for((e=function(e,t){return e.filter((function(e){return!!e.audio&&(t?e.audio.roles.includes(t):0==e.audio.roles.length)}))}(t=t.length?t:n.length?n:e,this.j)).length&&(t=e),this.g&&(e=Cn(t,this.g)).length&&(t=e),this.h&&(e=function(e,t){return e.filter((function(e){return!!e.audio&&e.audio.label.toLowerCase()==t.toLowerCase()}))}(t,this.h)).length&&(t=e),e=new zn(t[0]),n=(t=u(t)).next();!n.done;n=t.next())n=n.value,Hn(e.h,n)&&e.add(n);return e};var Kn=0,Yn=1;function Jn(e,t){var n=2,i=1e3,r=2,a=.5;this.l=null==e.maxAttempts?n:e.maxAttempts,this.j=null==e.baseDelay?i:e.baseDelay,this.s=null==e.fuzzFactor?a:e.fuzzFactor,this.m=null==e.backoffFactor?r:e.backoffFactor,this.g=0,this.h=this.j,(this.i=void 0!==t&&t)&&(this.g=1)}function Zn(e){var t,n;return D((function(i){if(1==i.g){if(e.g>=e.l){if(!e.i)throw new We(2,7,1010);e.g=1,e.h=e.j}return t=e.g,e.g++,0==t?i.return():(n=e.h*(1+(2*Math.random()-1)*e.s),b(i,new Promise((function(e){new Qt(e).S(n/1e3)})),2))}e.h*=e.m,w(i)}))}function $n(e,t){this.promise=e,this.i=t,this.g=!1}function Qn(e){return new $n(Promise.reject(e),(function(){return Promise.resolve()}))}function ei(){var e=Promise.reject(new We(2,7,7001));return e.catch((function(){})),new $n(e,(function(){return Promise.resolve()}))}function ti(e){return new $n(Promise.resolve(e),(function(){return Promise.resolve()}))}function ni(e){return new $n(e,(function(){return e.catch((function(){}))}))}function ii(e){return new $n(Promise.all(e.map((function(e){return e.promise}))),(function(){return Promise.all(e.map((function(e){return e.abort()})))}))}function ri(t,n){for(var i in n=void 0===n?{}:n)Object.defineProperty(this,i,{value:n[i],writable:!0,enumerable:!0});this.defaultPrevented=this.cancelable=this.bubbles=!1,this.timeStamp=e.performance&&e.performance.now?e.performance.now():Date.now(),this.type=t,this.isTrusted=!1,this.target=this.currentTarget=null,this.g=!1}function ai(){this.qc=new Jt,this.pc=this}function oi(e){var t=new Set;return function e(n){switch(typeof n){case"undefined":case"boolean":case"number":case"string":case"symbol":case"function":return n;default:if(!n||n.buffer&&n.buffer.constructor==ArrayBuffer)return n;if(t.has(n))return null;var i=n.constructor==Array;if(n.constructor!=Object&&!i)return null;t.add(n);var r,a=i?[]:{};for(r in n)a[r]=e(n[r]);return i&&(a.length=n.length),a}}(e)}function si(e){var t,n={};for(t in e)n[t]=e[t];return n}function li(){this.g=[]}function ui(e,t){e.g.push(t.finally((function(){ie(e.g,t)})))}function ci(e){ai.call(this),this.i=!1,this.l=new li,this.g=new Set,this.h=new Set,this.j=e||null,this.m=!1}function hi(e,t,n,i){n=n||vi;var r=yi[e];(!r||n>=r.priority)&&(yi[e]={priority:n,Cf:t,Ef:void 0!==i&&i})}function di(e,t,n){return{uris:e,method:"GET",body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:t,licenseRequestType:null,sessionId:null,streamDataCallback:void 0===n?null:n}}function pi(e,t,n,i,r,a,o){e.m&&(n.uris[r]=n.uris[r].replace("http://","https://"));var s=new Xe(n.uris[r]),l=s.Da,u=!1;l||(Ke(s,l=(l=location.protocol).slice(0,-1)),n.uris[r]=s.toString()),l=l.toLowerCase();var c=(l=yi[l])?l.Cf:null;if(!c)return Qn(new We(2,1,1e3,s));var h,d=l.Ef,p=null,f=null,m=!1;return ni(Zn(i)).ba((function(){if(e.i)return ei();h=Date.now();var i=c(n.uris[r],n,t,(function(n,i,r){p&&p.stop(),f&&f.S(s/1e3),e.j&&t==gi&&(e.j(n,i),u=!0,o.g=r)}));if(!d)return i;var a=n.retryParameters.connectionTimeout;a&&(p=new Qt((function(){m=!0,i.abort()}))).S(a/1e3);var s=n.retryParameters.stallTimeout;return s&&(f=new Qt((function(){m=!0,i.abort()}))),i})).ba((function(e){return p&&p.stop(),f&&f.stop(),null==e.timeMs&&(e.timeMs=Date.now()-h),{response:e,rf:u}}),(function(s){if(p&&p.stop(),f&&f.stop(),e.i)return ei();if(m&&(s=new We(1,1,1003,n.uris[r],t)),s instanceof We){if(7001==s.code)throw s;if(1010==s.code)throw a;if(1==s.severity){var l=new ri("retry",{error:s});return e.dispatchEvent(l),r=(r+1)%n.uris.length,pi(e,t,n,i,r,s,o)}}throw s}))}function fi(){this.g=0}function mi(e,t,n){$n.call(this,e,t),this.h=n}$n.prototype.abort=function(){return this.g=!0,this.i()},$n.prototype.finally=function(e){return this.promise.then((function(){return e(!0)}),(function(){return e(!1)})),this},$n.prototype.ba=function(e,t){function n(n){return function(s){if(r.g&&n)a.reject(o);else{var l=n?e:t;l?i=function(e,t,n){try{var i=e(t);return i&&i.promise&&i.abort?(n.resolve(i.promise),function(){return i.abort()}):(n.resolve(i),function(){return Promise.resolve(i).then((function(){}),(function(){}))})}catch(e){return n.reject(e),function(){return Promise.resolve()}}}(l,s,a):(n?a.resolve:a.reject)(s)}}}function i(){return a.reject(o),r.abort()}var r=this,a=new pt,o=new We(2,7,7001);return this.promise.then(n(!0),n(!1)),new $n(a,(function(){return i()}))},z("shaka.util.AbortableOperation",$n),$n.prototype.chain=$n.prototype.ba,$n.prototype.finally=$n.prototype.finally,$n.all=ii,$n.prototype.abort=$n.prototype.abort,$n.notAbortable=ni,$n.completed=ti,$n.aborted=ei,$n.failed=Qn,ri.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)},ri.prototype.stopImmediatePropagation=function(){this.g=!0},ri.prototype.stopPropagation=function(){},z("shaka.util.FakeEvent",ri),ai.prototype.addEventListener=function(e,t){this.qc.push(e,t)},ai.prototype.removeEventListener=function(e,t){this.qc.remove(e,t)},ai.prototype.dispatchEvent=function(e){var t=this.qc.get(e.type)||[],n=this.qc.get("All");for(n&&(t=t.concat(n)),n=(t=u(t)).next();!n.done;n=t.next()){n=n.value,e.target=this.pc,e.currentTarget=this.pc;try{n.handleEvent?n.handleEvent(e):n.call(this,e)}catch(e){}if(e.g)break}return e.defaultPrevented},li.prototype.destroy=function(){for(var e=[],t=u(this.g),n=t.next();!n.done;n=t.next())(n=n.value).promise.catch((function(){})),e.push(n.abort());return this.g=[],Promise.all(e)},g(ci,ai),(i=ci.prototype).Nd=function(e){this.m=e},i.Ff=function(e){this.g.add(e)},i.Wf=function(e){this.g.delete(e)},i.Ke=function(){this.g.clear()},i.Gf=function(e){this.h.add(e)},i.Xf=function(e){this.h.delete(e)},i.Le=function(){this.h.clear()},i.destroy=function(){return this.i=!0,this.g.clear(),this.h.clear(),this.l.destroy()},i.request=function(e,t){var n=this,i=new fi;if(this.i){var r=Promise.reject(new We(2,7,7001));return r.catch((function(){})),new mi(r,(function(){return Promise.resolve()}),i)}t.method=t.method||"GET",t.headers=t.headers||{},t.retryParameters=t.retryParameters?oi(t.retryParameters):{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4},t.uris=oi(t.uris);var a=(r=function(e,t,n){for(var i=ti(void 0),r={},a=(e=u(e.g)).next();!a.done;r={Zc:r.Zc},a=e.next())r.Zc=a.value,i=i.ba(function(e){return function(){return n.body&&(n.body=Re(n.body)),e.Zc(t,n)}}(r));return i.ba(void 0,(function(e){if(e instanceof We&&7001==e.code)throw e;throw new We(2,1,1006,e)}))}(this,e,t)).ba((function(){return pi(n,e,t,new Jn(t.retryParameters,!1),0,null,i)})),o=a.ba((function(t){return function(e,t,n){for(var i=ti(void 0),r={},a=(e=u(e.h)).next();!a.done;r={$c:r.$c},a=e.next())r.$c=a.value,i=i.ba(function(e){return function(){var i=n.response;return i.data&&(i.data=Re(i.data)),e.$c(t,i)}}(r));return i.ba((function(){return n}),(function(e){var t=2;if(e instanceof We){if(7001==e.code)throw e;t=e.severity}throw new We(t,1,1007,e)}))}(n,e,t)})),s=Date.now(),l=0;r.promise.then((function(){l=Date.now()-s}),(function(){}));var c=0;a.promise.then((function(){c=Date.now()}),(function(){}));var h=o.ba((function(t){var i=Date.now()-c,r=t.response;return r.timeMs+=l,r.timeMs+=i,t.rf||!n.j||r.fromCache||e!=gi||n.j(r.timeMs,r.data.byteLength),r}),(function(e){throw e&&(e.severity=2),e}));return r=new mi(h.promise,(function(){return h.abort()}),i),ui(this.l,r),r},z("shaka.net.NetworkingEngine",ci),ci.prototype.request=ci.prototype.request,ci.prototype.destroy=ci.prototype.destroy,ci.makeRequest=di,ci.defaultRetryParameters=function(){return{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4}},ci.prototype.clearAllResponseFilters=ci.prototype.Le,ci.prototype.unregisterResponseFilter=ci.prototype.Xf,ci.prototype.registerResponseFilter=ci.prototype.Gf,ci.prototype.clearAllRequestFilters=ci.prototype.Ke,ci.prototype.unregisterRequestFilter=ci.prototype.Wf,ci.prototype.registerRequestFilter=ci.prototype.Ff,ci.unregisterScheme=function(e){delete yi[e]},ci.registerScheme=hi,ci.prototype.setForceHTTPS=ci.prototype.Nd,ci.NumBytesRemainingClass=fi,g(mi,$n),ci.PendingRequest=mi;var gi=1;ci.RequestType={MANIFEST:0,SEGMENT:gi,LICENSE:2,APP:3,TIMING:4,SERVER_CERTIFICATE:5};var vi=3;ci.PluginPriority={FALLBACK:1,PREFERRED:2,APPLICATION:vi};var yi={};function xi(e){this.g=!1,this.h=new pt,this.i=e}function bi(e,t){if(e.g){if(t instanceof We&&7003==t.code)throw t;throw new We(2,7,7003,t)}}function wi(){this.g=new Jt}function Mi(e,t,n,i){this.target=e,this.type=t,this.listener=n,this.g=function(e,t){if(null==t)return!1;if("boolean"==typeof t)return t;var n=new Set(["passive","capture"]);return Object.keys(t).filter((function(e){return!n.has(e)})),function(e){var t=_i;if(null==t){t=!1;try{var n={},i={get:function(){return t=!0,!1}};Object.defineProperty(n,"passive",i),Object.defineProperty(n,"capture",i),i=function(){},e.addEventListener("test",i,n),e.removeEventListener("test",i,n)}catch(e){t=!1}_i=t}return t||!1}(e)?t:t.capture||!1}(e,i),this.target.addEventListener(t,n,this.g)}xi.prototype.destroy=function(){var e=this;return this.g?this.h:(this.g=!0,this.i().then((function(){e.h.resolve()}),(function(){e.h.resolve()})))},(i=wi.prototype).release=function(){this.ob(),this.g=null},i.A=function(e,t,n,i){this.g&&(e=new Mi(e,t,n,i),this.g.push(t,e))},i.va=function(e,t,n,i){var r=this;this.A(e,t,(function i(a){r.Ca(e,t,i),n(a)}),i)},i.Ca=function(e,t,n){if(this.g)for(var i=this.g.get(t)||[],r=(i=u(i)).next();!r.done;r=i.next())(r=r.value).target!=e||n!=r.listener&&n||(r.Ca(),this.g.remove(t,r))},i.ob=function(){if(this.g){var e,t=this.g,n=[];for(e in t.g)n.push.apply(n,c(t.g[e]));for(n=(t=u(n)).next();!n.done;n=t.next())n.value.Ca();this.g.g={}}},z("shaka.util.EventManager",wi),wi.prototype.removeAll=wi.prototype.ob,wi.prototype.unlisten=wi.prototype.Ca,wi.prototype.listenOnce=wi.prototype.va,wi.prototype.listen=wi.prototype.A,wi.prototype.release=wi.prototype.release,Mi.prototype.Ca=function(){this.target.removeEventListener(this.type,this.listener,this.g),this.listener=this.target=null,this.g=!1};var _i=void 0;function Si(){}function Ti(e){return new Xe(e=yt(e)).Ga}function Ei(e,t,n){function i(e){Ie(a).setUint32(o,e.byteLength,!0),o+=4,a.set(Le(e),o),o+=e.byteLength}if(!n||!n.byteLength)throw new We(2,6,6015);var r;r="string"==typeof t?bt(t,!0):t,e=bt(e=yt(e),!0);var a=new Uint8Array(12+e.byteLength+r.byteLength+n.byteLength),o=0;return i(e),i(r),i(n),a}function Ai(e){for(var t=new Map,n=u(Object.keys(e)),i=n.next();!i.done;i=n.next())i=i.value,t.set(i,e[i]);return t}function Ci(e){var t={};return e.forEach((function(e,n){t[n]=e})),t}function Ri(e,t){if(!e&&!t)return!0;if(e&&!t||t&&!e)return!1;if(e.size!=t.size)return!1;for(var n=u(e),i=n.next();!i.done;i=n.next()){var r=u(i.value);if(i=r.next().value,r=r.next().value,!t.has(i))return!1;if((i=t.get(i))!=r||null==i)return!1}return!0}function Li(e,t){var n=this;t=void 0===t?1:t,this.C=e,this.D=new Set,this.g=this.m=null,this.pa=this.T=!1,this.F=0,this.i=null,this.h=new wi,this.j=new Map,this.u=[],this.s=new pt,this.o=null,this.l=function(t){n.s.reject(t),e.onError(t)},this.qa=new Map,this.Y=new Map,this.N=new Qt((function(){return function(e){var t=e.qa,n=e.Y;n.clear(),t.forEach((function(e,t){return n.set(t,e)})),(t=Array.from(n.values())).length&&t.every((function(e){return"expired"==e}))&&e.l(new We(2,6,6014)),e.C.Gc(Ci(n))}(n)})),this.J=!1,this.H=[],this.L=!1,this.da=new Qt((function(){!function(e){e.j.forEach((function(t,n){var i=t.Dd,r=n.expiration;isNaN(r)&&(r=1/0),r!=i&&(e.C.onExpirationUpdated(n.sessionId,r),t.Dd=r)}))}(n)})).Ba(t),this.s.catch((function(){})),this.I=new xi((function(){return function(e){return D((function(t){switch(t.g){case 1:return e.h.release(),e.h=null,e.s.reject(),e.da.stop(),e.da=null,e.N.stop(),e.N=null,b(t,ji(e),2);case 2:if(!e.g){t.v(3);break}return M(t,4),b(t,e.g.setMediaKeys(null),6);case 6:S(t,5);break;case 4:T(t);case 5:e.g=null;case 3:e.i=null,e.D.clear(),e.m=null,e.u=[],e.o=null,e.l=function(){},e.C=null,w(t)}}))}(n)}))}function Ii(e,t,n){return e.u=n,e.J=0<n.length,Pi(e,t)}function Pi(t,n){var i,r,a,o,s,l,c,h,d,p,f,m;return D((function(g){if(1==g.g){if(i=function(t){if(0==(t=Ai(t.o.clearKeys)).size)return null;var n=[],i=[];t.forEach((function(e,t){var r=Et(t),a=Et(e);r={kty:"oct",kid:St(r,!1),k:St(a,!1)},n.push(r),i.push(r.kid)})),t=JSON.stringify({keys:n});var r=JSON.stringify({kids:i});return r=[{initData:Le(xt(r)),initDataType:"keyids"}],{keySystem:"org.w3.clearkey",licenseServerUri:"data:application/json;base64,"+e.btoa(t),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",sessionType:"",initData:r,keyIds:new Set(i)}}(t))for(r=u(n),a=r.next();!a.done;a=r.next())(o=a.value).video&&(o.video.drmInfos=[i]),o.audio&&(o.audio.drmInfos=[i]);for((s=n.some((function(e){return!!(e.video&&e.video.drmInfos.length||e.audio&&e.audio.drmInfos.length)})))||(l=Ai(t.o.servers),function(e,t){var n=[];t.forEach((function(e,t){n.push({keySystem:t,licenseServerUri:e,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,serverCertificateUri:"",initData:[],keyIds:new Set})}));for(var i=u(e),r=i.next();!r.done;r=i.next())(r=r.value).video&&(r.video.drmInfos=n),r.audio&&(r.audio.drmInfos=n)}(n,l)),c=u(n),a=c.next();!a.done;a=c.next())for(h=a.value,d=Wi(h),p=u(d),f=p.next();!f.done;f=p.next())Ki(f.value,Ai(t.o.servers),Ai(t.o.advanced||{}));return b(g,gn(n,t.J),2)}return s||Object.keys(t.o.servers).length?(m=Fi(t,void 0,n),g.return(s?m:m.catch((function(){})))):(t.T=!0,g.return(Promise.resolve()))}))}function Di(e){var t,n;return D((function(i){switch(i.g){case 1:if(!e.m||!e.i)return i.return();if(!e.i.serverCertificateUri||e.i.serverCertificate&&e.i.serverCertificate.length){i.v(2);break}return t=di([e.i.serverCertificateUri],e.o.retryParameters),M(i,3),b(i,e.C.lb.request(5,t).promise,5);case 5:n=i.h,e.i.serverCertificate=Le(n.data),S(i,4);break;case 3:throw new We(2,6,6017,T(i));case 4:if(e.I.g)return i.return();case 2:return e.i.serverCertificate&&e.i.serverCertificate.length?(M(i,6),b(i,e.m.setServerCertificate(e.i.serverCertificate),8)):i.return();case 8:S(i,0);break;case 6:throw new We(2,6,6004,T(i).message)}}))}function Ni(e){for(var t=(e.i?e.i.initData:[])||[],n=u(t),i=n.next();!i.done;i=n.next())ki(e,(i=i.value).initDataType,i.initData);for(i=(n=u(e.u)).next();!i.done;i=n.next())Bi(e,i.value);return t.length||e.u.length||e.s.resolve(),e.s}function ki(e,t,n){for(var i=e.j.values(),r=(i=u(i)).next();!r.done;r=i.next())if(Ae(n,r.value.initData)&&!sn("Tizen 2"))return;!function(e,t,n,i){try{var r=e.m.createSession(i)}catch(t){return void e.l(new We(2,6,6005,t.message))}e.h.A(r,"message",(function(t){e.g&&e.o.delayLicenseRequestUntilPlayed&&e.g.paused&&!e.L?e.H.push(t):Hi(e,t)})),e.h.A(r,"keystatuseschange",(function(t){return Gi(e,t)})),e.j.set(r,{initData:n,loaded:!1,Dd:1/0,Ka:null,type:i});try{n=e.o.initDataTransform(n,t,e.i)}catch(n){return t=n,n instanceof We||(t=new We(2,6,6016,n)),void e.l(t)}e.o.logLicenseExchange&&St(n),r.generateRequest(t,n).catch((function(t){if(!e.I.g){e.j.delete(r);var n=t.errorCode;if(n&&n.systemCode){var i=n.systemCode;0>i&&(i+=Math.pow(2,32)),i="0x"+i.toString(16)}e.l(new We(2,6,6006,t.message,t,i))}}))}(e,t,n,e.i.sessionType)}function Oi(e){return!!e&&!!e.match(/^com\.(microsoft|chromecast)\.playready/)}function Ui(e){return e=Q(e=e.j.keys(),(function(e){return e.sessionId})),Array.from(e)}function Fi(e,t,n){var i,r,a,o,s,l,c,h,d,p,f,m,g;return D((function(v){switch(v.g){case 1:if(i=new Map,n.length){r=function(e,t,n){for(var i=u(t),r=i.next();!r.done;r=i.next()){var a=u(Wi(r.value));for(r=a.next();!r.done;r=a.next())r=r.value,n.has(r.keySystem)||n.set(r.keySystem,[]),n.get(r.keySystem).push(r)}if(1==n.size&&n.has(""))throw new We(2,6,6e3);for(i={},r=(e=u(e.o.preferredKeySystems)).next();!r.done;i={Xc:i.Xc},r=e.next())for(i.Xc=r.value,r=(a=u(t)).next();!r.done;r=a.next())if(r=r.value.decodingInfos.find(function(e){return function(t){return t.supported&&null!=t.keySystemAccess&&t.keySystemAccess.keySystem==e.Xc}}(i)))return r.keySystemAccess;for(r=(e=u([!0,!1])).next();!r.done;r=e.next())for(i=r.value,r=(a=u(t)).next();!r.done;r=a.next()){var o=u(r.value.decodingInfos);for(r=o.next();!r.done;r=o.next()){var s=r.value;if(s.supported&&s.keySystemAccess){var l=u(r=n.get(s.keySystemAccess.keySystem));for(r=l.next();!r.done;r=l.next())if(!!r.value.licenseServerUri==i)return s.keySystemAccess}}}return null}(e,n,i),v.v(2);break}return b(v,function(e,t){var n,i,r,a,o,s,l,c,h,d,p,f,m,g;return D((function(v){switch(v.g){case 1:if(1==t.size&&t.has(""))throw new We(2,6,6e3);for(i=u(t.values()),r=i.next();!r.done;r=i.next())0==(a=r.value).audioCapabilities.length&&delete a.audioCapabilities,0==a.videoCapabilities.length&&delete a.videoCapabilities;o=u(e.o.preferredKeySystems),s=o.next();case 2:if(s.done){v.v(4);break}if(l=s.value,!t.has(l)){v.v(3);break}return c=t.get(l),M(v,6),b(v,navigator.requestMediaKeySystemAccess(l,[c]),8);case 8:return n=v.h,v.return(n);case 6:T(v);case 7:bi(e.I);case 3:s=o.next(),v.v(2);break;case 4:h=u([!0,!1]),d=h.next();case 9:if(d.done){v.v(11);break}p=d.value,f=u(t.keys()),s=f.next();case 12:if(s.done){d=h.next(),v.v(9);break}if(m=s.value,(g=t.get(m)).drmInfos.some((function(e){return!!e.licenseServerUri}))!=p){v.v(13);break}return M(v,15),b(v,navigator.requestMediaKeySystemAccess(m,[g]),17);case 17:return n=v.h,v.return(n);case 15:T(v);case 16:bi(e.I);case 13:s=f.next(),v.v(12);break;case 11:return v.return(n)}}))}(e,t),3);case 3:r=v.h;case 2:if(!(a=r))throw new We(2,6,6001);for(bi(e.I),M(v,4),e.D.clear(),o=a.getConfiguration(),s=o.audioCapabilities||[],l=o.videoCapabilities||[],c=u(s),h=c.next();!h.done;h=c.next())d=h.value,e.D.add(d.contentType.toLowerCase());for(p=u(l),h=p.next();!h.done;h=p.next())f=h.value,e.D.add(f.contentType.toLowerCase());if(n.length){var y=a.keySystem,x=i.get(a.keySystem),w=[],_=[],E=[],A=[],C=new Set;Xi(x,w,E,_,A,C);var R=e.J?"persistent-license":"temporary";for(y={keySystem:y,licenseServerUri:w[0],distinctiveIdentifierRequired:x[0].distinctiveIdentifierRequired,persistentStateRequired:x[0].persistentStateRequired,sessionType:x[0].sessionType||R,audioRobustness:x[0].audioRobustness||"",videoRobustness:x[0].videoRobustness||"",serverCertificate:E[0],serverCertificateUri:_[0],initData:A,keyIds:C},w=(x=u(x)).next();!w.done;w=x.next())(w=w.value).distinctiveIdentifierRequired&&(y.distinctiveIdentifierRequired=w.distinctiveIdentifierRequired),w.persistentStateRequired&&(y.persistentStateRequired=w.persistentStateRequired);x=y}else x=a.keySystem,y=t.get(a.keySystem),w=[],_=[],E=[],A=[],C=new Set,Xi(y.drmInfos,w,E,_,A,C),x={keySystem:x,licenseServerUri:w[0],distinctiveIdentifierRequired:"required"==y.distinctiveIdentifier,persistentStateRequired:"required"==y.persistentState,sessionType:y.sessionTypes[0]||"temporary",audioRobustness:(y.audioCapabilities?y.audioCapabilities[0].robustness:"")||"",videoRobustness:(y.videoCapabilities?y.videoCapabilities[0].robustness:"")||"",serverCertificate:E[0],serverCertificateUri:_[0],initData:A,keyIds:C};if(e.i=x,!e.i.licenseServerUri)throw new We(2,6,6012,e.i.keySystem);return b(v,a.createMediaKeys(),6);case 6:return m=v.h,bi(e.I),e.m=m,e.T=!0,b(v,Di(e),7);case 7:bi(e.I),S(v,0);break;case 4:if(g=T(v),bi(e.I,g),e.i=null,e.D.clear(),g instanceof We)throw g;throw new We(2,6,6002,g.message)}}))}function Bi(e,t){var n,i,r,a,o;return D((function(s){switch(s.g){case 1:try{n=e.m.createSession("persistent-license")}catch(t){return i=new We(2,6,6005,t.message),e.l(i),s.return(Promise.reject(i))}return e.h.A(n,"message",(function(t){e.g&&e.o.delayLicenseRequestUntilPlayed&&e.g.paused&&!e.L?e.H.push(t):Hi(e,t)})),e.h.A(n,"keystatuseschange",(function(t){return Gi(e,t)})),r={initData:null,loaded:!1,Dd:1/0,Ka:null,type:"persistent-license"},e.j.set(n,r),M(s,2),b(s,n.load(t),4);case 4:return a=s.h,bi(e.I),a?(r.loaded=!0,qi(e)&&e.s.resolve(),s.return(n)):(e.j.delete(n),e.l(new We(2,6,6013)),s.return(Promise.resolve()));case 2:o=T(s),bi(e.I,o),e.j.delete(n),e.l(new We(2,6,6005,o.message));case 3:return s.return(Promise.resolve())}}))}function zi(e,t,n){return"skd"==t&&(t=n.serverCertificate,e=Ei(e,n=Ti(e),t)),e}function Hi(e,t){var n,i,r,a,o,s,l,c,h,d,p,f;D((function(m){switch(m.g){case 1:return n=t.target,e.o.logLicenseExchange&&St(t.message),i=e.j.get(n),r=e.i.licenseServerUri,a=e.o.advanced[e.i.keySystem],"individualization-request"==t.messageType&&a&&a.individualizationServer&&(r=a.individualizationServer),(o=di([r],e.o.retryParameters)).body=t.message,o.method="POST",o.licenseRequestType=t.messageType,o.sessionId=n.sessionId,Oi(e.i.keySystem)&&function(e){var t=vt(e.body,!0,!0);if(t.includes("PlayReadyKeyMessage")){for(var n=u((t=(new DOMParser).parseFromString(t,"application/xml")).getElementsByTagName("HttpHeader")),i=n.next();!i.done;i=n.next())i=i.value,e.headers[i.getElementsByTagName("name")[0].textContent]=i.getElementsByTagName("value")[0].textContent;e.body=Tt(t.getElementsByTagName("Challenge")[0].textContent)}else e.headers["Content-Type"]="text/xml; charset=utf-8"}(o),s=Date.now(),M(m,2),b(m,e.C.lb.request(2,o).promise,4);case 4:l=m.h,S(m,3);break;case 2:return c=T(m),h=new We(2,6,6007,c),e.l(h),i&&i.Ka&&i.Ka.reject(h),m.return();case 3:return e.I.g?m.return():(e.F+=(Date.now()-s)/1e3,e.o.logLicenseExchange&&St(l.data),M(m,5),b(m,n.update(l.data),7));case 7:S(m,6);break;case 5:return d=T(m),p=new We(2,6,6008,d.message),e.l(p),i&&i.Ka&&i.Ka.reject(p),m.return();case 6:f=new ri("drmsessionupdate"),e.C.onEvent(f),i&&(i.Ka&&i.Ka.resolve(),new Qt((function(){i.loaded=!0,qi(e)&&e.s.resolve()})).S(Ji)),w(m)}}))}function Gi(e,t){var n=t.target,i=e.j.get(n),r=!1;n.keyStatuses.forEach((function(t,n){if("string"==typeof n){var a=n;n=t,t=a}if(Oi(e.i.keySystem)&&16==n.byteLength&&navigator.userAgent.match(/Edge?\//)){var o=(a=Ie(n)).getUint32(0,!0),s=a.getUint16(4,!0),l=a.getUint16(6,!0);a.setUint32(0,o,!1),a.setUint16(4,s,!1),a.setUint16(6,l,!1)}"status-pending"!=t&&(i.loaded=!0),"expired"==t&&(r=!0),a=At(n),e.qa.set(a,t)}));var a=n.expiration-Date.now();(0>a||r&&1e3>a)&&i&&!i.Ka&&(e.j.delete(n),n.close().catch((function(){}))),qi(e)&&(e.s.resolve(),e.N.S(Zi))}function ji(e){var t;return D((function(n){return t=Array.from(e.j.entries()),e.j.clear(),b(n,Promise.all(t.map((function(t){var n=(t=u(t)).next().value,i=t.next().value;return D((function(t){return 1==t.g?(M(t,2),e.pa||e.u.includes(n.sessionId)||"persistent-license"!==i.type?b(t,function(e){var t;return D((function(n){return 1==n.g?(t=new Promise((function(e,t){new Qt(t).S(Yi)})),M(n,2),b(n,Promise.race([Promise.all([e.close(),e.closed]),t]),4)):2!=n.g?S(n,0):(T(n),void w(n))}))}(n),5):b(t,n.remove(),5)):2!=t.g?S(t,0):(T(t),void w(t))}))}))),0)}))}function Vi(e,t){if(!e.length)return t;if(!t.length)return e;for(var n=[],i=u(e),r=i.next();!r.done;r=i.next()){r=r.value;for(var a=u(t),o=a.next();!o.done;o=a.next())if(o=o.value,r.keySystem==o.keySystem){a=(a=(a=[]).concat(r.initData||[])).concat(o.initData||[]);var s=r.keyIds&&o.keyIds?new Set([].concat(c(r.keyIds),c(o.keyIds))):r.keyIds||o.keyIds;n.push({keySystem:r.keySystem,licenseServerUri:r.licenseServerUri||o.licenseServerUri,distinctiveIdentifierRequired:r.distinctiveIdentifierRequired||o.distinctiveIdentifierRequired,persistentStateRequired:r.persistentStateRequired||o.persistentStateRequired,videoRobustness:r.videoRobustness||o.videoRobustness,audioRobustness:r.audioRobustness||o.audioRobustness,serverCertificate:r.serverCertificate||o.serverCertificate,serverCertificateUri:r.serverCertificateUri||o.serverCertificateUri,initData:a,keyIds:s});break}}return n}function Wi(e){return(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[])}function qi(e){return function(e,t){for(var n=u(e),i=n.next();!i.done;i=n.next())if(!t(i.value))return!1;return!0}(e=e.j.values(),(function(e){return e.loaded}))}function Xi(e,t,n,i,r,a){for(var o={},s=(e=u(e)).next();!s.done;o={oa:o.oa},s=e.next()){if(o.oa=s.value,t.includes(o.oa.licenseServerUri)||t.push(o.oa.licenseServerUri),i.includes(o.oa.serverCertificateUri)||i.push(o.oa.serverCertificateUri),o.oa.serverCertificate&&(n.some(function(e){return function(t){return Ae(t,e.oa.serverCertificate)}}(o))||n.push(o.oa.serverCertificate)),o.oa.initData){s={};for(var l=u(o.oa.initData),c=l.next();!c.done;s={jc:s.jc},c=l.next())s.jc=c.value,r.some(function(e){return function(t){var n=e.jc;return!(!t.keyId||t.keyId!=n.keyId)||t.initDataType==n.initDataType&&Ae(t.initData,n.initData)}}(s))||r.push(s.jc)}if(o.oa.keyIds)for(l=(s=u(o.oa.keyIds)).next();!l.done;l=s.next())a.add(l.value)}}function Ki(t,n,i){!t.keySystem||"org.w3.clearkey"==t.keySystem&&t.licenseServerUri||(n.size&&(n=n.get(t.keySystem)||"",t.licenseServerUri=n),t.keyIds||(t.keyIds=new Set),(i=i.get(t.keySystem))&&(t.distinctiveIdentifierRequired||(t.distinctiveIdentifierRequired=i.distinctiveIdentifierRequired),t.persistentStateRequired||(t.persistentStateRequired=i.persistentStateRequired),t.videoRobustness||(t.videoRobustness=i.videoRobustness),t.audioRobustness||(t.audioRobustness=i.audioRobustness),t.serverCertificate||(t.serverCertificate=i.serverCertificate),i.sessionType&&(t.sessionType=i.sessionType),t.serverCertificateUri||(t.serverCertificateUri=i.serverCertificateUri)),e.cast&&e.cast.__platform__&&"com.microsoft.playready"==t.keySystem&&(t.keySystem="com.chromecast.playready"))}z("shaka.util.FairPlayUtils",Si),Si.initDataTransform=Ei,Si.defaultGetContentId=Ti,(i=Li.prototype).destroy=function(){return this.I.destroy()},i.configure=function(e){this.o=e},i.Pb=function(e){var t,n=this;return D((function(i){if(1==i.g)return n.m?(n.g=e,n.h.va(n.g,"play",(function(){for(var e=u(n.H),t=e.next();!t.done;t=e.next())Hi(n,t.value);n.L=!0,n.H=[]})),"webkitCurrentPlaybackTargetIsWireless"in n.g&&n.h.A(n.g,"webkitcurrentplaybacktargetiswirelesschanged",(function(){return ji(n)})),b(i,n.g.setMediaKeys(n.m).catch((function(e){return Promise.reject(new We(2,6,6003,e.message))})),2)):(n.h.va(e,"encrypted",(function(){n.l(new We(2,6,6010))})),i.return());bi(n.I),Ni(n),n.i.initData.length||n.u.length||(t=function(e){return ki(n,e.initDataType,Le(e.initData))},n.h.A(n.g,"encrypted",t)),w(i)}))},i.Tb=function(){for(var e=1/0,t=this.j.keys(),n=(t=u(t)).next();!n.done;n=t.next())n=n.value,isNaN(n.expiration)||(e=Math.min(e,n.expiration));return e},i.zc=function(){return Ci(this.Y)};var Yi=1,Ji=5,Zi=.5,$i=new ft((function(){return Re(new Uint8Array([0]))}));function Qi(){}function er(e,t,n,i){var r,a,o,s;return D((function(l){if(1==l.g)return i&&(r=ir[i.toLowerCase()])?l.return(r):(a=nr(e))&&(o=rr[a])?l.return(o):i?l.v(2):b(l,tr(e,t,n),3);if(2!=l.g&&(i=l.h)&&(s=ir[i]))return l.return(s);throw new We(2,4,4e3,e)}))}function tr(e,t,n){var i,r,a;return D((function(o){return 1==o.g?((i=di([e],n)).method="HEAD",b(o,t.request(0,i).promise,2)):(r=o.h,a=r.headers["content-type"],o.return(a?a.toLowerCase().split(";").shift():""))}))}function nr(e){return 1==(e=new Xe(e).xa.split("/").pop().split(".")).length?"":e.pop().toLowerCase()}z("shaka.media.ManifestParser",Qi),Qi.unregisterParserByMime=function(e){delete ir[e]},Qi.registerParserByMime=function(e,t){ir[e]=t},Qi.registerParserByExtension=function(e,t){rr[e]=t};var ir={},rr={};function ar(e,t){this.R=Ie(e),this.h=t==sr,this.g=0}function or(){return new We(2,3,3e3)}(i=ar.prototype).na=function(){return this.g<this.R.byteLength},i.Z=function(){return this.g},i.Xe=function(){return this.R.byteLength},i.$=function(){try{var e=this.R.getUint8(this.g);return this.g+=1,e}catch(e){throw or()}},i.Fb=function(){try{var e=this.R.getUint16(this.g,this.h);return this.g+=2,e}catch(e){throw or()}},i.M=function(){try{var e=this.R.getUint32(this.g,this.h);return this.g+=4,e}catch(e){throw or()}},i.me=function(){try{var e=this.R.getInt32(this.g,this.h);return this.g+=4,e}catch(e){throw or()}},i.nb=function(){try{if(this.h)var e=this.R.getUint32(this.g,!0),t=this.R.getUint32(this.g+4,!0);else t=this.R.getUint32(this.g,!1),e=this.R.getUint32(this.g+4,!1)}catch(e){throw or()}if(2097151<t)throw new We(2,3,3001);return this.g+=8,t*Math.pow(2,32)+e},i.$a=function(e){if(this.g+e>this.R.byteLength)throw or();var t=Le(this.R,this.g,e);return this.g+=e,t},i.skip=function(e){if(this.g+e>this.R.byteLength)throw or();this.g+=e},i.oe=function(e){if(this.g<e)throw or();this.g-=e},i.seek=function(e){if(0>e||e>this.R.byteLength)throw or();this.g=e},i.ac=function(){for(var e=this.g;this.na()&&0!=this.R.getUint8(this.g);)this.g+=1;return e=Le(this.R,e,this.g-e),this.g+=1,gt(e)},z("shaka.util.DataViewReader",ar),ar.prototype.readTerminatedString=ar.prototype.ac,ar.prototype.seek=ar.prototype.seek,ar.prototype.rewind=ar.prototype.oe,ar.prototype.skip=ar.prototype.skip,ar.prototype.readBytes=ar.prototype.$a,ar.prototype.readUint64=ar.prototype.nb,ar.prototype.readInt32=ar.prototype.me,ar.prototype.readUint32=ar.prototype.M,ar.prototype.readUint16=ar.prototype.Fb,ar.prototype.readUint8=ar.prototype.$,ar.prototype.getLength=ar.prototype.Xe,ar.prototype.getPosition=ar.prototype.Z,ar.prototype.hasMoreData=ar.prototype.na;var sr=1;function lr(){this.i=[],this.h=[],this.g=!1}function ur(e){for(var t=fr(e);e.reader.na()&&!e.parser.g;)e.parser.Ic(e.start+t,e.reader,e.partialOkay)}function cr(e){for(var t=fr(e),n=e.reader.M(),i=(n=u(ee(n))).next();!i.done&&(e.parser.Ic(e.start+t,e.reader,e.partialOkay),!e.parser.g);i=n.next());}function hr(e){return function(t){e(t.reader.$a(t.reader.R.byteLength-t.reader.Z()))}}function dr(e){for(var t=0,n=(e=u(e)).next();!n.done;n=e.next())t=t<<8|n.value.charCodeAt(0);return t}function pr(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)}function fr(e){return 8+(e.has64BitSize?8:0)+(null!=e.flags?4:0)}ar.Endianness={BIG_ENDIAN:0,LITTLE_ENDIAN:sr},(i=lr.prototype).box=function(e,t){var n=dr(e);return this.i[n]=mr,this.h[n]=t,this},i.V=function(e,t){var n=dr(e);return this.i[n]=gr,this.h[n]=t,this},i.stop=function(){this.g=!0},i.parse=function(e,t,n){for(e=new ar(e,0),this.g=!1;e.na()&&!this.g;)this.Ic(0,e,t,n)},i.Ic=function(e,t,n,i){var r=t.Z();if(i&&r+8>t.R.byteLength)this.g=!0;else{var a=t.M(),o=t.M(),s=!1;switch(a){case 0:a=t.R.byteLength-r;break;case 1:if(i&&t.Z()+8>t.R.byteLength)return void(this.g=!0);a=t.nb(),s=!0}var l=this.h[o];if(l){var u=null,c=null;if(this.i[o]==gr){if(i&&t.Z()+4>t.R.byteLength)return void(this.g=!0);u=(c=t.M())>>>24,c&=16777215}o=r+a,n&&o>t.R.byteLength&&(o=t.R.byteLength),i&&o>t.R.byteLength?this.g=!0:(i=o-t.Z(),l({parser:this,partialOkay:n||!1,version:u,flags:c,reader:t=new ar(t=0<i?t.$a(i):new Uint8Array(0),0),size:a,start:r+e,has64BitSize:s}))}else t.skip(Math.min(r+a-t.Z(),t.R.byteLength-t.Z()))}},z("shaka.util.Mp4Parser",lr),lr.headerSize=fr,lr.typeToString=pr,lr.allData=hr,lr.sampleDescription=cr,lr.children=ur,lr.prototype.parseNext=lr.prototype.Ic,lr.prototype.parse=lr.prototype.parse,lr.prototype.stop=lr.prototype.stop,lr.prototype.fullBox=lr.prototype.V,lr.prototype.box=lr.prototype.box;var mr=0,gr=1;function vr(e,t,n,i,r){var a=xr.value(),o=e.subarray(n.start,n.start+n.size),s=Ie(o),l=new Uint8Array(n.size+a.byteLength);for(l.set(o,0),(o=Ie(l)).setUint32(4,r),l.set(a,n.size),r=s.getUint32(4),o.setUint32(n.size+16,r),yr(l,0,l.byteLength),r=new Uint8Array(e.byteLength+l.byteLength),n=sn("Xbox One")?n.start:n.start+n.size,a=e.subarray(n),r.set(e.subarray(0,n)),r.set(l,n),r.set(a,n+l.byteLength),i=(e=u(i)).next();!i.done;i=e.next())yr(r,(i=i.value).start,i.size+l.byteLength);return l=Ie(r,t.start),t=fr(t),e=l.getUint32(t),l.setUint32(t,e+1),r}function yr(e,t,n){0!=(t=(e=Ie(e,t)).getUint32(0))&&(1==t?(e.setUint32(8,n>>32),e.setUint32(12,4294967295&n)):e.setUint32(0,n))}var xr=new ft((function(){return new Uint8Array([0,0,0,80,115,105,110,102,0,0,0,12,102,114,109,97,0,0,0,0,0,0,0,20,115,99,104,109,0,0,0,0,99,101,110,99,0,1,0,0,0,0,0,40,115,99,104,105,0,0,0,32,116,101,110,99,0,0,0,0,0,0,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}));function br(e,t,n,i,r){if(i>=r)return null;for(var a=-1,o=-1,s=0;s<n.length;s++)if(n[s].some((function(e){return null!=e&&""!=e.g.trim()}))){a=s;break}for(s=n.length-1;0<=s;s--)if(n[s].some((function(e){return null!=e&&""!=e.g.trim()}))){o=s;break}if(-1===a||-1===o)return null;for(var l=s=!1,u="white",c="black",h=wr(i,r,s,l,u,c);a<=o;a++){for(var d=n[a],p=-1,f=-1,m=0;m<d.length;m++)if(null!=d[m]&&""!==d[m].g.trim()){p=m;break}for(m=d.length-1;0<=m;m--)if(null!=d[m]&&""!==d[m].g.trim()){f=m;break}if(-1===p||-1===f)d=Mr(i,r),e.nestedCues.push(d);else{for(;p<=f;p++)if(m=d[p]){var g=m.l,v=m.i,y=m.j,x=m.h;g==s&&v==l&&y==u&&x==c||(h.payload&&e.nestedCues.push(h),h=wr(i,r,g,v,y,x),s=g,l=v,u=y,c=x),h.payload+=m.g}else h.payload+=" ";h.payload&&e.nestedCues.push(h),a!==o&&(h=Mr(i,r),e.nestedCues.push(h)),h=wr(i,r,s,l,u,c)}}return e.nestedCues.length?{cue:e,stream:t}:null}function wr(e,t,n,i,r,a){return e=new oe(e,t,""),n&&e.textDecoration.push("underline"),i&&(e.fontStyle="italic"),e.color=r,e.backgroundColor=a,e}function Mr(e,t){var n=new oe(e,t,"");return n.lineBreak=!0,n}function _r(e,t,n,i,r){this.g=e,this.l=t,this.i=n,this.h=i,this.j=r}function Sr(e,t){this.i=[],this.g=1,this.h=0,this.D=e,this.u=t,this.j=this.m=!1,this.l="white",this.s="black",Er(this)}function Tr(e,t,n){return br(new oe(t,n,""),"CC"+(e.D<<1|e.u+1),e.i,t,n)}function Er(e){Rr(e,0,15),e.g=1}function Ar(e,t,n){if(!(32>n||127<n)){var i="";switch(t){case Lr:i=Nr.has(n)?Nr.get(n):String.fromCharCode(n);break;case Ir:i=kr.get(n);break;case Pr:e.i[e.g].pop(),i=Or.get(n);break;case Dr:e.i[e.g].pop(),i=Ur.get(n)}i&&e.i[e.g].push(new _r(i,e.m,e.j,e.s,e.l))}}function Cr(e,t,n,i){if(t>=n)for(--i;0<=i;i--)e.i[t+i]=e.i[n+i].map((function(e){return e}));else for(var r=0;r<i;r++)e.i[t+r]=e.i[n+r].map((function(e){return e}))}function Rr(e,t,n){for(var i=0;i<=n;i++)e.i[t+i]=[]}var Lr=0,Ir=1,Pr=2,Dr=3,Nr=new Map([[39,"â"],[42,"Ã¡"],[92,"Ã©"],[92,"Ã©"],[94,"Ã­"],[95,"Ã³"],[96,"Ãº"],[123,"Ã§"],[124,"Ã·"],[125,"Ã"],[126,"Ã±"],[127,"â"]]),kr=new Map([[48,"Â®"],[49,"Â°"],[50,"Â½"],[51,"Â¿"],[52,"â¢"],[53,"Â¢"],[54,"Â£"],[55,"âª"],[56,"Ã "],[57,"â "],[58,"Ã¨"],[59,"Ã¢"],[60,"Ãª"],[61,"Ã®"],[62,"Ã´"],[63,"Ã»"]]),Or=new Map([[32,"Ã"],[33,"Ã"],[34,"Ã"],[35,"Ã"],[36,"Ã"],[37,"Ã¼"],[38,"â"],[39,"Â¡"],[40,"*"],[41,"'"],[42,"â"],[43,"Â©"],[44,"â "],[45,"Â·"],[46,"â"],[47,"â"],[48,"Ã"],[49,"Ã"],[50,"Ã"],[51,"Ã"],[52,"Ã"],[53,"Ã"],[54,"Ã«"],[55,"Ã"],[56,"Ã"],[57,"Ã¯"],[58,"Ã"],[59,"Ã"],[60,"Ã¹"],[61,"Ã"],[62,"Â«"],[63,"Â»"]]),Ur=new Map([[32,"Ã"],[33,"Ã£"],[34,"Ã"],[35,"Ã"],[36,"Ã¬"],[37,"Ã"],[38,"Ã²"],[39,"Ã"],[40,"Ãµ"],[41,"{"],[42,"}"],[43,"\\"],[44,"^"],[45,"_"],[46,"|"],[47,"~"],[48,"Ã"],[49,"Ã¤"],[50,"Ã"],[51,"Ã¶"],[52,"Ã"],[53,"Â¥"],[54,"Â¤"],[55,"â"],[56,"Ã"],[57,"Ã¥"],[58,"Ã"],[59,"Ã¸"],[60,"â"],[61,"â"],[62,"â"],[63,"â"]]);function Fr(e,t){this.h=Gr,this.s=new Sr(e,t),this.i=new Sr(e,t),this.l=new Sr(e,t),this.g=this.i,this.j=0,this.m=null}function Br(e,t,n){e.g=e.i;var i=e.g,r=null;return e.h!==Vr&&e.h!==Wr&&(r=Tr(i,e.j,n),(n=e.i).g=0<n.h?n.h:0,Rr(n,0,15),(n=e.l).g=0<n.h?n.h:0,Rr(n,0,15),i.g=15),e.h=Vr,i.h=t,r}function zr(e){e.h=jr,e.g=e.l,e.g.h=0}function Hr(e){K("Cea608DataChannel","CEA-608 text mode entered, but is unsupported"),e.g=e.s,e.h=Wr}var Gr=0,jr=1,Vr=3,Wr=4,qr="black green blue cyan red yellow magenta black".split(" "),Xr="white green blue cyan red yellow magenta white_italics".split(" ");function Kr(){this.l=!1,this.F=this.J=0,this.H=na,this.i=[],this.g=this.h=this.j=0,this.D=this.s=!1,this.u="white",this.m="black",Yr(this)}function Yr(e){e.i=[];for(var t=0;15>t;t++)e.i.push(Jr())}function Jr(){for(var e=[],t=0;42>t;t++)e.push(null);return e}function Zr(e,t){$r(e)&&(e.i[e.h][e.g]=new _r(t,e.D,e.s,e.m,e.u),e.g++)}function $r(e){var t=e.g<e.F&&0<=e.g;return e.h<e.J&&0<=e.h&&t}function Qr(e,t,n){var i=new oe(e.j,t,"");return i.textAlign=e.H===ea?"left":e.H===ta?"right":ue,(n=br(i,"svc"+n,e.i,e.j,t))&&(e.j=t),n}Kr.prototype.isVisible=function(){return this.l};var ea=0,ta=1,na=2;function ia(){this.i=[],this.h=null,this.g=0}function ra(e,t){3===t.type?(e.g=2*(63&t.value)-1,e.h=[]):e.h&&(0<e.g&&(e.h.push(t),e.g--),0===e.g&&(e.i.push(new aa(e.h)),e.h=null,e.g=0))}function aa(e){this.g=0,this.h=e}function oa(e){if(!e.na())throw new We(2,2,3e3);return e.h[e.g++]}function sa(e){this.i=e,this.h=[null,null,null,null,null,null,null,null],this.g=null}function la(e,t,n,i){if(128<=n&&135>=n)i=7&n,e.h[i]&&(e.g=e.h[i]);else{if(136===n){n=oa(t).value,t=null;for(var r=(n=u(ua(e,n))).next();!r.done;r=n.next())(r=e.h[r.value]).isVisible()&&(t=Qr(r,i,e.i)),Yr(r);return t}if(137===n)for(t=oa(t).value,n=(t=u(ua(e,t))).next();!n.done;n=t.next())(n=e.h[n.value]).isVisible()||(n.j=i),n.l=!0;else{if(138===n){for(n=oa(t).value,t=null,r=(n=u(ua(e,n))).next();!r.done;r=n.next())(r=e.h[r.value]).isVisible()&&(t=Qr(r,i,e.i)),r.l=!1;return t}if(139===n){for(n=oa(t).value,t=null,r=(n=u(ua(e,n))).next();!r.done;r=n.next())(r=e.h[r.value]).isVisible()?t=Qr(r,i,e.i):r.j=i,r.l=!r.l;return t}if(140===n)return ca(e,t=oa(t).value,i);if(143===n)return i=ca(e,255,i),ha(e),i;if(144===n)t.skip(1),i=oa(t).value,e.g&&(e.g.s=0<(128&i),e.g.D=0<(64&i));else if(145===n)i=oa(t).value,n=oa(t).value,t.skip(1),e.g&&(t=da((48&n)>>4,(12&n)>>2,3&n),e.g.u=da((48&i)>>4,(12&i)>>2,3&i),e.g.m=t);else if(146===n)i=oa(t).value,t=oa(t).value,e.g&&((e=e.g).h=15&i,e.g=63&t);else if(151===n)t.skip(1),t.skip(1),i=oa(t).value,t.skip(1),e.g&&(e.g.H=3&i);else if(152<=n&&159>=n){if(n=(15&n)-8,!(r=null!==e.h[n])){var a=new Kr;a.j=i,e.h[n]=a}i=oa(t).value,oa(t),oa(t),a=oa(t).value;var o=oa(t).value;t=oa(t).value,r&&0==(7&t)||((t=e.h[n]).h=0,t.g=0,t.D=!1,t.s=!1,t.u="white",t.m="black"),(t=e.h[n]).l=0<(32&i),t.J=1+(15&a),t.F=1+(63&o),e.g=e.h[n]}}}return null}aa.prototype.na=function(){return this.g<this.h.length},aa.prototype.Z=function(){return this.g},aa.prototype.skip=function(e){if(this.g+e>this.h.length)throw new We(2,2,3e3);this.g+=e};var ua=function e(t,n){var i;return P(e,(function(e){return 1==e.g&&(i=0),5!=e.g?8>i?1==(1&n)&&t.h[i]?b(e,i,5):e.v(5):e.v(0):(n>>=1,i++,e.v(2))}))};function ca(e,t,n){for(var i=null,r=(t=u(ua(e,t))).next();!r.done;r=t.next()){r=r.value;var a=e.h[r];a.isVisible()&&(i=Qr(a,n,e.i)),e.h[r]=null}return i}function ha(e){e.g=null,e.h=[null,null,null,null,null,null,null,null]}function da(e,t,n){var i={0:0,1:0,2:1,3:1};return fa[(e=i[e])<<2|(t=i[t])<<1|(n=i[n])]}var pa=new Map([[32," "],[33,"Â "],[37,"â¦"],[42,"Å "],[44,"Å"],[48,"â"],[49,"â"],[50,"â"],[51,"â"],[52,"â"],[53,"â¢"],[57,"â¢"],[58,"Å¡"],[60,"Å"],[61,"â "],[63,"Å¸"],[118,"â"],[119,"â"],[120,"â"],[121,"â"],[122,"â"],[123,"â"],[124,"â"],[125,"â"],[126,"â"],[127,"â"]]),fa="black blue green cyan red magenta yellow white".split(" ");function ma(){this.h=[],this.g=[],this.i=new ia,this.l=0,this.u=new Map([["CC1",new Fr(0,0)],["CC2",new Fr(0,1)],["CC3",new Fr(1,0)],["CC4",new Fr(1,1)]]),this.s=this.m=0,this.j=new Map,ga(this)}function ga(e){e.m=0,e.s=0;for(var t=(e=u(e.u.values())).next();!t.done;t=e.next())(t=t.value).h=2,t.g=t.i,t.m=null,Er(t.i),Er(t.l),Er(t.s)}function va(e,t){var n=t.type;if(16==(112&t.za)){var i=t.za>>3&1;0===n?e.m=i:e.s=i}if(n=e.u.get("CC"+(n<<1|(n?e.s:e.m)+1)),255===t.za&&255===t.Pa||!t.za&&!t.Pa||!xa(t.za)||!xa(t.Pa))return 45<=++e.l&&ga(e),null;if(e.l=0,t.za&=127,t.Pa&=127,!t.za&&!t.Pa)return null;if(i=null,16==(112&t.za))e:{var r=t.za;if(i=t.Pa,n.m===(r<<8|i))n.m=null;else if(n.m=r<<8|i,16==(240&r)&&64==(192&i)){r=[11,11,1,2,3,4,12,13,14,15,5,6,7,8,9,10][(7&r)<<1|i>>5&1];var a=(30&i)>>1,o="white",s=!1;if(7>a?o=Xr[a]:7===a&&(s=!0),i=1==(1&i),n.h!==Wr){if(a=n.g,n.h===Vr&&r!==a.g){var l=1+r-a.h;Cr(a,l,1+a.g-a.h,a.h),Rr(a,0,l-1),Rr(a,r+1,15-r)}a.g=r,n.g.m=i,n.g.j=s,n.g.l=o,n.g.s="black"}}else if(17==(247&r)&&32==(240&i))n.g.m=!1,n.g.j=!1,n.g.l="white",Ar(n.g,Lr,32),o=!1,"white_italics"===(r=Xr[(14&i)>>1])&&(r="white",o=!0),n.g.m=1==(1&i),n.g.j=o,n.g.l=r;else if(16==(247&r)&&32==(240&i)||23==(247&r)&&45==(255&i))o="black",0==(7&r)&&(o=qr[(14&i)>>1]),n.g.s=o;else if(17==(247&r)&&48==(240&i))Ar(n.g,Ir,i);else if(18==(246&r)&&32==(224&i))Ar(n.g,1&r?Dr:Pr,i);else if(20==(246&r)&&32==(240&i)){switch(i=t.pts,r=null,t.Pa){case 32:zr(n);break;case 33:(n=n.g).i[n.g].pop();break;case 37:r=Br(n,2,i);break;case 38:r=Br(n,3,i);break;case 39:r=Br(n,4,i);break;case 40:Ar(n.g,Lr,32);break;case 41:n.h=2,n.g=n.i,n.g.h=0,n.j=i;break;case 42:Er(n.s),Hr(n);break;case 43:Hr(n);break;case 44:r=n.i,o=null,n.h!==Wr&&(o=Tr(r,n.j,i)),Rr(r,0,15),r=o;break;case 45:r=n.g,n.h!==Vr?r=null:(o=Tr(r,n.j,i),Cr(r,(s=r.g-r.h+1)-1,s,r.h),Rr(r,0,s-1),Rr(r,r.g,15-r.g),n.j=i,r=o);break;case 46:Rr(n.l,0,15);break;case 47:r=null,n.h!==Wr&&(r=Tr(n.i,n.j,i)),o=n.l,n.l=n.i,n.i=o,zr(n),n.j=i}i=r;break e}i=null}else r=t.Pa,Ar(n.g,Lr,t.za),Ar(n.g,Lr,r);return i}function ya(e,t){var n=[];try{for(;t.na();){var i=oa(t).value,r=(224&i)>>5,a=31&i;if(7===r&&0!=a&&(r=63&oa(t).value),0!=r){e.j.has(r)||e.j.set(r,new sa(r));for(var o=e.j.get(r),s=t.Z();t.Z()-s<a;){var l=oa(r=t),u=l.value,c=l.pts;if(16===u&&(u=u<<16|oa(r).value),0<=u&&31>=u){var h=c;if(o.g){var d=o.g;switch(r=null,u){case 8:!$r(d)||0>=d.g&&0>=d.h||(0>=d.g?(d.g=d.F-1,d.h--):d.g--,d.i[d.h][d.g]=null);break;case 13:if(d.isVisible()&&(r=Qr(d,h,o.i)),d.h+1>=d.J){h=d;for(var p=0,f=1;15>f;f++,p++)h.i[p]=h.i[f];for(f=0;1>f;f++,p++)h.i[p]=Jr()}else d.h++;d.g=0;break;case 14:d.isVisible()&&(r=Qr(d,h,o.i)),d.i[d.h]=Jr(),d.g=0;break;case 12:d.isVisible()&&(r=Qr(d,h,o.i)),Yr(d),(h=d).h=0,h.g=0}var m=r}else m=null}else if(128<=u&&159>=u)m=la(o,r,u,c);else{if(4096<=u&&4127>=u)8<=(h=255&u)&&15>=h?r.skip(1):16<=h&&23>=h?r.skip(2):24<=h&&31>=h&&r.skip(3);else if(4224<=u&&4255>=u)128<=(h=255&u)&&135>=h?r.skip(4):136<=h&&143>=h&&r.skip(5);else if(32<=u&&127>=u)r=u,o.g&&Zr(o.g,127===r?"âª":String.fromCharCode(r));else if(160<=u&&255>=u)o.g&&Zr(o.g,String.fromCharCode(u));else if(4128<=u&&4223>=u){if(r=255&u,o.g)if(pa.has(r)){var g=pa.get(r);Zr(o.g,g)}else Zr(o.g,"_")}else 4256<=u&&4351>=u&&o.g&&Zr(o.g,160!=(255&u)?"_":"[CC]");m=null}(r=m)&&n.push(r)}}}}catch(e){if(!(e instanceof We&&3e3===e.code))throw e;K("CEA708_INVALID_DATA","Buffer read out of bounds / invalid CEA-708 Data.")}return n}function xa(e){for(var t=0;e;)t^=1&e,e>>=1;return 1===t}function ba(){}var wa=function e(t,n){var i,r,a,o;return P(e,(function(e){if(1==e.g){for(var t=0,s=0,l=0;s<n.length;)2==t&&3==n[s]?t=0:(0==n[s]?t++:t=0,n[l]=n[s],l++),s++;i=s-l,r=0}if(4!=e.g){if(!(r+i<n.length))return e.v(0);for(a=0;255==n[r];)a+=255,r++;for(a+=n[r++],o=0;255==n[r];)o+=255,r++;return o+=n[r++],4!=a?e.v(4):b(e,n.subarray(r,r+o),4)}return r+=o,e.v(2)}))};function Ma(e,t){var n=null,i=null,r=e.M();return 1&t&&e.skip(8),2&t&&e.skip(4),8&t&&(n=e.M()),16&t&&(i=e.M()),{trackId:r,Yd:n,Ne:i}}function _a(e,t){return{hd:1==t?e.nb():e.M()}}function Sa(e,t){return 1==t?(e.skip(8),e.skip(8)):(e.skip(4),e.skip(4)),{timescale:e.M()}}function Ta(e,t,n){var i=e.M(),r=[];1&n&&e.skip(4),4&n&&e.skip(4);for(var a=u(ee(i)),o=a.next();!o.done;o=a.next())o={Jd:null,sampleSize:null,Kc:null},256&n&&(o.Jd=e.M()),512&n&&(o.sampleSize=e.M()),1024&n&&e.skip(4),2048&n&&(o.Kc=0==t?e.M():e.me()),r.push(o);return{Dg:i,pe:r}}function Ea(){this.j=new ba,this.i=new Map,this.h=this.g=0}function Aa(){this.h=new Ea,this.g=new ma}function Ca(e){return!e||1==e.length&&1e-6>e.end(0)-e.start(0)?null:e.length?e.end(e.length-1):null}function Ra(e,t,n){return n=void 0===n?0:n,!(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0)||t>e.end(e.length-1))&&t+n>=e.start(0)}function La(e,t){if(!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0))return 0;for(var n=0,i=u(Ia(e)),r=i.next();!r.done;r=i.next()){var a=r.value;r=a.start,(a=a.end)>t&&(n+=a-Math.max(r,t))}return n}function Ia(e){if(!e)return[];for(var t=[],n=u(ee(e.length)),i=n.next();!i.done;i=n.next())i=i.value,t.push({start:e.start(i),end:e.end(i)});return t}function Pa(e,t,n,i){var r=this;this.g=e,this.m=n,this.j={},this.J={},this.i=null,this.L=i||function(){},this.l={},this.h=new wi,this.u={},this.D=t,this.F=new pt,this.s=function(e,t){var n=new MediaSource;return e.h.va(n,"sourceopen",(function(){URL.revokeObjectURL(e.H),t.resolve()})),e.H=qa(n),e.g.src=e.H,n}(this,this.F),this.I=new xi((function(){return function(e){var t,n,i,r,a,o,s;return D((function(l){if(1==l.g){for(n in t=[],e.l)for(i=e.l[n],r=i[0],e.l[n]=i.slice(0,1),r&&t.push(r.p.catch(Be)),a=u(i.slice(1)),o=a.next();!o.done;o=a.next())o.value.p.reject(new We(2,7,7003,void 0));for(s in e.i&&t.push(e.i.destroy()),e.m&&t.push(e.m.destroy()),e.u)t.push(e.u[s].destroy());return b(l,Promise.all(t),2)}e.h&&(e.h.release(),e.h=null),e.g&&(e.g.removeAttribute("src"),e.g.load(),e.g=null),e.s=null,e.i=null,e.m=null,e.j={},e.u={},e.D=null,e.l={},w(l)}))}(r)})),this.H=""}function Da(e,t){e.i||(e.i=new Ut(e.m)),"application/cea-608"!=t&&"application/cea-708"!=t&&(e.i.s=He(Ht[t]))}function Na(e){return!e.s||"ended"==e.s.readyState}function ka(e,t){if(t==ct)var n=e.i.g;else n=!(n=Ua(e,t))||1==n.length&&1e-6>n.end(0)-n.start(0)?null:1==n.length&&0>n.start(0)?0:n.length?n.start(0):null;return n}function Oa(e,t){return t==ct?e.i.h:Ca(Ua(e,t))}function Ua(e,t){try{return e.j[t].buffered}catch(e){return null}}function Fa(e,t,n,i,r,a){var o,s,l,h,d,p,f,m;return D((function(g){return 1==g.g?t==(o=ht).aa?b(g,function(e,t,n,i){var r,a,o;return D((function(s){return 1==s.g?b(s,Promise.resolve(),2):e.s&&e.i?null==n||null==i?(e.s.parseInit(Le(t)),s.return()):(r={periodStart:e.D,segmentStart:n,segmentEnd:i},a=e.s.parseMedia(Le(t),r),o=a.filter((function(t){return t.startTime>=e.j&&t.startTime<e.l})),e.i.append(o),null==e.g&&(e.g=Math.max(n,e.j)),e.h=Math.min(i,e.l),void w(s)):s.return()}))}(e.i,n,i,r),0):e.u[t]?b(g,function(e,t){e.l=!0,e.h=new pt,e.m=[],e.j=[],e.i=[];var n=Le(t);return e.g.push(n),e.g.flush(),e.l&&e.h.reject(new We(2,3,3018)),e.h}(e.u[t],n),10):a?(e.i||Da(e,"text/vtt"),null==i&&null==r?e.D.init(n):(s=function(e,t){for(var n=e.h.parse(t),i=(n=u(n)).next();!i.done;i=n.next()){var r=i.value,a=Le(r.Bf);if(i=e.g,r=r.pts,181===(a=new ar(a,0)).$()&&49===a.Fb()&&1195456820===a.M()&&3===a.$()){var o=a.$();if(0!=(64&o)){o&=31,a.skip(1);for(var s=0;s<o;s++){var l=a.$(),h=(4&l)>>2,d=a.$(),p=a.$();h&&(0==(l&=3)||1===l?i.h.push({pts:r,type:l,za:d,Pa:p,order:i.h.length}):(i.g.push({pts:r,type:l,value:d,order:i.g.length}),i.g.push({pts:r,type:2,value:p,order:i.g.length})))}}}}return function(e){function t(e,t){return e.pts-t.pts||e.order-t.order}var n=[];e.h.sort(t),e.g.sort(t);for(var i=u(e.h),r=i.next();!r.done;r=i.next())(r=va(e,r.value))&&n.push(r);for(r=(i=u(e.g)).next();!r.done;r=i.next())ra(e.i,r.value);for(r=(i=u(e.i.i)).next();!r.done;r=i.next())r=ya(e,r.value),n.push.apply(n,c(r));return e.i.i=[],e.h=[],e.g=[],n}(e.g)}(e.D,n)).length&&(l=e.j[o.Na].timestampOffset,zt(e.i,s,i,r,l)),n=Wa(e,n,i,t),b(g,Ha(e,t,(function(){e.j[t].appendBuffer(n)})),0)):(n=Wa(e,n,i,t),b(g,Ha(e,t,(function(){e.j[t].appendBuffer(n)})),0)):(h=g.h,e.i||Da(e,"text/vtt"),h.metadata&&(d=e.j[t].timestampOffset,e.L(h.metadata,d,r)),h.captions&&h.captions.length&&(p=e.j[o.Na].timestampOffset,f=function(e){for(var t=[],n=(e=u(e)).next();!n.done;n=e.next())n=n.value,t.push({stream:n.stream,cue:new oe(n.startTime,n.endTime,n.text)});return t}(h.captions),zt(e.i,f,i,r,p)),m=h.data,m=Wa(e,m,i,t),b(g,Ha(e,t,(function(){e.j[t].appendBuffer(m)})),0))}))}function Ba(e,t){return D((function(n){return t==ht.aa?e.i?b(n,e.i.remove(0,1/0),0):n.return():b(n,Ha(e,t,(function(){var n=e.s.duration;0>=n?za(e,t):e.j[t].remove(0,n)})),0)}))}function za(e,t){var n=e.l[t][0];n&&(n.p.resolve(),ja(e,t))}function Ha(e,t,n){return bi(e.I),n={start:n,p:new pt},e.l[t].push(n),1==e.l[t].length&&Va(e,t),n.p}function Ga(e,t){var n,i,r,a,o;return D((function(s){switch(s.g){case 1:for(r in bi(e.I),n=[],i={},e.j)i.Kb=new pt,a={start:function(e){return function(){return e.Kb.resolve()}}(i),p:i.Kb},e.l[r].push(a),n.push(i.Kb),1==e.l[r].length&&a.start(),i={Kb:i.Kb};return M(s,2),b(s,Promise.all(n),4);case 4:S(s,3);break;case 2:throw T(s);case 3:try{t()}catch(e){throw new We(2,3,3015,e)}finally{for(o in e.j)ja(e,o)}w(s)}}))}function ja(e,t){e.l[t].shift(),Va(e,t)}function Va(e,t){var n=e.l[t][0];if(n)try{n.start()}catch(i){"QuotaExceededError"==i.name?n.p.reject(new We(2,3,3017,t)):n.p.reject(new We(2,3,3015,i)),ja(e,t)}}function Wa(e,t,n,i){var r=e.g.mediaKeys;return null==n&&r&&(nn()||sn("Xbox One"))&&"mp4"==e.J[i].split(";")[0].split("/")[1]&&(t=function(e){function t(){r=!0}function n(e){a.push(e),ur(e)}e=Le(e);var i,r=!1,a=[],o=[];if((new lr).box("moov",n).box("trak",n).box("mdia",n).box("minf",n).box("stbl",n).V("stsd",(function(e){i=e,a.push(e),cr(e)})).V("encv",t).V("enca",t).V("avc1",(function(e){o.push({box:e,yd:1701733238})})).V("ec-3",(function(e){o.push({box:e,yd:1701733217})})).V("mp4a",(function(e){o.push({box:e,yd:1701733217})})).parse(e),r)return e;if(0==o.length||!i)throw At(e),new We(2,3,3019);o.reverse();for(var s=u(o),l=s.next();!l.done;l=s.next())l=l.value,e=vr(e,i,l.box,a,l.yd);return e}(t)),t}Ea.prototype.init=function(e){var t=this,n=[],i=[];if((new lr).box("moov",ur).box("mvex",ur).V("trex",(function(e){var n=e.reader;n.skip(4),n.skip(4),e=n.M(),n=n.M(),t.g=e,t.h=n})).box("trak",ur).V("tkhd",(function(e){var t=e.reader;1==e.version?(t.skip(8),t.skip(8),e=t.nb()):(t.skip(4),t.skip(4),e=t.M()),n.push(e)})).box("mdia",ur).V("mdhd",(function(e){e=Sa(e.reader,e.version),i.push(e.timescale)})).parse(e,!0),!n.length||!i.length||n.length!=i.length)throw new We(2,2,2010);n.forEach((function(e,n){t.i.set(e,i[n])}))},Ea.prototype.parse=function(e){var t=this,n=[],i=this.g,r=this.h,a=[],o=null,s=9e4;return(new lr).box("moof",ur).box("traf",ur).V("trun",(function(e){a=Ta(e.reader,e.version,e.flags).pe})).V("tfhd",(function(e){e=Ma(e.reader,e.flags),i=e.Yd||t.g,r=e.Ne||t.h,e=e.trackId,t.i.has(e)&&(s=t.i.get(e))})).V("tfdt",(function(e){o=_a(e.reader,e.version).hd})).box("mdat",(function(e){if(null===o)throw new We(2,2,2010);e=e.reader;var l=o,c=s,h=i,d=r,p=a,f=0,m=d;for(p.length&&(m=p[0].sampleSize||d);e.na();){var g=e.M();if(6==(31&e.$())){var v=0;p.length>f&&(v=p[f].Kc||0),v=(l+v)/c;for(var y=u(wa(t.j,e.$a(g-1))),x=y.next();!x.done;x=y.next())n.push({Bf:x.value,pts:v})}else e.skip(g-1);0==(m-=g+4)&&(l=p.length>f?l+(p[f].Jd||h):l+h,f++,m=p.length>f&&p[f].sampleSize||d)}})).parse(e,!1),n},Aa.prototype.init=function(e){this.h.init(e)},(i=Pa.prototype).destroy=function(){return this.I.destroy()},i.init=function(e,t){var n,i,r,a,o,s,l,c=this;return D((function(h){if(1==h.g)return n=ht,b(h,c.F,2);for(i={},r=u(e.keys()),a=r.next();!a.done;i={ra:i.ra},a=r.next())i.ra=a.value,o=e.get(i.ra),s=Dt(o.mimeType,o.codecs),i.ra==n.aa?Da(c,s):(!t&&MediaSource.isTypeSupported(s)||!Lt(s,i.ra)||(c.u[i.ra]=new Rt,s=Pt(i.ra,s)),l=c.s.addSourceBuffer(s),c.h.A(l,"error",function(e){return function(){c.l[e.ra][0].p.reject(new We(2,3,3014,c.g.error?c.g.error.code:0))}}(i)),c.h.A(l,"updateend",function(e){return function(){return za(c,e.ra)}}(i)),c.j[i.ra]=l,c.J[i.ra]=s,c.l[i.ra]=[]);w(h)}))},i.xc=function(){var e={total:Ia(this.g.buffered),audio:Ia(Ua(this,"audio")),video:Ia(Ua(this,"video")),text:[]};if(this.i){var t=this.i.g,n=this.i.h;null!=t&&null!=n&&e.text.push({start:t,end:n})}return e},i.remove=function(e,t,n){var i=this;return D((function(r){return b(r,e==ht.aa?i.i.remove(t,n):Ha(i,e,(function(){n<=t?za(i,e):i.j[e].remove(t,n)})),0)}))},i.flush=function(e){var t=this;return D((function(n){return e==ht.aa?n.return():b(n,Ha(t,e,(function(){t.g.currentTime-=.001,za(t,e)})),0)}))},i.endOfStream=function(e){var t=this;return D((function(n){return b(n,Ga(t,(function(){Na(t)||(e?t.s.endOfStream(e):t.s.endOfStream())})),0)}))},i.Ja=function(e){var t=this;return D((function(n){return b(n,Ga(t,(function(){t.s.duration=e})),0)}))},i.getDuration=function(){return this.s.duration};var qa=e.URL.createObjectURL;function Xa(e,t,n){this.ma=e,this.ja=t,this.ea=n}function Ka(e,t,n,i,r,a,o,s,l,u,c){u=void 0===u?[]:u,this.startTime=e,this.j=this.endTime=t,this.i=n,this.ja=i,this.ea=r,this.h=a,this.timestampOffset=o,this.appendWindowStart=s,this.appendWindowEnd=l,this.g=u,this.tilesLayout=void 0===c?"":c}function Ya(e,t,n){this.j=e,this.Jc=t,this.m=this.l=1/0,this.g=1,this.h=this.i=null,this.s=0,this.u=!0,this.D=0,this.F=void 0===n||n,this.H=0}function Ja(e,t){this.j=e,this.m=$a(e),this.g=e.g.currentTime,this.l=Date.now()/1e3,this.h=!1,this.s=t,this.i=function(){}}function Za(e){this.g=e}function $a(e){if(e.g.paused||0==e.g.playbackRate||0==e.g.buffered.length)var t=!1;else e:{t=e.g.currentTime;for(var n=(e=u(Ia(e.g.buffered))).next();!n.done;n=e.next())if(!(t<(n=n.value).start-.1||t>n.end-.5)){t=!0;break e}t=!1}return t}function Qa(e,t,n,i,r){var a=this;this.g=e,this.D=t,this.o=n,this.u=r,this.h=new wi,this.s=!1,this.F=e.readyState,this.j=!1,this.i=i,this.m=!1,this.h.A(e,"waiting",(function(){return eo(a)})),this.l=new Qt((function(){eo(a)})).Ba(.25)}function eo(e){if(0!=e.g.readyState){if(e.g.seeking){if(!e.s)return}else e.s=!1;if(!e.g.paused||0==e.g.currentTime){var t;if(e.g.readyState!=e.F&&(e.j=!1,e.F=e.g.readyState),!(t=!e.i)){var n=(t=e.i).j,i=$a(n),r=n.g.currentTime,a=Date.now()/1e3;t.g==r&&t.m==i||(t.l=a,t.g=r,t.m=i,t.h=!1),(i=(r=a-t.l)>=t.s&&i&&!t.h)&&(t.i(t.g,r),t.h=!0,t.g=n.g.currentTime),t=!i}if(t){var o=e.o.smallGapLimit;if(r=e.g.currentTime,!(null==(n=function(e,t,n){return!e||!e.length||1==e.length&&1e-6>e.end(0)-e.start(0)?null:0<=(e=Ia(e).findIndex((function(e,i,r){return e.start>t&&(0==i||r[i-1].end-t<=n)})))?e:null}(t=e.g.buffered,r,e.o.gapDetectionThreshold))||0==n&&!e.m||(i=t.start(n),i>=e.D.Qa()))){o=(a=i-r)<=o;var s=!1;.001>a||(o||e.j||(e.j=!0,(r=new ri("largegap",{currentTime:r,gapSize:a})).cancelable=!0,e.u(r),e.o.jumpLargeGaps&&!r.defaultPrevented&&(s=!0)),!o&&!s)||(0!=n&&t.end(n-1),e.g.currentTime=i)}}}}}function to(e,t,n,i){t==HTMLMediaElement.HAVE_NOTHING||e.readyState>=t?i():(t=no.value().get(t),n.va(e,t,i))}Xa.prototype.Wb=function(){return this.ja},Xa.prototype.Sb=function(){return this.ea},z("shaka.media.InitSegmentReference",Xa),Xa.prototype.getEndByte=Xa.prototype.Sb,Xa.prototype.getStartByte=Xa.prototype.Wb,(i=Ka.prototype).ma=function(){return this.i()},i.hf=function(){return this.startTime},i.Ve=function(){return this.endTime},i.Wb=function(){return this.ja},i.Sb=function(){return this.ea},i.nf=function(){return this.tilesLayout},z("shaka.media.SegmentReference",Ka),Ka.prototype.getTilesLayout=Ka.prototype.nf,Ka.prototype.getEndByte=Ka.prototype.Sb,Ka.prototype.getStartByte=Ka.prototype.Wb,Ka.prototype.getEndTime=Ka.prototype.Ve,Ka.prototype.getStartTime=Ka.prototype.hf,Ka.prototype.getUris=Ka.prototype.ma,(i=Ya.prototype).getDuration=function(){return this.l},i.af=function(){return this.g},i.Ja=function(e){this.l=e},i.gf=function(){return this.j},i.ue=function(e){this.s=e},i.ec=function(e){this.u=e},i.Qd=function(e){this.m=e},i.Rf=function(e){this.Jc=e},i.Ue=function(){return this.Jc},i.Cb=function(e){if(0!=e.length){var t=e[e.length-1].endTime;this.Bd(e[0].startTime),this.g=e.reduce((function(e,t){return Math.max(e,t.endTime-t.startTime)}),this.g),this.h=Math.max(this.h,t),null!=this.j&&this.F&&(this.j=(Date.now()+this.s)/1e3-this.h-this.g)}},i.Bd=function(e){this.i=null==this.i?e:Math.min(this.i,e)},i.zd=function(e){this.g=Math.max(this.g,e)},i.offset=function(e){null!=this.i&&(this.i+=e),null!=this.h&&(this.h+=e)},i.X=function(){return 1/0==this.l&&!this.u},i.kb=function(){return 1/0!=this.l&&!this.u},i.Za=function(){return Math.max(this.D,this.gb()-this.m)},i.ve=function(e){this.D=e},i.gb=function(){return this.X()||this.kb()?Math.min(Math.max(0,(Date.now()+this.s)/1e3-this.g-this.j)+this.H,this.l):this.h||this.l},i.Vb=function(e){var t=Math.max(this.i,this.D);return 1/0==this.m?Math.ceil(1e3*t)/1e3:Math.max(t,Math.min(this.gb()-this.m+e,this.Qa()))},i.zb=function(){return this.Vb(0)},i.Qa=function(){return Math.max(0,this.gb()-(this.X()||this.kb()?this.Jc:0))},i.ye=function(){return!(null==this.j||null!=this.h&&this.F)},i.te=function(e){this.H=e},z("shaka.media.PresentationTimeline",Ya),Ya.prototype.setAvailabilityTimeOffset=Ya.prototype.te,Ya.prototype.usingPresentationStartTime=Ya.prototype.ye,Ya.prototype.getSeekRangeEnd=Ya.prototype.Qa,Ya.prototype.getSeekRangeStart=Ya.prototype.zb,Ya.prototype.getSafeSeekRangeStart=Ya.prototype.Vb,Ya.prototype.getSegmentAvailabilityEnd=Ya.prototype.gb,Ya.prototype.setUserSeekStart=Ya.prototype.ve,Ya.prototype.getSegmentAvailabilityStart=Ya.prototype.Za,Ya.prototype.isInProgress=Ya.prototype.kb,Ya.prototype.isLive=Ya.prototype.X,Ya.prototype.offset=Ya.prototype.offset,Ya.prototype.notifyMaxSegmentDuration=Ya.prototype.zd,Ya.prototype.notifyMinSegmentStartTime=Ya.prototype.Bd,Ya.prototype.notifySegments=Ya.prototype.Cb,Ya.prototype.getDelay=Ya.prototype.Ue,Ya.prototype.setDelay=Ya.prototype.Rf,Ya.prototype.setSegmentAvailabilityDuration=Ya.prototype.Qd,Ya.prototype.setStatic=Ya.prototype.ec,Ya.prototype.setClockOffset=Ya.prototype.ue,Ya.prototype.getPresentationStartTime=Ya.prototype.gf,Ya.prototype.setDuration=Ya.prototype.Ja,Ya.prototype.getMaxSegmentDuration=Ya.prototype.af,Ya.prototype.getDuration=Ya.prototype.getDuration,Ja.prototype.release=function(){this.j=null,this.i=function(){}},Qa.prototype.release=function(){this.h&&(this.h.release(),this.h=null),null!=this.l&&(this.l.stop(),this.l=null),this.i&&(this.i.release(),this.i=null),this.g=this.D=this.u=null},Qa.prototype.Ed=function(){this.m=!0,eo(this)};var no=new ft((function(){return new Map([[HTMLMediaElement.HAVE_METADATA,"loadedmetadata"],[HTMLMediaElement.HAVE_CURRENT_DATA,"loadeddata"],[HTMLMediaElement.HAVE_FUTURE_DATA,"canplay"],[HTMLMediaElement.HAVE_ENOUGH_DATA,"canplaythrough"]])}));function io(e,t,n){var i=this;this.g=e,this.l=t,this.j=n,this.m=!1,this.h=new wi,this.i=new lo(e),to(this.g,HTMLMediaElement.HAVE_METADATA,this.h,(function(){oo(i,i.j)}))}function ro(e){return e.m?e.g.currentTime:e.j}function ao(e,t){0<e.g.readyState?uo(e.i,t):to(e.g,HTMLMediaElement.HAVE_METADATA,e.h,(function(){oo(e,e.j)}))}function oo(e,t){.001>Math.abs(e.g.currentTime-t)?so(e):(e.h.va(e.g,"seeking",(function(){so(e)})),uo(e.i,0==e.g.currentTime?t:e.g.currentTime))}function so(e){e.m=!0,e.h.A(e.g,"seeking",(function(){return e.l()}))}function lo(e){var t=this;this.h=e,this.m=10,this.l=this.j=this.i=0,this.g=new Qt((function(){0>=t.i||t.h.currentTime!=t.j?t.g.stop():(t.h.currentTime=t.l,t.i--)}))}function uo(e,t){e.j=e.h.currentTime,e.l=t,e.i=e.m,e.h.currentTime=t,e.g.Ba(.1)}function co(e){var t=this;this.g=e,this.j=!1,this.i=null,this.h=new wi,to(this.g,HTMLMediaElement.HAVE_CURRENT_DATA,this.h,(function(){null==t.i?t.j=!0:(t.h.va(t.g,"seeking",(function(){t.j=!0})),t.g.currentTime=Math.max(0,t.g.currentTime+t.i))}))}function ho(e,t,n,i,r,a){var o=this;this.i=e,this.g=t.presentationTimeline,this.H=t.minBufferTime||0,this.o=n,this.D=r,this.u=null,this.j=new Qa(e,t.presentationTimeline,n,function(e,t){if(!t.stallEnabled)return null;var n=t.stallSkip,i=new Ja(new Za(e),t.stallThreshold);return function(e,t){e.i=t}(i,(function(){n?e.currentTime+=n:(e.pause(),e.play())})),i}(e,n),a),this.h=new io(e,(function(){var e=o.j;e.s=!0,e.m=!1,e.j=!1;var t=ro(o.h);return e=fo(o,t),.001<Math.abs(e-t)&&(t=Date.now()/1e3,!o.u||o.u<t-1)?(o.u=t,ao(o.h,e),e=void 0):(o.D(),e=void 0),e}),function(e,t){return null==t?t=1/0>e.g.getDuration()?e.g.zb():e.g.Qa():0>t&&(t=e.g.Qa()+t),po(e,mo(e,t))}(this,i)),this.s=new Qt((function(){if(0!=o.i.readyState&&!o.i.paused){var e=ro(o.h),t=o.g.zb(),n=o.g.Qa();3>n-t&&(t=n-3),e<t&&(e=fo(o,e),o.i.currentTime=e)}})).Ba(.25)}function po(e,t){var n=e.g.getDuration();return t>=n?n-e.o.durationBackoff:t}function fo(e,t){var n=Math.max(e.H,e.o.rebufferingGoal),i=e.o.safeSeekOffset,r=e.g.zb(),a=e.g.Qa(),o=e.g.getDuration();3>a-r&&(r=a-3);var s=e.g.Vb(n),l=e.g.Vb(i);return n=e.g.Vb(n+i),t>=o?po(e,t):t>a?a:t<r?Ra(e.i.buffered,l)?l:n:t>=s||Ra(e.i.buffered,t)?t:n}function mo(e,t){var n=e.g.zb();return t<n||t>(n=e.g.Qa())?n:t}function go(e){this.g=e,this.h=null,this.i=0,this.j=!1}function vo(e,t,n){return new go([new Ka(e,e+t,(function(){return n}),0,null,null,e,e,e+t)])}function yo(e,t,n){this.i=e,this.h=t,this.g=n}function xo(){go.call(this,[]),this.l=[]}function bo(e){var t=this;this.g=e,this.j=!1,this.i=this.g.Bc(),this.h=new Qt((function(){t.g.ke(.25*t.i)}))}function wo(e){e.h.stop();var t=e.j?0:e.i;if(0<=t)try{return void(e.g.Bc()!=t&&e.g.Pd(t))}catch(e){}e.h.Ba(.25),0!=e.g.Bc()&&e.g.Pd(0)}function Mo(e){var t=this;this.h=e,this.g=new Set,this.i=new Qt((function(){_o(t,!1)})).Ba(.25)}function _o(e,t){for(var n=u(e.g),i=n.next();!i.done;i=n.next()){i=i.value;for(var r=e.h.currentTime,a=t,o=u(i.l.g),s=o.next();!s.done;s=o.next()){s=s.value;var l=i.j.get(s),c=r<s.startTime?Eo:r>s.endTime?Co:Ao;i.j.set(s,c);for(var h=u(i.m),d=h.next();!d.done;d=h.next())(d=d.value).tb==l&&d.sb==c&&d.jb(s,a)}}}function So(e){var t=this;this.h=function(){},this.g=new Set,this.j=e,this.i=new Qt((function(){for(var e=t.j(),n=u(t.g),i=n.next();!i.done;i=n.next())(i=i.value).endTime<e.start&&t.g.delete(i)})).Ba(2)}function To(e){var t=this;this.l=e,this.j=new Map,this.g=function(){},this.h=function(){},this.i=function(){},this.m=[{tb:null,sb:Ao,jb:function(e,n){return t.g(e,n)}},{tb:Eo,sb:Ao,jb:function(e,n){return t.g(e,n)}},{tb:Co,sb:Ao,jb:function(e,n){return t.g(e,n)}},{tb:Ao,sb:Eo,jb:function(e,n){return t.h(e,n)}},{tb:Ao,sb:Co,jb:function(e,n){return t.h(e,n)}},{tb:Eo,sb:Co,jb:function(e,n){return t.i(e,n)}},{tb:Co,sb:Eo,jb:function(e,n){return t.i(e,n)}}]}io.prototype.release=function(){this.h&&(this.h.release(),this.h=null),null!=this.i&&(this.i.release(),this.i=null),this.l=function(){},this.g=null},lo.prototype.release=function(){this.g&&(this.g.stop(),this.g=null),this.h=null},co.prototype.release=function(){this.h&&(this.h.release(),this.h=null),this.g=null},co.prototype.m=function(e){this.i=this.j?this.i:e},co.prototype.l=function(){return(this.j?this.g.currentTime:this.i)||0},co.prototype.F=function(){},ho.prototype.release=function(){this.h&&(this.h.release(),this.h=null),this.j&&(this.j.release(),this.j=null),this.s&&(this.s.stop(),this.s=null),this.i=this.h=this.g=this.o=null,this.D=function(){}},ho.prototype.m=function(e){ao(this.h,e)},ho.prototype.l=function(){var e=ro(this.h);return 0<this.i.readyState&&!this.i.paused?mo(this,e):e},ho.prototype.F=function(){this.j.Ed()},(i=go.prototype).destroy=function(){return Ne("shaka.media.SegmentIndex","Please use release() instead of destroy()."),this.release(),Promise.resolve()},i.release=function(){this.j||(this.g=[],this.h&&this.h.stop(),this.h=null)},i.uf=function(){this.j=!0},i.find=function(e){for(var t=this.g.length-1,n=t;0<=n;--n){var i=this.g[n],r=n<t?this.g[n+1].startTime:i.endTime;if(e>=i.startTime&&e<r)return n+this.i}return this.g.length&&e<this.g[0].startTime?this.i:null},i.get=function(e){return 0==this.g.length||0>(e-=this.i)||e>=this.g.length?null:this.g[e]},i.offset=function(e){if(!this.j)for(var t=u(this.g),n=t.next();!n.done;n=t.next())(n=n.value).startTime+=e,n.endTime+=e,n.timestampOffset+=e},i.Ec=function(e){!this.j&&e.length&&(this.g=this.g.filter((function(t){return t.startTime<e[0].startTime})),this.g.push.apply(this.g,c(e)))},i.Bb=function(e,t){var n=this;e=e.filter((function(e){return e.endTime>t&&(0==n.g.length||e.endTime>n.g[0].startTime)})),this.Ec(e),this.eb(t)},i.eb=function(e){if(!this.j){var t=this.g.length;this.g=this.g.filter((function(t){return t.endTime>e})),this.i+=t-this.g.length}},i.Ya=function(e,t,n){if(n=void 0!==n&&n,!this.j){for(;this.g.length&&this.g[this.g.length-1].startTime>=t;)this.g.pop();for(;this.g.length&&this.g[0].endTime<=e;)this.g.shift(),n||this.i++;0!=this.g.length&&(e=this.g[this.g.length-1],this.g[this.g.length-1]=new Ka(e.startTime,t,e.i,e.ja,e.ea,e.h,e.timestampOffset,e.appendWindowStart,e.appendWindowEnd,e.g,e.tilesLayout))}},i.Mc=function(e,t){var n=this;this.j||(this.h&&this.h.stop(),this.h=new Qt((function(){var e=t();e?n.g.push.apply(n.g,c(e)):(n.h.stop(),n.h=null)})),this.h.Ba(e))},go.prototype[Symbol.iterator]=function(){return this.yb(0)},go.prototype.yb=function(e){var t=this.find(e);if(null==t)return null;t--;var n=this.get(t+1),i=-1;if(n&&0<n.g.length)for(var r=n.g.length-1;0<=r;--r){var a=n.g[r];if(e>=a.startTime&&e<a.endTime){t++,i=r-1;break}}return new yo(this,t,i)},z("shaka.media.SegmentIndex",go),go.forSingleSegment=vo,go.prototype.getIteratorForTime=go.prototype.yb,go.prototype.updateEvery=go.prototype.Mc,go.prototype.fit=go.prototype.Ya,go.prototype.evict=go.prototype.eb,go.prototype.mergeAndEvict=go.prototype.Bb,go.prototype.merge=go.prototype.Ec,go.prototype.offset=go.prototype.offset,go.prototype.get=go.prototype.get,go.prototype.find=go.prototype.find,go.prototype.markImmutable=go.prototype.uf,go.prototype.release=go.prototype.release,go.prototype.destroy=go.prototype.destroy,yo.prototype.seek=function(e){return Ne("shaka.media.SegmentIterator","Please use SegmentIndex.getIteratorForTime instead of seek()."),(e=this.i.yb(e))?(this.h=e.h,this.g=e.g):(this.h=Number.MAX_VALUE,this.g=0),this.next().value},yo.prototype.current=function(){var e=this.i.get(this.h);return e&&0<e.g.length&&e.ma().length&&this.g>=e.g.length&&(this.h++,this.g=0,e=this.i.get(this.h)),e&&0<e.g.length?e.g[this.g]:e},yo.prototype.next=function(){var e=this.i.get(this.h);return e&&0<e.g.length?(this.g++,e.ma().length&&this.g==e.g.length&&(this.h++,this.g=0)):(this.h++,this.g=0),{value:e=this.current(),done:!e}},z("shaka.media.SegmentIterator",yo),yo.prototype.next=yo.prototype.next,yo.prototype.current=yo.prototype.current,yo.prototype.seek=yo.prototype.seek,g(xo,go),(i=xo.prototype).clone=function(){var e=new xo;return e.l=this.l.slice(),e},i.release=function(){for(var e=u(this.l),t=e.next();!t.done;t=e.next())t.value.release();this.l=[]},i.find=function(e){for(var t=0,n=u(this.l),i=n.next();!i.done;i=n.next()){var r=(i=i.value).find(e);if(null!=r)return r+t;t+=i.i+i.g.length}return null},i.get=function(e){for(var t=0,n=u(this.l),i=n.next();!i.done;i=n.next()){var r=(i=i.value).get(e-t);if(r)return r;t+=i.i+i.g.length}return null},i.offset=function(){},i.Ec=function(){},i.eb=function(){},i.Bb=function(){},i.Ya=function(){},i.Mc=function(){},z("shaka.media.MetaSegmentIndex",xo),xo.prototype.updateEvery=xo.prototype.Mc,xo.prototype.fit=xo.prototype.Ya,xo.prototype.mergeAndEvict=xo.prototype.Bb,xo.prototype.evict=xo.prototype.eb,xo.prototype.merge=xo.prototype.Ec,xo.prototype.offset=xo.prototype.offset,xo.prototype.get=xo.prototype.get,xo.prototype.find=xo.prototype.find,xo.prototype.release=xo.prototype.release,bo.prototype.release=function(){this.h&&(this.h.stop(),this.h=null),this.g=null},bo.prototype.set=function(e){this.i=e,wo(this)},bo.prototype.yc=function(){return this.g.yc()},Mo.prototype.release=function(){this.i.stop();for(var e=u(this.g),t=e.next();!t.done;t=e.next())t.value.release();this.g.clear()},So.prototype.release=function(){this.h=function(){},this.g.clear(),this.i.stop()},To.prototype.release=function(){this.l=null,this.j.clear(),this.g=function(){},this.h=function(){},this.i=function(){}};var Eo=1,Ao=2,Co=3;function Ro(e,t,n,i,r){return e=di(e,i,r),0==t&&null==n||(e.headers.Range=n?"bytes="+t+"-"+n:"bytes="+t+"-"),e}function Lo(e,t){var n=this;this.C=t,this.B=e,this.o=null,this.l=1,this.i=this.h=null,this.g=new Map,this.m=!1,this.s=null,this.j=!1,this.I=new xi((function(){return function(e){var t,n,i,r;return D((function(a){if(1==a.g){for(t=[],n=u(e.g.values()),i=n.next();!i.done;i=n.next())Go(r=i.value),t.push(jo(r));return b(a,Promise.all(t),2)}e.g.clear(),e.C=null,e.B=null,e.o=null,w(a)}))}(n)}))}function Io(e,t){var n=e.g.get("video");if(n){var i=n.stream;if(i)if(t){var r=i.trickModeVideo;r&&!n.pb&&(No(e,r,!1,0,!1),n.pb=i)}else(i=n.pb)&&(n.pb=null,No(e,i,!0,0,!1))}}function Po(e,t,n,i,r){n=void 0!==n&&n,i=void 0===i?0:i,r=void 0!==r&&r,e.h=t,e.m&&(t.video&&No(e,t.video,n,i,r),t.audio&&No(e,t.audio,n,i,r))}function Do(e,t){e.i=t,e.m&&No(e,t,!0,0,!1)}function No(e,t,n,i,r){var a=e.g.get(t.type);a||t.type!=ct?a&&(a.pb&&(t.trickModeVideo?(a.pb=t,t=t.trickModeVideo):a.pb=null),a.stream!=t||r)&&(t.type==ct&&Da(e.C.P,Dt(t.mimeType,t.codecs)),a.stream=t,a.ca=null,n&&(a.Qb?a.Pc=!0:a.Ra?(a.rb=!0,a.uc=i,a.Pc=!0):(Go(a),zo(e,a,!0,i).catch((function(t){e.C&&e.C.onError(t)})))),function(e,t){var n,i;return D((function(r){if(1==r.g)return t.wa?(n=t.stream,i=t.wa,n.segmentIndex?r.v(2):b(r,n.createSegmentIndex(),2)):r.return();if(t.wa!=i||t.stream!=n)return r.return();var a=e.C.Ac(),o=Oa(e.C.P,t.type),s=t.stream.segmentIndex.find(t.Aa?t.Aa.endTime:a),l=null==s?null:t.stream.segmentIndex.get(s);s=l&&l.ea?l.ea-l.ja:null,l&&!s&&(s=(l.endTime-l.startTime)*(t.stream.bandwidth||0)/8),s?((l=l.h)&&(s+=(l.ea?l.ea-l.ja:null)||0),a=8*s/(l=e.C.getBandwidthEstimate())<(o||0)-a-Math.max(e.B.minBufferTime||0,e.o.rebufferingGoal)||t.wa.h.g>s):a=!1,a&&t.wa.abort(),w(r)}))}(e,a).catch((function(t){e.C&&e.C.onError(t)}))):function(e,t){var n,i,r,a;D((function(o){switch(o.g){case 1:return n=ht,M(o,2),b(o,Ba(e.C.P,n.aa),4);case 4:S(o,3);break;case 2:i=T(o),e.C&&e.C.onError(i);case 3:r=Dt(t.mimeType,t.codecs),Da(e.C.P,r),(e.C.P.m.isTextVisible()||e.o.alwaysStreamText)&&(a=Oo(t),e.g.set(n.aa,a),Ho(e,a,0)),w(o)}}))}(e,t)}function ko(e,t){t.Qb||t.rb||(t.Ra?(t.rb=!0,t.uc=0):null==ka(e.C.P,t.type)?null==t.La&&Ho(e,t,0):(Go(t),zo(e,t,!1,0).catch((function(t){e.C&&e.C.onError(t)}))))}function Oo(e){return{stream:e,type:e.type,ca:null,Aa:null,Dc:null,vd:null,ud:null,td:null,pb:null,endOfStream:!1,Ra:!1,La:null,rb:!1,uc:0,Pc:!1,Qb:!1,Hd:!1,Xb:!1,wa:null}}function Uo(e,t,n,i,r,a){var o;return D((function(s){return 1==s.g?(o=i.closedCaptions&&0<i.closedCaptions.size,null!=i.emsgSchemeIdUris&&0<i.emsgSchemeIdUris.length&&(new lr).V("emsg",(function(t){var n=i.emsgSchemeIdUris;if(0===t.version)var a=t.reader.ac(),o=t.reader.ac(),s=t.reader.M(),l=t.reader.M(),u=t.reader.M(),c=t.reader.M(),h=r.startTime+l/s;else s=t.reader.M(),l=(h=t.reader.nb()/s+r.timestampOffset)-r.startTime,u=t.reader.M(),c=t.reader.M(),a=t.reader.ac(),o=t.reader.ac();t=t.reader.$a(t.reader.R.byteLength-t.reader.Z()),n.includes(a)&&("urn:mpeg:dash:event:2012"==a?e.C.Af():(n=new ri(sl,{detail:{startTime:h,endTime:h+u/s,schemeIdUri:a,value:o,timescale:s,presentationTimeDelta:l,eventDuration:u,id:c,messageData:t}}),e.C.onEvent(n)))})).parse(a),b(s,function(e,t,n){var i,r,a;return D((function(o){if(1==o.g)return i=Math.max(e.o.bufferBehind,e.B.presentationTimeline.g),null==(r=ka(e.C.P,t.type))||.01>=(a=n-r-i)?o.return():b(o,e.C.P.remove(t.type,r,r+a),2);bi(e.I),w(o)}))}(e,t,n),2)):3!=s.g?(bi(e.I),b(s,Fa(e.C.P,t.type,a,r.startTime,r.endTime,o),3)):(bi(e.I),void w(s))}))}function Fo(e){return e&&e.type==ct&&("application/cea-608"==e.stream.mimeType||"application/cea-708"==e.stream.mimeType)}function Bo(e,t,n,i){var r,a,o,s;return D((function(l){return 1==l.g?(r=gi,a=Ro(n.ma(),n.ja,n.ea,e.o.retryParameters,i),o=e.C.lb.request(r,a),t.wa=o,b(l,o.promise,2)):(s=l.h,t.wa=null,l.return(s.data))}))}function zo(e,t,n,i){var r,a;return D((function(o){return 1==o.g?(t.rb=!1,t.Pc=!1,t.uc=0,t.Qb=!0,t.Aa=null,t.Dc=null,t.ca=null,i?(r=e.C.Ac(),a=e.C.P.getDuration(),b(o,e.C.P.remove(t.type,r+i,a),3)):b(o,Ba(e.C.P,t.type),4)):3!=o.g?(bi(e.I),n?b(o,e.C.P.flush(t.type),3):o.v(3)):(bi(e.I),t.Qb=!1,t.endOfStream=!1,Ho(e,t,0),void w(o))}))}function Ho(e,t,n){var i=t.type;(i!=ct||e.g.has(i))&&(t.La=new $t((function(){var n;return D((function(i){return 1==i.g?(M(i,2),b(i,e.Zb(t),4)):2!=i.g?S(i,0):(n=T(i),e.C&&e.C.onError(n),void w(i))}))})).S(n))}function Go(e){null!=e.La&&(e.La.stop(),e.La=null)}function jo(e){return D((function(t){return e.wa?b(t,e.wa.abort(),0):t.v(0)}))}function Vo(e,t){return D((function(n){if(1==n.g)return b(n,Zn(e.s),2);bi(e.I),e.C.onError(t),t.handled||e.o.failureCallback(t),w(n)}))}function Wo(e,t){var n={G:null,mimeType:null,startTime:null,Rd:NaN,uri:null},i=this;this.j=t,this.i=e,this.l=n,this.s=null,this.m=[],this.h=this.g=null,this.u=Promise.resolve().then((function(){return function(e){return D((function(t){if(e.I.g)t=t.v(0);else{if(0==e.m.length||e.g&&!e.g.ib)var n=!1;else{e.g&&(e.g.Ha.mb(),e.g=null);var i=(n=e.m.shift()).create(e.l);i?(n.Ha.Db(),e.g={node:i.node,payload:i.payload,ib:i.ib,Ha:n.Ha}):n.Ha.Hc(),n=!0}n?n=Promise.resolve():e.g?n=function(e){var t,n;return D((function(i){switch(i.g){case 1:return e.i=e.j.cf(e.i,e.l,e.g.node,e.g.payload),M(i,2),e.h=e.j.Pe(e.i,e.l,e.g.payload),b(i,e.h.promise,4);case 4:e.h=null,e.i==e.g.node&&(e.g.Ha.Fc(),e.g=null),S(i,0);break;case 2:return 7001==(t=T(i)).code?e.g.Ha.mb():e.g.Ha.onError(t),e.g=null,e.h=null,n=e,b(i,e.j.handleError(e.l,t),5);case 5:n.i=i.h,w(i)}}))}(e):(e.j.zf(e.i),e.s=new pt,n=e.s),t=b(t,n,1)}return t}))}(i)})),this.I=new xi((function(){return function(e){var t,n;return D((function(i){if(1==i.g)return e.h&&e.h.abort(),Xo(e),b(i,e.u,2);for(e.g&&e.g.Ha.mb(),t=u(e.m),n=t.next();!n.done;n=t.next())n.value.Ha.mb();e.g=null,e.m=[],e.j=null,w(i)}))}(i)}))}function qo(e,t){var n={Db:function(){},Fc:function(){},mb:function(){},onError:function(){},Hc:function(){},Cg:function(){}};return e.m.push({create:t,Ha:n}),e.h&&e.h.abort(),Xo(e),n}function Xo(e){e.s&&(e.s.resolve(),e.s=null)}function Ko(e){this.g=null;for(var t=u(Array.from(e.textTracks)),n=t.next();!n.done;n=t.next())(n=n.value).mode="disabled","Shaka Player TextTrack"==n.label&&(this.g=n);this.g||(this.g=e.addTextTrack("subtitles","Shaka Player TextTrack")),this.g.mode="hidden"}function Yo(e){if(e.startTime>=e.endTime)return null;var t=new VTTCue(e.startTime,e.endTime,e.payload);t.lineAlign=e.lineAlign,t.positionAlign=e.positionAlign,e.size&&(t.size=e.size);try{t.align=e.textAlign}catch(e){}return"center"==e.textAlign&&"center"!=t.align&&(t.align="middle"),"vertical-lr"==e.writingMode?t.vertical="lr":"vertical-rl"==e.writingMode&&(t.vertical="rl"),1==e.lineInterpretation&&(t.snapToLines=!1),null!=e.line&&(t.line=e.line),null!=e.position&&(t.position=e.position),t}function Jo(e,t){var n=e.mode;e.mode="showing"==n?"showing":"hidden";for(var i=u(Array.from(e.cues)),r=i.next();!r.done;r=i.next())(r=r.value)&&t(r)&&e.removeCue(r);e.mode=n}function Zo(){}function $o(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function Qo(t,n){var i=this;this.u=!1,this.j=[],this.g=t,this.m=n,this.i=document.createElement("div"),this.i.classList.add("shaka-text-container"),this.i.style.textAlign="center",this.i.style.display="flex",this.i.style.flexDirection="column",this.i.style.alignItems="center",this.i.style.justifyContent="flex-end",this.m.appendChild(this.i),this.D=new Qt((function(){es(i)})).Ba(.25),this.l=new Map,this.h=new wi,this.h.A(document,"fullscreenchange",(function(){es(i,!0)})),this.s=null,"ResizeObserver"in e&&(this.s=new ResizeObserver((function(){es(i,!0)})),this.s.observe(this.i))}function es(e,t){function n(t){return e.j.includes(t)&&e.u&&t.startTime<=i&&t.endTime>i}t=void 0!==t&&t;for(var i=e.g.currentTime,r=u(e.l.keys()),a=r.next();!a.done;a=r.next())if(!n(a=a.value)||t){var o=e.l.get(a);e.i.removeChild(o),e.l.delete(a)}for(r=new Set(e.l.values()),o=(a=u(Array.from(e.i.childNodes))).next();!o.done;o=a.next())o=o.value,r.has(o)||e.i.removeChild(o);for(a=(r=u(r=e.j.filter((function(t){return n(t)&&!e.l.has(t)})).sort((function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime-t.endTime})))).next();!a.done;a=r.next())a=a.value,o=ts(e,e.i,a,!1),e.l.set(a,o)}function ts(e,t,n,i){var r=i?"span":"div";(n.lineBreak||n.spacer)&&(n.spacer&&Ne("shaka.extern.Cue","Please use lineBreak instead of spacer."),r="br");var a=document.createElement(r);for("br"!=r&&function(e,t,n,i){var r=t.style,a=0==n.nestedCues.length;r.whiteSpace="pre-wrap";var o=n.payload.replace(/\s+$/g,(function(e){return"Â ".repeat(e.length)}));i?t.textContent=o:o.length&&((r=document.createElement("span")).textContent=o,t.appendChild(r),r=r.style),r.backgroundColor=n.backgroundColor,r.border=n.border,r.color=n.color,r.direction=n.direction,r.opacity=n.opacity,r.paddingLeft=ns(n.linePadding,n,e.m),r.paddingRight=ns(n.linePadding,n,e.m),n.backgroundImage&&(r.backgroundImage="url('"+n.backgroundImage+"')",r.backgroundRepeat="no-repeat",r.backgroundSize="contain",r.backgroundPosition="center",""==n.backgroundColor&&(r.backgroundColor="transparent")),i?r.display="inline":(r.display="flex",r.flexDirection="column",r.alignItems="center",r.justifyContent="before"==n.displayAlign?"flex-start":"center"==n.displayAlign?"center":"flex-end"),a||(r.margin="0"),r.fontFamily=n.fontFamily,r.fontWeight=n.fontWeight.toString(),r.fontStyle=n.fontStyle,r.letterSpacing=n.letterSpacing,r.fontSize=ns(n.fontSize,n,e.m),n.line?1==n.lineInterpretation&&(r.position="absolute",n.writingMode==fe?n.lineAlign==ge?r.top=n.line+"%":"end"==n.lineAlign&&(r.bottom=n.line+"%"):"vertical-lr"==n.writingMode?n.lineAlign==ge?r.left=n.line+"%":"end"==n.lineAlign&&(r.right=n.line+"%"):n.lineAlign==ge?r.right=n.line+"%":"end"==n.lineAlign&&(r.left=n.line+"%")):n.region&&n.region.id&&(!i&&!a||n.backgroundImage)&&(e=n.region.widthUnits==Se?"%":"px",t=n.region.viewportAnchorUnits==Se?"%":"px",r.height=n.region.height+(n.region.heightUnits==Se?"%":"px"),r.width=n.region.width+e,r.position="absolute",r.top=n.region.viewportAnchorY+t,r.left=n.region.viewportAnchorX+t),r.lineHeight=n.lineHeight,n.position&&(n.writingMode==fe?r.paddingLeft=n.position:r.paddingTop=n.position),"line-left"==n.positionAlign?r.cssFloat="left":"line-right"==n.positionAlign&&(r.cssFloat="right"),r.textAlign=n.textAlign,r.textDecoration=n.textDecoration.join(" "),r.writingMode=n.writingMode,"writingMode"in document.documentElement.style&&r.writingMode==n.writingMode||(r.webkitWritingMode=n.writingMode),n.size&&(n.writingMode==fe?r.width=n.size+"%":r.height=n.size+"%")}(e,a,n,i),r=a,!i&&n.nestedCues.length&&((r=document.createElement("span")).classList.add("shaka-text-wrapper"),a.appendChild(r)),i=(n=u(n.nestedCues)).next();!i.done;i=n.next())ts(e,r,i.value,!0);return t.appendChild(a),a}function ns(e,t,n){var i=(i=new RegExp(/(\d*\.?\d+)([a-z]+|%+)/).exec(e))?{value:Number(i[1]),Vf:i[2]}:null;if(!i)return e;var r=i.value;switch(i.Vf){case"%":return r/100*n.clientHeight/t.cellResolution.rows+"px";case"c":return n.clientHeight*r/t.cellResolution.rows+"px";default:return e}}function is(){}function rs(e,t,n,i,r){var a,o=r in i,s=!0;for(a in t){var l=r+"."+a,u=o?i[r]:n[a];o||a in n?void 0===t[a]?void 0===u||o?delete e[a]:e[a]=oi(u):u.constructor==Object&&t[a]&&t[a].constructor==Object?(e[a]||(e[a]=oi(u)),l=rs(e[a],t[a],u,i,l),s=s&&l):typeof t[a]!=typeof u||null==t[a]||"function"!=typeof t[a]&&t[a].constructor!=u.constructor?(q("Invalid config, wrong type for "+l),s=!1):("function"==typeof n[a]&&n[a].length!=t[a].length&&X("Unexpected number of arguments for "+l),e[a]=t[a]):(q("Invalid config, unrecognized key "+l),s=!1)}return s}function as(e,t){for(var n={},i=n,r=0,a=0;!(0>(r=e.indexOf(".",r)));)0!=r&&"\\"==e[r-1]||(i[a=e.substring(a,r).replace(/\\\./g,".")]={},i=i[a],a=r+1),r+=1;return i[e.substring(a).replace(/\\\./g,".")]=t,n}function os(){}function ss(){var e=1/0;navigator.connection&&navigator.connection.saveData&&(e=360);var t={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4},servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1,initDataTransform:zi,logLicenseExchange:!1,updateExpirationTime:1,preferredKeySystems:[]},n={retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4},failureCallback:function(e){return[e]},rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,gapDetectionThreshold:.1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1,useNativeHlsOnSafari:!0,inaccurateManifestTolerance:2,lowLatencyMode:!1,autoLowLatencyMode:!1,forceHTTPS:!1,preferNativeHls:!1,updateIntervalSeconds:1};(navigator.userAgent.match(/Edge\//)||nn()||rn())&&(n.gapDetectionThreshold=.5),(sn("Web0S")||nn()||rn())&&(n.stallSkip=0);var i={trackSelectionCallback:function(e){return D((function(t){return t.return(e)}))},downloadSizeCallback:function(e){var t;return D((function(n){return 1==n.g?navigator.storage&&navigator.storage.estimate?b(n,navigator.storage.estimate(),3):n.return(!0):(t=n.h,n.return(t.usage+e<.95*t.quota))}))},progressCallback:function(e,t){return[e,t]},usePersistentLicense:!0},r={drm:t,manifest:{retryParameters:{maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:3e4,stallTimeout:5e3,connectionTimeout:1e4},availabilityWindowOverride:NaN,disableAudio:!1,disableVideo:!1,disableText:!1,disableThumbnails:!1,defaultPresentationDelay:0,dash:{clockSyncUri:"",ignoreDrmInfo:!1,disableXlinkProcessing:!1,xlinkFailGracefully:!1,ignoreMinBufferTime:!1,autoCorrectDrift:!0,initialSegmentLimit:1e3,ignoreSuggestedPresentationDelay:!1,ignoreEmptyAdaptationSet:!1,ignoreMaxSegmentDuration:!1,keySystemsByURI:{"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},manifestPreprocessor:function(e){return e}},hls:{ignoreTextStreamFailures:!1,ignoreImageStreamFailures:!1,useFullSegmentsForStartTime:!1}},streaming:n,offline:i,abrFactory:function(){return new Un},abr:{enabled:!0,useNetworkInformation:!0,defaultBandwidthEstimate:1e6,switchInterval:8,bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:e,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0}},preferredAudioLanguage:"",preferredTextLanguage:"",preferredVariantRole:"",preferredTextRole:"",preferredAudioChannelCount:2,preferredVideoCodecs:[],preferredAudioCodecs:[],preferForcedSubs:!1,preferredDecodingAttributes:[],restrictions:{minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0,minFrameRate:0,maxFrameRate:1/0,minBandwidth:0,maxBandwidth:1/0},playRangeStart:0,playRangeEnd:1/0,textDisplayFactory:function(){return null}};return i.trackSelectionCallback=function(e){return D((function(t){return t.return(function(e,t){var n=e.filter((function(e){return"variant"==e.type})),i=[],r=Kt(t,n.map((function(e){return e.language})));r&&(i=n.filter((function(e){return Wt(e.language)==r}))),0==i.length&&(i=n.filter((function(e){return e.primary}))),0==i.length&&(n.map((function(e){return e.language})),i=n);var a=i.filter((function(e){return e.height&&480>=e.height}));if(a.length&&(a.sort((function(e,t){return t.height-e.height})),i=a.filter((function(e){return e.height==a[0].height}))),n=[],i.length){var o=Math.floor(i.length/2);i.sort((function(e,t){return e.bandwidth-t.bandwidth})),n.push(i[o])}for(o=(i=u(e)).next();!o.done;o=i.next())(o=o.value).type!=ct&&"image"!=o.type||n.push(o);return n}(e,r.preferredAudioLanguage))}))},r}function ls(e,t,n){var i={".drm.servers":"",".drm.clearKeys":"",".drm.advanced":{distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:"",audioRobustness:"",sessionType:"",serverCertificate:new Uint8Array(0),serverCertificateUri:"",individualizationServer:""}};return rs(e,t,n||ss(),i,"")}function us(){this.g=null,this.h=[]}function cs(e,t){if(null==e.g)e.g={timestamp:Date.now()/1e3,state:t,duration:0};else{var n=Date.now()/1e3;e.g.duration=n-e.g.timestamp,e.g.state!=t&&(e.h.push(e.g),e.g={timestamp:n,state:t,duration:0})}}function hs(e,t){var n=0;e.g&&e.g.state==t&&(n+=e.g.duration);for(var i=u(e.h),r=i.next();!r.done;r=i.next())n+=(r=r.value).state==t?r.duration:0;return n}function ds(){this.i=this.h=null,this.g=[]}function ps(e,t,n){e.i!=t&&(e.i=t,e.g.push({timestamp:Date.now()/1e3,id:t.id,type:"text",fromAdaptation:n,bandwidth:null}))}function fs(){this.s=this.u=this.J=this.F=this.m=this.j=this.H=this.l=this.i=this.L=this.N=this.T=this.D=this.Y=NaN,this.g=new us,this.h=new ds}function ms(t,n){ai.call(this);var i=this;this.l=Cl,this.nc=this.g=null,this.Y=!1,this.h=new wi,this.fd=this.u=this.Wa=this.B=this.rc=this.s=this.i=this.fc=this.H=this.oc=this.F=this.Fa=this.D=this.J=this.m=this.O=null,this.nd=1e9,this.o=Cs(this),this.md={width:1/0,height:1/0},this.j=null,this.pa=new Wn(this.o.preferredAudioLanguage,this.o.preferredVariantRole,this.o.preferredAudioChannelCount),this.qa=this.o.preferredTextLanguage,this.Nb=this.o.preferredTextRole,this.Xa=this.o.preferForcedSubs,this.gd=[],n&&n(this),this.O=function(e){return new ci((function(t,n){e.u&&e.u.segmentDownloaded(t,n)}))}(this),this.O.Nd(this.o.streaming.forceHTTPS),this.L=null,Nl&&(this.L=He(Nl)),this.h.A(e,"online",(function(){i.Id()})),this.sa={name:"detach"},this.Oa={name:"attach"},this.T={name:"unload"},this.pd={name:"manifest-parser"},this.ld={name:"manifest"},this.Ea={name:"media-source"},this.jd={name:"drm-engine"},this.N={name:"load"},this.qd={name:"src-equals-drm-engine"},this.Ma={name:"src-equals"};var r=new Map;r.set(this.Oa,(function(e,t){return ni(function(e,t,n){return null==t.G&&(t.G=n.G,e.h.A(t.G,"error",(function(){var t=Ws(e);t&&js(e,t)}))),e.g=t.G,Promise.resolve()}(i,e,t))})),r.set(this.sa,(function(e){return e.G&&(i.h.Ca(e.G,"error"),e.G=null),i.g=null,ni(e=Promise.resolve())})),r.set(this.T,(function(e){return ni(vs(i,e))})),r.set(this.Ea,(function(e){return ni(e=function(e,t){var n,i,r,a;return D((function(o){if(1==o.g)return n=new Aa,i=e.o.textDisplayFactory,r=He(i),e.kd=i,b(o,(a=function(e,t,n,i){return new Pa(e,t,n,i)}(t.G,n,r,(function(t,n,i){for(var r=(t=u(t)).next();!r.done;r=t.next())if((r=r.value).data&&r.cueTime&&r.frames){for(var a=r.cueTime+n,o=i,s=u(r.frames),l=s.next();!l.done;l=s.next())ys(e,a,o,"ID3",l.value);e.L&&e.L.onHlsTimedMetadata(r,a)}}))).F,2);e.J=a,w(o)}))}(i,e))})),r.set(this.pd,(function(e,t){return ni(function(e,t,n){var i,r,a,o;return D((function(s){if(1==s.g)return t.mimeType=n.mimeType,t.uri=n.uri,i=t.uri,r=e.O,e.Wa=i,a=e,b(s,er(i,r,e.o.manifest.retryParameters,t.mimeType),2);a.rc=s.h,e.s=He(e.rc),o=oi(e.o.manifest),n.G&&"AUDIO"===n.G.nodeName&&(o.disableVideo=!0),e.s.configure(o),w(s)}))}(i,e,t))})),r.set(this.ld,(function(e){return function(e,t){var n=t.uri,i=e.O;e.fc=new So((function(){return e.bc()})),function(e,t){e.h=t}(e.fc,(function(t){Vs(e,bl,t),e.L&&e.L.onDashTimedMetadata(t)}));var r={networkingEngine:i,filter:function(t){return D((function(n){return n.return(e.wc(t))}))},makeTextStreamsForClosedCaptions:function(t){return function(e,t){for(var n=new Set,i=u(t.textStreams),r=i.next();!r.done;r=i.next())"application/cea-608"!=(r=r.value).mimeType&&"application/cea-708"!=r.mimeType||n.add(r.originalId);for(r=(i=u(t.variants)).next();!r.done;r=i.next())if((r=r.value.video)&&r.closedCaptions)for(var a=u(r.closedCaptions.keys()),o=a.next();!o.done;o=a.next())if(o=o.value,!n.has(o)){var s=o.startsWith("CC")?"application/cea-608":"application/cea-708",l=new xo;s={id:e.nd++,originalId:o,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:l,mimeType:s,codecs:"",kind:"caption",encrypted:!1,drmInfos:[],keyIds:new Set,language:r.closedCaptions.get(o),label:null,type:ct,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:r.roles,forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},t.textStreams.push(s),n.add(o)}}(e,t)},onTimelineRegionAdded:function(t){var n=e.fc;e:{for(var i=u(n.g),r=i.next();!r.done;r=i.next())if((r=r.value).schemeIdUri==t.schemeIdUri&&r.id==t.id&&r.startTime==t.startTime&&r.endTime==t.endTime){i=r;break e}i=null}null==i&&(n.g.add(t),n.h(t))},onEvent:function(t){return e.dispatchEvent(t)},onError:function(t){return js(e,t)},isLowLatencyMode:function(){return e.o.streaming.lowLatencyMode},isAutoLowLatencyMode:function(){return e.o.streaming.autoLowLatencyMode},enableLowLatencyMode:function(){e.configure("streaming.lowLatencyMode",!0)}},a=Date.now()/1e3;return new $n(function(){var t,i,o,s;return D((function(l){if(1==l.g)return t=e,b(l,e.s.start(n,r),2);if(t.B=l.h,i=gs(dl),e.dispatchEvent(i),0==e.B.variants.length)throw new We(2,4,4036);!function(e){function t(e){return e.video&&e.audio||e.video&&e.video.codecs.includes(",")}e.variants.some(t)&&(e.variants=e.variants.filter(t))}(e.B),o=Date.now()/1e3,s=o-a,e.j.H=s,w(l)}))}(),(function(){return e.s.stop()}))}(i,e)})),r.set(this.jd,(function(e){return ni(e=function(e,t){var n,i;return D((function(r){return 1==r.g?(n=Date.now()/1e3,i=!0,e.m=bs(e,{lb:e.O,onError:function(t){js(e,t)},Gc:function(t){qs(e,t)},onExpirationUpdated:function(t,n){Xs(e,t,n)},onEvent:function(t){e.dispatchEvent(t),t.type==ol&&i&&(i=!1,e.j.j=Date.now()/1e3-n)}}),e.m.configure(e.o.drm),b(r,Ii(e.m,e.B.variants,e.B.offlineSessionIds),2)):3!=r.g?b(r,e.m.Pb(t.G),3):b(r,e.wc(e.B),0)}))}(i,e))})),r.set(this.N,(function(e,t){return ni(function(e,t,n){var i,r,a,o,s,l,c,h,d,p;return D((function(f){switch(f.g){case 1:if(t.startTime=n.startTime,i=t.G,r=t.uri,e.Wa=r,e.F=new bo({Bc:function(){return t.G.playbackRate},yc:function(){return t.G.defaultPlaybackRate},Pd:function(e){t.G.playbackRate=e},ke:function(e){t.G.currentTime+=e}}),a=function(){return Ps(e)},o=function(){return Is(e)},e.h.A(i,"playing",a),e.h.A(i,"pause",a),e.h.A(i,"ended",a),e.h.A(i,"ratechange",o),s=e.o.abrFactory,e.u&&e.fd==s||(e.fd=s,e.u=He(s),"function"!=typeof e.u.playbackRateChanged&&(Ne("AbrManager","Please use an AbrManager with playbackRateChanged function."),e.u.playbackRateChanged=function(){}),e.u.configure(e.o.abr)),e.pa=new Wn(e.o.preferredAudioLanguage,e.o.preferredVariantRole,e.o.preferredAudioChannelCount),e.qa=e.o.preferredTextLanguage,e.Nb=e.o.preferredTextRole,e.Xa=e.o.preferForcedSubs,Ks(e.B.presentationTimeline,e.o.playRangeStart,e.o.playRangeEnd),e.u.init((function(t,n,i){e.i&&t!=e.i.h&&ks(e,t,!0,void 0!==n&&n,void 0===i?0:i)})),e.D=function(e,t){return new ho(e.g,e.B,e.o.streaming,t,(function(){if(e.Fa&&_o(e.Fa,!0),e.i)for(var t=e.i,n=t.C.Ac(),i=t.o.smallGapLimit,r=u(t.g.keys()),a=r.next();!a.done;a=r.next()){a=a.value;var o=t.g.get(a);o.ca=null;var s=t.C.P;if(!(s=a==ct?null!=(s=s.i).g&&null!=s.h&&n>=s.g&&n<s.h:Ra(s=Ua(s,a),n,i))&&(null!=Oa(t.C.P,a)&&ko(t,o),o.wa&&(o.wa.abort(),o.wa=null),a===ct))for((a=t.C.P.D.g).l=0,a.h=[],a.g=[],(o=a.i).i=[],o.h=[],o.g=0,ga(a),o=(a=u(a.j.values())).next();!o.done;o=a.next())ha(o.value)}e.H&&Ms(e)}),(function(t){return e.dispatchEvent(t)}))}(e,t.startTime),e.Fa=function(e){var t=new To(e.fc);!function(e,t,n,i){e.g=t,e.h=n,e.i=i}(t,(function(t){Vs(e,wl,t)}),(function(t){Vs(e,Ml,t)}),(function(t,n){n||(Vs(e,wl,t),Vs(e,Ml,t))}));var n=new Mo(e.g);return n.g.add(t),n}(e),l=Math.max(e.B.minBufferTime,e.o.streaming.rebufferingGoal),ws(e,l),hn(e.B,e.o.preferredVideoCodecs,e.o.preferredAudioCodecs,e.o.preferredAudioChannelCount,e.o.preferredDecodingAttributes),e.i=function(e){return new Lo(e.B,{Ac:function(){return e.D.l()},getBandwidthEstimate:function(){return e.u.getBandwidthEstimate()},P:e.J,lb:e.O,onError:function(t){return js(e,t)},onEvent:function(t){return e.dispatchEvent(t)},Af:function(){e.s&&e.s.update&&e.s.update()},Ed:function(){e.D&&e.D.F(),Ms(e)}})}(e),e.i.configure(e.o.streaming),e.l=Rl,e.dispatchEvent(gs(vl)),c=null,e.Cc().find((function(e){return e.active}))){f.v(2);break}if(c=Ds(e)?e.u.chooseVariant():null,ks(e,c,!0,!1,0),!e.o.streaming.startAtSegmentBoundary){f.v(3);break}return h=e.D.l(),b(f,function(e,t){var n,i,r,a,o;return D((function(s){return 1==s.g?(n=e.audio,i=e.video,r=function(e,t){var n,i;return D((function(r){return 1==r.g?e?b(r,e.createSegmentIndex(),2):r.return(null):(n=e.segmentIndex[Symbol.iterator]().seek(t))?(i=n.startTime,r.return(i)):r.return(null)}))},b(s,r(n,t),2)):3!=s.g?(a=s.h,b(s,r(i,t),3)):null!=(o=s.h)&&null!=a?s.return(Math.max(o,a)):null!=o?s.return(o):null!=a?s.return(a):s.return(t)}))}(c,h),4);case 4:d=f.h,e.D.m(d);case 3:Us(e,null,bn(c));case 2:return e.hb().find((function(e){return e.active}))||((p=Rn(e.B.textStreams,e.qa,e.Nb,e.Xa)[0]||null)&&ps(e.j.h,p,!0),c&&(p?(c.audio&&function(e,t,n){return e=Wt(e.o.preferredTextLanguage),t=Wt(t.language),Gt(n=Wt(n.language),e)&&!Gt(t,n)}(e,c.audio,p)&&(e.Y=!0),e.Y&&e.J.m.setTextVisibility(!0),Hs(e)):e.Y=!1),p&&(e.o.streaming.alwaysStreamText||e.sd())&&Do(e.i,p)),b(f,e.i.start(),5);case 5:e.o.abr.enabled&&(e.u.enable(),Gs(e)),yn(e.i?e.i.h:null,e.B),Js(e.B),Fs(e),Ds(e),e.B.variants.some((function(e){return e.primary})),e.h.va(i,"loadedmetadata",(function(){e.j.l=Date.now()/1e3-n.Rd})),w(f)}}))}(i,e,t))})),r.set(this.qd,(function(e,t){return ni(function(e,t,n){var i,r,a,o,s,l,u;return D((function(c){return 1==c.g?(i=ht,r=Date.now()/1e3,a=!0,e.m=bs(e,{lb:e.O,onError:function(t){js(e,t)},Gc:function(t){qs(e,t)},onExpirationUpdated:function(t,n){Xs(e,t,n)},onEvent:function(t){e.dispatchEvent(t),t.type==ol&&a&&(a=!1,e.j.j=Date.now()/1e3-r)}}),e.m.configure(e.o.drm),o=t.uri||"",s=nr(o),"application/x-mpegurl"==(l=kl[s])&&an()&&(l="application/vnd.apple.mpegurl"),l||(l="video/mp4"),u={id:0,language:"und",primary:!1,audio:null,video:{id:0,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:null,mimeType:n.mimeType?n.mimeType.split(";")[0]:l,codecs:n.mimeType?Ot(n.mimeType):"",encrypted:!0,drmInfos:[],keyIds:new Set,language:"und",label:null,type:i.Na,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},bandwidth:100,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},b(c,Ii(e.m,[u],[]),2)):b(c,e.m.Pb(t.G),0)}))}(i,e,t))})),r.set(this.Ma,(function(e,t){return function(e,t,n){function i(){return Ps(e)}t.uri=n.uri,t.startTime=n.startTime,e.Wa=t.uri,e.D=new co(t.G),null!=t.startTime&&e.D.m(t.startTime),e.F=new bo({Bc:function(){return t.G.playbackRate},yc:function(){return t.G.defaultPlaybackRate},Pd:function(e){t.G.playbackRate=e},ke:function(e){t.G.currentTime+=e}}),ws(e,e.o.streaming.rebufferingGoal),e.h.A(t.G,"playing",i),e.h.A(t.G,"pause",i),e.h.A(t.G,"ended",i),e.h.A(t.G,"ratechange",(function(){return Is(e)})),"none"!=e.g.preload&&e.h.va(e.g,"loadedmetadata",(function(){e.j.l=Date.now()/1e3-n.Rd})),e.g.audioTracks&&(e.h.A(e.g.audioTracks,"addtrack",(function(){return Fs(e)})),e.h.A(e.g.audioTracks,"removetrack",(function(){return Fs(e)})),e.h.A(e.g.audioTracks,"change",(function(){return Fs(e)}))),e.g.textTracks&&(e.h.A(e.g.textTracks,"addtrack",(function(t){if(t.track)switch(t=t.track,t.kind){case"metadata":!function(e,t){"metadata"==t.kind&&(t.mode="hidden",e.h.A(t,"cuechange",(function(){if(t.activeCues)for(var n=u(t.activeCues),i=n.next();!i.done;i=n.next())i=i.value,ys(e,i.startTime,i.endTime,i.type,i.value),e.L&&e.L.onCueMetadataChange(i.value)})),new Qt((function(){for(var t=function(e){return Array.from(e.g.textTracks).filter((function(e){return"metadata"==e.kind}))}(e),n=(t=u(t)).next();!n.done;n=t.next())n.value.mode="hidden"})).Hb().S(.5))}(e,t);break;case"chapters":xs(e,t);break;default:Fs(e)}})),e.h.A(e.g.textTracks,"removetrack",(function(){return Fs(e)})),e.h.A(e.g.textTracks,"change",(function(){return Fs(e)}))),t.G.src=t.uri,(nn()||sn("Web0S"))&&t.G.load(),e.l=Ll,e.dispatchEvent(gs(vl));var r=new pt;to(e.g,HTMLMediaElement.HAVE_METADATA,e.h,(function(){r.resolve()}));var a=!1;return e.gd.push((function(){a=!0})),to(e.g,HTMLMediaElement.HAVE_CURRENT_DATA,e.h,(function(){return D((function(t){return 1==t.g?a?t.return():(function(e){var t=e.o.preferredAudioLanguage;if(""!=t){e.Kd(t);var n=e.o.preferredVariantRole;""!=n&&e.Kd(t,n)}}(e),Ss(e).find((function(e){return"disabled"!=e.mode}))?t.v(2):b(t,new Promise((function(t){e.h.va(e.g.textTracks,"change",t),new Qt(t).S(1)})),2)):a?t.return():(function(e){var t=e.o.preferredTextLanguage,n=e.o.preferForcedSubs;if(""!=t){e.Ld(t,"",n);var i=e.o.preferredTextRole;""!=i&&e.Ld(t,i,n)}}(e),void w(t))}))})),e.g.error?r.reject(Ws(e)):"none"==e.g.preload&&(X('With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.'),r.resolve()),e.h.va(e.g,"error",(function(){r.reject(Ws(e))})),new $n(r,(function(){return r.reject(new We(2,7,7001)),Promise.resolve()}))}(i,e,t)})),this.da=new Wo(this.sa,{cf:function(e,t,n,r){var a=null;return e==i.sa&&(a=n==i.sa?i.sa:i.Oa),e==i.Oa&&(a=n==i.sa||t.G!=r.G?i.sa:n==i.Oa?i.Oa:n==i.Ea||n==i.N?i.Ea:n==i.Ma?i.qd:null),e==i.Ea&&(a=n==i.N&&t.G==r.G?i.pd:i.T),e==i.pd&&(a=tl(i.N,i.ld,i.T,n,t,r)),e==i.ld&&(a=tl(i.N,i.jd,i.T,n,t,r)),e==i.jd&&(a=tl(i.N,i.N,i.T,n,t,r)),e==i.qd&&(a=n==i.Ma&&t.G==r.G?i.Ma:i.T),e!=i.N&&e!=i.Ma||(a=i.T),e==i.T&&(a=r.G&&t.G==r.G?i.Oa:i.sa),a},Pe:function(e,t,n){return i.dispatchEvent(gs(fl,{state:e.name})),r.get(e)(t,n)},handleError:function(e){return D((function(t){return 1==t.g?b(t,vs(i,e),2):t.return(e.G?i.Oa:i.sa)}))},zf:function(e){i.dispatchEvent(gs(ml,{state:e.name}))}}),t&&this.Pb(t,!0)}function gs(e,t){return new ri(e,t)}function vs(e,t){var n,i,r,a,o,s,l,c,h;return D((function(d){switch(d.g){case 1:return e.l!=Al&&(e.l=Cl),n=e.gd.map((function(e){return e()})),e.gd=[],b(d,Promise.all(n),2);case 2:if(e.dispatchEvent(gs(Sl)),t.mimeType=null,t.startTime=null,t.uri=null,t.G&&(e.h.Ca(t.G,"loadedmetadata"),e.h.Ca(t.G,"playing"),e.h.Ca(t.G,"pause"),e.h.Ca(t.G,"ended"),e.h.Ca(t.G,"ratechange")),e.Fa&&(e.Fa.release(),e.Fa=null),e.oc&&(e.oc.stop(),e.oc=null),!e.s){d.v(3);break}return b(d,e.s.stop(),4);case 4:e.s=null,e.rc=null;case 3:if(!e.u){d.v(5);break}return b(d,e.u.stop(),5);case 5:if(!e.i){d.v(7);break}return b(d,e.i.destroy(),8);case 8:e.i=null;case 7:if(e.F&&(e.F.release(),e.F=null),e.D&&(e.D.release(),e.D=null),!e.J){d.v(9);break}return b(d,e.J.destroy(),10);case 10:e.J=null;case 9:if(e.L&&e.L.onAssetUnload(),!t.G||!t.G.src){d.v(11);break}return b(d,new Promise((function(e){return new Qt(e).S(.1)})),12);case 12:for(t.G.removeAttribute("src"),t.G.load();t.G.lastChild;)t.G.removeChild(t.G.firstChild);case 11:if(!e.m){d.v(13);break}return b(d,e.m.destroy(),14);case 14:e.m=null;case 13:if(e.Wa=null,e.H=null,e.B){for(i=u(e.B.variants),r=i.next();!r.done;r=i.next())for(a=r.value,o=u([a.audio,a.video]),s=o.next();!s.done;s=o.next())(l=s.value)&&l.segmentIndex&&l.segmentIndex.release();for(c=u(e.B.textStreams),s=c.next();!s.done;s=c.next())(h=s.value).segmentIndex&&h.segmentIndex.release()}e.B=null,e.j=new fs,e.kd=null,Ls(e),w(d)}}))}function ys(e,t,n,i,r){e.dispatchEvent(gs(pl,{startTime:t,endTime:n,Ag:i,payload:r}))}function xs(e,t){t&&"chapters"==t.kind&&(t.mode="hidden",new Qt((function(){for(var t=Ts(e),n=(t=u(t)).next();!n.done;n=t.next())n.value.mode="hidden"})).Hb().S(.5))}function bs(e,t){return new Li(t,e.o.drm.updateExpirationTime)}function ws(e,t){e.H=new qn,e.H.g=Kn,Xn(e.H,t,Math.min(.5,t/2)),Ls(e),e.oc=new Qt((function(){Ms(e)})).Ba(.25)}function Ms(e){switch(e.l){case Ll:if(e.g.ended)var t=!0;else{var n=Ca(e.g.buffered);t=null!=n&&n>=e.g.duration-1}break;case Rl:e:if(e.g.ended||Na(e.J))t=!0;else{if(e.B.presentationTimeline.X()){n=e.B.presentationTimeline.gb();var i=Ca(e.g.buffered);if(null!=i&&i>=n){t=!0;break e}}t=!1}break;default:t=!1}i=La(e.g.buffered,e.g.currentTime);var r=t,a=(n=e.H).h.get(n.g);t=n.g,i=r||i>=a?Yn:Kn,n.g=i,t!=i&&Ls(e)}function _s(e){if(e.s){var t=oi(e.o.manifest);e.g&&"AUDIO"===e.g.nodeName&&(t.disableVideo=!0),e.s.configure(t)}if(e.m&&e.m.configure(e.o.drm),e.i){e.i.configure(e.o.streaming);try{Rs(e,e.B)}catch(t){js(e,t)}e.u&&Ds(e),!(t=e.i.h)||t.allowedByApplication&&t.allowedByKeySystem||Ns(e)}if(e.O&&e.O.Nd(e.o.streaming.forceHTTPS),e.J&&(t=e.o.textDisplayFactory,e.kd!=t)){var n=He(t),i=e.J,r=i.m;i.m=n,r&&(n.setTextVisibility(r.isTextVisible()),r.destroy()),i.i&&(i.i.i=n),e.kd=t,e.i&&(n=(t=e.i).g.get(ct))&&No(t,n.stream,!0,0,!0)}e.u&&(e.u.configure(e.o.abr),e.o.abr.enabled?e.u.enable():e.u.disable(),Gs(e)),e.H&&(t=e.o.streaming.rebufferingGoal,e.B&&(t=Math.max(t,e.B.minBufferTime)),Xn(e.H,t,Math.min(.5,t/2))),e.B&&Ks(e.B.presentationTimeline,e.o.playRangeStart,e.o.playRangeEnd)}function Ss(e){return Array.from(e.g.textTracks).filter((function(e){return"metadata"!=e.kind&&"chapters"!=e.kind&&"Shaka Player TextTrack"!=e.label}))}function Ts(e){return Array.from(e.g.textTracks).filter((function(e){return"chapters"==e.kind}))}function Es(e,t){var n,i;return D((function(r){switch(r.g){case 1:return n=nr(t),(i=Ol[n])?r.return(i):(M(r,2),b(r,tr(t,e.O,e.o.streaming.retryParameters),4));case 4:i=r.h,S(r,3);break;case 2:T(r);case 3:if(i)return r.return(i);throw new We(1,2,2011,n)}}))}function As(e,t,n,i,r,a){var o,s,l;return D((function(c){if(1==c.g)return"text/vtt"==r?c.v(2):b(c,function(e,t,n){var i,r,a;return D((function(o){return 1==o.g?(i=gi,(r=di([e],n)).method="GET",b(o,t.request(i,r).promise,2)):(a=o.h,o.return(a.data))}))}(t,e.O,e.o.streaming.retryParameters),3);if(2!=c.g){o=c.h;var h=r,d=Ht[h];if(!d)throw new We(2,2,2014,h);h=d(),d={periodStart:0,segmentStart:0,segmentEnd:e.g.duration};var p=Le(o);h=function(e){function t(e){var n=[],i=700<=e.fontWeight,r="italic"==e.fontStyle,a=e.textDecoration.includes("underline");return i&&n.push("b"),r&&n.push("i"),a&&n.push("u"),i=n.reduce((function(e,t){return e+"<"+t+">"}),""),n=n.reduceRight((function(e,t){return e+"</"+t+">"}),""),e.lineBreak||e.spacer?(e.spacer&&Ne("shaka.text.Cue","Please use lineBreak instead of spacer."),"\n"):e.nestedCues.length?e.nestedCues.map(t).join(""):i+e.payload+n}var n=e.map((function(e){if(e.nestedCues.length){var n=e.clone();return n.nestedCues=[],n.payload=t(e),n}return e}));e="WEBVTT\n\n";for(var i=(n=u(n)).next();!i.done;i=n.next()){var r=function(e){var t=Math.floor(e/3600),n=Math.floor(e/60%60),i=Math.floor(e%60);return(10>t?"0":"")+t+":"+(10>n?"0":"")+n+":"+(10>i?"0":"")+i+"."+(100>(e=Math.floor(1e3*e%1e3))?10>e?"00":"0":"")+e};e+=r((i=i.value).startTime)+" --\x3e "+r(i.endTime)+function(e){var t=[];switch(e.textAlign){case"left":t.push("align:left");break;case"right":t.push("align:right");break;case ue:t.push("align:middle");break;case"start":t.push("align:start");break;case"end":t.push("align:end")}switch(e.writingMode){case"vertical-lr":t.push("vertical:lr");break;case"vertical-rl":t.push("vertical:rl")}return t.length?" "+t.join(" "):""}(i)+"\n",e+=i.payload+"\n\n"}return e}(h=h.parseMedia(p,d)),s=new Blob([h],{type:"text/vtt"}),t=qa(s),r="text/vtt"}(l=document.createElement("track")).src=t,l.label=a||"",l.kind=i,l.srclang=n,e.g.getAttribute("crossorigin")||e.g.setAttribute("crossorigin","anonymous"),e.g.appendChild(l),w(c)}))}function Cs(e){var t=ss();return t.streaming.failureCallback=function(t){e.X()&&[1001,1002,1003].includes(t.code)&&(t.severity=1,e.Id())},t.textDisplayFactory=function(){return e.nc?new Qo(e.g,e.nc):new Ko(e.g)},t}function Rs(e,t){if(e.l!=Al){for(var n=e.o.restrictions,i=e.md,r=!1,a=u(t.variants),o=a.next();!o.done;o=a.next()){var s=(o=o.value).allowedByApplication;o.allowedByApplication=fn(o,n,i),s!=o.allowedByApplication&&(r=!0)}if(r&&e.i&&Fs(e),(n=e.m?e.m.i:null)&&e.m.m)for(r=(i=u(t.variants)).next();!r.done;r=i.next())for(a=(r=u(((r=r.value).video?r.video.drmInfos:[]).concat(r.audio?r.audio.drmInfos:[]))).next();!a.done;a=r.next())if((a=a.value).keySystem==n.keySystem)for(o=(a=u(a.initData||[])).next();!o.done;o=a.next())o=o.value,ki(e.m,o.initDataType,o.initData);Ys(e,t)}}function Ls(e){var t=e.rd();if(e.j&&e.H&&e.D){var n=e.F;n.j=t,wo(n),Ps(e)}e.dispatchEvent(gs(al,{buffering:t}))}function Is(e){var t=e.g.playbackRate;0!=t&&(e.F&&e.F.set(t),t=gs(gl),e.dispatchEvent(t))}function Ps(e){if(e.j&&e.H){var t=e.j.g;e.H.g==Kn?cs(t,"buffering"):e.g.paused?cs(t,"paused"):e.g.ended?cs(t,"ended"):cs(t,"playing")}}function Ds(e){try{Ys(e,e.B)}catch(t){return js(e,t),!1}var t=e.B.variants.filter((function(e){return An(e)}));return t=e.pa.create(t),e.u.setVariants(Array.from(t.values())),!0}function Ns(e){var t;(t=Ds(e)?e.u.chooseVariant():null)&&ks(e,t,!0,!0,0)}function ks(e,t,n,i,r){var a=e.i.h;if(t==a)i&&Po(e.i,t,i,r,!0);else{var o=e.j.h;o.h!=t&&(o.h=t,o.g.push({timestamp:Date.now()/1e3,id:t.id,type:"variant",fromAdaptation:n,bandwidth:t.bandwidth})),Po(e.i,t,i,r),i=null,a&&(i=bn(a)),t=bn(t),n?Us(e,i,t):Bs(e,i,t)}}function Os(e,t){var n=Array.from(e.g.audioTracks).find((function(e){return e.enabled}));t.enabled=!0,t.id!==n.id&&(n.enabled=!1),Bs(e,n=Tn(n),Tn(t))}function Us(e,t,n){Zs(e,t=gs(rl,{yf:t,xf:n}))}function Fs(e){Zs(e,gs(_l))}function Bs(e,t,n){Zs(e,t=gs(Tl,{yf:t,xf:n}))}function zs(e){Zs(e,gs(yl))}function Hs(e){Zs(e,gs(xl))}function Gs(e){Zs(e,gs(il,{Bg:e.o.abr.enabled}))}function js(e,t){if(e.l!=Al){var n=gs(ll,{detail:t});e.dispatchEvent(n),n.defaultPrevented&&(t.handled=!0)}}function Vs(e,t,n){e.dispatchEvent(gs(t,{detail:{schemeIdUri:n.schemeIdUri,value:n.value,startTime:n.startTime,endTime:n.endTime,id:n.id,eventElement:n.eventElement}}))}function Ws(e){if(!e.g.error)return null;var t=e.g.error.code;if(1==t)return null;var n=e.g.error.msExtendedCode;return n&&(0>n&&(n+=Math.pow(2,32)),n=n.toString(16)),new We(2,3,3016,t,n,e.g.error.message)}function qs(e,t){if(e.i){var n=Object.keys(t),i=1==n.length&&"00"==n[0],r=!1;if(n.length)for(var a=(n=u(e.B.variants)).next();!a.done;a=n.next()){var o=[];(a=a.value).audio&&o.push(a.audio),a.video&&o.push(a.video);for(var s=(o=u(o)).next();!s.done;s=o.next()){var l=s.value;if(s=a.allowedByKeySystem,l.keyIds.size){a.allowedByKeySystem=!0;for(var c=(l=u(l.keyIds)).next();!c.done;c=l.next())c=c.value,c=t[i?"00":c],a.allowedByKeySystem=a.allowedByKeySystem&&!!c&&!Pl.includes(c)}s!=a.allowedByKeySystem&&(r=!0)}}r&&Ds(e),(i=e.i.h)&&!i.allowedByKeySystem&&Ns(e),r&&Fs(e)}}function Xs(e,t,n){e.s&&e.s.onExpirationUpdated&&e.s.onExpirationUpdated(t,n),t=gs(ul),e.dispatchEvent(t)}function Ks(e,t,n){0<t&&(e.X()||e.ve(t)),n<(t=e.getDuration())&&(e.X()||e.Ja(n))}function Ys(e,t){var n=e.m?e.m.zc():{},i=Object.keys(n);i=i.length&&"00"==i[0];for(var r=!1,a=!1,o=new Set,s=new Set,l=u(t.variants),c=l.next();!c.done;c=l.next()){var h=[];(c=c.value).audio&&h.push(c.audio),c.video&&h.push(c.video);for(var d=(h=u(h)).next();!d.done;d=h.next())if((d=d.value).keyIds.size)for(var p=(d=u(d.keyIds)).next();!p.done;p=d.next()){p=p.value;var f=n[i?"00":p];f?Pl.includes(f)&&s.add(f):o.add(p)}c.allowedByApplication?c.allowedByKeySystem&&(r=!0):a=!0}if(!r)throw new We(2,4,4012,n={hasAppRestrictions:a,missingKeys:Array.from(o),restrictedKeyStatuses:Array.from(s)})}function Js(e){if(!e.variants.some(An))throw new We(2,4,4032)}function Zs(e,t){D((function(n){if(1==n.g)return b(n,Promise.resolve(),2);e.l!=Al&&e.dispatchEvent(t),w(n)}))}function $s(e){for(var t=new Set,n=(e=u(e)).next();!n.done;n=e.next())(n=n.value).language?t.add(Wt(n.language)):t.add("und");return t}function Qs(e){for(var t=new Map,n=new Map,i=(e=u(e)).next();!i.done;i=e.next()){var r="und",a=[];(i=i.value).language&&(r=Wt(i.language)),(a="variant"==i.type?i.audioRoles:i.roles)&&a.length||(a=[""]),t.has(r)||t.set(r,new Set);for(var o=(a=u(a)).next();!o.done;o=a.next())o=o.value,t.get(r).add(o),i.label&&(n.has(r)||n.set(r,new Map),n.get(r).set(o,i.label))}var s=[];return t.forEach((function(e,t){for(var i=u(e),r=i.next();!r.done;r=i.next()){r=r.value;var a=null;n.has(t)&&n.get(t).has(r)&&(a=n.get(t).get(r)),s.push({language:t,role:r,label:a})}})),s}function el(){return new We(2,7,7e3)}function tl(e,t,n,i,r,a){return i==e&&r.G==a.G&&r.uri==a.uri&&r.mimeType==a.mimeType?t:n}function nl(e){return new Promise((function(t,n){e.mb=function(){return n(el())},e.Fc=function(){return t()},e.onError=function(e){return n(e)},e.Hc=function(){return n(el())}}))}Lo.prototype.destroy=function(){return this.I.destroy()},Lo.prototype.configure=function(e){this.o=e,this.s=new Jn({maxAttempts:Math.max(e.retryParameters.maxAttempts,2),baseDelay:e.retryParameters.baseDelay,backoffFactor:e.retryParameters.backoffFactor,fuzzFactor:e.retryParameters.fuzzFactor,timeout:0,stallTimeout:0,connectionTimeout:0},!0)},Lo.prototype.start=function(){var e=this;return D((function(t){if(1==t.g)return b(t,function(e){var t,n,i,r,a,o,s,l,c,h;return D((function(d){if(1==d.g){if(t=ht,!e.h)throw new We(2,5,5006);return n=new Map,i=new Set,e.h.audio&&(n.set(t.bb,e.h.audio),i.add(e.h.audio)),e.h.video&&(n.set(t.Na,e.h.video),i.add(e.h.video)),e.i&&(n.set(t.aa,e.i),i.add(e.i)),r=e.C.P,a=e.o.forceTransmuxTS,b(d,r.init(n,a),2)}bi(e.I);var p=e.B.presentationTimeline.getDuration();for(1/0>p?e.C.P.Ja(p):e.C.P.Ja(Math.pow(2,32)),o=u(n.keys()),s=o.next();!s.done;s=o.next())l=s.value,c=n.get(l),e.g.has(l)||(h=Oo(c),e.g.set(l,h),Ho(e,h,0));w(d)}))}(e),2);bi(e.I),e.m=!0,w(t)}))},Lo.prototype.Zb=function(t){var n,i,r,a,o,s=this;return D((function(l){switch(l.g){case 1:if(bi(s.I),t.Ra||null==t.La||t.Qb)return l.return();if(t.La=null,!t.rb){l.v(2);break}return b(l,zo(s,t,t.Pc,t.uc),3);case 3:return l.return();case 2:if(t.stream.segmentIndex){l.v(4);break}return n=t.stream,b(l,t.stream.createSegmentIndex(),5);case 5:if(n!=t.stream)return null==t.La&&Ho(s,t,0),l.return();case 4:M(l,6),null!=(i=function(t,n){if(Fo(n))return function(e,t){var n=Oa(e,"video")||0;Bt(e.i,t,n)}(t.C.P,n.stream.originalId||""),null;n.type==ct&&function(e){e.i&&Bt(e.i,"",0)}(t.C.P);var i=t.C.Ac(),r=n.Aa?n.Aa.endTime:i,a=function(e,t,n){return t==ct?null==(e=e.i).h||e.h<n?0:e.h-Math.max(n,e.g):La(e=Ua(e,t),n)}(t.C.P,n.type,i),o=Math.max(t.B.minBufferTime||0,t.o.rebufferingGoal,t.o.bufferingGoal)*t.l;if(r>=t.B.presentationTimeline.getDuration())return n.endOfStream=!0,"video"==n.type&&(i=t.g.get(ct))&&Fo(i)&&(i.endOfStream=!0),null;if(n.endOfStream=!1,a>=o)return t.o.updateIntervalSeconds/2;if(!(a=function(e,t,n,i){if(t.ca)return t.ca.current();if(t.Aa||i)return t.ca=t.stream.segmentIndex.yb(t.Aa?t.Aa.endTime:i),t.ca&&t.ca.next().value;e=e.o.inaccurateManifestTolerance,i=Math.max(n-e,0);var r=null;return e&&(t.ca=t.stream.segmentIndex.yb(i),r=t.ca&&t.ca.next().value),r||(t.ca=t.stream.segmentIndex.yb(n),r=t.ca&&t.ca.next().value),r}(t,n,i,a=Oa(t.C.P,n.type))))return t.o.updateIntervalSeconds;o=1/0;for(var s=Array.from(t.g.values()),l=(s=u(s)).next();!l.done;l=s.next())Fo(l=l.value)||l.ca&&!l.ca.current()||(o=Math.min(o,l.Aa?l.Aa.endTime:i));return r>=o+t.B.presentationTimeline.g?t.o.updateIntervalSeconds:(function(t,n,i,r){var a,o,s,l,u,c,h,d,p,f,m;return D((function(g){switch(g.g){case 1:return a=ht,o=n.stream,s=n.ca,n.Ra=!0,M(g,2),b(g,function(e,t,n){var i,r,a,o,s,l,u;return D((function(c){return i=[],r=Math.max(0,n.appendWindowStart-.1),a=n.appendWindowEnd+.01,(o=n.timestampOffset)==t.vd&&r==t.ud&&a==t.td||(s=function(){var n;return D((function(i){if(1==i.g)return M(i,2),t.ud=r,t.td=a,t.vd=o,b(i,function(e,t,n,i,r){return D((function(a){return t==ht.aa?(e.i.D=n,function(e,t,n){e.j=t,e.l=n}(e.i,i,r),a.return()):b(a,Promise.all([Ha(e,t,(function(){var n=e.j[t].appendWindowStart,i=e.j[t].appendWindowEnd;e.j[t].abort(),e.j[t].appendWindowStart=n,e.j[t].appendWindowEnd=i,za(e,t)})),Ha(e,t,(function(){var i=n;0>i&&(i+=.001),e.j[t].timestampOffset=i,za(e,t)})),Ha(e,t,(function(){e.j[t].appendWindowStart=0,e.j[t].appendWindowEnd=r,e.j[t].appendWindowStart=i,za(e,t)}))]),0)}))}(e.C.P,t.type,o,r,a),4);if(2!=i.g)return S(i,0);throw n=T(i),t.ud=null,t.td=null,t.vd=null,n}))},i.push(s())),!function(e,t){return e&&t?e.Wb()==t.Wb()&&e.Sb()==t.Sb()&&ae(e.ma(),t.ma()):e==t}(n.h,t.Dc)&&(t.Dc=n.h)&&(l=Bo(e,t,n.h),u=function(){var n,i,r;return D((function(a){switch(a.g){case 1:return M(a,2),b(a,l,4);case 4:return n=a.h,bi(e.I),i=t.stream.closedCaptions&&0<t.stream.closedCaptions.size,b(a,Fa(e.C.P,t.type,n,null,null,i),5);case 5:S(a,0);break;case 2:throw r=T(a),t.Dc=null,r}}))},i.push(u())),b(c,Promise.all(i),0)}))}(t,n,r),4);case 4:return bi(t.I),t.j?g.return():(l="video/mp4"==o.mimeType||"audio/mp4"==o.mimeType,u=e.ReadableStream,t.o.lowLatencyMode&&u&&l?(h=new Uint8Array(0),d=function(e){var a,s,l;return D((function(u){return bi(t.I),t.j?u.return():(h=function(e,t){var n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}(h,e),a=!1,s=0,(new lr).box("mdat",(function(e){s=e.size+e.start,a=!0})).parse(h,!1,!0),a?(l=h.subarray(0,s),h=h.subarray(s),b(u,Uo(t,n,i,o,r,l),0)):u.v(0))}))},b(g,Bo(t,n,r,d),6)):b(g,Bo(t,n,r),7));case 7:return c=g.h,bi(t.I),t.j?g.return():n.rb?(n.Ra=!1,Ho(t,n,0),g.return()):b(g,Uo(t,n,i,o,r,c),6);case 6:if(bi(t.I),t.j)return g.return();n.Aa=r,s.next(),n.Ra=!1,n.Hd=!1,p=t.C.P.xc(),f=p[n.type],JSON.stringify(f),n.rb||t.C.Ed(),Ho(t,n,0),S(g,0);break;case 2:if(m=T(g),bi(t.I,m),t.j)return g.return();if(n.Ra=!1,7001==m.code)n.Ra=!1,n.La=null,Ho(t,n,0),g.v(0);else if(n.type==a.aa&&t.o.ignoreTextStreamFailures)t.g.delete(a.aa),g.v(0);else if(3017==m.code)(function(e,t,n){if(!Array.from(e.g.values()).some((function(e){return e!=t&&e.Hd}))){var i=Math.round(100*e.l);if(20<i)e.l-=.2;else{if(!(4<i))return t.Xb=!0,e.j=!0,void e.C.onError(n);e.l-=.04}t.Hd=!0}Ho(e,t,4)})(t,n,m),g.v(0);else{if(1001!=m.code||!m.data||404!=m.data[1])return n.Xb=!0,m.severity=2,b(g,Vo(t,m),0);n.Ra=!1,n.La=null,Ho(t,n,1),g.v(0)}}}))}(t,n,i,a).catch((function(){})),null)}(s,t))&&(Ho(s,t,i),t.Xb=!1),S(l,7);break;case 6:return r=T(l),b(l,Vo(s,r),8);case 8:return l.return();case 7:if(a=Array.from(s.g.values()),!s.m||!a.every((function(e){return e.endOfStream}))){l.v(0);break}return b(l,s.C.P.endOfStream(),10);case 10:bi(s.I),0!=(o=s.C.P.getDuration())&&o<s.B.presentationTimeline.getDuration()&&s.B.presentationTimeline.Ja(o),w(l)}}))},Wo.prototype.destroy=function(){return this.I.destroy()},(i=Ko.prototype).remove=function(e,t){return!!this.g&&(Jo(this.g,(function(n){return n.startTime<t&&n.endTime>e})),!0)},i.append=function(e){function t(e){var n=[],i=700<=e.fontWeight,r="italic"==e.fontStyle,a=e.textDecoration.includes("underline");return i&&n.push("b"),r&&n.push("i"),a&&n.push("u"),i=n.reduce((function(e,t){return e+"<"+t+">"}),""),n=n.reduceRight((function(e,t){return e+"</"+t+">"}),""),e.lineBreak||e.spacer?(e.spacer&&Ne("shaka.extern.Cue","Please use lineBreak instead of spacer."),"\n"):e.nestedCues.length?e.nestedCues.map(t).join(""):i+e.payload+n}var n=e.map((function(e){if(e.nestedCues.length){var n=e.clone();return n.nestedCues=[],n.payload=t(e),n}return e})),i=[];e=this.g.cues?Array.from(this.g.cues):[];for(var r={},a=(n=u(n)).next();!a.done;r={ub:r.ub},a=n.next())r.ub=a.value,e.some(function(e){return function(t){return t.startTime==e.ub.startTime&&t.endTime==e.ub.endTime&&t.text==e.ub.payload}}(r))||(a=Yo(r.ub))&&i.push(a);for(r=(e=u(e=i.slice().sort((function(e,t){return e.startTime!=t.startTime?e.startTime-t.startTime:e.endTime!=t.endTime?e.endTime-t.startTime:"line"in VTTCue.prototype?i.indexOf(t)-i.indexOf(e):i.indexOf(e)-i.indexOf(t)})))).next();!r.done;r=e.next())this.g.addCue(r.value)},i.destroy=function(){return this.g&&(Jo(this.g,(function(){return!0})),this.g.mode="disabled"),this.g=null,Promise.resolve()},i.isTextVisible=function(){return"showing"==this.g.mode},i.setTextVisibility=function(e){this.g.mode=e?"showing":"hidden"},z("shaka.text.SimpleTextDisplayer",Ko),Ko.prototype.setTextVisibility=Ko.prototype.setTextVisibility,Ko.prototype.isTextVisible=Ko.prototype.isTextVisible,Ko.prototype.destroy=Ko.prototype.destroy,Ko.prototype.append=Ko.prototype.append,Ko.prototype.remove=Ko.prototype.remove,z("shaka.util.Dom",Zo),Zo.removeAllChildren=$o,(i=Qo.prototype).append=function(e){for(var t=[].concat(c(this.j)),n={},i=(e=u(e)).next();!i.done;n={hc:n.hc},i=e.next())n.hc=i.value,t.some(function(e){return function(t){return se(t,e.hc)}}(n))||this.j.push(n.hc);es(this)},i.destroy=function(){this.m.removeChild(this.i),this.i=null,this.u=!1,this.j=[],this.D&&this.D.stop(),this.l.clear(),this.h&&(this.h.release(),this.h=null),this.s&&(this.s.disconnect(),this.s=null)},i.remove=function(e,t){return!!this.i&&(this.j=this.j.filter((function(n){return n.startTime<e||n.endTime>=t})),es(this),!0)},i.isTextVisible=function(){return this.u},i.setTextVisibility=function(e){this.u=e},z("shaka.text.UITextDisplayer",Qo),Qo.prototype.setTextVisibility=Qo.prototype.setTextVisibility,Qo.prototype.isTextVisible=Qo.prototype.isTextVisible,Qo.prototype.remove=Qo.prototype.remove,Qo.prototype.destroy=Qo.prototype.destroy,Qo.prototype.append=Qo.prototype.append,z("shaka.text.WebVttGenerator",(function(){})),z("shaka.util.ConfigUtils",is),is.convertToConfigObject=as,is.mergeConfigObjects=rs,z("shaka.util.PlayerConfiguration",os),os.mergeConfigObjects=ls,g(ms,ai),(i=ms.prototype).destroy=function(){var e,t=this;return D((function(n){switch(n.g){case 1:return t.l==Al?n.return():(t.l=Al,e=qo(t.da,(function(){return{node:t.sa,payload:{G:null,mimeType:null,startTime:null,Rd:NaN,uri:null},ib:!1}})),b(n,new Promise((function(t){e.Db=function(){},e.Fc=function(){t()},e.mb=function(){t()},e.onError=function(){t()},e.Hc=function(){t()}})),2));case 2:return b(n,t.da.destroy(),3);case 3:if(t.h&&(t.h.release(),t.h=null),t.fd=null,t.u=null,t.o=null,t.j=null,t.nc=null,!t.O){n.v(0);break}return b(n,t.O.destroy(),5);case 5:t.O=null,w(n)}}))},i.Pb=function(e,t){if(t=void 0===t||t,this.l==Al)return Promise.reject(el());var n={G:null,mimeType:null,startTime:null,Rd:NaN,uri:null};n.G=e,en()||(t=!1);var i=t?this.Ea:this.Oa,r=qo(this.da,(function(){return{node:i,payload:n,ib:!1}}));return r.Db=function(){},nl(r)},i.detach=function(){var e=this;if(this.l==Al)return Promise.reject(el());var t=qo(this.da,(function(){return{node:e.sa,payload:{G:null,mimeType:null,startTime:null,Rd:NaN,uri:null},ib:!1}}));return t.Db=function(){},nl(t)},i.Td=function(e){var t=this;if(e=void 0===e||e,this.l==Al)return Promise.reject(el());en()||(e=!1);var n={G:null,mimeType:null,startTime:null,Rd:NaN,uri:null},i=qo(this.da,(function(i){var r=i.G&&e?t.Ea:i.G?t.Oa:t.sa;return n.G=i.G,{node:r,payload:n,ib:!1}}));return i.Db=function(){},nl(i)},i.load=function(e,t,n){var i=this;if(this.l==Al)return Promise.reject(el());this.dispatchEvent(gs(hl));var r={G:null,mimeType:null,startTime:null,Rd:NaN,uri:null};r.uri=e,r.Rd=Date.now()/1e3,n&&(r.mimeType=n),void 0!==t&&(r.startTime=t);var a=function(e,t){if(!en())return!0;var n=t.mimeType,i=t.uri||"";if(n||(n=nr(i),n=kl[n]),n){if(""==(t.G||ln()).canPlayType(n))return!1;if(!en()||!(n in ir)&&!(nr(i)in rr)||e.o.streaming.preferNativeHls)return!0;if(an())return e.o.streaming.useNativeHlsOnSafari}return!1}(this,r)?this.Ma:this.N,o=qo(this.da,(function(e){return null==e.G?null:(r.G=e.G,{node:a,payload:r,ib:!0})}));return this.j=new fs,o.Db=function(){},new Promise((function(e,t){o.Hc=function(){return t(new We(2,7,7002))},o.Fc=function(){e(),i.dispatchEvent(gs(cl))},o.mb=function(){return t(el())},o.onError=function(e){return t(e)}}))},i.configure=function(e,t){2==arguments.length&&"string"==typeof e&&(e=as(e,t)),e.manifest&&e.manifest.dash&&"defaultPresentationDelay"in e.manifest.dash&&(Ne("manifest.dash.defaultPresentationDelay configuration","Please Use manifest.defaultPresentationDelay instead."),e.manifest.defaultPresentationDelay=e.manifest.dash.defaultPresentationDelay,delete e.manifest.dash.defaultPresentationDelay),e.streaming&&e.streaming.lowLatencyMode&&(null==e.streaming.inaccurateManifestTolerance&&(e.streaming.inaccurateManifestTolerance=0),null==e.streaming.rebufferingGoal&&(e.streaming.rebufferingGoal=.01));var n=ls(this.o,e,Cs(this));return _s(this),n},i.getConfiguration=function(){var e=Cs(this);return ls(e,this.o,Cs(this)),e},i.Se=function(){if(this.g){var e=this.g.buffered.length;e=e?this.g.buffered.end(e-1):0;var t=this.getConfiguration().streaming.bufferingGoal;if(e>=(t=Math.min(this.g.currentTime+t,this.bc().end)))return 1;if(!(e<=this.g.currentTime)&&e<t)return(e-this.g.currentTime)/(t-this.g.currentTime)}return 0},i.Lf=function(){for(var e in this.o)delete this.o[e];ls(this.o,Cs(this),Cs(this)),_s(this)},i.Ye=function(){return this.l},i.bf=function(){return this.g},i.Ub=function(){return this.O},i.od=function(){return this.Wa},i.be=function(){return this.L?this.L:null},i.X=function(){return this.B?this.B.presentationTimeline.X():!(!this.g||!this.g.src)&&1/0==this.g.duration},i.kb=function(){return!!this.B&&this.B.presentationTimeline.kb()},i.sf=function(){if(this.B){var e=this.B.variants;return!!e.length&&!e[0].video}return!(!this.g||!this.g.src)&&(this.g.videoTracks?0==this.g.videoTracks.length:0==this.g.videoHeight)},i.bc=function(){if(this.B){var e=this.B.presentationTimeline;return{start:e.zb(),end:e.Qa()}}return this.g&&this.g.src&&(e=this.g.seekable).length?{start:e.start(0),end:e.end(e.length-1)}:{start:0,end:0}},i.qf=function(){this.X()&&(this.g.currentTime=this.bc().end)},i.keySystem=function(){var e=this.drmInfo();return e?e.keySystem:""},i.drmInfo=function(){return this.m?this.m.i:null},i.Tb=function(){return this.m?this.m.Tb():1/0},i.zc=function(){return this.m?this.m.zc():{}},i.rd=function(){return!!this.H&&this.H.g==Kn},i.df=function(){return this.g?this.F?this.F.i:1:0},i.Uf=function(e){0==e?X("A trick play rate of 0 is unsupported!"):(this.g.paused&&this.g.play(),this.F.set(e),this.l==Rl&&(this.u.playbackRateChanged(e),Io(this.i,1<Math.abs(e))))},i.Ie=function(){var e=this.F.yc();this.l==Ll&&this.F.set(e),this.l==Rl&&(this.F.set(e),this.u.playbackRateChanged(e),Io(this.i,!1))},i.Cc=function(){if(this.B){for(var e=this.i?this.i.h:null,t=[],n=u(this.B.variants),i=n.next();!i.done;i=n.next())if(An(i=i.value)){var r=bn(i);r.active=i==e,t.push(r)}return t}return this.g&&this.g.audioTracks?Array.from(this.g.audioTracks).map((function(e){return Tn(e)})):[]},i.hb=function(){if(this.B){for(var e=this.i?this.i.i:null,t=[],n=u(this.B.textStreams),i=n.next();!i.done;i=n.next()){var r=wn(i=i.value);r.active=i==e,t.push(r)}return t}return this.g&&this.g.src&&this.g.textTracks?Ss(this).map((function(e){return Sn(e)})):[]},i.We=function(){return this.B?this.B.imageStreams.map((function(e){return Mn(e)})):[]},i.mf=function(e,t){var n,i,r,a,o,s,l,u,c,h,d,p,f,m,g,v,y,x,w=this;return D((function(M){return 1==M.g?w.B?(n=w.B.imageStreams.find((function(t){return t.id==e})))?n.segmentIndex?M.v(3):b(M,n.createSegmentIndex(),3):M.return(null):M.v(2):2!=M.g?null==(i=n.segmentIndex.find(t))?M.return(null):(r=n.segmentIndex.get(i),a=r.tilesLayout||n.tilesLayout,(o=/(\d+)x(\d+)/.exec(a))?(s=n.width||0,l=n.height||0,u=parseInt(o[1],10),c=parseInt(o[2],10),h=s/u,d=l/c,p=u*c,f=r.j-r.startTime,m=f/p,g=r.startTime,y=v=0,1<p&&(x=Math.floor((t-r.startTime)/m),g=r.startTime+x*m,v=x%u*h,y=Math.floor(x/u)*d),M.return({height:d,positionX:v,positionY:y,startTime:g,duration:m,uris:r.ma(),width:h})):M.return(null)):M.return(null)}))},i.re=function(e){if(this.B&&this.i){var t=this.B.textStreams.find((function(t){return t.id==e.id}));t&&t!=this.i.i&&(ps(this.j.h,t,!1),Do(this.i,t),zs(this),this.qa=t.language)}else if(this.g&&this.g.src&&this.g.textTracks){for(var n=(t=u(t=Ss(this))).next();!n.done;n=t.next())_n(n=n.value)==e.id?n.mode=this.Y?"showing":"hidden":n.mode="disabled";zs(this)}},i.se=function(e,t,n){if(t=void 0!==t&&t,n=void 0===n?0:n,this.B&&this.i){this.o.abr.enabled&&X("Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().");var i=this.B.variants.find((function(t){return t.id==e.id}));i&&An(i)&&(ks(this,i,!1,t,n),this.pa=new Vn(i),Ds(this))}else if(this.g&&this.g.audioTracks)for(n=(t=u(t=Array.from(this.g.audioTracks))).next();!n.done;n=t.next())if(_n(n=n.value)==e.id){Os(this,n);break}},i.Re=function(){return Qs(this.Cc())},i.lf=function(){return Qs(this.hb())},i.Qe=function(){return Array.from($s(this.Cc()))},i.kf=function(){return Array.from($s(this.hb()))},i.Kd=function(e,t){if(this.B&&this.D){this.pa=new Wn(e,t||"",0,"");for(var n=function(e,t){return e.video||t.video?e.video&&t.video?Math.abs((e.video.height||0)-(t.video.height||0))+Math.abs((e.video.width||0)-(t.video.width||0)):1/0:0},i=this.i.h,r=this.pa.create(this.B.variants),a=null,o=(r=u(r.values())).next();!o.done;o=r.next())o=o.value,(!a||n(a,i)>n(o,i))&&(a=o);a?(n=bn(a),this.se(n,!0)):Ns(this)}else if(this.g&&this.g.audioTracks){for(r=Array.from(this.g.audioTracks),n=Wt(e),a=i=null,o=(r=u(r)).next();!o.done;o=r.next()){var s=Tn(o=o.value);Wt(s.language)==n&&(i=o,t?s.roles.includes(t)&&(a=o):0==s.roles.length&&(a=o))}a?Os(this,a):i&&Os(this,i)}},i.Ld=function(e,t,n){if(n=void 0!==n&&n,this.B&&this.D)this.qa=e,this.Nb=t||"",this.Xa=n,(e=Rn(this.B.textStreams,this.qa,this.Nb,this.Xa)[0]||null)&&e!=this.i.i&&(ps(this.j.h,e,!1),this.o.streaming.alwaysStreamText||this.sd())&&(Do(this.i,e),zs(this));else{var i=Wt(e);(e=this.hb().find((function(e){return Wt(e.language)==i&&(!t||e.roles.includes(t))&&e.forced==n})))&&this.re(e)}},i.Mf=function(e){if(this.B&&this.D){for(var t=null,n=u(this.B.variants),i=n.next();!i.done;i=n.next())if((i=i.value).audio.label==e){t=i;break}null!=t&&(this.pa=new Wn(t.language,"",0,e),Ns(this))}},i.sd=function(){var e=this.Y;return this.J?this.J.m.isTextVisible():this.g&&this.g.src&&this.g.textTracks?Ss(this).some((function(e){return"showing"==e.mode})):e},i.ce=function(){return this.g&&this.g.src&&this.g.textTracks?Ts(this).map((function(e){return Sn(e)})):[]},i.Te=function(e){var t=Wt(e),n=Ts(this).find((function(e){return Wt(e.language)==t}));if(!n||!n.cues)return[];e=[];for(var i=(n=u(n.cues)).next();!i.done;i=n.next())i=i.value,e.push({title:i.text,startTime:i.startTime,endTime:i.endTime});return e},i.Sf=function(e){if(e=!!e,this.Y!=e){if(this.Y=e,this.l==Rl)this.J.m.setTextVisibility(e),this.o.streaming.alwaysStreamText||(e?this.i.i||0<(e=Rn(this.B.textStreams,this.qa,this.Nb,this.Xa)).length&&(Do(this.i,e[0]),zs(this)):function(e){var t=e.g.get(ct);t&&(Go(t),jo(t).catch((function(){})),e.g.delete(ct)),e.i=null}(this.i));else if(this.g&&this.g.src&&this.g.textTracks)for(var t=Ss(this),n=(t=u(t)).next();!n.done;n=t.next())"disabled"!=(n=n.value).mode&&(n.mode=e?"showing":"hidden");Hs(this)}},i.ff=function(){if(!this.X())return null;var e=this.da.l,t=0;if(this.D)t=this.D.l();else if(e){if(null==e.startTime)return new Date;t=e.startTime}return this.B?new Date(1e3*(this.B.presentationTimeline.j+t)):this.g&&this.g.getStartDate?(e=this.g.getStartDate(),isNaN(e.getTime())?null:new Date(e.getTime()+1e3*t)):null},i.de=function(){if(!this.X())return null;if(this.B)return new Date(1e3*this.B.presentationTimeline.j);if(this.g&&this.g.getStartDate){var e=this.g.getStartDate();return isNaN(e.getTime())?null:e}return null},i.xc=function(){if(this.l==Rl)return this.J.xc();var e={total:[],audio:[],video:[],text:[]};return this.l==Ll&&(e.total=Ia(this.g.buffered)),e},i.getStats=function(){if(this.l!=Rl&&this.l!=Ll)return{width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,corruptedFrames:NaN,estimatedBandwidth:NaN,completionPercent:NaN,loadLatency:NaN,manifestTimeSeconds:NaN,drmTimeSeconds:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,licenseTime:NaN,liveLatency:NaN,maxSegmentDuration:NaN,switchHistory:[],stateHistory:[]};Ps(this);var e=this.g,t=e.currentTime/e.duration;if(!isNaN(t)){var n=this.j;t=Math.round(100*t),n.i=isNaN(n.i)?t:Math.max(n.i,t)}e.getVideoPlaybackQuality&&(e=e.getVideoPlaybackQuality(),n=this.j,t=Number(e.totalVideoFrames),n.T=Number(e.droppedVideoFrames),n.N=t,this.j.L=Number(e.corruptedVideoFrames)),e=this.m&&(e=this.m).F?e.F:NaN,this.j.m=e,this.l==Rl&&((e=this.i.h)&&(this.j.u=(this.F?this.F.i:1)*e.bandwidth),e&&e.video&&(n=this.j,t=e.video.height||NaN,n.Y=e.video.width||NaN,n.D=t),this.X()&&(e=this.de().valueOf()+1e3*this.bc().end,this.j.F=(Date.now()-e)/1e3),this.B&&this.B.presentationTimeline&&(this.j.J=this.B.presentationTimeline.g),e=this.u.getBandwidthEstimate(),this.j.s=e);var i=this.j;e=i.Y,n=i.D,t=i.u;for(var r=i.N,a=i.T,o=i.L,s=i.s,l=i.i,c=i.l,h=i.H,d=i.j,p=hs(i.g,"playing"),f=hs(i.g,"paused"),m=hs(i.g,"buffering"),g=i.m,v=i.F,y=i.J,x=function(e){function t(e){return{timestamp:e.timestamp,state:e.state,duration:e.duration}}for(var n=[],i=u(e.h),r=i.next();!r.done;r=i.next())n.push(t(r.value));return e.g&&n.push(t(e.g)),n}(i.g),b=[],w=(i=u(i.h.g)).next();!w.done;w=i.next())w=w.value,b.push({timestamp:w.timestamp,id:w.id,type:w.type,fromAdaptation:w.fromAdaptation,bandwidth:w.bandwidth});return{width:e,height:n,streamBandwidth:t,decodedFrames:r,droppedFrames:a,corruptedFrames:o,estimatedBandwidth:s,completionPercent:l,loadLatency:c,manifestTimeSeconds:h,drmTimeSeconds:d,playTime:p,pauseTime:f,bufferingTime:m,licenseTime:g,liveLatency:v,maxSegmentDuration:y,stateHistory:x,switchHistory:b}},i.addTextTrack=function(e,t,n,i,r,a,o){if(o=void 0!==o&&o,Ne("addTextTrack","Please use an addTextTrackAsync."),this.l!=Rl&&this.l!=Ll)throw new We(1,7,7004);if(!i){var s=nr(e);if(!(i=Ol[s]))throw new We(1,2,2011,s)}if(this.l==Ll){if("text/vtt"!=i)throw new We(1,2,2013,i);if(o&&(n="forced"),(i=document.createElement("track")).src=e,i.label=a||"",i.kind=n,i.srclang=t,this.g.getAttribute("crossorigin")||this.g.setAttribute("crossorigin","anonymous"),this.g.appendChild(i),e=this.hb().find((function(e){return e.language==t&&e.label==(a||"")&&e.kind==n})))return Fs(this),e;throw new We(1,2,2012)}if(1/0==(s=this.B.presentationTimeline.getDuration()))throw new We(1,4,4033);if(!Ft(Dt((e={id:this.nd++,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:vo(0,s,[e]),mimeType:i||"",codecs:r||"",kind:n,encrypted:!1,drmInfos:[],keyIds:new Set,language:t,label:a||null,type:ct,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!!o,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null}).mimeType,e.codecs)))throw new We(2,2,2014,i);return this.B.textStreams.push(e),Fs(this),wn(e)},i.Ee=function(e,t,n,i,r,a,o){o=void 0!==o&&o;var s,l,u,c,h,d=this;return D((function(p){switch(p.g){case 1:if(d.l!=Rl&&d.l!=Ll)throw new We(1,7,7004);if(i){p.v(2);break}return b(p,Es(d,e),3);case 3:i=p.h;case 2:if(d.l!=Ll){p.v(4);break}return o&&(n="forced"),b(p,As(d,e,t,n,i,a),5);case 5:if(s=d.hb(),l=s.find((function(e){return e.language==t&&e.label==(a||"")&&e.kind==n})))return Fs(d),p.return(l);throw new We(1,2,2012);case 4:if(u=ht,1/0==(c=d.B.presentationTimeline.getDuration()))throw new We(1,4,4033);if(h={id:d.nd++,originalId:null,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:vo(0,c,[e]),mimeType:i||"",codecs:r||"",kind:n,encrypted:!1,drmInfos:[],keyIds:new Set,language:t,label:a||null,type:u.aa,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!!o,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null},!Ft(Dt(h.mimeType,h.codecs)))throw new We(2,2,2014,i);return d.B.textStreams.push(h),Fs(d),p.return(wn(h))}}))},i.De=function(e,t,n){var i,r,a,o,s,l,c=this;return D((function(h){switch(h.g){case 1:if(c.l!=Rl&&c.l!=Ll)throw new We(1,7,7004);if(n){h.v(2);break}return b(h,Es(c,e),3);case 3:n=h.h;case 2:return b(h,As(c,e,t,"chapters",n),4);case 4:if(i=c.ce(),r=i.find((function(e){return e.language==t}))){for(a=Ts(c),o=u(a),s=o.next();!s.done;s=o.next())l=s.value,xs(c,l);return h.return(r)}throw new We(1,2,2012)}}))},i.Od=function(e,t){this.md.width=e,this.md.height=t},i.Id=function(){if(this.l==Rl){var e=this.i;if(e.I.g)e=!1;else if(e.j)e=!1;else{for(var t=u(e.g.values()),n=t.next();!n.done;n=t.next())(n=n.value).Xb&&(n.Xb=!1,Ho(e,n,.1));e=!0}}else e=!1;return e},i.Ze=function(){return X("Shaka Player's internal Manifest structure is NOT covered by semantic versioning compatibility guarantees.  It may change at any time!  Please consider filing a feature request for whatever you use getManifest() for."),this.B},i.$e=function(){return this.rc},i.we=function(e){this.nc=e},i.wc=function(e){var t=this;return D((function(n){if(1==n.g)return b(n,function(e,t){return D((function(n){if(1==n.g)return b(n,function(e,t){return D((function(n){if(1==n.g)return b(n,mn(t,0<t.offlineSessionIds.length),2);yn(e,t),function(e){e.textStreams=e.textStreams.filter((function(e){return Ft(Dt(e.mimeType,e.codecs))}))}(t),function(e){e.imageStreams=e.imageStreams.filter((function(e){var t=["image/svg+xml","image/png","image/jpeg"];return(sn("Web0S")||nn()||rn())&&t.push("image/webp"),t.includes(e.mimeType)}))}(t),w(n)}))}(e.i?e.i.h:null,t),2);Js(t),w(n)}))}(t,e),2);Rs(t,e),w(n)}))},z("shaka.Player",ms),ms.prototype.setVideoContainer=ms.prototype.we,ms.prototype.getManifestParserFactory=ms.prototype.$e,ms.prototype.getManifest=ms.prototype.Ze,ms.prototype.retryStreaming=ms.prototype.Id,ms.prototype.setMaxHardwareResolution=ms.prototype.Od,ms.prototype.addChaptersTrack=ms.prototype.De,ms.prototype.addTextTrackAsync=ms.prototype.Ee,ms.prototype.addTextTrack=ms.prototype.addTextTrack,ms.prototype.getStats=ms.prototype.getStats,ms.prototype.getBufferedInfo=ms.prototype.xc,ms.prototype.getPresentationStartTimeAsDate=ms.prototype.de,ms.prototype.getPlayheadTimeAsDate=ms.prototype.ff,ms.prototype.setTextTrackVisibility=ms.prototype.Sf,ms.prototype.getChapters=ms.prototype.Te,ms.prototype.getChaptersTracks=ms.prototype.ce,ms.prototype.isTextTrackVisible=ms.prototype.sd,ms.prototype.selectVariantsByLabel=ms.prototype.Mf,ms.prototype.selectTextLanguage=ms.prototype.Ld,ms.prototype.selectAudioLanguage=ms.prototype.Kd,ms.prototype.getTextLanguages=ms.prototype.kf,ms.prototype.getAudioLanguages=ms.prototype.Qe,ms.prototype.getTextLanguagesAndRoles=ms.prototype.lf,ms.prototype.getAudioLanguagesAndRoles=ms.prototype.Re,ms.prototype.selectVariantTrack=ms.prototype.se,ms.prototype.selectTextTrack=ms.prototype.re,ms.prototype.getThumbnails=ms.prototype.mf,ms.prototype.getImageTracks=ms.prototype.We,ms.prototype.getTextTracks=ms.prototype.hb,ms.prototype.getVariantTracks=ms.prototype.Cc,ms.prototype.cancelTrickPlay=ms.prototype.Ie,ms.prototype.trickPlay=ms.prototype.Uf,ms.prototype.getPlaybackRate=ms.prototype.df,ms.prototype.isBuffering=ms.prototype.rd,ms.prototype.getKeyStatuses=ms.prototype.zc,ms.prototype.getExpiration=ms.prototype.Tb,ms.prototype.drmInfo=ms.prototype.drmInfo,ms.prototype.keySystem=ms.prototype.keySystem,ms.prototype.goToLive=ms.prototype.qf,ms.prototype.seekRange=ms.prototype.bc,ms.prototype.isAudioOnly=ms.prototype.sf,ms.prototype.isInProgress=ms.prototype.kb,ms.prototype.isLive=ms.prototype.X,ms.prototype.getAdManager=ms.prototype.be,ms.prototype.getAssetUri=ms.prototype.od,ms.prototype.getNetworkingEngine=ms.prototype.Ub,ms.prototype.getMediaElement=ms.prototype.bf,ms.prototype.getLoadMode=ms.prototype.Ye,ms.prototype.resetConfiguration=ms.prototype.Lf,ms.prototype.getBufferFullness=ms.prototype.Se,ms.prototype.getConfiguration=ms.prototype.getConfiguration,ms.prototype.configure=ms.prototype.configure,ms.prototype.load=ms.prototype.load,ms.prototype.unload=ms.prototype.Td,ms.prototype.detach=ms.prototype.detach,ms.prototype.attach=ms.prototype.Pb,ms.probeSupport=function(e){var t,n,i,r,a;return e=void 0===e||e,D((function(o){if(1==o.g)return t={},e?b(o,function(){var e,t,n,i,r,a;return D((function(o){return 1==o.g?(e="org.w3.clearkey com.widevine.alpha com.microsoft.playready com.microsoft.playready.recommendation com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime".split(" "),n=[{videoCapabilities:t=[{contentType:'video/mp4; codecs="avc1.42E01E"'},{contentType:'video/webm; codecs="vp8"'}],persistentState:"required",sessionTypes:["persistent-license"]},{initDataTypes:["cenc"],videoCapabilities:t}],i=new Map,r=function(e){var t,r,a;return D((function(o){switch(o.g){case 1:return M(o,2),b(o,navigator.requestMediaKeySystemAccess(e,n),4);case 4:return t=o.h,a=!!(r=t.getConfiguration().sessionTypes)&&r.includes("persistent-license"),sn("Tizen 3")&&(a=!1),i.set(e,{persistentState:a}),b(o,t.createMediaKeys(),5);case 5:S(o,0);break;case 2:T(o),i.set(e,null),w(o)}}))},a=e.map((function(e){return r(e)})),b(o,Promise.all(a),2)):o.return(Ci(i))}))}(),3):o.v(2);2!=o.g&&(t=o.h);var s={};if(en()){for(var l in ir)s[l]=!0;for(var c in rr)s[c]=!0}l={mpd:"application/dash+xml",m3u8:"application/x-mpegurl",ism:"application/vnd.ms-sstr+xml"};for(var h=(c=u(["application/dash+xml","application/x-mpegurl","application/vnd.apple.mpegurl","application/vnd.ms-sstr+xml"])).next();!h.done;h=c.next())s[h=h.value]=en()?!!ir[h]:tn(h);for(var d in l)s[d]=en()?!!rr[d]:tn(l[d]);for(n=s,s={},l=(d=u('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(","))).next();!l.done;l=d.next())s[l=l.value]=en()?!!Ft(l)||MediaSource.isTypeSupported(l)||Lt(l):tn(l),s[c=l.split(";")[0]]=s[c]||s[l];for(a in i={manifest:n,media:s,drm:t},r=Dl)i[a]=r[a]();return o.return(i)}))},ms.isBrowserSupported=function(){if(e.Promise||X("A Promise implementation or polyfill is required"),e.TextDecoder&&e.TextEncoder||X("A TextDecoder/TextEncoder implementation or polyfill is required"),!(e.Promise&&e.Uint8Array&&e.TextDecoder&&e.TextEncoder&&Array.prototype.forEach)||sn("Trident/"))return!1;var t=on();return!(t&&12>t||!(e.MediaKeys&&e.navigator&&e.navigator.requestMediaKeySystemAccess&&e.MediaKeySystemAccess&&e.MediaKeySystemAccess.prototype.getConfiguration))&&(!!en()||tn("application/x-mpegurl"))},ms.setAdManagerFactory=function(e){Nl=e},ms.registerSupportPlugin=function(e,t){Dl[e]=t},ms.prototype.destroy=ms.prototype.destroy;var il="abrstatuschanged",rl="adaptation",al="buffering",ol="drmsessionupdate",sl="emsg",ll="error",ul="expirationupdated",cl="loaded",hl="loading",dl="manifestparsed",pl="metadata",fl="onstatechange",ml="onstateidle",gl="ratechange",vl="streaming",yl="textchanged",xl="texttrackvisibility",bl="timelineregionadded",wl="timelineregionenter",Ml="timelineregionexit",_l="trackschanged",Sl="unloading",Tl="variantchanged",El={ag:il,bg:rl,cg:al,dg:ol,fg:sl,Error:ll,gg:ul,hg:"largegap",ig:cl,jg:hl,kg:dl,Metadata:pl,lg:fl,mg:ml,ng:gl,og:"sessiondata",pg:vl,qg:yl,rg:xl,sg:bl,tg:wl,ug:Ml,vg:_l,wg:Sl,xg:Tl},Al=0,Cl=1,Rl=2,Ll=3;ms.LoadMode={DESTROYED:Al,NOT_LOADED:Cl,MEDIA_SOURCE:Rl,SRC_EQUALS:Ll},ms.version="v3.2.0";var Il=["3","2"];Ue=new function(e){this.g=e,this.i=ke,this.h=Oe}(new De(Number(Il[0]),Number(Il[1])));var Pl=["output-restricted","internal-error"],Dl={},Nl=null,kl={mp4:"video/mp4",m4v:"video/mp4",m4a:"audio/mp4",webm:"video/webm",weba:"audio/webm",mkv:"video/webm",ts:"video/mp2t",ogv:"video/ogg",ogg:"audio/ogg",mpg:"video/mpeg",mpeg:"video/mpeg",m3u8:"application/x-mpegurl",mp3:"audio/mpeg",aac:"audio/aac",flac:"audio/flac",wav:"audio/wav"},Ol={sbv:"text/x-subviewer",srt:"text/srt",vtt:"text/vtt",webvtt:"text/vtt",ttml:"application/ttml+xml",lrc:"application/x-subtitle-lrc",ssa:"text/x-ssa",ass:"text/x-ssa"};function Ul(){this.h=[],this.j=this.i=this.g=0}function Fl(e,t){var n=this;this.i=e,this.g=t,this.j=!1,this.l=this.g.getVolume(),this.h=new wi,this.h.A(this.g,google.ima.AdEvent.Type.PAUSED,(function(){n.j=!0})),this.h.A(this.g,google.ima.AdEvent.Type.RESUMED,(function(){n.j=!1}))}function Bl(e,t,n,i){var r=this;this.m=e,this.g=t,this.u=NaN,this.j=i,this.s=null,this.h=new wi,google.ima.settings.setLocale(n),(e=new google.ima.AdDisplayContainer(this.m,this.g)).initialize(),this.l=new google.ima.AdsLoader(e),this.l.getSettings().setPlayerType("shaka-player"),this.l.getSettings().setPlayerVersion("v3.2.0"),this.i=null,this.h.va(this.l,google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,(function(e){!function(e,t){e.j(new ri("ads-loaded",{loadTime:Date.now()/1e3-e.u})),e.i=t.getAdsManager(e.g),e.j(new ri("ima-ad-manager-loaded",{imaAdManager:e.i}));var n=e.i.getCuePoints();if(n.length){for(var i=[],r=(n=u(n)).next();!r.done;r=n.next())i.push(new ql(r.value));e.j(new ri("ad-cue-points-changed",{cuepoints:i}))}!function(e){e.h.A(e.i,google.ima.AdErrorEvent.Type.AD_ERROR,(function(t){zl(e,t)})),e.h.A(e.i,google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,(function(t){Hl(e,t)})),e.h.A(e.i,google.ima.AdEvent.Type.STARTED,(function(t){Hl(e,t)})),e.h.A(e.i,google.ima.AdEvent.Type.FIRST_QUARTILE,(function(t){e.j(new ri("ad-first-quartile",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.MIDPOINT,(function(t){e.j(new ri("ad-midpoint",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.THIRD_QUARTILE,(function(t){e.j(new ri("ad-third-quartile",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.COMPLETE,(function(t){e.j(new ri("ad-complete",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,(function(t){Gl(e,t)})),e.h.A(e.i,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,(function(t){Gl(e,t)})),e.h.A(e.i,google.ima.AdEvent.Type.SKIPPED,(function(t){e.j(new ri("ad-skipped",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.VOLUME_CHANGED,(function(t){e.j(new ri("ad-volume-changed",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.VOLUME_MUTED,(function(t){e.j(new ri("ad-muted",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.PAUSED,(function(t){e.s.j=!0,e.j(new ri("ad-paused",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.RESUMED,(function(t){e.s.j=!1,e.j(new ri("ad-resumed",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,(function(t){e.j(new ri("ad-skip-state-changed",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.CLICK,(function(t){e.j(new ri("ad-clicked",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.AD_PROGRESS,(function(t){e.j(new ri("ad-progress",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.AD_BUFFERING,(function(t){e.j(new ri("ad-buffering",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.IMPRESSION,(function(t){e.j(new ri("ad-impression",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.DURATION_CHANGE,(function(t){e.j(new ri("ad-duration-changed",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.USER_CLOSE,(function(t){e.j(new ri("ad-closed",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.LOADED,(function(t){e.j(new ri("ad-loaded",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.ALL_ADS_COMPLETED,(function(t){e.j(new ri("all-ads-completed",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.LINEAR_CHANGED,(function(t){e.j(new ri("ad-linear-changed",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.AD_METADATA,(function(t){e.j(new ri("ad-metadata",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.LOG,(function(t){e.j(new ri("ad-recoverable-error",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.AD_BREAK_READY,(function(t){e.j(new ri("ad-break-ready",{originalEvent:t}))})),e.h.A(e.i,google.ima.AdEvent.Type.INTERACTION,(function(t){e.j(new ri("ad-interaction",{originalEvent:t}))}))}(e);try{e.i.init(e.g.offsetWidth,e.g.offsetHeight,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL),e.h.A(e.g,"loadeddata",(function(){e.i.resize(e.g.offsetWidth,e.g.offsetHeight,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)})),e.i.start()}catch(t){Gl(e,null)}}(r,e)})),this.h.A(this.l,google.ima.AdErrorEvent.Type.AD_ERROR,(function(e){zl(r,e)})),this.g.onended=function(){r.l.contentComplete()}}function zl(e,t){t.getError(),Gl(e,null),e.j(new ri("ad-cue-points-changed",{cuepoints:[]}))}function Hl(e,t){var n=t.getAd();e.s=new Fl(n,e.i),e.j(new ri("ad-started",{ad:e.s,sdkAdObject:n,originalEvent:t})),e.m.setAttribute("ad-active","true"),e.g.pause()}function Gl(e,t){e.j(new ri("ad-stopped",{originalEvent:t})),e.m.removeAttribute("ad-active"),e.g.play()}function jl(e,t){this.i=e,this.h=null,this.g=t}function Vl(e,t,n,i){var r=this;this.u=e,this.g=t,this.l=null,this.J=NaN,this.j=i,this.H=!1,this.D=this.m=this.s=null,this.F="",this.h=new wi,(e=new google.ima.dai.api.UiSettings).setLocale(n),this.i=new google.ima.dai.api.StreamManager(this.g,this.u,e),this.j(new ri("ima-stream-manager-loaded",{imaStreamManager:this.i})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.LOADED,(function(e){!function(e,t){e.j(new ri("ads-loaded",{loadTime:Date.now()/1e3-e.J}));var n=t.getStreamData().url;e.l.resolve(n),e.l=null,e.H||e.h.A(e.g,"seeked",(function(){var t=e.g.currentTime;if(0!=t){e.i.streamTimeForContentTime(t);var n=e.i.previousCuePointForStreamTime(t);n&&!n.played&&(e.s=t,e.g.currentTime=n.start)}}))}(r,e)})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.ERROR,(function(){r.F.length?r.l.resolve(r.F):r.l.reject("IMA Stream request returned an error and there was no backup asset uri provided."),r.l=null})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,(function(){})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.STARTED,(function(e){e=e.getAd(),r.m=new jl(e,r.g),r.D&&(r.m.h=r.D),r.j(new ri("ad-started",{ad:r.m})),r.u.setAttribute("ad-active","true")})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,(function(){r.u.removeAttribute("ad-active");var e=r.g.currentTime;r.s&&r.s>e&&(r.g.currentTime=r.s,r.s=null)})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,(function(e){r.D=e.getStreamData().adProgressData,r.m&&(r.m.h=r.D)})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,(function(){r.j(new ri("ad-first-quartile"))})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.MIDPOINT,(function(){r.j(new ri("ad-midpoint"))})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE,(function(){r.j(new ri("ad-third-quartile"))})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.COMPLETE,(function(){r.j(new ri("ad-complete")),r.j(new ri("ad-stopped")),r.u.removeAttribute("ad-active"),r.m=null})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.SKIPPED,(function(){r.j(new ri("ad-skipped")),r.j(new ri("ad-stopped"))})),this.h.A(this.i,google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED,(function(e){var t=e.getStreamData();e=[];for(var n=(t=u(t.cuepoints)).next();!n.done;n=t.next())n=n.value,e.push(new ql(n.start,n.end));r.j(new ri("ad-cue-points-changed",{cuepoints:e}))}))}function Wl(){ai.call(this),this.g=this.h=null,this.j=new Ul,this.i=navigator.language}function ql(e,t){this.start=e,this.end=void 0===t?null:t}function Xl(e){return JSON.stringify(e,(function(e,t){if("function"!=typeof t){if(t instanceof Event||t instanceof ri){var n={};for(r in t){var i=t[r];i&&"object"==typeof i?"detail"==r&&(n[r]=i):r in Event||(n[r]=i)}return n}if(t instanceof Error){var r=new Set(["name","message","stack"]);for(n in t)r.add(n);for(n=(i=u(Object.getOwnPropertyNames(t))).next();!n.done;n=i.next())r.add(n.value);for(i={},n=(r=u(r)).next();!n.done;n=r.next())i[n=n.value]=t[n];r={__type__:"Error",contents:i}}else if(t instanceof TimeRanges)for(r={__type__:"TimeRanges",length:t.length,start:[],end:[]},i=(n=u(Ia(t))).next();!i.done;i=n.next()){var a=(i=i.value).end;r.start.push(i.start),r.end.push(a)}else r=t instanceof Uint8Array?{__type__:"Uint8Array",entries:Array.from(t)}:"number"==typeof t?isNaN(t)?"NaN":isFinite(t)?t:0>t?"-Infinity":"Infinity":t;return r}}))}function Kl(e){return JSON.parse(e,(function(e,t){if("NaN"==t)var n=NaN;else if("-Infinity"==t)n=-1/0;else if("Infinity"==t)n=1/0;else if(t&&"object"==typeof t&&"TimeRanges"==t.__type__)n=function(e){return{length:e.length,start:function(t){return e.start[t]},end:function(t){return e.end[t]}}}(t);else if(t&&"object"==typeof t&&"Uint8Array"==t.__type__)n=new Uint8Array(t.entries);else if(t&&"object"==typeof t&&"Error"==t.__type__){n=t.contents;var i,r=Error(n.message);for(i in n)r[i]=n[i];n=r}else n=t;return n}))}(i=Fl.prototype).getDuration=function(){return this.i.getDuration()},i.getMinSuggestedDuration=function(){return this.i.getMinSuggestedDuration()},i.getRemainingTime=function(){return this.g.getRemainingTime()},i.isPaused=function(){return this.j},i.isSkippable=function(){return 0<=this.i.getSkipTimeOffset()},i.getTimeUntilSkippable=function(){var e=this.i.getSkipTimeOffset();return e=this.getRemainingTime()-e,Math.max(e,0)},i.canSkipNow=function(){return this.g.getAdSkippableState()},i.skip=function(){return this.g.skip()},i.pause=function(){return this.g.pause()},i.play=function(){return this.g.resume()},i.getVolume=function(){return this.g.getVolume()},i.setVolume=function(e){return this.g.setVolume(e)},i.isMuted=function(){return 0==this.g.getVolume()},i.resize=function(e,t){this.g.resize(e,t,document.fullscreenElement?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL)},i.setMuted=function(e){e?(this.l=this.getVolume(),this.setVolume(0)):this.setVolume(this.l)},i.getSequenceLength=function(){var e=this.i.getAdPodInfo();return null==e?1:e.getTotalAds()},i.getPositionInSequence=function(){var e=this.i.getAdPodInfo();return null==e?1:e.getAdPosition()},i.release=function(){this.g=this.i=null},z("shaka.ads.ClientSideAd",Fl),Fl.prototype.release=Fl.prototype.release,Fl.prototype.getPositionInSequence=Fl.prototype.getPositionInSequence,Fl.prototype.getSequenceLength=Fl.prototype.getSequenceLength,Fl.prototype.setMuted=Fl.prototype.setMuted,Fl.prototype.resize=Fl.prototype.resize,Fl.prototype.isMuted=Fl.prototype.isMuted,Fl.prototype.setVolume=Fl.prototype.setVolume,Fl.prototype.getVolume=Fl.prototype.getVolume,Fl.prototype.play=Fl.prototype.play,Fl.prototype.pause=Fl.prototype.pause,Fl.prototype.skip=Fl.prototype.skip,Fl.prototype.canSkipNow=Fl.prototype.canSkipNow,Fl.prototype.getTimeUntilSkippable=Fl.prototype.getTimeUntilSkippable,Fl.prototype.isSkippable=Fl.prototype.isSkippable,Fl.prototype.isPaused=Fl.prototype.isPaused,Fl.prototype.getRemainingTime=Fl.prototype.getRemainingTime,Fl.prototype.getMinSuggestedDuration=Fl.prototype.getMinSuggestedDuration,Fl.prototype.getDuration=Fl.prototype.getDuration,Bl.prototype.stop=function(){this.i&&this.i.stop(),this.m&&$o(this.m)},(i=jl.prototype).getDuration=function(){return this.h?this.h.duration:-1},i.getMinSuggestedDuration=function(){return this.getDuration()},i.getRemainingTime=function(){return this.h?this.h.duration-this.h.currentTime:-1},i.isPaused=function(){return this.g.paused},i.isSkippable=function(){return this.i.isSkippable()},i.getTimeUntilSkippable=function(){var e=this.i.getSkipTimeOffset();return e=this.getRemainingTime()-e,Math.max(e,0)},i.canSkipNow=function(){return 0==this.getTimeUntilSkippable()},i.skip=function(){this.g.currentTime+=this.getRemainingTime()},i.pause=function(){return this.g.pause()},i.play=function(){return this.g.play()},i.getVolume=function(){return this.g.volume},i.setVolume=function(e){this.g.volume=e},i.isMuted=function(){return this.g.muted},i.resize=function(){},i.setMuted=function(e){this.g.muted=e},i.getSequenceLength=function(){var e=this.i.getAdPodInfo();return null==e?1:e.getTotalAds()},i.getPositionInSequence=function(){var e=this.i.getAdPodInfo();return null==e?1:e.getAdPosition()},i.release=function(){this.g=this.h=this.i=null},z("shaka.ads.ServerSideAd",jl),jl.prototype.release=jl.prototype.release,jl.prototype.getPositionInSequence=jl.prototype.getPositionInSequence,jl.prototype.getSequenceLength=jl.prototype.getSequenceLength,jl.prototype.setMuted=jl.prototype.setMuted,jl.prototype.resize=jl.prototype.resize,jl.prototype.isMuted=jl.prototype.isMuted,jl.prototype.setVolume=jl.prototype.setVolume,jl.prototype.getVolume=jl.prototype.getVolume,jl.prototype.play=jl.prototype.play,jl.prototype.pause=jl.prototype.pause,jl.prototype.skip=jl.prototype.skip,jl.prototype.canSkipNow=jl.prototype.canSkipNow,jl.prototype.getTimeUntilSkippable=jl.prototype.getTimeUntilSkippable,jl.prototype.isSkippable=jl.prototype.isSkippable,jl.prototype.isPaused=jl.prototype.isPaused,jl.prototype.getRemainingTime=jl.prototype.getRemainingTime,jl.prototype.getMinSuggestedDuration=jl.prototype.getMinSuggestedDuration,jl.prototype.getDuration=jl.prototype.getDuration,Vl.prototype.stop=function(){this.i.reset(),this.F="",this.s=null},Vl.prototype.onCueMetadataChange=function(e){if(e.key&&e.data){var t={};t[e.key]=e.data,this.i.onTimedMetadata(t)}},g(Wl,ai),(i=Wl.prototype).setLocale=function(e){this.i=e},i.initClientSide=function(t,n){var i=this;if(!e.google||!google.ima||!google.ima.AdsLoader)throw new We(2,10,1e4);this.h=new Bl(t,n,this.i,(function(e){if(e&&e.type)switch(e.type){case"ads-loaded":i.j.h.push(e.loadTime);break;case"ad-started":i.j.g++;break;case"ad-complete":i.j.i++;break;case"ad-skipped":i.j.j++}i.dispatchEvent(e)}))},i.onAssetUnload=function(){this.h&&this.h.stop(),this.dispatchEvent(new ri("ad-stopped")),this.j=new Ul},i.requestClientSideAds=function(e){if(!this.h)throw new We(1,10,10001);var t=this.h;t.u=Date.now()/1e3,t.l.requestAds(e)},i.initServerSide=function(t,n){var i=this;if(!e.google||!google.ima||!google.ima.dai)throw new We(2,10,10002);this.g=new Vl(t,n,this.i,(function(e){if(e&&e.type)switch(e.type){case"ads-loaded":i.j.h.push(e.loadTime);break;case"ad-started":i.j.g++;break;case"ad-complete":i.j.i++;break;case"ad-skipped":i.j.j++}i.dispatchEvent(e)}))},i.requestServerSideStream=function(e,t){if(t=void 0===t?"":t,!this.g)throw new We(1,10,10003);e.adTagParameters||(e.adTagParameters={});var n=e.adTagParameters;(n.mpt||n.mpv)&&X('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),e.adTagParameters.mpt="shaka-player",e.adTagParameters.mpv="v3.2.0";var i=t;return(n=this.g).l?n=Promise.reject(new We(1,10,10004)):(e instanceof google.ima.dai.api.LiveStreamRequest&&(n.H=!0),n.l=new pt,n.i.requestStream(e),n.F=i||"",n.J=Date.now()/1e3,n=n.l),n},i.replaceServerSideAdTagParameters=function(e){if(!this.g)throw new We(1,10,10003);(e.mpt||e.mpv)&&X('You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overriden.'),e.mpt="Shaka Player",e.mpv="v3.2.0",this.g.i.replaceAdTagParameters(e)},i.getStats=function(){var e=this.j;return{loadTimes:e.h,started:e.g,playedCompletely:e.i,skipped:e.j}},i.onDashTimedMetadata=function(e){if(this.g&&"urn:google:dai:2018"==e.schemeIdUri){var t=e.schemeIdUri,n=e.eventElement?e.eventElement.getAttribute("messageData"):null;this.g.i.processMetadata(t,n,e.startTime)}},i.onHlsTimedMetadata=function(e,t){this.g&&this.g.i.processMetadata("ID3",e.data,t)},i.onCueMetadataChange=function(e){this.g&&this.g.onCueMetadataChange(e)},z("shaka.ads.AdManager",Wl),Wl.prototype.onCueMetadataChange=Wl.prototype.onCueMetadataChange,Wl.prototype.onHlsTimedMetadata=Wl.prototype.onHlsTimedMetadata,Wl.prototype.onDashTimedMetadata=Wl.prototype.onDashTimedMetadata,Wl.prototype.getStats=Wl.prototype.getStats,Wl.prototype.replaceServerSideAdTagParameters=Wl.prototype.replaceServerSideAdTagParameters,Wl.prototype.requestServerSideStream=Wl.prototype.requestServerSideStream,Wl.prototype.initServerSide=Wl.prototype.initServerSide,Wl.prototype.requestClientSideAds=Wl.prototype.requestClientSideAds,Wl.prototype.onAssetUnload=Wl.prototype.onAssetUnload,Wl.prototype.initClientSide=Wl.prototype.initClientSide,Wl.prototype.setLocale=Wl.prototype.setLocale,Wl.ADS_LOADED="ads-loaded",Wl.AD_STARTED="ad-started",Wl.AD_FIRST_QUARTILE="ad-first-quartile",Wl.AD_MIDPOINT="ad-midpoint",Wl.AD_THIRD_QUARTILE="ad-third-quartile",Wl.AD_COMPLETE="ad-complete",Wl.AD_STOPPED="ad-stopped",Wl.AD_SKIPPED="ad-skipped",Wl.AD_VOLUME_CHANGED="ad-volume-changed",Wl.AD_MUTED="ad-muted",Wl.AD_PAUSED="ad-paused",Wl.AD_RESUMED="ad-resumed",Wl.AD_SKIP_STATE_CHANGED="ad-skip-state-changed",Wl.CUEPOINTS_CHANGED="ad-cue-points-changed",Wl.IMA_AD_MANAGER_LOADED="ima-ad-manager-loaded",Wl.IMA_STREAM_MANAGER_LOADED="ima-stream-manager-loaded",Wl.AD_CLICKED="ad-clicked",Wl.AD_PROGRESS="ad-progress",Wl.AD_BUFFERING="ad-buffering",Wl.AD_IMPRESSION="ad-impression",Wl.AD_DURATION_CHANGED="ad-duration-changed",Wl.AD_CLOSED="ad-closed",Wl.AD_LOADED="ad-loaded",Wl.ALL_ADS_COMPLETED="all-ads-completed",Wl.AD_LINEAR_CHANGED="ad-linear-changed",Wl.AD_METADATA="ad-metadata",Wl.AD_RECOVERABLE_ERROR="ad-recoverable-error",Wl.AD_BREAK_READY="ad-break-ready",Wl.AD_INTERACTION="ad-interaction",Nl=function(){return new Wl};var Yl="ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(" "),Jl="buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(" "),Zl=["loop","playbackRate"],$l=["pause","play"],Ql={getAssetUri:2,getAudioLanguages:4,getAudioLanguagesAndRoles:4,getBufferFullness:1,getBufferedInfo:2,getConfiguration:4,getExpiration:2,getKeyStatuses:2,getPlaybackRate:2,getTextLanguages:4,getTextLanguagesAndRoles:4,getTextTracks:2,getStats:5,getVariantTracks:2,getImageTracks:2,getThumbnails:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,getLoadMode:10},eu={getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20},tu=[["getConfiguration","configure"]],nu=[["isTextTrackVisible","setTextTrackVisibility"]],iu="addChaptersTrack addTextTrack addTextTrackAsync cancelTrickPlay configure getChapters getChaptersTracks resetConfiguration retryStreaming selectAudioLanguage selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel setTextTrackVisibility trickPlay goToLive".split(" "),ru=["attach","detach","load","unload"];function au(e,t,n,i,r,a){var o=this;this.L=e,this.j=new Qt(t),this.da=n,this.D=!1,this.u=i,this.J=r,this.T=a,this.h=this.m=!1,this.Y="",this.s=null,this.F=function(){return cu(o)},this.H=function(e,t){var n=Kl(t);switch(n.type){case"event":var i=n.targetName;n=new ri((n=n.event).type,n),o.u(i,n);break;case"update":for(var r in i=n.update)for(var a in n=o.g[r]||{},i[r])n[a]=i[r][a];o.D&&(o.da(),o.D=!1);break;case"asyncComplete":if(r=n.id,n=n.error,a=o.i[r],delete o.i[r],a)if(n){for(i in r=new We(n.severity,n.category,n.code),n)r[i]=n[i];a.reject(r)}else a.resolve()}},this.g={video:{},player:{}},this.N=0,this.i={},this.l=null,gu.add(this)}function ou(e,t,n){mu=n,n.addUpdateListener(e.F),n.addMessageListener("urn:x-cast:com.google.shaka.v2",e.H),cu(e),du(e,{type:"init",initState:t,appData:e.s}),e.l.resolve()}function su(e,t){var n=8003;switch(t.code){case"cancel":n=8004;break;case"timeout":n=8005;break;case"receiver_unavailable":n=8006}e.l.reject(new We(2,8,n,t))}function lu(e,t){var n=e.T();e.l=new pt,e.D=!0,ou(e,n,t)}function uu(e){var t=mu;t.removeUpdateListener(e.F),t.removeMessageListener("urn:x-cast:com.google.shaka.v2",e.H)}function cu(e){var t=!!mu&&"connected"==mu.status;if(e.h&&!t){for(var n in e.J(),e.g)e.g[n]={};hu(e)}e.h=t,e.Y=t?mu.receiver.friendlyName:"",e.j.Hb()}function hu(e){for(var t in e.i){var n=e.i[t];delete e.i[t],n.reject(new We(1,7,7e3))}}function du(e,t){var n=Xl(t),i=mu;try{i.sendMessage("urn:x-cast:com.google.shaka.v2",n,(function(){}),Y)}catch(t){throw i=new ri("error",{detail:n=new We(2,8,8005,t)}),e.u("player",i),e.wb(),n}}(i=au.prototype).destroy=function(){return gu.delete(this),hu(this),mu&&uu(this),this.j&&(this.j.stop(),this.j=null),this.J=this.u=null,this.h=this.m=!1,this.H=this.F=this.l=this.i=this.g=this.s=null,Promise.resolve()},i.ta=function(){return this.h},i.Gd=function(){return this.Y},i.init=function(){if(this.L.length)if(e.chrome&&chrome.cast&&chrome.cast.isAvailable){this.m=!0,this.j.Hb();var t=new chrome.cast.SessionRequest(this.L);t=new chrome.cast.ApiConfig(t,(function(e){for(var t=u(gu),n=t.next();!n.done;n=t.next())lu(n.value,e)}),(function(e){for(var t=u(gu),n=t.next();!n.done;n=t.next())n=n.value,fu="available"==e,n.j.Hb()}),"origin_scoped"),chrome.cast.initialize(t,(function(){}),(function(){})),fu&&this.j.S(pu),(t=mu)&&t.status!=chrome.cast.SessionStatus.STOPPED?lu(this,t):mu=null}else e.__onGCastApiAvailable||(e.__onGCastApiAvailable=vu),e.__onGCastApiAvailable!=vu&&X("A global Cast SDK hook is already installed! Shaka Player will be unable to receive a notification when the Cast SDK is ready.")},i.Md=function(e){this.s=e,this.h&&du(this,{type:"appData",appData:this.s})},i.cast=function(e){var t=this;return D((function(n){if(!t.m)throw new We(1,8,8e3);if(!fu)throw new We(1,8,8001);if(t.h)throw new We(1,8,8002);return t.l=new pt,chrome.cast.requestSession((function(n){return ou(t,e,n)}),(function(e){return su(t,e)})),b(n,t.l,0)}))},i.wb=function(){if(this.h){if(hu(this),mu){uu(this);try{mu.stop((function(){}),(function(){}))}catch(e){}mu=null}cu(this)}},i.get=function(e,t){var n=this;if("video"==e){if($l.includes(t))return function(i){for(var r=[],a=0;a<arguments.length;++a)r[a]=arguments[a];return n.ne.apply(n,[e,t].concat(c(r)))}}else if("player"==e){if(eu[t]&&!this.get("player","isLive")())return function(){};if(iu.includes(t))return function(i){for(var r=[],a=0;a<arguments.length;++a)r[a]=arguments[a];return n.ne.apply(n,[e,t].concat(c(r)))};if(ru.includes(t))return function(i){for(var r=[],a=0;a<arguments.length;++a)r[a]=arguments[a];return n.If.apply(n,[e,t].concat(c(r)))};if(Ql[t])return function(){return n.g[e][t]}}return this.g[e][t]},i.set=function(e,t,n){this.g[e][t]=n,du(this,{type:"set",targetName:e,property:t,value:n})},i.ne=function(e,t,n){for(var i=[],r=2;r<arguments.length;++r)i[r-2]=arguments[r];du(this,{type:"call",targetName:e,methodName:t,args:i})},i.If=function(e,t,n){for(var i=[],r=2;r<arguments.length;++r)i[r-2]=arguments[r];r=new pt;var a=this.N.toString();this.N++,this.i[a]=r;try{du(this,{type:"asyncCall",targetName:e,methodName:t,args:i,id:a})}catch(e){r.reject(e)}return r};var pu=.02,fu=!1,mu=null,gu=new Set;function vu(e){if(e)for(var t=(e=u(gu)).next();!t.done;t=e.next())t.value.init()}function yu(e,t,n){ai.call(this);var i=this;this.j=e,this.i=t,this.h=this.s=this.l=this.u=this.m=null,this.F=n,this.D=new Map,this.g=new au(n,(function(){return wu(i)}),(function(){return Mu(i)}),(function(e,t){return Tu(i,e,t)}),(function(){return _u(i)}),(function(){return bu(i)})),function(e){e.g.init(),e.h=new wi;for(var t=u(Yl),n=t.next();!n.done;n=t.next())e.h.A(e.j,n.value,(function(t){e.g.ta()||(t=new ri(t.type,t),e.l.dispatchEvent(t))}));for(var i in El)e.h.A(e.i,El[i],(function(t){e.g.ta()||e.s.dispatchEvent(t)}));for(var r in e.m={},t={},e.j)t.Ib=r,Object.defineProperty(e.m,t.Ib,{configurable:!1,enumerable:!0,get:function(t){return function(){return Su(e,t.Ib)}}(t),set:function(t){return function(n){var i=t.Ib;e.g.ta()?e.g.set("video",i,n):e.j[i]=n}}(t)}),t={Ib:t.Ib};e.u={},xu(e,(function(t){Object.defineProperty(e.u,t,{configurable:!1,enumerable:!0,get:function(){return function(e,t){if(e.D.has(t)&&(t=e.D.get(t)),"addEventListener"==t)return function(t,n,i){return e.s.addEventListener(t,n,i)};if("removeEventListener"==t)return function(t,n,i){return e.s.removeEventListener(t,n,i)};if("getMediaElement"==t)return function(){return e.m};if("getSharedConfiguration"==t)return e.g.get("player","getConfiguration");if("getNetworkingEngine"==t)return function(){return e.i.Ub()};if("getDrmEngine"==t)return function(){return e.i.m};if("getAdManager"==t)return function(){return e.i.be()};if("setVideoContainer"==t)return function(t){return e.i.we(t)};if(e.g.ta()){if("getManifest"==t||"drmInfo"==t)return function(){return X(t+"() does not work while casting!"),null};if("attach"==t||"detach"==t)return function(){return X(t+"() does not work while casting!"),Promise.resolve()}}return e.g.ta()&&0==Object.keys(e.g.g.video).length&&Ql[t]||!e.g.ta()?e.i[t].bind(e.i):e.g.get("player",t)}(e,t)}})})),function(e){var t=new Map;xu(e,(function(n,i){if(t.has(i)){var r=t.get(i);n.length<r.length?e.D.set(n,r):e.D.set(r,n)}else t.set(i,n)}))}(e),e.l=new ai,e.l.pc=e.m,e.s=new ai,e.s.pc=e.u}(this)}function xu(e,t){function n(e){return"constructor"!=e&&"function"==typeof i[e]&&!r.has(e)}var i=e.i,r=new Set;for(a in i)n(a)&&(r.add(a),t(a,i[a]));for(var a=Object.getPrototypeOf(i),o=Object.getPrototypeOf({});a&&a!=o;){for(var s=u(Object.getOwnPropertyNames(a)),l=s.next();!l.done;l=s.next())n(l=l.value)&&(r.add(l),t(l,i[l]));a=Object.getPrototypeOf(a)}}function bu(e){var t={video:{},player:{},playerAfterLoad:{},manifest:e.i.od(),startTime:null};e.j.pause();for(var n=u(Zl),i=n.next();!i.done;i=n.next())i=i.value,t.video[i]=e.j[i];for(e.j.ended||(t.startTime=e.j.currentTime),i=(n=u(tu)).next();!i.done;i=n.next()){var r=i.value;i=r[1],r=e.i[r[0]](),t.player[i]=r}for(i=(n=u(nu)).next();!i.done;i=n.next())i=(r=i.value)[1],r=e.i[r[0]](),t.playerAfterLoad[i]=r;return t}function wu(e){var t=new ri("caststatuschanged");e.dispatchEvent(t)}function Mu(e){var t=new ri(e.m.paused?"pause":"play");e.l.dispatchEvent(t)}function _u(e){for(var t=u(tu),n=t.next();!n.done;n=t.next()){var i=n.value;n=i[1],i=e.g.get("player",i[0])(),e.i[n](i)}var r=e.g.get("player","getAssetUri")();n=e.g.get("video","ended"),t=Promise.resolve();var a=e.j.autoplay;i=null,n||(i=e.g.get("video","currentTime")),r&&(e.j.autoplay=!1,t=e.i.load(r,i));var o={};for(i=(n=u(Zl)).next();!i.done;i=n.next())i=i.value,o[i]=e.g.get("video",i);t.then((function(){if(e.j){for(var t=u(Zl),n=t.next();!n.done;n=t.next())n=n.value,e.j[n]=o[n];for(n=(t=u(nu)).next();!n.done;n=t.next()){var i=n.value;n=i[1],i=e.g.get("player",i[0])(),e.i[n](i)}e.j.autoplay=a,r&&e.j.play()}}),(function(t){t=new ri(ll,{detail:t}),e.i.dispatchEvent(t)}))}function Su(e,t){if("addEventListener"==t)return function(t,n,i){return e.l.addEventListener(t,n,i)};if("removeEventListener"==t)return function(t,n,i){return e.l.removeEventListener(t,n,i)};if(e.g.ta()&&0==Object.keys(e.g.g.video).length){var n=e.j[t];if("function"!=typeof n)return n}return e.g.ta()?e.g.get("video",t):("function"==typeof(n=e.j[t])&&(n=n.bind(e.j)),n)}function Tu(e,t,n){e.g.ta()&&("video"==t?e.l.dispatchEvent(n):"player"==t&&e.s.dispatchEvent(n))}function Eu(e,t,n,i){ai.call(this);var r=this;this.g=e,this.i=t,this.h=new wi,this.N={video:e,player:t},this.H=n||function(){},this.T=i||function(e){return e},this.j=null,this.J=!1,this.s=!0,this.m=0,this.F=!1,this.D=!0,this.u=this.l=null,this.L=new Qt((function(){Lu(r)})),function(e){var t=cast.receiver.CastReceiverManager.getInstance();t.onSenderConnected=function(){return Au(e)},t.onSenderDisconnected=function(){return Au(e)},t.onSystemVolumeChanged=function(){var t=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();t&&Nu(e,{type:"update",update:{video:{volume:t.level,muted:t.muted}}},e.l),Nu(e,{type:"event",targetName:"video",event:{type:"volumechange"}},e.l)},e.u=t.getCastMessageBus("urn:x-cast:com.google.cast.media"),e.u.onMessage=function(t){return function(e,t){var n=Kl(t.data);switch(n.type){case"PLAY":e.g.play(),ku(e);break;case"PAUSE":e.g.pause(),ku(e);break;case"SEEK":var i=n.currentTime,r=n.resumeState;null!=i&&(e.g.currentTime=Number(i)),r&&"PLAYBACK_START"==r?(e.g.play(),ku(e)):r&&"PLAYBACK_PAUSE"==r&&(e.g.pause(),ku(e));break;case"STOP":e.i.Td().then((function(){e.i&&ku(e)}));break;case"GET_STATUS":Pu(e,Number(n.requestId));break;case"VOLUME":i=(r=n.volume).level,r=r.muted;var a=e.g.volume,o=e.g.muted;null!=i&&(e.g.volume=Number(i)),null!=r&&(e.g.muted=r),a==e.g.volume&&o==e.g.muted||ku(e);break;case"LOAD":e.m=0,e.F=!1,e.D=!1,i=n.media,r=n.currentTime,a=e.T(i.contentId),o=n.autoplay||!0,e.H(i.customData),o&&(e.g.autoplay=!0),e.i.load(a,r).then((function(){e.i&&Pu(e)})).catch((function(t){var i="LOAD_FAILED";7==t.category&&7e3==t.code&&(i="LOAD_CANCELLED"),Nu(e,{requestId:Number(n.requestId),type:i},e.u)}));break;default:Nu(e,{requestId:Number(n.requestId),type:"INVALID_REQUEST",reason:"INVALID_COMMAND"},e.u)}}(e,t)},e.l=t.getCastMessageBus("urn:x-cast:com.google.shaka.v2"),e.l.onMessage=function(t){return function(e,t){var n=Kl(t.data);switch(n.type){case"init":e.m=0,e.F=!1,e.D=!0,function(e,t,n){var i,r,a,o,s,l,u,c,h;D((function(d){switch(d.g){case 1:for(i in t.player)r=t.player[i],e.i[i](r);return e.H(n),a=e.g.autoplay,t.manifest?(e.g.autoplay=!1,M(d,5),b(d,e.i.load(t.manifest,t.startTime),7)):b(d,Promise.resolve(),3);case 7:S(d,3);break;case 5:return o=T(d),s=new ri(ll,{detail:o}),e.i&&e.i.dispatchEvent(s),d.return();case 3:if(!e.i)return d.return();for(l in t.video)u=t.video[l],e.g[l]=u;for(c in t.playerAfterLoad)h=t.playerAfterLoad[c],e.i[c](h);e.g.autoplay=a,t.manifest&&(e.g.play(),ku(e)),w(d)}}))}(e,n.initState,n.appData),Lu(e);break;case"appData":e.H(n.appData);break;case"set":var i=n.targetName,r=n.property;if(n=n.value,"video"==i){var a=cast.receiver.CastReceiverManager.getInstance();if("volume"==r){a.setSystemVolumeLevel(n);break}if("muted"==r){a.setSystemVolumeMuted(n);break}}e.N[i][r]=n;break;case"call":(i=e.N[n.targetName])[n.methodName].apply(i,n.args);break;case"asyncCall":i=n.targetName,r=n.methodName,"player"==i&&"load"==r&&(e.m=0,e.F=!1);var o=n.id,s=t.senderId;n=(a=e.N[i])[r].apply(a,n.args),"player"==i&&"load"==r&&(n=n.then((function(){e.D=!0}))),n.then((function(){return Du(e,s,o,null)}),(function(t){return Du(e,s,o,t)}))}}(e,t)},t.start();for(var n=(t=u(Yl)).next();!n.done;n=t.next())e.h.A(e.g,n.value,(function(t){return Ru(e,"video",t)}));for(var i in El)e.h.A(e.i,El[i],(function(t){return Ru(e,"player",t)}));cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?e.i.Od(3840,2160):e.i.Od(1920,1080),e.h.A(e.g,"loadeddata",(function(){e.F=!0})),e.h.A(e.i,"loading",(function(){e.s=!1,Cu(e)})),e.h.A(e.g,"playing",(function(){e.s=!1,Cu(e)})),e.h.A(e.g,"pause",(function(){Cu(e)})),e.h.A(e.i,"unloading",(function(){e.s=!0,Cu(e)})),e.h.A(e.g,"ended",(function(){new Qt((function(){e.g&&e.g.ended&&(e.s=!0,Cu(e))})).S(Uu)}))}(this)}function Au(e){e.m=0,e.D=!0,e.J=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length,Cu(e)}function Cu(e){var t;D((function(n){return 1==n.g?b(n,Promise.resolve(),2):e.i?(t=new ri("caststatuschanged"),e.dispatchEvent(t),Iu(e)||ku(e),void w(n)):n.return()}))}function Ru(e,t,n){e.i&&(Lu(e),Nu(e,{type:"event",targetName:t,event:n},e.l))}function Lu(e){e.L.S(Ou);for(var t={video:{},player:{}},n=u(Jl),i=n.next();!i.done;i=n.next())i=i.value,t.video[i]=e.g[i];if(e.i.X())for(var r in eu)0==e.m%eu[r]&&(t.player[r]=e.i[r]());for(var a in Ql)0==e.m%Ql[a]&&(t.player[a]=e.i[a]());(n=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())&&(t.video.volume=n.level,t.video.muted=n.muted),e.F&&(e.m+=1),Nu(e,{type:"update",update:t},e.l),Iu(e)}function Iu(e){return!(!e.D||!e.g.duration&&!e.i.X()||(Pu(e),e.D=!1,0))}function Pu(e,t){var n={contentId:e.i.od(),streamType:e.i.X()?"LIVE":"BUFFERED",contentType:""};e.i.X()||(n.duration=e.g.duration),e.j&&(n.metadata=e.j),ku(e,void 0===t?0:t,n)}function Du(e,t,n,i){e.i&&Nu(e,{type:"asyncComplete",id:n,error:i},e.l,t)}function Nu(e,t,n,i){e.J&&(e=Xl(t),i?n.getCastChannel(i).send(e):n.broadcast(e))}function ku(e,t,n){n=void 0===n?null:n;var i={mediaSessionId:0,playbackRate:e.g.playbackRate,playerState:e.s?Fu:e.i.rd()?zu:e.g.paused?Hu:Bu,currentTime:e.g.currentTime,supportedMediaCommands:63,volume:{level:e.g.volume,muted:e.g.muted}};n&&(i.media=n),Nu(e,{requestId:void 0===t?0:t,type:"MEDIA_STATUS",status:[i]},e.u)}g(yu,ai),(i=yu.prototype).destroy=function(e){return e&&this.g.wb(),this.h&&(this.h.release(),this.h=null),e=[],this.i&&(e.push(this.i.destroy()),this.i=null),this.g&&(e.push(this.g.destroy()),this.g=null),this.u=this.m=this.j=null,Promise.all(e)},i.pf=function(){return this.m},i.ef=function(){return this.u},i.Ge=function(){return this.g.m&&fu},i.ta=function(){return this.g.ta()},i.Gd=function(){return this.g.Gd()},i.cast=function(){var e,t=this;return D((function(n){return 1==n.g?(e=bu(t),b(n,t.g.cast(e),2)):t.i?b(n,t.i.Td(),0):n.return()}))},i.Md=function(e){this.g.Md(e)},i.Tf=function(){!function(e){if(e.h){var t=e.T();chrome.cast.requestSession((function(n){return ou(e,t,n)}),(function(t){return su(e,t)}))}}(this.g)},i.wb=function(){this.g.wb()},i.Je=function(e){var t=this;return D((function(n){if(1==n.g)return e==t.F?n.return():(t.F=e,t.g.wb(),b(n,t.g.destroy(),2));t.g=null,t.g=new au(e,(function(){return wu(t)}),(function(){return Mu(t)}),(function(e,n){return Tu(t,e,n)}),(function(){return _u(t)}),(function(){return bu(t)})),t.g.init(),w(n)}))},z("shaka.cast.CastProxy",yu),yu.prototype.changeReceiverId=yu.prototype.Je,yu.prototype.forceDisconnect=yu.prototype.wb,yu.prototype.suggestDisconnect=yu.prototype.Tf,yu.prototype.setAppData=yu.prototype.Md,yu.prototype.cast=yu.prototype.cast,yu.prototype.receiverName=yu.prototype.Gd,yu.prototype.isCasting=yu.prototype.ta,yu.prototype.canCast=yu.prototype.Ge,yu.prototype.getPlayer=yu.prototype.ef,yu.prototype.getVideo=yu.prototype.pf,yu.prototype.destroy=yu.prototype.destroy,g(Eu,ai),(i=Eu.prototype).isConnected=function(){return this.J},i.tf=function(){return this.s},i.Pf=function(e){this.j=e},i.Me=function(){this.j=null},i.Qf=function(e){this.j||(this.j={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.j.title=e},i.Of=function(e){this.j||(this.j={metadataType:cast.receiver.media.MetadataType.GENERIC}),this.j.images=[{url:e}]},i.Nf=function(e){this.j||(this.j={}),this.j.artist=e,this.j.metadataType=cast.receiver.media.MetadataType.MUSIC_TRACK},i.destroy=function(){var e,t=this;return D((function(n){if(1==n.g)return t.h&&(t.h.release(),t.h=null),e=[],t.i&&(e.push(t.i.destroy()),t.i=null),t.L&&(t.L.stop(),t.L=null),t.g=null,t.N=null,t.H=null,t.J=!1,t.s=!0,t.l=null,t.u=null,b(n,Promise.all(e),2);cast.receiver.CastReceiverManager.getInstance().stop(),w(n)}))},z("shaka.cast.CastReceiver",Eu),Eu.prototype.destroy=Eu.prototype.destroy,Eu.prototype.setContentArtist=Eu.prototype.Nf,Eu.prototype.setContentImage=Eu.prototype.Of,Eu.prototype.setContentTitle=Eu.prototype.Qf,Eu.prototype.clearContentMetadata=Eu.prototype.Me,Eu.prototype.setContentMetadata=Eu.prototype.Pf,Eu.prototype.isIdle=Eu.prototype.tf,Eu.prototype.isConnected=Eu.prototype.isConnected;var Ou=.5,Uu=5,Fu="IDLE",Bu="PLAYING",zu="BUFFERING",Hu="PAUSED";function Gu(e){var t=this;this.g=[],this.h=[],this.data=[],(new lr).box("moov",ur).V("pssh",(function(e){if(!(1<e.version)){var n=Le(e.reader.R,-12,e.size);if(t.data.push(n),t.g.push(At(e.reader.$a(16))),0<e.version){n=e.reader.M();for(var i=(n=u(ee(n))).next();!i.done;i=n.next())i=At(e.reader.$a(16)),t.h.push(i)}}})).parse(e)}function ju(e,t){var n=e.length,i=t.length+16+n,r=new Uint8Array(i),a=Ie(r),o=0;return a.setUint32(o,i),o+=4,a.setUint32(o,1886614376),o+=4,a.setUint32(o,0),o+=4,r.set(t,o),o+=t.length,a.setUint32(o,n),r.set(e,o+4),r}function Vu(e,t){var n=qu(e,t);return 1!=n.length?null:n[0]}function Wu(e,t,n){return 1!=(e=Xu(e,t,n)).length?null:e[0]}function qu(e,t){return Array.from(e.childNodes).filter((function(e){return e instanceof Element&&e.tagName==t}))}function Xu(e,t,n){return Array.from(e.childNodes).filter((function(e){return e instanceof Element&&e.localName==n&&e.namespaceURI==t}))}function Ku(e,t,n){return e.hasAttributeNS(t,n)?e.getAttributeNS(t,n):null}function Yu(e){return Array.from(e.childNodes).every(Ju)?e.textContent.trim():null}function Ju(e){return e.nodeType==Node.TEXT_NODE||e.nodeType==Node.CDATA_SECTION_NODE}function Zu(e,t,n,i){i=void 0===i?null:i;var r=null;return null!=(e=e.getAttribute(t))&&(r=n(e)),null==r?i:r}function $u(e){return e?(/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e)&&(e+="Z"),e=Date.parse(e),isNaN(e)?null:Math.floor(e/1e3)):null}function Qu(e){return e&&(e=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(e))?(e=31536e3*Number(e[1]||null)+2592e3*Number(e[2]||null)+86400*Number(e[3]||null)+3600*Number(e[4]||null)+60*Number(e[5]||null)+Number(e[6]||null),isFinite(e)?e:null):null}function ec(e){var t=/([0-9]+)-([0-9]+)/.exec(e);return t?(e=Number(t[1]),isFinite(e)?(t=Number(t[2]),isFinite(t)?{start:e,end:t}:null):null):null}function tc(e){return 0==(e=Number(e))%1?e:null}function nc(e){return 0==(e=Number(e))%1&&0<e?e:null}function ic(e){return 0==(e=Number(e))%1&&0<=e?e:null}function rc(e){return e=Number(e),isNaN(e)?null:e}function ac(e){var t;return e=(t=e.match(/^(\d+)\/(\d+)$/))?Number(t[1])/Number(t[2]):Number(e),isNaN(e)?null:e}function oc(e,t){var n=new DOMParser,i=null,r=null;try{r=n.parseFromString(e,"text/xml")}catch(e){}return r&&r.documentElement.tagName==t&&(i=r.documentElement),i&&0<i.getElementsByTagName("parsererror").length?null:i}function sc(e,t){try{return oc(gt(e),t)}catch(e){return null}}function lc(e,t,n){var i=function(e){for(var t=[],n=(e=u(e)).next();!n.done;n=e.next())(n=cc(n.value))&&t.push(n);return t}(e),r=null;e=[];var a=[],o=new Set(i.map((function(e){return e.keyId})));if(o.delete(null),1<o.size)throw new We(2,4,4010);if(t||(a=i.filter((function(e){return"urn:mpeg:dash:mp4protection:2011"!=e.qe||(r=e.init||r,!1)}))).length&&0==(e=function(e,t,n){for(var i=[],r=(t=u(t)).next();!r.done;r=t.next()){var a,o=n[(r=r.value).qe];if(o)a=(a=Wu(r.node,"urn:microsoft:playready","pro"))?[{initData:ju(a=Tt(a.textContent),new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149])),initDataType:"cenc",keyId:r.keyId}]:null,a=st(o,r.init||e||a),(o=dc.get(o))&&(a.licenseServerUri=o(r)),i.push(a)}return i}(r,a,n)).length&&(e=[st("",r)]),i.length&&(t||!a.length))for(e=[],n=(t=u(Object.values(n))).next();!n.done;n=t.next())"org.w3.clearkey"!=(n=n.value)&&e.push(st(n,r));if(o=Array.from(o)[0]||null)for(n=(t=u(e)).next();!n.done;n=t.next())for(i=(n=u(n.value.initData)).next();!i.done;i=n.next())i.value.keyId=o;return{Xd:o,yg:r,drmInfos:e,ae:!0}}function uc(e){return(e=Wu(e.node,"urn:microsoft:playready","pro"))&&(e=function(e){var t=0,n=Ie(e),i=n.getUint32(t,!0);if(i!=e.byteLength)return[];e:{for(e=t+6,t=[];e<n.byteLength-1;){i=n.getUint16(e,!0),e+=2;var r=n.getUint16(e,!0);if(e+=2,0!=(1&r)||r+e>n.byteLength){n=[];break e}var a=Le(n,e,r);t.push({type:i,value:a}),e+=r}n=t}return n}(e=Tt(e.textContent)).filter((function(e){return e.type===hc}))[0])&&(e=oc(e=vt(e.value,!0),"WRMHEADER"))?function(e){for(var t=(e=u(e.getElementsByTagName("DATA"))).next();!t.done;t=e.next())for(var n=(t=u(t.value.childNodes)).next();!n.done;n=t.next())if((n=n.value)instanceof Element&&"LA_URL"==n.tagName)return n.textContent;return""}(e):""}function cc(e){var t=e.getAttribute("schemeIdUri"),n=Ku(e,"urn:mpeg:cenc:2013","default_KID"),i=Xu(e,"urn:mpeg:cenc:2013","pssh").map(Yu);if(!t)return null;if(t=t.toLowerCase(),n&&(n=n.replace(/-/g,"").toLowerCase()).includes(" "))throw new We(2,4,4009);var r=[];try{r=i.map((function(e){return{initDataType:"cenc",initData:Tt(e),keyId:null}}))}catch(e){throw new We(2,4,4007)}return{node:e,qe:t,keyId:n,init:0<r.length?r:null}}var hc=1,dc=(new Map).set("com.widevine.alpha",(function(e){return(e=Wu(e.node,"urn:microsoft","laurl"))&&e.getAttribute("licenseUrl")||""})).set("com.microsoft.playready",uc).set("com.microsoft.playready.recommendation",uc).set("com.microsoft.playready.software",uc).set("com.microsoft.playready.hardware",uc);function pc(t,n,i,r,a){var o={RepresentationID:n,Number:i,Bandwidth:r,Time:a};return t.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,(function(t,n,i,r){if("$$"==t)return"$";var a=o[n];if(null==a)return t;switch("RepresentationID"==n&&i&&(i=void 0),"Time"==n&&(a=Math.round(a)),r){case void 0:case"d":case"i":case"u":t=a.toString();break;case"o":t=a.toString(8);break;case"x":t=a.toString(16);break;case"X":t=a.toString(16).toUpperCase();break;default:t=a.toString()}return i=e.parseInt(i,10)||1,Array(Math.max(0,i-t.length)+1).join("0")+t}))}function fc(e,t){var n=mc(e,t,"timescale"),i=1;n&&(i=nc(n)||1);var r=mc(e,t,"duration");n=nc(r||""),"image"==e.K.contentType&&(n=rc(r||"")),n&&(n/=i);var a=mc(e,t,"startNumber");r=Number(mc(e,t,"presentationTimeOffset"))||0;var o=ic(a||"");null!=a&&null!=o||(o=1);var s=gc(e,t,"SegmentTimeline");if(a=null,s){a=i;var l=e.W.duration||1/0,c=qu(s,"S");s=[];for(var h=-r,d=(c=u(te(c))).next();!d.done;d=c.next()){var p=(d=d.value).item,f=d.next,m=Zu(p,"t",ic);d=Zu(p,"d",ic);var g=Zu(p,"r",tc);if(null!=m&&(m-=r),!d)break;if(p=null!=m?m:h,0>(m=g||0))if(f){if(null==(f=Zu(f,"t",ic)))break;if(p>=f)break;m=Math.ceil((f-p)/d)-1}else{if(1/0==l)break;if(p/a>=l)break;m=Math.ceil((l*a-p)/d)-1}for(0<s.length&&p!=h&&(s[s.length-1].end=p/a),m=(f=u(ee(m+1))).next();!m.done;m=f.next())h=p+d,s.push({start:p/a,end:h/a,Yf:p}),p=h}a=s}return{timescale:i,ia:n,Gb:o,Ta:r/i||0,Ud:r,timeline:a}}function mc(e,t,n){return[t(e.K),t(e.ka),t(e.fa)].filter(ze).map((function(e){return e.getAttribute(n)})).reduce((function(e,t){return e||t}))}function gc(e,t,n){return[t(e.K),t(e.ka),t(e.fa)].filter(ze).map((function(e){return Vu(e,n)})).reduce((function(e,t){return e||t}))}function vc(e,t,n,i,r,a){if(a=void 0===a?0:a,Ku(e,"http://www.w3.org/1999/xlink","href")){var o=function(e,t,n,i,r,a){for(var o=Ku(e,"http://www.w3.org/1999/xlink","href"),s=Ku(e,"http://www.w3.org/1999/xlink","actuate")||"onRequest",l=u(Array.from(e.attributes)),c=l.next();!c.done;c=l.next())"http://www.w3.org/1999/xlink"==(c=c.value).namespaceURI&&e.removeAttributeNS(c.namespaceURI,c.localName);if(5<=a)return Qn(new We(2,4,4028));if("onLoad"!=s)return Qn(new We(2,4,4027));var h=ot([i],[o]);return r.request(0,di(h,t)).ba((function(i){if(!(i=sc(i.data,e.tagName)))return Qn(new We(2,4,4001,o));for(;e.childNodes.length;)e.removeChild(e.childNodes[0]);for(;i.childNodes.length;){var s=i.childNodes[0];i.removeChild(s),e.appendChild(s)}for(s=(i=u(Array.from(i.attributes))).next();!s.done;s=i.next())e.setAttributeNode(s.value.cloneNode(!1));return vc(e,t,n,h[0],r,a+1)}))}(e,t,n,i,r,a);return n&&(o=o.ba(void 0,(function(){return vc(e,t,n,i,r,a)}))),o}o=[];for(var s=u(Array.from(e.childNodes)),l=s.next();!l.done;l=s.next())(l=l.value)instanceof Element&&("urn:mpeg:dash:resolve-to-zero:2013"==Ku(l,"http://www.w3.org/1999/xlink","href")?e.removeChild(l):"SegmentTimeline"!=l.tagName&&o.push(vc(l,t,n,i,r,a)));return ii(o).ba((function(){return e}))}function yc(e){this.h=Ie(e),this.g=new ar(this.h,0)}function xc(e){var t=bc(e);if(7<t.length)throw new We(2,3,3002);for(var n=0,i=(t=u(t)).next();!i.done;i=t.next())n=256*n+i.value;t=bc(e);e:{for(var r=(i=u(wc)).next();!r.done;r=i.next())if(Ae(t,new Uint8Array(r.value))){i=!0;break e}i=!1}if(i)t=e.h.byteLength-e.g.Z();else{if(8==t.length&&224&t[1])throw new We(2,3,3001);i=0;for(var a=(r=u(te(t))).next();!a.done;a=r.next()){var o=(a=a.value).item;i=0==a.ha?o&(1<<8-t.length)-1:256*i+o}t=i}return t=e.g.Z()+t<=e.h.byteLength?t:e.h.byteLength-e.g.Z(),i=Ie(e.h,e.g.Z(),t),e.g.skip(t),new Mc(n,i)}function bc(e){var t=e.g.Z(),n=e.g.$();if(0==n)throw new We(2,3,3002);return n=8-Math.floor(Math.log2(n)),e.g.skip(n-1),Le(e.h,t,n)}yc.prototype.na=function(){return this.g.na()};var wc=[[255],[127,255],[63,255,255],[31,255,255,255],[15,255,255,255,255],[7,255,255,255,255,255],[3,255,255,255,255,255,255],[1,255,255,255,255,255,255,255]];function Mc(e,t){this.id=e,this.g=t}function _c(e){if(8<e.g.byteLength)throw new We(2,3,3002);if(8==e.g.byteLength&&224&e.g.getUint8(0))throw new We(2,3,3001);for(var t=0,n=u(ee(e.g.byteLength)),i=n.next();!i.done;i=n.next())t=256*t+(i=e.g.getUint8(i.value));return t}function Sc(e){var t=new yc(e.g);if(179!=(e=xc(t)).id)throw new We(2,3,3013);if(e=_c(e),183!=(t=xc(t)).id)throw new We(2,3,3012);t=new yc(t.g);for(var n=0;t.na();){var i=xc(t);if(241==i.id){n=_c(i);break}}return{Zf:e,Hf:n}}function Tc(e,t){var n=gc(e,t,"Initialization");if(!n)return null;var i=e.K.ya,r=n.getAttribute("sourceURL");r&&(i=ot(e.K.ya,[r])),r=0;var a=null;return(n=Zu(n,"range",ec))&&(r=n.start,a=n.end),new Xa((function(){return i}),r,a)}function Ec(e,t,n,i,r,a,o){var s,l,c,h,d,p,f,m,g,v,y,x,w,M,_;return D((function(S){if(1==S.g)return s=e.presentationTimeline,l=!e.cb||!e.W.ge,c=e.W.start,h=e.W.duration,d=e.K.mimeType.split("/")[1],f=null,m=[(p=t)(i,r,a),"webm"==d?p(n.ma(),n.ja,n.ea):null],p=null,b(S,Promise.all(m),2);if(g=S.h,v=g[0],y=g[1]||null,w=c-o,M=c,_=h?c+h:1/0,"mp4"==d)var T=function(e,t,n,i,r,a,o){var s,l=(new lr).V("sidx",(function(e){s=function(e,t,n,i,r,a,o){var s=[];o.reader.skip(4);var l=o.reader.M();if(0==l)throw new We(2,3,3005);if(0==o.version)var c=o.reader.M(),h=o.reader.M();else c=o.reader.nb(),h=o.reader.nb();o.reader.skip(2);var d=o.reader.Fb();for(e=e+o.size+h,h=(d=u(ee(d))).next();!h.done;h=d.next()){var p=o.reader.M();h=(2147483648&p)>>>31,p&=2147483647;var f=o.reader.M();if(o.reader.skip(4),1==h)throw new We(2,3,3006);s.push(new Ka(c/l+n,(c+f)/l+n,(function(){return a}),e,e+p-1,t,n,i,r)),c+=f,e+=p}return o.parser.stop(),s}(t,i,r,a,o,n,e)}));if(e&&l.parse(e),s)return s;throw new We(2,3,3004)}(v,r,i,n,w,M,_);else{if(440786851!=xc(T=new yc(y)).id)throw new We(2,3,3008);var E=xc(T);if(408125543!=E.id)throw new We(2,3,3009);T=E.g.byteOffset,E=new yc(E.g);for(var A=null;E.na();){var C=xc(E);if(357149030==C.id){A=C;break}}if(!A)throw new We(2,3,3010);for(A=new yc(A.g),C=1e6,E=null;A.na();){var R=xc(A);if(2807729==R.id)C=_c(R);else if(17545==R.id)if(4==R.g.byteLength)E=R.g.getFloat32(0);else{if(8!=R.g.byteLength)throw new We(2,3,3003);E=R.g.getFloat64(0)}}if(null==E)throw new We(2,3,3011);if(E*=A=C/1e9,475249515!=(C=xc(new yc(v))).id)throw new We(2,3,3007);T=function(e,t,n,i,r,a,o,s,l){function u(){return r}var c=[];e=new yc(e.g);for(var h=null,d=null;e.na();){var p=xc(e);if(187==p.id){var f=Sc(p);f&&(p=n*f.Zf,f=t+f.Hf,null!=h&&c.push(new Ka(h+o,p+o,u,d,f-1,a,o,s,l)),h=p,d=f)}}return null!=h&&c.push(new Ka(h+o,i+o,u,d,null,a,o,s,l)),c}(C,T,A,E,i,n,w,M,_)}return x=T,s.Cb(x),f=new go(x),l&&f.Ya(M,_,!0),S.return(f)}))}function Ac(e){return e.cc}function Cc(e){var t=gc(e,Ac,"RepresentationIndex");return e=ec((e=mc(e,Ac,"indexRange"))||""),t&&(e=Zu(t,"range",ec,e)),e}function Rc(e,t){var n=e.K.mimeType.split("/")[1];if(e.K.contentType!=ct&&"mp4"!=n&&"webm"!=n)throw new We(2,4,4006);if("webm"==n&&!t)throw new We(2,4,4005)}function Lc(e){return e.ab}function Ic(e){return e.dc}function Pc(){this.l=[],this.g=[],this.h=[],this.j=[],this.i=[],this.m=new Set}function Dc(e){var t,n,i,r,a,o,s,l,c,h,d,p,f,m,g,v,y,x,w,M,_,S,T,E;return D((function(A){switch(A.g){case 1:if(t=ht,1==e.length)return A.return(e[0]);for(n=e.map((function(e){return e.filter((function(e){return e.type==t.bb}))})),i=e.map((function(e){return e.filter((function(e){return e.type==t.Na}))})),r=e.map((function(e){return e.filter((function(e){return e.type==t.aa}))})),a=e.map((function(e){return e.filter((function(e){return e.type==t.Mb}))})),o=u(r),s=o.next();!s.done;s=o.next())s.value.push(Yc(t.aa));for(l=u(a),c=l.next();!c.done;c=l.next())c.value.push(Yc(t.Mb));return b(A,Nc([],n,0,Fc,zc),2);case 2:return h=A.h,b(A,Nc([],i,0,Fc,zc),3);case 3:return d=A.h,b(A,Nc([],r,0,Fc,zc),4);case 4:return p=A.h,b(A,Nc([],a,0,Fc,zc),5);case 5:if(f=A.h,m=0,d.length&&h.length)for(x=u(h),w=x.next();!w.done;w=x.next())for(M=w.value,_=u(d),S=_.next();!S.done;S=_.next())T=S.value,E=m++,T.variantIds.push(E),M.variantIds.push(E);else for(g=d.concat(h),v=u(g),y=v.next();!y.done;y=v.next())y.value.variantIds=[m++];return A.return(d.concat(h).concat(p).concat(f))}}))}function Nc(e,t,n,i,r){var a,o,s,l,c,h,d,p,f,m,g,v,y,x,w,M,_,S,T,E,A;return D((function(C){switch(C.g){case 1:for(a=ht,o=[],s=u(te(t)),l=s.next();!l.done;l=s.next())c=l.value,h=c.ha,d=c.item,h>=n?o.push(new Set(d)):o.push(new Set);p=u(e),f=p.next();case 2:if(f.done){C.v(4);break}return b(C,function(e,t,n,i,r){var a;return D((function(o){return 1==o.g?(a=Hc(t,e))?b(o,kc(a),2):o.return(!1):(Oc(e,a,n,i,r),o.return(!0))}))}(f.value,t,n,r,o),5);case 5:if(!C.h)throw new We(2,4,4037);f=p.next(),C.v(2);break;case 4:m=u(o),g=m.next();case 6:if(g.done){C.v(8);break}v=g.value,y=u(v),x=y.next();case 9:if(x.done){g=m.next(),C.v(6);break}return b(C,function(e,t,n,i,r){var a,o;return D((function(s){return 1==s.g?(a=n(e),(o=Hc(t,a))?a.createSegmentIndex?b(s,kc(o),2):s.v(2):s.return(null)):(Oc(a,o,0,i,r),s.return(a))}))}(x.value,t,i,r,o),12);case 12:(w=C.h)&&e.push(w),x=y.next(),C.v(9);break;case 8:for(M=u(o),g=M.next();!g.done;g=M.next())for(_=g.value,S={},T=u(_),x=T.next();!x.done;S={Va:S.Va},x=T.next())if(S.Va=x.value,E=S.Va.type==a.aa&&!S.Va.language,A=S.Va.type==a.Mb&&!S.Va.tilesLayout,!E&&!A&&e.some(function(e){return function(t){return t.mimeType==e.Va.mimeType&&kt(t.codecs)==kt(e.Va.codecs)}}(S)))throw new We(2,4,4037);return C.return(e)}}))}function kc(e){for(var t=[],n=(e=u(e)).next();!n.done;n=e.next())n=n.value,t.push(n.createSegmentIndex()),n.trickModeVideo&&!n.trickModeVideo.segmentIndex&&t.push(n.trickModeVideo.createSegmentIndex());return Promise.all(t)}function Oc(e,t,n,i,r){for(var a=(t=u(te(t))).next();!a.done;a=t.next()){var o=a.value;if(a=o.ha,o=o.item,a>=n){i(e,o);var s=!0;"audio"==e.type&&0==qt(e.language,o.language)&&(s=!1),s&&r[a].delete(o)}}}function Uc(e){return(e=Object.assign({},e)).originalId=null,e.createSegmentIndex=function(){return Promise.resolve()},e.segmentIndex=new xo,e.emsgSchemeIdUris=[],e.keyIds=new Set,e.closedCaptions=null,e.trickModeVideo=null,e}function Fc(e){return(e=Object.assign({},e)).keyIds=new Set,e.segments=[],e.variantIds=[],e.closedCaptions=null,e}function Bc(e,t){e.roles=Array.from(new Set(e.roles.concat(t.roles))),t.emsgSchemeIdUris&&(e.emsgSchemeIdUris=Array.from(new Set(e.emsgSchemeIdUris.concat(t.emsgSchemeIdUris))));var n=t.keyIds;if(n=new Set([].concat(c(e.keyIds),c(n))),e.keyIds=n,null==e.originalId?e.originalId=t.originalId:e.originalId+=","+(t.originalId||""),n=Vi(e.drmInfos,t.drmInfos),t.drmInfos.length&&e.drmInfos.length&&!n.length)throw new We(2,4,4038);if(e.drmInfos=n,e.encrypted=e.encrypted||t.encrypted,t.closedCaptions){e.closedCaptions||(e.closedCaptions=new Map);for(var i=(n=u(t.closedCaptions)).next();!i.done;i=n.next()){var r=u(i.value);i=r.next().value,r=r.next().value,e.closedCaptions.set(i,r)}}e.segmentIndex.l.push(t.segmentIndex),t.trickModeVideo?(e.trickModeVideo||(e.trickModeVideo=Uc(t.trickModeVideo),e.trickModeVideo.segmentIndex=e.segmentIndex.clone()),Bc(e.trickModeVideo,t.trickModeVideo)):e.trickModeVideo&&Bc(e.trickModeVideo,t)}function zc(e,t){e.roles=Array.from(new Set(e.roles.concat(t.roles)));var n=t.keyIds;if(n=new Set([].concat(c(e.keyIds),c(n))),e.keyIds=n,e.encrypted=e.encrypted&&t.encrypted,e.segments.push.apply(e.segments,c(t.segments)),t.closedCaptions){e.closedCaptions||(e.closedCaptions=new Map);for(var i=(n=u(t.closedCaptions)).next();!i.done;i=n.next()){var r=u(i.value);i=r.next().value,r=r.next().value,e.closedCaptions.set(i,r)}}}function Hc(e,t){for(var n=[],i=u(e),r=i.next();!r.done;r=i.next()){for(var a=t,o={audio:Gc,video:Gc,text:jc,image:Vc}[a.type],s={audio:Wc,video:qc,text:Xc,image:Kc}[a.type],l=null,c=(r=u(r.value)).next();!c.done;c=r.next())!o(a,c=c.value)||l&&!s(a,l,c)||(l=c);if(!(a=l))return null;n.push(a)}return n}function Gc(e,t){var n;if(!(n=t.mimeType!=e.mimeType||kt(t.codecs)!=kt(e.codecs))&&(n=e.drmInfos)){n=e.drmInfos;var i=t.drmInfos;n=!(!n.length||!i.length||0<Vi(n,i).length)}return!n}function jc(e,t){return!!e.language&&(!t.language||0!=qt(e.language,t.language)&&t.kind==e.kind)}function Vc(e){return!!e.tilesLayout}function Wc(e,t,n){if(e.id==n.id)return!0;var i=qt(e.language,t.language),r=qt(e.language,n.language);return r>i||!(r<i)&&(!(t.primary||!n.primary)||!(t.primary&&!n.primary)&&(e.roles.length?(i=t.roles.filter((function(t){return e.roles.includes(t)})),(r=n.roles.filter((function(t){return e.roles.includes(t)}))).length>i.length||!(r.length<i.length)&&n.roles.length<t.roles.length):!(n.roles.length||!t.roles.length)||!(n.roles.length&&!t.roles.length)&&((i=Zc(e.channelsCount,t.channelsCount,n.channelsCount))==Qc||i!=th&&((i=Zc(e.audioSamplingRate,t.audioSamplingRate,n.audioSamplingRate))==Qc||i!=th&&!(!e.bandwidth||$c(e.bandwidth,t.bandwidth,n.bandwidth)!=Qc)))))}function qc(e,t,n){if(e.id==n.id)return!0;var i=Zc(e.width*e.height,t.width*t.height,n.width*n.height);if(i==Qc)return!0;if(i==th)return!1;if(e.frameRate){if((i=Zc(e.frameRate,t.frameRate,n.frameRate))==Qc)return!0;if(i==th)return!1}return!(!e.bandwidth||$c(e.bandwidth,t.bandwidth,n.bandwidth)!=Qc)}function Xc(e,t,n){if(e.id==n.id)return!0;var i=qt(e.language,t.language),r=qt(e.language,n.language);if(r>i)return!0;if(r<i)return!1;if(!t.primary&&n.primary)return!0;if(t.primary&&!n.primary)return!1;if(e.roles.length){if(i=t.roles.filter((function(t){return e.roles.includes(t)})),(r=n.roles.filter((function(t){return e.roles.includes(t)}))).length>i.length)return!0;if(r.length<i.length)return!1}else{if(!n.roles.length&&t.roles.length)return!0;if(n.roles.length&&!t.roles.length)return!1}return n.mimeType==e.mimeType&&n.codecs==e.codecs&&(t.mimeType!=e.mimeType||t.codecs!=e.codecs)}function Kc(e,t,n){return e.id==n.id||Zc(e.width*e.height,t.width*t.height,n.width*n.height)==Qc}function Yc(e){return{id:0,originalId:"",primary:!1,type:e,mimeType:"",codecs:"",language:"",label:null,width:null,height:null,encrypted:!1,keyIds:new Set,segments:[],variantIds:[],roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null}}function Jc(e){return{id:0,originalId:"",createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new go([]),mimeType:"",codecs:"",encrypted:!1,drmInfos:[],keyIds:new Set,language:"",label:null,type:e,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],forced:!1,channelsCount:null,audioSamplingRate:null,spatialAudio:!1,closedCaptions:null}}function Zc(e,t,n){if(t==e&&e!=n)return th;if(n==e&&e!=t)return Qc;if(t>e){if(n<=e||n-e<t-e)return Qc;if(n-e>t-e)return th}else{if(n>e)return th;if(e-n<e-t)return Qc;if(e-n>e-t)return th}return eh}function $c(e,t,n){return t=Math.abs(e-t),(e=Math.abs(e-n))<t?Qc:t<e?th:eh}Pc.prototype.release=function(){for(var e=u(this.g.concat(this.h,this.j,this.i)),t=e.next();!t.done;t=e.next())(t=t.value).segmentIndex&&t.segmentIndex.release();this.g=[],this.h=[],this.j=[],this.i=[],this.l=[]};var Qc=1,eh=0,th=-1;function nh(){var e=this;this.C=this.o=null,this.h=[],this.B=null,this.D=1,this.l={},this.H={},this.g=new Pc,this.u=0,this.F=new H(5),this.s=new Qt((function(){e.Zb()})),this.i=new li,this.j=1/0,this.m=!1}function ih(e){var t,n,i,r,a,o,s;return D((function(l){return 1==l.g?(t=di(e.h,e.o.retryParameters),n=e.C.networkingEngine,i=Date.now(),r=n.request(0,t),ui(e.i,r),b(l,r.promise,2)):3!=l.g?(a=l.h,e.C?(a.uri&&!e.h.includes(a.uri)&&e.h.unshift(a.uri),b(l,function(e,t,n){var i,r,a,o;return D((function(s){if(1==s.g){if(!(i=sc(t,"MPD")))throw new We(2,4,4001,n);return e.o.dash.disableXlinkProcessing?s.return(rh(e,i,n)):(r=e.o.dash.xlinkFailGracefully,a=vc(i,e.o.retryParameters,r,n,e.C.networkingEngine),ui(e.i,a),b(s,a.promise,2))}return o=s.h,s.return(rh(e,o,n))}))}(e,a.data,a.uri),3)):l.return(0)):(o=Date.now(),s=(o-i)/1e3,G(e.F,1,s),l.return(s))}))}function rh(e,t,n){var i,r,a,o,s,l,c,h,d,p,f,m,g,v,y,x,_,E,A,C,R,L,I,P,N,k,O,U;return D((function(F){switch(F.g){case 1:if((i=e.o.dash.manifestPreprocessor)&&i(t),r=[n],0<(a=qu(t,"Location").map(Yu).filter(ze)).length&&(o=ot(r,a),r=e.h=o),s=qu(t,"BaseURL"),l=s.map(Yu),c=ot(r,l),h=0,s&&s.length&&(h=Zu(s[0],"availabilityTimeOffset",rc)||0),d=e.o.dash.ignoreMinBufferTime,p=0,d||(p=Zu(t,"minBufferTime",Qu)||0),e.u=Zu(t,"minimumUpdatePeriod",Qu,-1),f=Zu(t,"availabilityStartTime",$u),m=Zu(t,"timeShiftBufferDepth",Qu),g=e.o.dash.ignoreSuggestedPresentationDelay,v=null,g||(v=Zu(t,"suggestedPresentationDelay",Qu)),y=e.o.dash.ignoreMaxSegmentDuration,x=null,y||(x=Zu(t,"maxSegmentDuration",Qu)),_=t.getAttribute("type")||"static",e.B)for(E=e.B.presentationTimeline,A=u(Object.values(e.l)),C=A.next();!C.done;C=A.next())C.value.eb(E.Za());else R=e.o.defaultPresentationDelay||1.5*p,E=new Ya(f,null!=v?v:R,e.o.dash.autoCorrectDrift);L=t.getAttribute("profiles")||"",I={cb:"static"!=_,presentationTimeline:E,fa:null,W:null,ka:null,K:null,bandwidth:0,ee:!1,vb:h,profiles:L.split(",")};for(var B=Zu(t,"mediaPresentationDuration",Qu),z=[],H=0,G=qu(t,"Period"),j=(G=u(te(G))).next();!j.done;j=G.next()){var V=j.value;j=V.item,V=V.next,H=Zu(j,"start",Qu,H);var W=Zu(j,"duration",Qu),q=null;if(V){var K=Zu(V,"start",Qu);null!=K&&(q=K-H)}else null!=B&&(q=B-H);if(null==q&&(q=W),j=ah(e,I,c,{start:H,duration:q,node:j,ge:null==q||!V}),z.push(j),I.fa.id&&q&&(e.H[I.fa.id]=q),null==q){H=null;break}H+=q}return N=(P=null!=B?{periods:z,duration:B,Zd:!1}:{periods:z,duration:H,Zd:!0}).duration,k=P.periods,E.ec("static"==_),"static"!=_&&P.Zd||E.Ja(N||1/0),e.j&&!e.m&&e.C.isAutoLowLatencyMode()&&(e.C.enableLowLatencyMode(),e.m=e.C.isLowLatencyMode()),e.m?E.te(e.j):e.j&&X("Low-latency DASH live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."),E.X()&&!isNaN(e.o.availabilityWindowOverride)&&(m=e.o.availabilityWindowOverride),null==m&&(m=1/0),E.Qd(m),E.zd(x||1),b(F,function(e,t,n){var i,r,a,o,s,l,c,h,d,p,f,m,g,v,y,x,M,_,S,T,E,A,C,R,L,I,P,N,k,O,U;return D((function(D){switch(D.g){case 1:if(i=ht,function(e){for(var t=(e=u(e)).next();!t.done;t=e.next()){for(var n=[],i=u((t=t.value).sc),r=i.next();!r.done;r=i.next()){r=r.value;for(var a=!1,o=u(n),s=o.next();!s.done;s=o.next())s=s.value,r.id!=s.id&&r.channelsCount==s.channelsCount&&r.language==s.language&&r.bandwidth==s.bandwidth&&r.label==s.label&&r.codecs==s.codecs&&r.mimeType==s.mimeType&&re(r.roles,s.roles)&&r.audioSamplingRate==s.audioSamplingRate&&r.primary==s.primary&&(a=!0);a||n.push(r)}t.sc=n}}(t),function(e){for(var t=(e=u(e)).next();!t.done;t=e.next()){for(var n=[],i=u((t=t.value).Oc),r=i.next();!r.done;r=i.next()){r=r.value;for(var a=!1,o=u(n),s=o.next();!s.done;s=o.next())s=s.value,r.id!=s.id&&r.width==s.width&&r.frameRate==s.frameRate&&r.codecs==s.codecs&&r.mimeType==s.mimeType&&r.label==s.label&&re(r.roles,s.roles)&&Ri(r.closedCaptions,s.closedCaptions)&&r.bandwidth==s.bandwidth&&(a=!0);a||n.push(r)}t.Oc=n}}(t),function(e){for(var t=(e=u(e)).next();!t.done;t=e.next()){for(var n=[],i=u((t=t.value).textStreams),r=i.next();!r.done;r=i.next()){r=r.value;for(var a=!1,o=u(n),s=o.next();!s.done;s=o.next())s=s.value,r.id!=s.id&&r.language==s.language&&r.label==s.label&&r.codecs==s.codecs&&r.mimeType==s.mimeType&&re(r.roles,s.roles)&&(a=!0);a||n.push(r)}t.textStreams=n}}(t),function(e){for(var t=(e=u(e)).next();!t.done;t=e.next()){for(var n=[],i=u((t=t.value).imageStreams),r=i.next();!r.done;r=i.next()){r=r.value;for(var a=!1,o=u(n),s=o.next();!s.done;s=o.next())s=s.value,r.id!=s.id&&r.width==s.width&&r.codecs==s.codecs&&r.mimeType==s.mimeType&&(a=!0);a||n.push(r)}t.imageStreams=n}}(t),!n&&1==t.length){r=t[0],e.g=r.sc,e.h=r.Oc,e.j=r.textStreams,e.i=r.imageStreams,D.v(2);break}for(a=-1,o=u(te(t)),s=o.next();!s.done;s=o.next())l=s.value,c=l.ha,h=l.item,e.m.has(h.id)||(e.m.add(h.id),-1==a&&(a=c));if(-1==a)return D.return();for(d=t.map((function(e){return e.sc})),p=t.map((function(e){return e.Oc})),f=t.map((function(e){return e.textStreams})),m=t.map((function(e){return e.imageStreams})),g=u(f),v=g.next();!v.done;v=g.next())v.value.push(Jc(i.aa));for(y=u(m),x=y.next();!x.done;x=y.next())x.value.push(Jc(i.Mb));return b(D,Nc(e.g,d,a,Uc,Bc),3);case 3:return b(D,Nc(e.h,p,a,Uc,Bc),4);case 4:return b(D,Nc(e.j,f,a,Uc,Bc),5);case 5:return b(D,Nc(e.i,m,a,Uc,Bc),2);case 2:if(M=0,_=[],e.h.length&&e.g.length)for(R=u(e.g),L=R.next();!L.done;L=R.next())for(I=L.value,P=u(e.h),N=P.next();!N.done;N=P.next())k=N.value,O=Vi(I.drmInfos,k.drmInfos),I.drmInfos.length&&k.drmInfos.length&&!O.length||(U=M++,_.push({id:U,language:I.language,primary:I.primary,audio:I,video:k,bandwidth:(I.bandwidth||0)+(k.bandwidth||0),drmInfos:O,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]}));else for(S=e.h.concat(e.g),T=u(S),E=T.next();!E.done;E=T.next())A=E.value,C=M++,_.push({id:C,language:A.language,primary:A.primary,audio:A.type==i.bb?A:null,video:A.type==i.Na?A:null,bandwidth:A.bandwidth||0,drmInfos:A.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});e.l=_,w(D)}}))}(e.g,k,I.cb),2);case 2:if(e.B){e.B.variants=e.g.l,e.B.textStreams=e.g.j,e.B.imageStreams=e.g.i,e.C.filter(e.B),F.v(3);break}if(e.B={presentationTimeline:E,variants:e.g.l,textStreams:e.g.j,imageStreams:e.g.i,offlineSessionIds:[],minBufferTime:p||0},!E.ye()){F.v(3);break}return O=qu(t,"UTCTiming"),b(F,function(e,t,n){var i,r,a,o,s,l,c,h;return D((function(d){switch(d.g){case 1:i=n.map((function(e){return{scheme:e.getAttribute("schemeIdUri"),value:e.getAttribute("value")}})),r=e.o.dash.clockSyncUri,!i.length&&r&&i.push({scheme:"urn:mpeg:dash:utc:http-head:2014",value:r}),a=u(i),o=a.next();case 2:if(o.done){d.v(4);break}switch(s=o.value,M(d,5),l=s.scheme,c=s.value,l){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":return d.v(7);case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":return d.v(8);case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":return h=Date.parse(c),d.return(isNaN(h)?0:h-Date.now());case"urn:mpeg:dash:utc:http-ntp:2014":case"urn:mpeg:dash:utc:ntp:2014":case"urn:mpeg:dash:utc:sntp:2014":X("NTP UTCTiming scheme is not supported");break;default:X("Unrecognized scheme in UTCTiming element",l)}d.v(9);break;case 7:return b(d,uh(e,t,c,"HEAD"),10);case 10:return d.return(d.h);case 8:return b(d,uh(e,t,c,"GET"),11);case 11:return d.return(d.h);case 9:S(d,3);break;case 5:T(d);case 3:o=a.next(),d.v(2);break;case 4:return X("A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!"),d.return(0)}}))}(e,c,O),5);case 5:if(U=F.h,!e.C)return F.return();E.ue(U);case 3:e.C.makeTextStreamsForClosedCaptions(e.B),w(F)}}))}function ah(e,t,n,i){t.fa=lh(i.node,null,n),t.W=i,t.fa.vb=t.vb,t.fa.id||(t.fa.id="__shaka_period_"+i.start);for(var r=(n=u(n=qu(i.node,"EventStream"))).next();!r.done;r=n.next())ch(e,i.start,i.duration,r.value);if(n=qu(i.node,"AdaptationSet").map((function(n){return function(e,t,n){t.ka=lh(n,t.fa,null);var i=!1,r=qu(n,"Role"),a=r.map((function(e){return e.getAttribute("value")})).filter(ze),o=void 0,s=t.ka.contentType==ct;s&&(o="subtitle");for(var l=(r=u(r)).next();!l.done;l=r.next()){var h=(l=l.value).getAttribute("schemeIdUri");if(null==h||"urn:mpeg:dash:role:2011"==h)switch(l=l.getAttribute("value"),l){case"main":i=!0;break;case"caption":case"subtitle":o=l}}r=null,l=!1;for(var d=(h=u(h=qu(n,"EssentialProperty"))).next();!d.done;d=h.next())"http://dashif.org/guidelines/trickmode"==(d=d.value).getAttribute("schemeIdUri")?r=d.getAttribute("value"):l=!0;h=qu(n,"Accessibility");var p=new Map;for(d=(h=u(h)).next();!d.done;d=h.next()){var f=d.value;if(d=f.getAttribute("schemeIdUri"),f=f.getAttribute("value"),"urn:scte:dash:cc:cea-608:2015"==d)if(d=1,null!=f)for(var m=u(f=f.split(";")),g=m.next();!g.done;g=m.next()){var v=g.value,y=g=void 0;v.includes("=")?(g=(v=v.split("="))[0].startsWith("CC")?v[0]:"CC"+v[0],y=v[1]):(g="CC"+d,2==f.length?d+=2:d++,y=v),p.set(g,Wt(y))}else p.set("CC1","und");else if("urn:scte:dash:cc:cea-708:2015"==d)if(d=1,null!=f)for(g=(f=u(f.split(";"))).next();!g.done;g=f.next())v=m=void 0,(g=g.value).includes("=")?(m="svc"+(g=g.split("="))[0],v=g[1].split(",")[0].split(":").pop()):(m="svc"+d,d++,v=g),p.set(m,Wt(v));else p.set("svc1","und");else"urn:mpeg:dash:role:2011"==d&&null!=f&&(a.push(f),"captions"==f&&(o="caption"))}if(l)return null;var x=lc(l=qu(n,"ContentProtection"),e.o.dash.ignoreDrmInfo,e.o.dash.keySystemsByURI),M=Wt(n.getAttribute("lang")||"und"),_=n.getAttribute("label");if((l=qu(n,"Label"))&&l.length&&(l=l[0]).textContent&&(_=l.textContent),0==(n=(l=qu(n,"Representation")).map((function(n){return function(e,t,n,i,r,a,o,s,l,c){if(t.K=lh(c,t.ka,null),e.j=Math.min(e.j,t.K.vb),!function(e){var t=e.cc?1:0;return t+=e.ab?1:0,0==(t+=e.dc?1:0)?e.contentType==ct||"application"==e.contentType:(1!=t&&(e.cc&&(e.ab=null),e.dc=null),!0)}(t.K))return null;var h=t.W.start;t.bandwidth=Zu(c,"bandwidth",nc)||0;var d=t.K.contentType,p=d==ct||"application"==d;d="image"==d;try{var f=function(t,n,i){return function(e,t,n,i){var r,a,o,s,l;return D((function(u){return 1==u.g?(r=gi,a=Ro(t,n,i,e.o.retryParameters),o=e.C.networkingEngine,s=o.request(r,a),ui(e.i,s),b(u,s.promise,2)):(l=u.h,u.return(l.data))}))}(e,t,n,i)};if(t.K.cc)var m=function(e,t){var n=Number(mc(e,Ac,"presentationTimeOffset"))||0,i=mc(e,Ac,"timescale"),r=1;i&&(r=nc(i)||1);var a=n/r||0,o=Tc(e,Ac);!function(e,t){if(Rc(e,t),!Cc(e))throw new We(2,4,4002)}(e,o);var s=si(e);return{xb:function(){var e=gc(s,Ac,"RepresentationIndex"),n=s.K.ya;return e&&(e=e.getAttribute("sourceURL"))&&(n=ot(s.K.ya,[e])),e=Cc(s),Ec(s,t,o,n,e.start,e.end,a)}}}(t,f);else if(t.K.ab)m=function(e,t){var n=Tc(e,Lc),i=function(e){var t=function(e){return[e.K.ab,e.ka.ab,e.fa.ab].filter(ze).map((function(e){return qu(e,"SegmentURL")})).reduce((function(e,t){return 0<e.length?e:t})).map((function(t){return t.getAttribute("indexRange")&&!e.ee&&(e.ee=!0),{wf:t.getAttribute("media"),start:(t=Zu(t,"mediaRange",ec,{start:0,end:null})).start,end:t.end}}))}(e),n=(e=fc(e,Lc)).Gb;0==n&&(n=1);var i=0;return e.ia?i=e.ia*(n-1):e.timeline&&0<e.timeline.length&&(i=e.timeline[0].start),{ia:e.ia,startTime:i,Gb:n,Ta:e.Ta,timeline:e.timeline,Ab:t}}(e);if(!i.ia&&!i.timeline&&1<i.Ab.length)throw new We(2,4,4002);if(!i.ia&&!e.W.duration&&!i.timeline&&1==i.Ab.length)throw new We(2,4,4002);if(i.timeline&&0==i.timeline.length)throw new We(2,4,4002);var r=null,a=null;return e.fa.id&&e.K.id&&(a=e.fa.id+","+e.K.id,r=t[a]),n=function(e,t,n,i,r){var a=i.Ab.length;i.timeline&&i.timeline.length!=i.Ab.length&&(a=Math.min(i.timeline.length,i.Ab.length));for(var o=e-i.Ta,s=t?e+t:1/0,l=[],c=i.startTime,h={},d=(a=u(ee(a))).next();!d.done;h={Vc:h.Vc},d=a.next()){d=d.value;var p,f=i.Ab[d];h.Vc=ot(n,[f.wf]),p=null!=i.ia?c+i.ia:i.timeline?i.timeline[d].end:c+t,l.push(new Ka(e+c,e+p,function(e){return function(){return e.Vc}}(h),f.start,f.end,r,o,e,s)),c=p}return l}(e.W.start,e.W.duration,e.K.ya,i,n),i=!r,r?r.Bb(n,e.presentationTimeline.Za()):(e.presentationTimeline.Cb(n),r=new go(n),a&&e.cb&&(t[a]=r)),e.cb&&e.W.ge||r.Ya(e.W.start,e.W.duration?e.W.start+e.W.duration:1/0,i),{xb:function(){return Promise.resolve(r)}}}(t,e.l);else if(t.K.dc)m=function(e,t,n,i,r,a){var o=function(e){var t=mc(e,Ic,"initialization");if(!t)return null;var n=e.K.id,i=e.bandwidth||null,r=e.K.ya;return new Xa((function(){var e=pc(t,n,null,i,null);return ot(r,[e])}),0,null)}(e),s=function(e){var t=fc(e,Ic),n=mc(e,Ic,"media");return e=mc(e,Ic,"index"),{ia:t.ia,timescale:t.timescale,Gb:t.Gb,Ta:t.Ta,Ud:t.Ud,timeline:t.timeline,xd:n,Yb:e}}(e);!function(e){var t=e.Yb?1:0;if(t+=e.timeline?1:0,0==(t+=e.ia?1:0))throw new We(2,4,4002);if(1!=t&&(e.Yb&&(e.timeline=null),e.ia=null),!e.Yb&&!e.xd)throw new We(2,4,4002)}(s);var l=si(e);if(s.Yb)return Rc(e,o),{xb:function(){var e=pc(s.Yb,l.K.id,null,l.bandwidth||null,null);return e=ot(l.K.ya,[e]),Ec(l,t,o,e,0,null,s.Ta)}};if(s.ia)return i||(e.presentationTimeline.zd(s.ia),e.presentationTimeline.Bd(e.W.start)),{xb:function(){return function(e,t,n,i,r){function a(e){var n=(e-f)*p,r=n+t.Ta,a=n+c;return n=a+p,(a=new Ka(a,Math.min(n,s()),(function(){var t=pc(g,y,e,v,r*m);return ot(x,[t])}),0,null,i,b,c,s())).j=n,a}function o(){var e=[Math.max(l.Za(),c),Math.min(l.gb(),s())].map((function(e){return e-c}));return[Math.ceil(e[0]/p),Math.ceil(e[1]/p)-1].map((function(e){return e+f}))}function s(){var e=null!=h&&r[h]||d;return e?c+e:1/0}var l=e.presentationTimeline,c=e.W.start,h=e.fa.id,d=e.W.duration,p=t.ia,f=t.Gb,m=t.timescale,g=t.xd,v=e.bandwidth||null,y=e.K.id,x=e.K.ya,b=c-t.Ta,w=o();e=e.cb?Math.max(w[0],w[1]-n+1):w[0],w=w[1],n=[];for(var M=e;M<=w;++M){var _=a(M);n.push(_)}var S=new go(n);if(n=l.gb()<s(),M=l.X(),n||M){var T=Math.max(e,w+1);S.Mc(p,(function(){var e=l.Za();S.eb(e);var t=u(o());t.next(),t=t.next().value;for(var n=[];T<=t;){var i=a(T);n.push(i),T++}return e>s()&&!n.length?null:n}))}return Promise.resolve(S)}(l,s,r,o,a)}};var c=null;i=null,e.fa.id&&e.K.id&&(i=e.fa.id+","+e.K.id,c=n[i]);var h=function(e,t,n){var i=e.W.start,r=e.W.duration,a=i-t.Ta;r=r?i+r:1/0;for(var o=[],s={},l=u(te(t.timeline)),c=l.next();!c.done;s={Uc:s.Uc,Yc:s.Yc,bd:s.bd,Rc:s.Rc,dd:s.dd,Sc:s.Sc},c=l.next()){var h=(c=c.value).item,d=h.start,p=h.Yf;h=h.end,s.bd=c.ha+t.Gb,s.dd=p+t.Ud,s.Yc=e.K.id,s.Rc=e.bandwidth||null,s.Uc=t.xd,s.Sc=e.K.ya,o.push(new Ka(i+d,i+h,function(e){return function(){var t=pc(e.Uc,e.Yc,e.bd,e.Rc||null,e.dd);return ot(e.Sc,[t]).map((function(e){return e.toString()}))}}(s),0,null,n,a,i,r))}return o}(l,s,o),d=e.W.start,p=e.W.duration?e.W.start+e.W.duration:1/0,f=1/0!=p;return c?(f&&new go(h).Ya(d,p,!0),c.Bb(h,e.presentationTimeline.Za())):(e.presentationTimeline.Cb(h),c=new go(h),i&&e.cb&&(n[i]=c)),f&&c.Ya(d,p),{xb:function(){return Promise.resolve(c)}}}(t,f,e.l,!!e.B,e.o.dash.initialSegmentLimit,e.H);else{var g=t.K.ya,v=t.W.duration||0;m={xb:function(){return Promise.resolve(vo(h,v,g))}}}}catch(e){if((p||d)&&4002==e.code)return null;throw e}f=function(e,t,n,i){var r=lc(e,n,i);if(t.ae)e=1==t.drmInfos.length&&!t.drmInfos[0].keySystem,n=0==r.drmInfos.length,(0==t.drmInfos.length||e&&!n)&&(t.drmInfos=r.drmInfos),t.ae=!1;else if(0<r.drmInfos.length&&(t.drmInfos=t.drmInfos.filter((function(e){return r.drmInfos.some((function(t){return t.keySystem==e.keySystem}))})),0==t.drmInfos.length))throw new We(2,4,4008);return r.Xd||t.Xd}(f=qu(c,"ContentProtection"),n,e.o.dash.ignoreDrmInfo,e.o.dash.keySystemsByURI),f=new Set(f?[f]:[]);var y=!1;qu(c,"SupplementalProperty").some((function(e){return"tag:dolby.com,2018:dash:EC3_ExtensionType:2018"==e.getAttribute("schemeIdUri")&&"JOC"==e.getAttribute("value")}))&&(t.K.mimeType="audio/eac3-joc",y=!0);var x,M,_=!1;if(p&&(_=s.includes("forced_subtitle")),d&&((c=qu(c,"EssentialProperty").find((function(e){return["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"].includes(e.getAttribute("schemeIdUri"))})))&&(x=c.getAttribute("value")),!x))return null;c=t.K.codecs,t.profiles.includes("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10")&&(c.includes("hvc1.2.4.L153.B0")||c.includes("hev1.2.4.L153.B0"))&&(M="PQ");var S={id:e.D++,originalId:t.K.id,createSegmentIndex:function(){var e;return D((function(t){if(1==t.g)return S.segmentIndex?t.v(0):(e=S,b(t,m.xb(),3));e.segmentIndex=t.h,w(t)}))},segmentIndex:null,mimeType:t.K.mimeType,codecs:t.K.codecs,frameRate:t.K.frameRate,pixelAspectRatio:t.K.pixelAspectRatio,bandwidth:t.bandwidth,width:t.K.width,height:t.K.height,kind:i,encrypted:0<n.drmInfos.length,drmInfos:n.drmInfos,keyIds:f,language:r,label:a,type:t.ka.contentType,primary:o,trickModeVideo:null,emsgSchemeIdUris:t.K.emsgSchemeIdUris,roles:s,forced:_,channelsCount:t.K.Cd,audioSamplingRate:t.K.audioSamplingRate,spatialAudio:y,closedCaptions:l,hdr:M,tilesLayout:x};return S}(e,t,x,o,M,_,i,a,p,n)})).filter((function(e){return!!e}))).length){if(r="image"==t.ka.contentType,e.o.dash.ignoreEmptyAdaptationSet||s||r)return null;throw new We(2,4,4003)}if(!t.ka.contentType||"application"==t.ka.contentType)for(t.ka.contentType=hh(n[0].mimeType,n[0].codecs),h=(s=u(n)).next();!h.done;h=s.next())h.value.type=t.ka.contentType;for(h=(s=u(n)).next();!h.done;h=s.next())for(h=h.value,f=(d=u(x.drmInfos)).next();!f.done;f=d.next())(f=f.value).keyIds=f.keyIds&&h.keyIds?new Set([].concat(c(f.keyIds),c(h.keyIds))):f.keyIds||h.keyIds;return s=l.map((function(e){return e.getAttribute("id")})).filter(ze),{id:t.ka.id||"__fake__"+e.D++,contentType:t.ka.contentType,language:M,zg:i,streams:n,drmInfos:x.drmInfos,Sd:r,Kf:s}}(e,t,n)})).filter(ze),t.cb){i=[];for(var a=(r=u(n)).next();!a.done;a=r.next())for(var o=(a=u(a.value.Kf)).next();!o.done;o=a.next())i.push(o.value);if(i.length!=new Set(i).size)throw new We(2,4,4018)}for(i=n.filter((function(e){return!e.Sd})),r=(n=u(n=n.filter((function(e){return e.Sd})))).next();!r.done;r=n.next()){a=(r=r.value).Sd.split(" ");for(var s=(o=u(i)).next();!s.done;s=o.next()){var l=s.value;if(a.includes(l.id)){s={};for(var h=(l=u(l.streams)).next();!h.done;s={mc:s.mc},h=l.next())s.mc=h.value,s.mc.trickModeVideo=r.streams.find(function(e){return function(t){return kt(e.mc.codecs)==kt(t.codecs)}}(s))}}}if(r=e.o.disableAudio?[]:oh(i,"audio"),o=e.o.disableVideo?[]:oh(i,"video"),a=e.o.disableText?[]:oh(i,ct),n=e.o.disableThumbnails?[]:oh(i,"image"),!o.length&&!r.length)throw new We(2,4,4004);for(i=[],s=(r=u(r)).next();!s.done;s=r.next())i.push.apply(i,c(s.value.streams));for(r=[],s=(o=u(o)).next();!s.done;s=o.next())r.push.apply(r,c(s.value.streams));for(o=[],s=(a=u(a)).next();!s.done;s=a.next())o.push.apply(o,c(s.value.streams));for(a=[],s=(n=u(n)).next();!s.done;s=n.next())a.push.apply(a,c(s.value.streams));return{id:t.fa.id,sc:i,Oc:r,textStreams:o,imageStreams:a}}function oh(e,t){return e.filter((function(e){return e.contentType==t}))}function sh(e,t){0>e.u||e.s.S(Math.max(3,e.u-t,j(e.F)))}function lh(e,t,n){t=t||{contentType:"",mimeType:"",codecs:"",emsgSchemeIdUris:[],frameRate:void 0,pixelAspectRatio:void 0,Cd:null,audioSamplingRate:null,vb:0},n=n||t.ya;for(var i=qu(e,"BaseURL"),r=i.map(Yu),a=e.getAttribute("contentType")||t.contentType,o=e.getAttribute("mimeType")||t.mimeType,s=e.getAttribute("codecs")||t.codecs,l=Zu(e,"frameRate",ac)||t.frameRate,c=e.getAttribute("sar")||t.pixelAspectRatio,h=qu(e,"InbandEventStream"),d=t.emsgSchemeIdUris.slice(),p=(h=u(h)).next();!p.done;p=h.next())p=p.value.getAttribute("schemeIdUri"),d.includes(p)||d.push(p);h=function(e){for(var t=(e=u(e)).next();!t.done;t=e.next()){var n=t.value;if((t=n.getAttribute("schemeIdUri"))&&(n=n.getAttribute("value")))switch(t){case"urn:mpeg:dash:outputChannelPositionList:2012":return n.trim().split(/ +/).length;case"urn:mpeg:dash:23003:3:audio_channel_configuration:2011":case"urn:dts:dash:audio_channel_configuration:2012":if(!(t=parseInt(n,10)))continue;return t;case"tag:dolby.com,2014:dash:audio_channel_configuration:2011":case"urn:dolby:dash:audio_channel_configuration:2011":if(!(t=parseInt(n,16)))continue;for(e=0;t;)1&t&&++e,t>>=1;return e;case"urn:mpeg:mpegB:cicp:ChannelConfiguration":if(t=[0,1,2,3,4,5,6,8,2,3,4,7,8,24,8,12,10,12,14,12,14],(n=parseInt(n,10))&&0<n&&n<t.length)return t[n]}}return null}(h=qu(e,"AudioChannelConfiguration"))||t.Cd,p=Zu(e,"audioSamplingRate",ic)||t.audioSamplingRate,a||(a=hh(o,s));var f=Vu(e,"SegmentBase"),m=Vu(e,"SegmentTemplate"),g=f&&Zu(f,"availabilityTimeOffset",rc)||0,v=m&&Zu(m,"availabilityTimeOffset",rc)||0;return i=i&&i.length&&Zu(i[0],"availabilityTimeOffset",rc)||0,i=t.vb+i+g+v,{ya:ot(n,r),cc:f||t.cc,ab:Vu(e,"SegmentList")||t.ab,dc:m||t.dc,width:Zu(e,"width",ic)||t.width,height:Zu(e,"height",ic)||t.height,contentType:a,mimeType:o,codecs:s,frameRate:l,pixelAspectRatio:c,emsgSchemeIdUris:d,id:e.getAttribute("id"),Cd:h,audioSamplingRate:p,vb:i}}function uh(e,t,n,i){var r,a,o,s,l,u;return D((function(c){if(1==c.g)return r=ot(t,[n]),(a=di(r,e.o.retryParameters)).method=i,o=e.C.networkingEngine.request(4,a),ui(e.i,o),b(c,o.promise,2);if(s=c.h,"HEAD"==i){if(!s.headers||!s.headers.date)return c.return(0);l=s.headers.date}else l=gt(s.data);return u=Date.parse(l),isNaN(u)?c.return(0):c.return(u-Date.now())}))}function ch(e,t,n,i){for(var r=i.getAttribute("schemeIdUri")||"",a=i.getAttribute("value")||"",o=Zu(i,"timescale",ic)||1,s=(i=u(qu(i,"Event"))).next();!s.done;s=i.next()){var l=Zu(s=s.value,"presentationTime",ic)||0,c=Zu(s,"duration",ic)||0;c=(l=l/o+t)+c/o,null!=n&&(l=Math.min(l,t+n),c=Math.min(c,t+n)),s={schemeIdUri:r,value:a,startTime:l,endTime:c,id:s.getAttribute("id")||"",eventElement:s},e.C.onTimelineRegionAdded(s)}}function hh(e,t){return Ft(Dt(e,t))?ct:e.split("/")[0]}function dh(e,t,n,i){this.g=e,this.type=t,this.U=n,this.segments=i||null}function ph(e,t,n,i){this.id=e,this.name=t,this.g=n,this.value=void 0===i?null:i}function fh(e,t,n){return(e=e.getAttribute(t))?e.value:n||null}function mh(e,t){var n=e.getAttribute(t);if(!n)throw new We(2,4,4023,t);return n.value}function gh(e,t,n){n=void 0===n?[]:n,this.U=t,this.g=e,this.h=n}function vh(e,t){this.name=e,this.value=t}function yh(e,t){return e.filter((function(e){return e.name==t}))}function xh(e,t){return e.filter((function(e){return mh(e,"TYPE")==t}))}function bh(e,t){var n=yh(e,t);return n.length?n[0]:null}function wh(e,t,n){return n=void 0===n?0:n,(e=bh(e,t))?Number(e.value):n}function Mh(e){this.h=e,this.g=0}function _h(e){Sh(e,/[ \t]+/gm)}function Sh(e,t){t.lastIndex=e.g;var n=t.exec(e.h);return n=null==n?null:{position:n.index,length:n[0].length,results:n},e.g==e.h.length||null==n||n.position!=e.g?null:(e.g+=n.length,n.results)}function Th(e){return e.g==e.h.length?null:(e=Sh(e,/[^ \t\n]*/gm))?e[0]:null}function Eh(){this.g=0}function Ah(e,t,n){var i=(t=(t=gt(t)).replace(/\r\n|\r(?=[^\n]|$)/gm,"\n").trim()).split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(i[0]))throw new We(2,4,4015);t=0;for(var r=!0,a=u(i),o=a.next();!o.done;o=a.next())if(o=o.value,/^#(?!EXT)/m.test(o)||r)r=!1;else{if(o=Ch(e.g++,o),--e.g,Rh.includes(o.name)){t=1;break}"EXT-X-STREAM-INF"==o.name&&(r=!0)}a=[],r=!0;for(var s=(o=u(te(i))).next();!s.done;s=o.next()){var l=s.value;s=l.ha;var c=l.item;if(l=l.next,/^#(?!EXT)/m.test(c)||r)r=!1;else{if(c=Ch(e.g++,c),Lh.includes(c.name)){if(1!=t)throw new We(2,4,4017);l=i.splice(s,i.length-s),i=n,r=[],o=[],s=[],c=null;for(var h=(l=u(l)).next();!h.done;h=l.next())h=h.value,/^(#EXT)/.test(h)?(h=Ch(e.g++,h),Rh.includes(h.name)?a.push(h):"EXT-X-MAP"==h.name?c=h:"EXT-X-PART"==h.name?s.push(h):"EXT-X-PRELOAD-HINT"==h.name?"PART"==fh(h,"TYPE")?s.push(h):"MAP"==fh(h,"TYPE")&&(h.name="EXT-X-MAP",c=h):o.push(h)):/^#(?!EXT)/m.test(h)||(h=ot([i],[h.trim()])[0],c&&o.push(c),r.push(new gh(h,o,s)),o=[],s=[]);return s.length&&(c&&o.push(c),r.push(new gh("",o,s))),new dh(n,t,a,r)}a.push(c),"EXT-X-STREAM-INF"==c.name&&(c.g.push(new vh("URI",l)),r=!0)}}return new dh(n,t,a)}function Ch(e,t){var n=t.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!n)throw new We(2,4,4016,t);var i,r=n[1],a=n[2];if(n=[],a){var o;(o=Sh(a=new Mh(a),/^([^,=]+)(?:,|$)/g))&&(i=o[1]);for(var s=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;o=Sh(a,s);)n.push(new vh(o[1],o[2]||o[3]))}return new ph(e,r,n,i)}(i=nh.prototype).configure=function(e){this.o=e},i.start=function(e,t){var n,i=this;return D((function(r){if(1==r.g)return i.m=t.isLowLatencyMode(),i.h=[e],i.C=t,b(r,ih(i),2);if(n=r.h,i.C&&sh(i,n),!i.C)throw new We(2,7,7001);return r.return(i.B)}))},i.stop=function(){for(var e=u(Object.values(this.l)),t=e.next();!t.done;t=e.next())t.value.release();return this.g&&this.g.release(),this.o=this.C=null,this.h=[],this.B=null,this.l={},this.g=null,null!=this.s&&(this.s.stop(),this.s=null),this.i.destroy()},i.update=function(){var e,t=this;return D((function(n){return 1==n.g?(M(n,2),b(n,ih(t),4)):2!=n.g?S(n,0):(e=T(n),t.C&&e?(t.C.onError(e),void w(n)):n.return())}))},i.onExpirationUpdated=function(){},i.Zb=function(){var e,t,n=this;return D((function(i){switch(i.g){case 1:return e=0,M(i,2),b(i,ih(n),4);case 4:e=i.h,S(i,3);break;case 2:t=T(i),n.C&&(t.severity=1,n.C.onError(t));case 3:if(!n.C)return i.return();sh(n,e),w(i)}}))},z("shaka.dash.DashParser",nh),rr.mpd=function(){return new nh},ir["application/dash+xml"]=function(){return new nh},ir["video/vnd.mpeg.dash.mpd"]=function(){return new nh},ph.prototype.toString=function(){var e="#"+this.name,t=this.g?this.g.map((function(e){return e.name+"="+(isNaN(Number(e.value))?'"'+e.value+'"':e.value)})):[];return this.value&&t.unshift(this.value),0<t.length&&(e+=":"+t.join(",")),e},ph.prototype.getAttribute=function(e){var t=this.g.filter((function(t){return t.name==e}));return t.length?t[0]:null};var Rh="EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST EXT-X-SERVER-CONTROL EXT-X-SKIP".split(" "),Lh="EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE EXT-X-MAP".split(" ");function Ih(){}function Ph(e){try{var t=Dh(e);return ti({uri:e,le:e,data:t.data,headers:{"content-type":t.contentType}})}catch(e){return Qn(e)}}function Dh(t){var n=t.split(":");if(2>n.length||"data"!=n[0])throw new We(2,1,1004,t);if(2>(n=n.slice(1).join(":").split(",")).length)throw new We(2,1,1004,t);var i=n[0];t=e.decodeURIComponent(n.slice(1).join(",")),n=i.split(";"),i=n[0];var r=!1;return 1<n.length&&"base64"==n[n.length-1]&&(r=!0,n.pop()),{data:r?Tt(t):xt(t),contentType:i}}function Nh(){var e=this;this.o=this.C=null,this.Ma=1,this.l=new Map,this.s=new Map,this.Fa=new Set,this.g=new Map,this.h=null,this.L="",this.Y=new Eh,this.Ea=0,this.u=new Qt((function(){e.Zb()})),this.j=ed,this.B=null,this.pa=0,this.F=1/0,this.T=this.Xa=0,this.D=new li,this.qa=[],this.J=new Map,this.Wa=!1,this.m=new Map,this.N=null,this.da=new Map,this.H=new Map,this.i=!1}function kh(e,t){var n,i,r,a,o,s,l,u,c,h,d,p;return D((function(f){if(1==f.g)return n=id,i=t.Ce,r=new Xe(i),e.i&&t.He&&Je(r,new at("_HLS_skip=YES")),b(f,Jh(e,di([r.toString()],e.o.retryParameters),0),2);if(3!=f.g){if(a=f.h,1!=(o=Ah(e.Y,a.data,a.uri)).type)throw new We(2,4,4017);return s=yh(o.U,"EXT-X-DEFINE"),l=Oh(e,s),u=t.stream,b(f,Wh(e,t.Nc,o,u.type,u.mimeType,t.wd,l,t.Oe),3)}c=f.h,u.segmentIndex.Bb(c,e.h.Za()),c.length&&(h=wh(o.U,"EXT-X-MEDIA-SEQUENCE",0),d=t.wd.get(h),u.segmentIndex.eb(d)),p=c[c.length-1],bh(o.U,"EXT-X-ENDLIST")&&(Yh(e,n.Be),e.h.Ja(p.endTime)),w(f)}))}function Oh(e,t){for(var n=new Map,i=u(t),r=i.next();!r.done;r=i.next()){var a=r.value;r=fh(a,"NAME");var o=fh(a,"VALUE");a=fh(a,"IMPORT"),r&&o&&n.set(r,o),a&&(r=e.l.get(a))&&n.set(a,r)}return n}function Uh(e,t){var n=[];e.o.disableVideo||n.push("avc1.42E01E"),e.o.disableAudio||n.push("mp4a.40.2");var i=fh(t,"CODECS",n.join(",")).split(/\s*,\s*/);n=new Set;for(var r=[],a=(i=u(i)).next();!a.done;a=i.next()){var o=kt(a=a.value);n.has(o)||(r.push(a),n.add(o))}return r}function Fh(e){return Wt(e=fh(e,"LANGUAGE")||"und")}function Bh(e,t){var n,i,r,a,o,s,l,u,c,h,d,p,f;return D((function(m){if(1==m.g){n=mh(t,"GROUP-ID"),i="";var g=mh(t,"TYPE").toLowerCase();return"subtitles"==g&&(g=ct),(r=g)!=ct&&n&&e.m.has(n)&&(i=e.m.get(n)),a=Kh(mh(t,"URI"),e.l),e.g.has(a)?m.return(e.g.get(a)):(o=Fh(t),s=fh(t,"NAME"),l=t.getAttribute("DEFAULT"),u="YES"==l,g="audio"==r&&(g=fh(t,"CHANNELS"))?parseInt(g.split("/")[0],10):null,c=g,g="audio"==r&&!!(g=fh(t,"CHANNELS"))&&g.includes("/JOC"),h=g,d=fh(t,"CHARACTERISTICS"),p=fh(t,"FORCED"),b(m,zh(e,a,i,r,o,u,s,c,null,d,"YES"==p,h),2))}return f=m.h,e.s.has(n)?e.s.get(n).push(f):e.s.set(n,[f]),null==f?m.return(null):e.g.has(a)?m.return(e.g.get(a)):(e.g.set(a,f),m.return(f))}))}function zh(e,t,n,i,r,a,o,s,l,h,d,p){var f,m,g,v,y,x,w,_,E,A,C,R,L,I,P,N,k,O,U,F,B,z,H,G,j,V,W,q,K,Y,J,Z,$,Q,ee,te,ne,ie,re;return D((function(ae){switch(ae.g){case 1:return f=ot([e.L],[t])[0],b(ae,Jh(e,di([f],e.o.retryParameters),0),2);case 2:if(m=ae.h,f=m.uri,1!=(g=Ah(e.Y,m.data,f)).type)throw new We(2,4,4017);if(v=[],g.segments)for(y=u(g.segments),x=y.next();!x.done;x=y.next())w=x.value,_=yh(w.U,"EXT-X-KEY"),v.push.apply(v,c(_));for(E=!1,A=[],C=new Set,R=u(v),L=R.next();!L.done;L=R.next())if(I=L.value,"NONE"!=(P=mh(I,"METHOD"))){if(E=!0,"AES-128"==P)return e.Wa=!0,ae.return(null);if(N=mh(I,"KEYFORMAT"),O=(k=Qh[N])?k(I):null){if(O.keyIds)for(U=u(O.keyIds),F=U.next();!F.done;F=U.next())B=F.value,C.add(B);A.push(O)}}if(E&&!A.length)throw new We(2,4,4026);return z=yh(g.U,"EXT-X-DEFINE"),H=Oh(e,z),function(e,t){var n=bh(t.U,"EXT-X-PLAYLIST-TYPE"),i=bh(t.U,"EXT-X-ENDLIST");if(i=n&&"VOD"==n.value||i,n=n&&"EVENT"==n.value&&!i,n=!i&&!n,i)Yh(e,ed);else{if(Yh(e,n?nd:td),!(i=bh(t.U,"EXT-X-TARGETDURATION")))throw new We(2,4,4024,"EXT-X-TARGETDURATION");i=Number(i.value),n=bh(t.U,"EXT-X-PART-INF"),e.i&&n?(e.Xa=Number(mh(n,"PART-TARGET")),e.F=Math.min(e.Xa,e.F),n=bh(t.U,"EXT-X-SERVER-CONTROL"),e.T=n?Number(mh(n,"PART-HOLD-BACK")):0):e.F=Math.min(i,e.F),e.pa=Math.max(i,e.pa)}}(e,g),b(ae,function(e,t,n,i,r){var a,o,s,l,u,c,h,d,p,f,m;return D((function(g){return 1==g.g?(a=ht,o=gi,s=Kh(i.segments[0].g,r),l=new Xe(s),u=l.xa.split(".").pop(),c=$h[t],(h=c[u])?g.return(h):t==a.aa?n&&"vtt"!=n&&"wvtt"!=n?g.return("application/mp4"):g.return("text/vtt"):t!=a.Mb||n&&"jpeg"!=n?((d=di([s],e.o.retryParameters)).method="HEAD",b(g,Jh(e,d,o),2)):g.return("image/jpeg")):(p=g.h,(f=p.headers["content-type"])?g.return(f.split(";")[0]):(m=c.mp4,g.return(m)))}))}(e,i,n,g,H),3);case 3:return G=ae.h,Zh.includes(G)&&(n=""),j=new Map,V=new Map,M(ae,4),b(ae,Wh(e,t,g,i,G,j,H,V),6);case 6:W=ae.h,S(ae,5);break;case 4:if(4035==(q=T(ae)).code)return X("Skipping unsupported HLS stream",G,t),ae.return(null);throw q;case 5:if(K=W[0].startTime,Y=W[W.length-1].endTime,J=new go(W),Z=i==ct?"subtitle":void 0,$=[],h)for(Q=u(h.split(",")),ee=Q.next();!ee.done;ee=Q.next())te=ee.value,$.push(te);return ie=!!(ne=bh(g.U,"EXT-X-SERVER-CONTROL"))&&null!=ne.getAttribute("CAN-SKIP-UNTIL"),re={id:e.Ma++,originalId:o,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:J,mimeType:G,codecs:n,kind:Z,encrypted:E,drmInfos:A,keyIds:C,language:r,label:o,type:i,primary:a,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,pixelAspectRatio:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:$,forced:d,channelsCount:s,audioSamplingRate:null,spatialAudio:p,closedCaptions:l,hdr:void 0,tilesLayout:void 0},ae.return({stream:re,Nc:t,Ce:f,je:K,vf:Y,wd:j,Oe:V,He:ie})}}))}function Hh(e,t,n,i){return(n=bh(n,"EXT-X-MAP"))?(t=[i=Kh(ot([t],[mh(n,"URI")])[0],i),fh(n,"BYTERANGE","")].join("-"),e.da.has(t)||(n=function(e,t){var n=0,i=null,r=fh(t,"BYTERANGE");return r&&(n=r.split("@"),i=Number(n[0]),i=(n=Number(n[1]))+i-1),new Xa((function(){return[e]}),n,i)}(i,n),e.da.set(t,n)),e.da.get(t)):null}function Gh(e,t,n,i,r,a,o,s,l){var c=i.U,h=Kh(i.g,o),d=bh(c,"EXTINF"),p=o=0,f=null,m=[];if(e.i&&i.h.length){e={};for(var g=(i=u(te(i.h))).next();!g.done;e={Wc:e.Wc},g=i.next()){var v=(g=g.value).ha;g=g.item;var y=0==v?n:m[m.length-1];v=0==v?r:y.endTime;var x=Number(fh(g,"DURATION"));x=v+x;var b=0,w=null;"EXT-X-PRELOAD-HINT"==g.name?b=(y=fh(g,"BYTERANGE-START"))?Number(y):0:(b=(y=u(jh(y,b=fh(g,"BYTERANGE")))).next().value,w=y.next().value),g=fh(g,"URI"),e.Wc=ot([s],[g])[0],m.push(new Ka(v,x,function(e){return function(){return[e.Wc]}}(e),b,w,t,a,0,1/0))}}else if(!d)throw new We(2,4,4024,"EXTINF");return o=d?r+Number(d.value.split(",")[0]):m[m.length-1].endTime,(s=bh(c,"EXT-X-BYTERANGE"))?(p=(f=u(jh(n,s.value))).next().value,f=f.next().value):m.length&&(p=m[0].ja,f=m[m.length-1].ea),n="","image"==l&&(n="1x1",(l=bh(c,"EXT-X-TILES"))&&(n=mh(l,"LAYOUT"))),new Ka(r,o,(function(){return h.length?[h]:[]}),p,f,t,a,0,1/0,m,n)}function jh(e,t){var n=0,i=null;return t&&(n=t.split("@"),i=Number(n[0]),i=(n=n[1]?Number(n[1]):e.ea+1)+i-1),[n,i]}function Vh(e){if(e.h){for(var t=u(e.qa),n=t.next();!n.done;n=t.next())e.h.Cb(n.value);e.qa=[]}}function Wh(e,t,n,i,r,a,o,s){var l,c,h,d,p,f,m,g,v,y,x,w,M,_,S,T,E,A,C,R;return D((function(L){switch(L.g){case 1:if(l=n.segments,h=wh(n.U,"EXT-X-MEDIA-SEQUENCE",0),p=(d=bh(n.U,"EXT-X-SKIP"))?Number(fh(d,"SKIPPED-SEGMENTS")):0,f=h+p,e.j!=ed&&a.has(f)){m=a.get(f),L.v(2);break}if(null!=e.N){L.v(3);break}return c=Hh(e,n.g,l[0].U,o),g=e,b(L,Xh(e,t,c,r,f,!1,l[0],o,i),4);case 4:g.N=L.h;case 3:m=e.N;case 2:if(l[0].g.split("/").pop(),v=wh(n.U,"EXT-X-DISCONTINUITY-SEQUENCE"),e.i&&(s.has(v)||s.set(v,f),p))for(;s.has(v+1)&&s.get(v+1)<f;)v++;y=e.H.get(v)||0,x=[],w=u(te(l)),M=w.next();case 5:if(M.done){L.v(7);break}if(_=M.value,S=_.ha,T=_.item,E=x[x.length-1],A=0==S?m:E.endTime,f=h+p+S,a.set(f,A),c=Hh(e,n.g,T.U,o),!bh(T.U,"EXT-X-DISCONTINUITY")){L.v(8);break}return v++,s.set(v,f),b(L,function(e,t,n,i,r,a,o,s,l,u){var c,h;return D((function(d){return 1==d.g?(c=0,e.H.has(t)?(c=e.H.get(t),d.v(2)):b(d,Xh(e,n,i,r,a,!0,o,s,u),3)):(2!=d.g&&(h=d.h,c=l-h,e.H.set(t,c)),d.return(c))}))}(e,v,t,c,r,f,T,o,A,i),9);case 9:y=L.h;case 8:!e.i&&e.C.isAutoLowLatencyMode()&&(e.C.enableLowLatencyMode(),e.i=e.C.isLowLatencyMode()),C=bh(T.U,"EXTINF"),e.i||C?(R=Gh(e,c,E,T,A,y,o,n.g,i),x.push(R)):e.i||X("Low-latency HLS live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details."),M=w.next(),L.v(5);break;case 7:return e.qa.push(x),Vh(e),L.return(x)}}))}function qh(e,t){var n,i,r,a,o,s;return D((function(l){switch(l.g){case 1:return n=gi,i=Ro(t.ma(),t.ja,t.ea,e.o.retryParameters),e.o.hls.useFullSegmentsForStartTime?l.return(Jh(e,i,n)):(r=Ro(t.ma(),t.ja,t.ja+2048-1,e.o.retryParameters),M(l,2),b(l,Jh(e,r,n),4));case 4:return a=l.h,l.return(a);case 2:if(7001==(o=T(l)).code)throw o;return X("Unable to fetch the starting part of HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.",r.uris[0]),b(l,Jh(e,i,n),5);case 5:return s=l.h,l.return(s)}}))}function Xh(e,t,n,i,r,a,o,s,l){var u,c,h,d,p,f,m,g;return D((function(v){switch(v.g){case 1:if(u=Gh(e,n,null,o,0,0,s,"",l),e.B&&!a&&(c=e.g.get(t),null!=(h=c.wd.get(r))))return v.return(h);if(i=i.toLowerCase(),Zh.includes(i))throw X("Raw formats are not yet supported.  Skipping "+i),new We(1,4,4035);if("video/webm"==i)throw X("WebM in HLS is not yet supported.  Skipping."),new We(1,4,4035);if("video/mp4"!=i&&"audio/mp4"!=i){v.v(2);break}return d=[qh(e,u)],n&&d.push(qh(e,n)),b(v,Promise.all(d),3);case 3:return p=v.h,f=p[0],m=p[1]||p[0],v.return(function(e,t,n,i){var r=0;if((new lr).box("moov",ur).box("trak",ur).box("mdia",ur).V("mdhd",(function(e){r=Sa(e.reader,e.version).timescale,e.parser.stop()})).parse(i,!0),!r)throw new We(2,4,4030,e,t);var a=0,o=!1;if((new lr).box("moof",ur).box("traf",ur).V("tfdt",(function(e){a=_a(e.reader,e.version).hd/r,o=!0,e.parser.stop()})).parse(n,!0),!o)throw new We(2,4,4030,e,t);return a}(t,f.uri,f.data,m.data));case 2:if("video/mp2t"!=i){v.v(4);break}return b(v,qh(e,u),5);case 5:return g=v.h,v.return(function(e,t,n){function i(){a.seek(o+188),71!=(s=a.$())&&(a.seek(o+192),s=a.$()),71!=s&&(a.seek(o+204),s=a.$()),71!=s&&r(),a.oe(1)}function r(){throw new We(2,4,4030,e,t)}for(var a=new ar(n,0),o=0,s=0;;)if(o=a.Z(),71!=(s=a.$())&&r(),8191==(8191&(n=a.Fb())))i();else if(16384&n){if(0!=(n=(48&a.$())>>4)&&2!=n||r(),3==n&&(n=a.$(),a.skip(n)),1==a.M()>>8)return a.skip(3),0!=(n=a.$()>>6)&&1!=n||r(),0==a.$()&&r(),(1073741824*((14&(n=a.$()))>>1)+((65534&a.Fb())<<14|(65534&a.Fb())>>1))/9e4;i()}else i()}(t,g.uri,g.data));case 4:throw new We(2,4,4030,t)}}))}function Kh(e,t){var n=String(e).replace(/%7B/g,"{").replace(/%7D/g,"}"),i=n.match(/{\$\w*}/g);if(i)for(var r=(i=u(i)).next();!r.done;r=i.next()){var a=(r=r.value).slice(2,r.length-1),o=t.get(a);if(!o)throw new We(2,4,4039,a);n=n.replace(r,o)}return n}function Yh(e,t){e.j=t,e.h&&e.h.ec(e.j==ed),e.j!=ed||e.u.stop()}function Jh(e,t,n){if(!e.D)throw new We(2,7,7001);return t=e.C.networkingEngine.request(n,t),ui(e.D,t),t.promise}z("shaka.net.DataUriPlugin",Ih),Ih.parse=Ph,hi("data",Ph),(i=Nh.prototype).configure=function(e){this.o=e},i.start=function(e,t){var n,i,r=this;return D((function(a){return 1==a.g?(r.C=t,r.i=t.isLowLatencyMode(),b(a,Jh(r,di([e],r.o.retryParameters),0),2)):3!=a.g?(n=a.h,r.L=n.uri,b(a,function(e,t){var n,i,r,a,o,s,l,c,h,d,p,f,m,g,v,y,x,_,S,E,A,C,R,L,I,P;return D((function(N){switch(N.g){case 1:if(0!=(n=Ah(e.Y,t,e.L)).type)throw new We(2,4,4022);for(var k=u(yh(n.U,"EXT-X-DEFINE")),O=k.next();!O.done;O=k.next()){var U=O.value;O=fh(U,"NAME"),U=fh(U,"VALUE"),O&&U&&(e.l.has(O)||e.l.set(O,U))}for(i=yh(n.U,"EXT-X-MEDIA"),r=yh(n.U,"EXT-X-STREAM-INF"),a=yh(n.U,"EXT-X-IMAGE-STREAM-INF"),O=(k=u(r)).next();!O.done;O=k.next()){var F=O.value;U=fh(F,"AUDIO"),O=fh(F,"VIDEO");var B=fh(F,"SUBTITLES");if(F=Uh(e,F),B){var z=ut(ct,F);e.m.set(B,z),ie(F,z)}U&&(B=lt("audio",F),e.m.set(U,B)),O&&(U=lt("video",F),e.m.set(O,U))}for(o=yh(n.U,"EXT-X-SESSION-DATA"),s=u(o),l=s.next();!l.done;l=s.next())c=l.value,h=fh(c,"DATA-ID"),d=fh(c,"URI"),p=fh(c,"LANGUAGE"),f=fh(c,"VALUE"),m={id:h},d&&(m.uri=ot([e.L],[d])[0]),p&&(m.language=p),f&&(m.value=f),g=new ri("sessiondata",m),e.C&&e.C.onEvent(g);return b(N,function(e,t){var n;return D((function(i){return 1==i.g?(t=t.filter((function(e){var t=fh(e,"URI")||"";return"SUBTITLES"!=fh(e,"TYPE")&&""!=t}))).length?b(i,Bh(e,t[0]),2):i.v(2):(n=t.slice(1).map((function(t){return Bh(e,t)})),b(i,Promise.all(n),0))}))}(e,i),2);case 2:for(O=(k=u(k=xh(i,"CLOSED-CAPTIONS"))).next();!O.done;O=k.next())O=Fh(B=O.value),U=mh(B,"GROUP-ID"),B=mh(B,"INSTREAM-ID"),e.J.get(U)||e.J.set(U,new Map),e.J.get(U).set(B,O);return b(N,function(e,t){var n,i,r;return D((function(a){return 1==a.g?(n=t.map((function(t){var n,i,r,a,o,s,l,c;return D((function(h){if(1==h.g)return n=fh(t,"FRAME-RATE"),i=Number(fh(t,"AVERAGE-BANDWIDTH"))||Number(mh(t,"BANDWIDTH")),r=fh(t,"RESOLUTION"),a=u(r?r.split("x"):[null,null]),o=a.next().value,s=a.next().value,l=fh(t,"VIDEO-RANGE"),b(h,function(e,t){var n,i,r,a,o,s,l,c,h,d,p,f,m,g;return D((function(v){if(1==v.g)return n=ht,i=Uh(e,t),r=fh(t,"AUDIO"),a=fh(t,"VIDEO"),s=(o=r||a)&&e.s.has(o)?e.s.get(o):[],l={audio:r?s:[],video:a?s:[]},h=!1,d=mh(t,"URI"),p=l.audio.find((function(e){return e&&e.Nc==d})),f=ut(n.Na,i),(m=ut(n.bb,i))&&!f?c=n.bb:!s.length&&m&&f?(c=n.Na,i=[[f,m].join()]):l.audio.length&&p?(c=n.bb,h=!0):c=l.video.length?n.bb:n.Na,h?v.v(2):b(v,function(e,t,n,i){var r,a,o,s;return D((function(l){if(1==l.g){if(r=Kh(mh(t,"URI"),e.l),e.g.has(r))return l.return(e.g.get(r));var u=fh(t,"CLOSED-CAPTIONS");return a="video"==i&&u&&"NONE"!=u?e.J.get(u):null,o=lt(i,n),b(l,zh(e,r,o,i,"und",!1,null,null,a,null,!1,!1),2)}return null==(s=l.h)?l.return(null):e.g.has(r)?l.return(e.g.get(r)):(e.g.set(r,s),l.return(s))}))}(e,t,i,c),3);if(2!=v.g&&(g=v.h),g)l[g.stream.type]=[g];else if(null===g)return v.return(null);return function(e){for(var t=(e=u(e.audio.concat(e.video))).next();!t.done;t=e.next())if(t=t.value){var n=t.stream.codecs.split(",");n=n.filter((function(e){return"mp4a.40.34"!=e})),t.stream.codecs=n.join(",")}}(l),v.return(l)}))}(e,t),2);if(c=h.h){for(var d=h.return,p=c.audio,f=c.video,m=u(f),g=m.next();!g.done;g=m.next())(g=g.value.stream)&&(g.width=Number(o)||void 0,g.height=Number(s)||void 0,g.frameRate=Number(n)||void 0,g.hdr=l||void 0);for(m=e.o.disableAudio,p.length&&!m||(p=[null]),m=e.o.disableVideo,f.length&&!m||(f=[null]),m=[],g=(p=u(p)).next();!g.done;g=p.next()){g=g.value;for(var v=u(f),y=v.next();!y.done;y=v.next()){var x=y.value;y=g?g.stream:null;var w=x?x.stream:null,M=g?g.stream.drmInfos:null,_=x?x.stream.drmInfos:null;x=(x?x.Nc:"")+" - "+(g?g.Nc:""),y&&w&&M.length&&_.length&&!(0<Vi(M,_).length)||e.Fa.has(x)||(y={id:e.Ma++,language:y?y.language:"und",primary:!!y&&y.primary||!!w&&w.primary,audio:y,video:w,bandwidth:i,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]},m.push(y),e.Fa.add(x))}}h=d.call(h,m)}else h=h.return([]);return h}))})),b(a,Promise.all(n),2)):(i=a.h,r=(r=i.reduce(Fe,[])).filter((function(e){return null!=e})),a.return(r))}))}(e,r),3);case 3:return v=N.h,b(N,function(e,t){var n,i,r,a,o,s,l,c,h,d,p;return D((function(f){if(1==f.g)return n=xh(t,"SUBTITLES"),i=n.map((function(t){var n,i;return D((function(r){if(1==r.g)return e.o.disableText?r.return(null):(M(r,2),b(r,Bh(e,t),4));if(2!=r.g)return n=r.h,r.return(n.stream);if(i=T(r),e.o.hls.ignoreTextStreamFailures)return r.return(null);throw i}))})),b(f,Promise.all(i),2);for(r=f.h,a=u(n),o=a.next();!o.done;o=a.next())if(s=o.value,l=mh(s,"GROUP-ID"),(c=e.m.get(l))&&(h=e.s.get(l)))for(d=u(h),p=d.next();!p.done;p=d.next())p.value.stream.codecs=c;return f.return(r.filter((function(e){return e})))}))}(e,i),4);case 4:return y=N.h,b(N,function(e,t){var n,i;return D((function(r){return 1==r.g?(n=t.map((function(t){var n,i;return D((function(r){if(1==r.g)return e.o.disableThumbnails?r.return(null):(M(r,2),b(r,function(e,t){var n,i,r,a,o,s;return D((function(l){return 1==l.g?(n=Kh(mh(t,"URI"),e.l),i=fh(t,"CODECS","jpeg")||"",e.g.has(n)?l.return(e.g.get(n)):(r=Fh(t),a=fh(t,"NAME"),o=fh(t,"CHARACTERISTICS"),b(l,zh(e,n,i,"image",r,!1,a,null,null,o,!1,!1),2))):null==(s=l.h)?l.return(null):e.g.has(n)?l.return(e.g.get(n)):(e.g.set(n,s),l.return(s))}))}(e,t),4));if(2!=r.g)return n=r.h,r.return(n.stream);if(i=T(r),e.o.hls.ignoreImageStreamFailures)return r.return(null);throw i}))})),b(r,Promise.all(n),2)):(i=r.h,r.return(i.filter((function(e){return e}))))}))}(e,a),5);case 5:if(x=N.h,!e.C)throw new We(2,7,7001);if(e.Wa&&0==v.length)throw new We(2,4,4034);for(S=_=1/0,E=u(e.g.values()),A=E.next();!A.done;A=E.next())C=A.value,_=Math.min(_,C.je),"text"!=C.stream.type&&(S=Math.min(S,C.vf-C.je));if(e.j!=ed?(e.h=new Ya(0,e.o.defaultPresentationDelay?e.o.defaultPresentationDelay:e.T?e.T:3*e.pa),e.h.ec(!1)):(e.h=new Ya(null,0),e.h.ec(!0)),Vh(e),e.j!=ed)e.Ea=e.F,R=id,e.j==R.Ae&&(L=e.h.Jc,isNaN(e.o.availabilityWindowOverride)||(L=e.o.availabilityWindowOverride),e.h.Qd(L));else for(e.h.Ja(S),e.h.offset(-_),I=u(e.g.values()),A=I.next();!A.done;A=I.next())(P=A.value).stream.segmentIndex.offset(-_),P.stream.segmentIndex.Ya(0,S);e.B={presentationTimeline:e.h,variants:v,textStreams:y,imageStreams:x,offlineSessionIds:[],minBufferTime:0},e.C.makeTextStreamsForClosedCaptions(e.B),w(N)}}))}(r,n.data),3)):(0<(i=r.Ea)&&r.u.S(i),a.return(r.B))}))},i.stop=function(){this.u&&(this.u.stop(),this.u=null);var e=[];return this.D&&(e.push(this.D.destroy()),this.D=null),this.o=this.C=null,this.Fa.clear(),this.B=null,this.g.clear(),this.s.clear(),this.m.clear(),this.l.clear(),Promise.all(e)},i.update=function(){var e,t,n,i=this;return D((function(r){if(1==r.g)return i.j==ed?r.return():(e=[],i.N=null,(t=Array.from(i.g.values())).length?b(r,kh(i,t[0]),2):r.v(2));for(n=1;n<t.length;n++)e.push(kh(i,t[n]));return b(r,Promise.all(e),0)}))},i.onExpirationUpdated=function(){},i.Zb=function(){var e,t,n=this;return D((function(i){return 1==i.g?n.C?(M(i,2),b(i,n.update(),4)):i.return():2!=i.g?(e=n.Ea,n.u.S(e),S(i,0)):(t=T(i),n.C?(t.severity=1,n.C.onError(t),n.u.S(.1),void w(i)):i.return())}))},z("shaka.hls.HlsParser",Nh);var Zh=["audio/aac","audio/ac3","audio/ec3","audio/mpeg"],$h={audio:{mp4:"audio/mp4",mp4a:"audio/mp4",m4s:"audio/mp4",m4i:"audio/mp4",m4a:"audio/mp4",m4f:"audio/mp4",cmfa:"audio/mp4",ts:"video/mp2t",aac:"audio/aac",ac3:"audio/ac3",ec3:"audio/ec3",mp3:"audio/mpeg"},video:{mp4:"video/mp4",mp4v:"video/mp4",m4s:"video/mp4",m4i:"video/mp4",m4v:"video/mp4",m4f:"video/mp4",cmfv:"video/mp4",ts:"video/mp2t"},text:{mp4:"application/mp4",m4s:"application/mp4",m4i:"application/mp4",m4f:"application/mp4",cmft:"application/mp4",vtt:"text/vtt",ttml:"application/ttml+xml"},image:{jpg:"image/jpeg",png:"image/png",svg:"image/svg+xml",webp:"image/webp",avif:"image/avif"}},Qh={"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":function(e){var t=mh(e,"METHOD");return["SAMPLE-AES","SAMPLE-AES-CTR"].includes(t)?(t=st("com.widevine.alpha",[{initDataType:"cenc",initData:t=Le((t=Dh(t=mh(e,"URI"))).data)}]),(e=fh(e,"KEYID"))&&(t.keyIds=new Set([e.toLowerCase().substr(2)])),t):null},"com.microsoft.playready":function(e){var t=mh(e,"METHOD");return["SAMPLE-AES","SAMPLE-AES-CTR"].includes(t)?st("com.microsoft.playready",[{initDataType:"cenc",initData:e=ju(e=Le((e=Dh(e=mh(e,"URI"))).data),t=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]))}]):null}},ed="VOD",td="EVENT",nd="LIVE",id={Be:ed,eg:td,Ae:nd};function rd(e,t,n,i,r,a){if(200<=n&&299>=n&&202!=n)return{uri:r||i,le:i,data:t,headers:e,fromCache:!!e["x-shaka-from-cache"]};r=null;try{r=yt(t)}catch(e){}throw new We(401==n||403==n?2:1,1,1001,i,n,r,e,a)}function ad(){}function od(e,t,n,i){var r=new hd;Ai(t.headers).forEach((function(e,t){r.append(t,e)}));var a=new ud,o={Vd:!1,xe:!1};if(e=new $n(e=function(e,t,n,i,r,a){var o,s,l,u,c,h,d,p,f,m,g,v;return D((function(y){switch(y.g){case 1:return o=ld,s=cd,h=c=0,d=Date.now(),M(y,2),b(y,o(e,n),4);case 4:return l=y.h,p=l.clone().body.getReader(),m=(f=l.headers.get("Content-Length"))?parseInt(f,10):0,new s({start:function(e){!function t(){var n,i;return D((function(o){switch(o.g){case 1:return M(o,2),b(o,p.read(),4);case 4:n=o.h,S(o,3);break;case 2:return T(o),o.return();case 3:if(n.done){o.v(5);break}if(c+=n.value.byteLength,!a){o.v(5);break}return b(o,a(n.value),5);case 5:(100<(i=Date.now())-d||n.done)&&(r(i-d,c-h,m-c),h=c,d=i),n.done?e.close():(e.enqueue(n.value),t()),w(o)}}))}()}}),b(y,l.arrayBuffer(),5);case 5:u=y.h,S(y,3);break;case 2:if(g=T(y),i.Vd)throw new We(1,1,7001,e,t);if(i.xe)throw new We(1,1,1003,e,t);throw new We(1,1,1002,e,g,t);case 3:return v={},l.headers.forEach((function(e,t){v[t.trim()]=e})),y.return(rd(v,u,l.status,e,l.url,t))}}))}(e,n,{body:t.body||void 0,headers:r,method:t.method,signal:a.signal,credentials:t.allowCrossSiteCredentials?"include":void 0},o,i,t.streamDataCallback),(function(){return o.Vd=!0,a.abort(),Promise.resolve()})),t=t.retryParameters.timeout){var s=new Qt((function(){o.xe=!0,a.abort()}));s.S(t/1e3),e.finally((function(){s.stop()}))}return e}function sd(){if(!e.ReadableStream)return!1;try{new ReadableStream({})}catch(e){return!1}return!(!e.fetch||!e.AbortController)}rr.m3u8=function(){return new Nh},ir["application/x-mpegurl"]=function(){return new Nh},ir["application/vnd.apple.mpegurl"]=function(){return new Nh},z("shaka.net.HttpFetchPlugin",ad),ad.isSupported=sd,ad.parse=od;var ld=e.fetch,ud=e.AbortController,cd=e.ReadableStream,hd=e.Headers;function dd(){}function pd(e,t,n,i){var r=new fd,a=Date.now(),o=0;return new $n(new Promise((function(s,l){for(var c in r.open(t.method,e,!0),r.responseType="arraybuffer",r.timeout=t.retryParameters.timeout,r.withCredentials=t.allowCrossSiteCredentials,r.onabort=function(){l(new We(1,1,7001,e,n))},r.onload=function(t){for(var i=(t=t.target).getAllResponseHeaders().trim().split("\r\n"),r={},a=(i=u(i)).next();!a.done;a=i.next())r[(a=a.value.split(": "))[0].toLowerCase()]=a.slice(1).join(": ");try{var o=rd(r,t.response,t.status,e,t.responseURL,n);s(o)}catch(e){l(e)}},r.onerror=function(t){l(new We(1,1,1002,e,t,n))},r.ontimeout=function(){l(new We(1,1,1003,e,n))},r.onprogress=function(e){var t=Date.now();(100<t-a||e.lengthComputable&&e.loaded==e.total)&&(i(t-a,e.loaded-o,e.total-e.loaded),o=e.loaded,a=t)},t.headers)r.setRequestHeader(c.toLowerCase(),t.headers[c]);r.send(t.body)})),(function(){return r.abort(),Promise.resolve()}))}sd()&&(hi("http",od,2,!0),hi("https",od,2,!0)),z("shaka.net.HttpXHRPlugin",dd),dd.parse=pd;var fd=e.XMLHttpRequest;function md(){this.h=this.j=this.i=0,this.g=new Map,this.l=0}function gd(e){var t=this;this.O=e,this.g=new Map,this.I=new xi((function(){var e=Array.from(t.g.values());return Promise.all(e.map((function(e){return e.catch((function(){}))})))})),this.h=[],this.ie=function(){},this.he=function(){},this.Ob=new md}function vd(e){var t=e.h.map((function(e){return e()}));return e.h=[],Promise.all(t)}function yd(e,t,n,i,r,a){bi(e.I);var o=function(e,t){e.i+=t;var n=e.l;return e.l++,e.g.set(n,t),n}(e.Ob,i);return i=(e.g.get(t)||Promise.resolve()).then((function(){var t,i,s,l,u,c,h;return D((function(d){if(1==d.g)return b(d,function(e,t){var n,i,r,a;return D((function(o){return 1==o.g?(n=gi,i=e.O.request(n,t),r=function(){return i.abort()},e.h.push(r),b(o,i.promise,2)):(a=o.h,ie(e.h,r),o.return(a.data))}))}(e,n),2);if(t=d.h,e.I.g)throw new We(2,9,7001);if(r)for(l in i=Le(t),(s=new Gu(i)).data)u=Number(l),c=s.data[u],h=s.g[u],e.he(c,h);e.Ob.close(o,t.byteLength);var p=e.Ob;return e.ie(0==p.i?0:p.j/p.i,e.Ob.h),d.return(a(t))}))})),e.g.set(t,i),i}function xd(e,t){var n=this;this.i=e,this.h=e.objectStore(t),this.g=new pt,e.onabort=function(e){e.preventDefault(),n.g.reject()},e.onerror=function(e){e.preventDefault(),n.g.reject()},e.oncomplete=function(){n.g.resolve()}}function bd(e,t){return new Promise((function(n,i){var r=e.h.openCursor();r.onerror=i,r.onsuccess=function(){var e;return D((function(i){if(1==i.g)return null==r.result?(n(),i.return()):(e=r.result,b(i,t(e.key,e.value,e),2));e.continue(),w(i)}))}}))}function wd(e){this.h=e,this.g=[]}function Md(e,t){return _d(e,t,"readwrite")}function _d(e,t,n){var i=new xd(n=e.h.transaction([t],n),t);return e.g.push(i),i.promise().then((function(){ie(e.g,i)}),(function(){ie(e.g,i)})),i}function Sd(e,t,n){this.g=new wd(e),this.i=t,this.h=n}function Td(e){return Promise.reject(new We(2,9,9011,"Cannot add new value to "+e))}function Ed(e,t,n,i){t=(e=Md(e.g,t)).store();for(var r={},a=(n=u(n)).next();!a.done;r={kc:r.kc},a=n.next())r.kc=a.value,t.delete(r.kc).onsuccess=function(e){return function(){return i(e.kc)}}(r);return e.promise()}function Ad(e,t,n){var i,r,a,o,s,l,c;return D((function(h){if(1==h.g){for(i=_d(e.g,t,"readonly"),r=i.store(),a={},o=[],s={},l=u(n),c=l.next();!c.done;s={Lb:s.Lb,Jb:s.Jb},c=l.next())s.Jb=c.value,s.Lb=r.get(s.Jb),s.Lb.onsuccess=function(e){return function(){null==e.Lb.result&&o.push(e.Jb),a[e.Jb]=e.Lb.result}}(s);return b(h,i.promise(),2)}if(o.length)throw new We(2,9,9012,"Could not find values for "+o);return h.return(n.map((function(e){return a[e]})))}))}function Cd(e){this.g=new wd(e)}function Rd(){this.g=new Map}function Ld(e,t,n){if(!(e=e.g.get(t)))throw new We(2,9,9013,"Could not find mechanism with name "+t);if(!(t=e.getCells().get(n)))throw new We(2,9,9013,"Could not find cell with name "+n);return t}function Id(e,t){Pd.set(e,t)}hi("http",pd,1,!0),hi("https",pd,1,!0),md.prototype.close=function(e,t){if(this.g.has(e)){var n=this.g.get(e);this.g.delete(e),this.j+=n,this.h+=t}},gd.prototype.destroy=function(){return this.I.destroy()},xd.prototype.abort=function(){var e=this;return D((function(t){if(1==t.g){try{e.i.abort()}catch(e){}return M(t,2),b(t,e.g,4)}if(2!=t.g)return S(t,0);T(t),w(t)}))},xd.prototype.store=function(){return this.h},xd.prototype.promise=function(){return this.g},wd.prototype.destroy=function(){return Promise.all(this.g.map((function(e){return e.abort()})))},(i=Sd.prototype).destroy=function(){return this.g.destroy()},i.hasFixedKeySpace=function(){return!0},i.addSegments=function(){return Td(this.i)},i.removeSegments=function(e,t){return Ed(this,this.i,e,t)},i.getSegments=function(e){var t,n=this;return D((function(i){return 1==i.g?b(i,Ad(n,n.i,e),2):(t=i.h,i.return(t.map((function(e){return n.Wd(e)}))))}))},i.addManifests=function(){return Td(this.h)},i.updateManifestExpiration=function(e,t){var n=Md(this.g,this.h),i=n.store();return i.get(e).onsuccess=function(n){(n=n.target.result)&&(n.expiration=t,i.put(n,e))},n.promise()},i.removeManifests=function(e,t){return Ed(this,this.h,e,t)},i.getManifests=function(e){var t,n=this;return D((function(i){return 1==i.g?b(i,Ad(n,n.h,e),2):(t=i.h,i.return(Promise.all(t.map((function(e){return n.Rb(e)})))))}))},i.getAllManifests=function(){var e,t,n=this;return D((function(i){return 1==i.g?(e=_d(n.g,n.h,"readonly"),t=new Map,b(i,bd(e,(function(e,i){var r;return D((function(a){if(1==a.g)return b(a,n.Rb(i),2);r=a.h,t.set(e,r),w(a)}))})),2)):3!=i.g?b(i,e.promise(),3):i.return(t)}))},i.Wd=function(e){return e},i.Rb=function(e){return Promise.resolve(e)},i.add=function(e,t){var n,i,r,a,o,s,l,c=this;return D((function(h){if(1==h.g){for(n=Md(c.g,e),i=n.store(),r=[],a={},o=u(t),s=o.next();!s.done;a={lc:a.lc},s=o.next())l=s.value,a.lc=i.add(l),a.lc.onsuccess=function(e){return function(){r.push(e.lc.result)}}(a);return b(h,n.promise(),2)}return h.return(r)}))},Cd.prototype.destroy=function(){return this.g.destroy()},Cd.prototype.getAll=function(){var e,t,n=this;return D((function(i){return 1==i.g?(e=_d(n.g,"session-ids","readonly"),t=[],b(i,bd(e,(function(e,n){t.push(n)})),2)):3!=i.g?b(i,e.promise(),3):i.return(t)}))},Cd.prototype.add=function(e){for(var t=Md(this.g,"session-ids"),n=t.store(),i=(e=u(e)).next();!i.done;i=e.next())n.add(i.value);return t.promise()},Cd.prototype.remove=function(e){var t,n=this;return D((function(i){return 1==i.g?b(i,bd(t=Md(n.g,"session-ids"),(function(t,n,i){e.includes(n.sessionId)&&i.delete()})),2):b(i,t.promise(),0)}))},Rd.prototype.destroy=function(){for(var e=[],t=u(this.g.values()),n=t.next();!n.done;n=t.next())e.push(n.value.destroy());return this.g.clear(),Promise.all(e)},Rd.prototype.init=function(){var e=this;Pd.forEach((function(t,n){var i=t();i&&e.g.set(n,i)}));for(var t=[],n=u(this.g.values()),i=n.next();!i.done;i=n.next())t.push(i.value.init());return Promise.all(t)},z("shaka.offline.StorageMuxer",Rd),Rd.unregister=function(e){Pd.delete(e)},Rd.register=Id,Rd.prototype.destroy=Rd.prototype.destroy;var Pd=new Map;function Dd(){Sd.apply(this,arguments)}function Nd(e,t){!function(e){var t=e.streams.filter((function(e){return"audio"==e.contentType}));if(e=e.streams.filter((function(e){return"video"==e.contentType})),!t.every((function(e){return e.variantIds}))||!e.every((function(e){return e.variantIds}))){for(var n=u(t),i=n.next();!i.done;i=n.next())i.value.variantIds=[];for(i=(n=u(e)).next();!i.done;i=n.next())i.value.variantIds=[];if(n=0,e.length&&!t.length){var r=n++,a=u(e);for(i=a.next();!i.done;i=a.next())i.value.variantIds.push(r)}if(!e.length&&t.length)for(r=n++,i=(a=u(t)).next();!i.done;i=a.next())i.value.variantIds.push(r);if(e.length&&t.length)for(i=(t=u(t)).next();!i.done;i=t.next())for(i=i.value,a=(r=u(e)).next();!a.done;a=r.next()){a=a.value;var o=n++;i.variantIds.push(o),a.variantIds.push(o)}}}(e);for(var n=u(e.streams),i=n.next();!i.done;i=n.next());return e.streams.map((function(n){return function(e,t,n){var i=e.initSegmentUri?kd(e.initSegmentUri):null,r=t+e.presentationTimeOffset,a=t+n;return{id:e.id,originalId:null,primary:e.primary,type:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:void 0,hdr:void 0,kind:e.kind,language:e.language,label:e.label,width:e.width,height:e.height,initSegmentKey:i,encrypted:e.encrypted,keyIds:new Set([e.keyId]),segments:e.segments.map((function(e){var n=kd(e.uri);return{startTime:t+e.startTime,endTime:t+e.endTime,dataKey:n,initSegmentKey:i,appendWindowStart:t,appendWindowEnd:a,timestampOffset:r,tilesLayout:""}})),variantIds:e.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0}}(n,e.startTime,t)}))}function kd(e){var t;if((t=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(e))||(t=/^offline:segment\/([0-9]+)$/.exec(e)))return Number(t[1]);throw new We(2,9,9004,"Could not parse uri "+e)}function Od(){Sd.apply(this,arguments)}function Ud(e,t,n){return{id:e.id,originalId:e.originalId,primary:e.primary,type:e.contentType,mimeType:e.mimeType,codecs:e.codecs,frameRate:e.frameRate,pixelAspectRatio:e.pixelAspectRatio,hdr:void 0,kind:e.kind,language:e.language,label:e.label,width:e.width,height:e.height,encrypted:e.encrypted,keyIds:new Set([e.keyId]),segments:e.segments.map((function(i){return{startTime:t+i.startTime,endTime:t+i.endTime,initSegmentKey:e.initSegmentKey,appendWindowStart:t,appendWindowEnd:n,timestampOffset:t-e.presentationTimeOffset,dataKey:i.dataKey,tilesLayout:""}})),variantIds:e.variantIds,roles:[],forced:!1,audioSamplingRate:null,channelsCount:null,spatialAudio:!1,closedCaptions:null,tilesLayout:void 0}}function Fd(){Sd.apply(this,arguments)}function Bd(){this.m=this.j=this.i=this.h=this.g=this.l=null}function zd(e,t,n,i){this.g=e,this.i=t,this.h=n,this.l=i,this.j=["offline:",e,"/",t,"/",n,"/",i].join("")}function Hd(e){if(null==(e=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(e)))return null;var t=e[1];if("manifest"!=t&&"segment"!=t)return null;var n=e[2];if(!n)return null;var i=e[3];return i&&null!=t?new zd(t,n,i,Number(e[4])):null}function Gd(e,t){this.h=e,this.g=t}function jd(e,t){var n=new Ya(null,0);n.Ja(t.duration);var i=t.streams.filter((function(e){return"audio"==e.type})),r=t.streams.filter((function(e){return"video"==e.type}));i=function(e,t,n,i){for(var r=new Set,a=u(t),o=a.next();!o.done;o=a.next()){var s=u(o.value.variantIds);for(o=s.next();!o.done;o=s.next())r.add(o.value)}for(o=(a=u(n)).next();!o.done;o=a.next())for(o=(s=u(o.value.variantIds)).next();!o.done;o=s.next())r.add(o.value);for(a=new Map,o=(r=u(r)).next();!o.done;o=r.next())o=o.value,a.set(o,{id:o,language:"",primary:!1,audio:null,video:null,bandwidth:0,allowedByApplication:!0,allowedByKeySystem:!0,decodingInfos:[]});for(r=(t=u(t)).next();!r.done;r=t.next())for(o=Vd(e,r=r.value,i),r=(s=u(r.variantIds)).next();!r.done;r=s.next())(r=a.get(r.value)).language=o.language,r.primary=r.primary||o.primary,r.audio=o;for(t=(n=u(n)).next();!t.done;t=n.next())for(t=Vd(e,r=t.value,i),r=(o=u(r.variantIds)).next();!r.done;r=o.next())(r=a.get(r.value)).primary=r.primary||t.primary,r.video=t;return a}(e,i,r,n),r=t.streams.filter((function(e){return e.type==ct})).map((function(t){return Vd(e,t,n)}));var a=t.streams.filter((function(e){return"image"==e.type})).map((function(t){return Vd(e,t,n)})),o=t.drmInfo?[t.drmInfo]:[];if(t.drmInfo)for(var s=u(i.values()),l=s.next();!l.done;l=s.next())(l=l.value).audio&&l.audio.encrypted&&(l.audio.drmInfos=o),l.video&&l.video.encrypted&&(l.video.drmInfos=o);return{presentationTimeline:n,minBufferTime:2,offlineSessionIds:t.sessionIds,variants:Array.from(i.values()),textStreams:r,imageStreams:a}}function Vd(e,t,n){var i=t.segments.map((function(t){return function(e,t){var n=new zd("segment",e.h,e.g,t.dataKey);return new Ka(t.startTime,t.endTime,(function(){return[n.toString()]}),0,null,null!=t.initSegmentKey?function(e,t){var n=new zd("segment",e.h,e.g,t);return new Xa((function(){return[n.toString()]}),0,null)}(e,t.initSegmentKey):null,t.timestampOffset,t.appendWindowStart,t.appendWindowEnd,[],t.tilesLayout||"")}(e,t)}));return n.Cb(i),{id:t.id,originalId:t.originalId,createSegmentIndex:function(){return Promise.resolve()},segmentIndex:new go(i),mimeType:t.mimeType,codecs:t.codecs,width:t.width||void 0,height:t.height||void 0,frameRate:t.frameRate,pixelAspectRatio:t.pixelAspectRatio,hdr:t.hdr,kind:t.kind,encrypted:t.encrypted,drmInfos:[],keyIds:t.keyIds,language:t.language,label:t.label,type:t.type,primary:t.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:t.roles,forced:t.forced,channelsCount:t.channelsCount,audioSamplingRate:t.audioSamplingRate,spatialAudio:t.spatialAudio,closedCaptions:t.closedCaptions,tilesLayout:t.tilesLayout}}function Wd(){this.g=null}function qd(){}function Xd(e){var t=Hd(e);return e=t&&"manifest"==t.g?ti(e={uri:e,le:e,data:new ArrayBuffer(0),headers:{"content-type":"application/x-offline-manifest"}}):t&&"segment"==t.g?function(e,t){var n=new Rd;return ti(void 0).ba((function(){return n.init()})).ba((function(){return Ld(n,t.Ia(),t.la())})).ba((function(e){return e.getSegments([t.key()])})).ba((function(e){return{uri:t,data:e[0].data,headers:{}}})).finally((function(){return n.destroy()}))}(t.key(),t):Qn(new We(2,1,9004,e))}function Kd(e,t,n){var i,r,a,o,s,l;return D((function(c){switch(c.g){case 1:i=[];for(var h=[],d=u(n),p=d.next();!p.done;p=d.next()){p=p.value;for(var f=!1,m=u(h),g=m.next();!g.done;g=m.next())if(Yd((g=g.value).info,p)){g.sessionIds.push(p.sessionId),f=!0;break}f||h.push({info:p,sessionIds:[p.sessionId]})}r=u(h),a=r.next();case 2:if(a.done){c.v(4);break}return o=a.value,s=function(e,t,n){var i,r;return D((function(a){switch(a.g){case 1:return i=new Li({lb:t,onError:function(){},Gc:function(){},onExpirationUpdated:function(){},onEvent:function(){}}),M(a,2),i.configure(e),b(a,function(e,t,n,i,r,a){var o=new Map;return(r={audioCapabilities:r,videoCapabilities:a,distinctiveIdentifier:"optional",persistentState:"required",sessionTypes:["persistent-license"],label:t}).drmInfos=[{keySystem:t,licenseServerUri:n,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:"",videoRobustness:"",serverCertificate:i,serverCertificateUri:"",initData:null,keyIds:null}],o.set(t,r),Fi(e,o,[])}(i,n.info.keySystem,n.info.licenseUri,n.info.serverCertificate,n.info.audioCapabilities,n.info.videoCapabilities),4);case 4:S(a,3);break;case 2:return T(a),b(a,i.destroy(),5);case 5:return a.return([]);case 3:return M(a,6),b(a,Di(i),8);case 8:S(a,7);break;case 6:return T(a),b(a,i.destroy(),9);case 9:return a.return([]);case 7:return r=[],b(a,Promise.all(n.sessionIds.map((function(e){return D((function(t){return 1==t.g?(M(t,2),b(t,function(e,t){var n,i,r;return D((function(a){return 1==a.g?b(a,Bi(e,t),2):(n=a.h)?(i=[],(r=e.j.get(n))&&(r.Ka=new pt,i.push(r.Ka)),i.push(n.remove()),b(a,Promise.all(i),0)):a.return()}))}(i,e),4)):2!=t.g?(r.push(e),S(t,0)):(T(t),void w(t))}))}))),10);case 10:return b(a,i.destroy(),11);case 11:return a.return(r)}}))}(e,t,o),b(c,s,5);case 5:l=c.h,i=i.concat(l),a=r.next(),c.v(2);break;case 4:return c.return(i)}}))}function Yd(e,t){function n(e,t){return e.robustness==t.robustness&&e.contentType==t.contentType}return e.keySystem==t.keySystem&&e.licenseUri==t.licenseUri&&re(e.audioCapabilities,t.audioCapabilities,n)&&re(e.videoCapabilities,t.videoCapabilities,n)}function Jd(e,t){var n=jd(new Gd(e.Ia(),e.la()),t),i=t.appMetadata||{};return n=Zd(n),{offlineUri:e.toString(),originalManifestUri:t.originalManifestUri,duration:t.duration,size:t.size,expiration:t.expiration,tracks:n,appMetadata:i}}function Zd(e){for(var t=[],n=function(e){return e.filter((function(e){return An(e)}))}(e.variants),i=(n=u(n)).next();!i.done;i=n.next())t.push(bn(i.value));for(n=(e=u(e.textStreams)).next();!n.done;n=e.next())t.push(wn(n.value));return t}function $d(){this.g={}}function Qd(e,t){var n=e.g[t];return null==n&&(n=0),n}function ep(e){var t=this;if(e&&e.constructor!=ms)throw new We(2,9,9008);this.O=this.o=null,e?(this.o=e.o,this.O=e.Ub()):(this.o=ss(),this.O=new ci),this.Lc=[],this.$b=[],this.Fd=[];var n=!e;this.I=new xi((function(){var e,i,r,a,o;return D((function(s){switch(s.g){case 1:return b(s,Promise.all(t.Fd.map((function(e){return vd(e)}))),2);case 2:for(e=function(){},i=[],r=u(t.$b),a=r.next();!a.done;a=r.next())o=a.value,i.push(o.then(e,e));return b(s,Promise.all(i),3);case 3:if(!n){s.v(4);break}return b(s,t.O.destroy(),4);case 4:t.o=null,t.O=null,w(s)}}))}))}function tp(){if(en())e:{for(var e=u(Pd.values()),t=e.next();!t.done;t=e.next())if(t=(t=t.value)()){t.destroy(),e=!0;break e}e=!1}else e=!1;return e}function np(e,t){for(var n=[],i=u(e.streams),r=i.next();!r.done;r=i.next())r=r.value,t&&"video"==r.type?n.push({contentType:Dt(r.mimeType,r.codecs),robustness:e.drmInfo.videoRobustness}):t||"audio"!=r.type||n.push({contentType:Dt(r.mimeType,r.codecs),robustness:e.drmInfo.audioRobustness});return n}function ip(e,t,n){return D((function(i){return b(i,function(e,t,n,i){var r,a,o;return D((function(s){return 1==s.g?i.drmInfo?(r=function(e){var t=Array.from(e.g.keys());if(!t.length)throw new We(2,9,9e3,"No supported storage mechanisms found");return e.g.get(t[0]).getEmeSessionCell()}(n),a=i.sessionIds.map((function(e){return{sessionId:e,keySystem:i.drmInfo.keySystem,licenseUri:i.drmInfo.licenseServerUri,serverCertificate:i.drmInfo.serverCertificate,audioCapabilities:np(i,!1),videoCapabilities:np(i,!0)}})),b(s,Kd(t,e,a),2)):s.return():3!=s.g?(o=s.h,b(s,r.remove(o),3)):b(s,r.add(a.filter((function(e){return!o.includes(e.sessionId)}))),0)}))}(e.O,e.o.drm,n,t),0)}))}function rp(e,t,n){function i(){}var r=function(e){for(var t=[],n=(e=u(e.streams)).next();!n.done;n=e.next())for(var i=(n=u(n.value.segments)).next();!i.done;i=n.next())null!=(i=i.value).initSegmentKey&&t.push(i.initSegmentKey),t.push(i.dataKey);return t}(n);return Jd(t,n),Promise.all([e.removeSegments(r,i),e.removeManifests([t.key()],i)])}function ap(e,t,n,i,r,a,o,s,l){var u={id:a.id,originalId:a.originalId,primary:a.primary,type:a.type,mimeType:a.mimeType,codecs:a.codecs,frameRate:a.frameRate,pixelAspectRatio:a.pixelAspectRatio,hdr:a.hdr,kind:a.kind,language:a.language,label:a.label,width:a.width||null,height:a.height||null,encrypted:a.encrypted,keyIds:a.keyIds,segments:[],variantIds:[],roles:a.roles,forced:a.forced,channelsCount:a.channelsCount,audioSamplingRate:a.audioSamplingRate,spatialAudio:a.spatialAudio,closedCaptions:a.closedCaptions,tilesLayout:a.tilesLayout},c=a.id;return function(e,t,n){if(null!=(t=e.segmentIndex.find(t)))for(var i=e.segmentIndex.get(t);i;)n(i),i=e.segmentIndex.get(++t)}(a,r.presentationTimeline.Za(),(function(r){var h=function(e,t,n,i,r,a,o,s,l){return l.has(o)?l.get(o):(t=yd(t,n,s=Ro(o.ma(),o.ja,o.ea,s.streaming.retryParameters),.5*Qd(a,i),!0,(function(t){var n;return D((function(i){return 1==i.g?b(i,r.addSegments([{data:t}]),2):(n=i.h,e.Lc.push(n[0]),i.return(n[0]))}))})),l.set(o,t),t)}(e,t,c,a.id,n,i,r.h,o,s),d=function(e,t,n,i,r,a,o,s,l){var u=[o.ma()[0],o.ja,o.ea].join("-");return l.has(u)?l.get(u):(t=yd(t,n,s=Ro(o.ma(),o.ja,o.ea,s.streaming.retryParameters),function(e,t,n){return n=n.endTime-n.startTime,Qd(e,t)*n}(a,i,o),!1,(function(t){var n;return D((function(i){return 1==i.g?b(i,r.addSegments([{data:t}]),2):(n=i.h,e.Lc.push(n[0]),i.return(n[0]))}))})),l.set(u,t),t)}(e,t,c,a.id,n,i,r,o,l);!function(e,t,n){bi(e.I);var i=(e.g.get(t)||Promise.resolve()).then((function(){return D((function(e){return b(e,D((function(e){return 1==e.g?b(e,h,2):3!=e.g?(t=e.h,b(e,d,3)):(n=e.h,u.segments.push({initSegmentKey:t,startTime:r.startTime,endTime:r.endTime,appendWindowStart:r.appendWindowStart,appendWindowEnd:r.appendWindowEnd,timestampOffset:r.timestampOffset,tilesLayout:r.tilesLayout,dataKey:n}),void w(e))})),0);var t,n}))}));e.g.set(t,i)}(t,c)})),u}function op(e){if(e.I.g)throw new We(2,9,7001)}function sp(){if(!tp())throw new We(2,9,9e3)}function lp(e,t){return D((function(n){return 1==n.g?(e.$b.push(t),_(n),b(n,t,4)):2!=n.g?n.return(n.h):(E(n),ie(e.$b,t),A(n,0))}))}function up(e){for(var t=new Set,n=u(e.textStreams),i=n.next();!i.done;i=n.next())t.add(i.value);for(i=(n=u(e.imageStreams)).next();!i.done;i=n.next())t.add(i.value);for(n=(e=u(e.variants)).next();!n.done;n=e.next())(n=n.value).audio&&t.add(n.audio),n.video&&t.add(n.video);return t}g(Dd,Sd),Dd.prototype.updateManifestExpiration=function(e,t){var n,i,r,a=this;return D((function(o){return n=Md(a.g,a.h),i=n.store(),r=new pt,i.get(e).onsuccess=function(n){(n=n.target.result)?(n.expiration=t,i.put(n),r.resolve()):r.reject(new We(2,9,9012,"Could not find values for "+e))},b(o,Promise.all([n.promise(),r]),0)}))},Dd.prototype.Rb=function(e){var t,n,i,r,a,o;return D((function(s){if(1==s.g){for(t=[],n=0;n<e.periods.length;++n)i=n==e.periods.length-1?e.duration:e.periods[n+1].startTime,r=i-e.periods[n].startTime,a=Nd(e.periods[n],r),t.push(a);return b(s,Dc(t),2)}return o=s.h,s.return({creationTime:0,originalManifestUri:e.originalManifestUri,duration:e.duration,size:e.size,expiration:null==e.expiration?1/0:e.expiration,streams:o,sessionIds:e.sessionIds,drmInfo:e.drmInfo,appMetadata:e.appMetadata})}))},Dd.prototype.Wd=function(e){return{data:e.data}},g(Od,Sd),Od.prototype.Rb=function(e){var t,n,i,r,a,o;return D((function(s){if(1==s.g){for(t=[],n=0;n<e.periods.length;++n){i=n==e.periods.length-1?e.duration:e.periods[n+1].startTime,r=i-e.periods[n].startTime;for(var l=e.periods[n],c=[],h=u(l.streams),d=h.next();!d.done;d=h.next())0!=(d=d.value).variantIds.length&&c.push(Ud(d,l.startTime,l.startTime+r));a=c,t.push(a)}return b(s,Dc(t),2)}return o=s.h,s.return({appMetadata:e.appMetadata,creationTime:0,drmInfo:e.drmInfo,duration:e.duration,expiration:null==e.expiration?1/0:e.expiration,originalManifestUri:e.originalManifestUri,sessionIds:e.sessionIds,size:e.size,streams:o})}))},g(Fd,Sd),Fd.prototype.hasFixedKeySpace=function(){return!1},Fd.prototype.addSegments=function(e){return this.add(this.i,e)},Fd.prototype.addManifests=function(e){return this.add(this.h,e)},Fd.prototype.Rb=function(e){return null==e.expiration&&(e.expiration=1/0),Promise.resolve(e)},(i=Bd.prototype).init=function(){var t=this,n=new pt,i=e.indexedDB.open("shaka_offline_db",5);return i.onsuccess=function(){var e=i.result;t.l=e;var r=e.objectStoreNames;r=r.contains("manifest")&&r.contains("segment")?new Dd(e,"segment","manifest"):null,t.g=r,r=(r=e.objectStoreNames).contains("manifest-v2")&&r.contains("segment-v2")?new Od(e,"segment-v2","manifest-v2"):null,t.h=r,r=(r=e.objectStoreNames).contains("manifest-v3")&&r.contains("segment-v3")?new Od(e,"segment-v3","manifest-v3"):null,t.i=r,r=(r=e.objectStoreNames).contains("manifest-v5")&&r.contains("segment-v5")?new Fd(e,"segment-v5","manifest-v5"):null,t.j=r,e=e.objectStoreNames.contains("session-ids")?new Cd(e):null,t.m=e,n.resolve()},i.onupgradeneeded=function(){for(var e=i.result,t=u(["segment-v5","manifest-v5","session-ids"]),n=t.next();!n.done;n=t.next())n=n.value,e.objectStoreNames.contains(n)||e.createObjectStore(n,{autoIncrement:!0})},i.onerror=function(e){n.reject(new We(2,9,9001,i.error)),e.preventDefault()},n},i.destroy=function(){var e=this;return D((function(t){switch(t.g){case 1:if(!e.g){t.v(2);break}return b(t,e.g.destroy(),2);case 2:if(!e.h){t.v(4);break}return b(t,e.h.destroy(),4);case 4:if(!e.i){t.v(6);break}return b(t,e.i.destroy(),6);case 6:if(!e.j){t.v(8);break}return b(t,e.j.destroy(),8);case 8:if(!e.m){t.v(10);break}return b(t,e.m.destroy(),10);case 10:e.l&&e.l.close(),w(t)}}))},i.getCells=function(){var e=new Map;return this.g&&e.set("v1",this.g),this.h&&e.set("v2",this.h),this.i&&e.set("v3",this.i),this.j&&e.set("v5",this.j),e},i.getEmeSessionCell=function(){return this.m},i.erase=function(){var t=this;return D((function(n){switch(n.g){case 1:if(!t.g){n.v(2);break}return b(n,t.g.destroy(),2);case 2:if(!t.h){n.v(4);break}return b(n,t.h.destroy(),4);case 4:if(!t.i){n.v(6);break}return b(n,t.i.destroy(),6);case 6:if(!t.j){n.v(8);break}return b(n,t.j.destroy(),8);case 8:return t.l&&t.l.close(),b(n,function(){var t=new pt,n=e.indexedDB.deleteDatabase("shaka_offline_db");return n.onblocked=function(){},n.onsuccess=function(){t.resolve()},n.onerror=function(e){t.reject(new We(2,9,9001,n.error)),e.preventDefault()},t}(),10);case 10:return t.l=null,t.g=null,t.h=null,t.i=null,t.j=null,b(n,t.init(),0)}}))},Id("idb",(function(){return rn()||!e.indexedDB?null:new Bd})),zd.prototype.Ia=function(){return this.i},zd.prototype.la=function(){return this.h},zd.prototype.key=function(){return this.l},zd.prototype.toString=function(){return this.j},(i=Wd.prototype).configure=function(){},i.start=function(e,t){var n,i,r,a,o,s,l=this;return D((function(u){switch(u.g){case 1:if(n=Hd(e),l.g=n,null==n||"manifest"!=n.g)throw new We(2,1,9004,e);return i=new Rd,_(u),b(u,i.init(),4);case 4:return b(u,Ld(i,n.Ia(),n.la()),5);case 5:return b(u,u.h.getManifests([n.key()]),6);case 6:return r=u.h,a=r[0],o=new Gd(n.Ia(),n.la()),s=jd(o,a),t.makeTextStreamsForClosedCaptions(s),u.return(s);case 2:return E(u),b(u,i.destroy(),7);case 7:A(u,0)}}))},i.stop=function(){return Promise.resolve()},i.update=function(){},i.onExpirationUpdated=function(e,t){var n,i,r,a,o,s,l,u=this;return D((function(c){switch(c.g){case 1:return n=u.g,i=new Rd,M(c,2,3),b(c,i.init(),5);case 5:return b(c,Ld(i,n.Ia(),n.la()),6);case 6:return b(c,(r=c.h).getManifests([n.key()]),7);case 7:if(a=c.h,o=a[0],s=o.sessionIds.includes(e),l=null==o.expiration||o.expiration>t,!s||!l){c.v(3);break}return b(c,r.updateManifestExpiration(n.key(),t),3);case 3:return E(c),b(c,i.destroy(),10);case 10:A(c,0);break;case 2:T(c),c.v(3)}}))},ir["application/x-offline-manifest"]=function(){return new Wd},z("shaka.offline.OfflineScheme",qd),qd.plugin=Xd,hi("offline",Xd),(i=ep.prototype).destroy=function(){return this.I.destroy()},i.configure=function(e,t){return 2==arguments.length&&"string"==typeof e&&(e=as(e,t)),e.manifest&&e.manifest.dash&&"defaultPresentationDelay"in e.manifest.dash&&(Ne("manifest.dash.defaultPresentationDelay configuration","Please Use manifest.defaultPresentationDelay instead."),e.manifest.defaultPresentationDelay=e.manifest.dash.defaultPresentationDelay,delete e.manifest.dash.defaultPresentationDelay),ls(this.o,e)},i.getConfiguration=function(){var e=ss();return ls(e,this.o,ss()),e},i.Ub=function(){return this.O},i.store=function(e,t,n){var i=this,r=this.getConfiguration(),a=new gd(this.O);this.Fd.push(a);var o=new $n(t=function(e,t,n,i,r,a){var o,s,l,c,h,d,p,f,m,g;return D((function(v){switch(v.g){case 1:return sp(),s=o=null,l=new Rd,h=c=null,M(v,2,3),b(v,i(),5);case 5:return o=v.h,b(v,function(e,t,n,i){var r,a,o,s,l;return D((function(u){if(1==u.g)return r=null,a=e.O,o={networkingEngine:a,filter:function(){return Promise.resolve()},makeTextStreamsForClosedCaptions:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(e){r=e},isLowLatencyMode:function(){return!1},isAutoLowLatencyMode:function(){return!1},enableLowLatencyMode:function(){}},n.configure(i.manifest),op(e),b(u,n.start(t,o),2);if(3!=u.g)return s=u.h,op(e),l=up(s),b(u,Promise.all(Q(l,(function(e){return e.createSegmentIndex()}))),3);if(op(e),r)throw r;return u.return(s)}))}(e,t,o,r),6);case 6:if(d=v.h,op(e),d.presentationTimeline.X()||d.presentationTimeline.kb())throw new We(2,9,9005,t);return b(v,function(e,t,n,i){var r;return D((function(a){switch(a.g){case 1:return(r=new Li({lb:e.O,onError:n,Gc:function(){},onExpirationUpdated:function(){},onEvent:function(){}})).configure(i.drm),b(a,function(e,t,n){return e.pa=!0,e.u=[],e.J=n,Pi(e,t)}(r,t.variants,i.offline.usePersistentLicense),2);case 2:return b(a,Di(r),3);case 3:return b(a,Ni(r),4);case 4:return a.return(r)}}))}(e,d,(function(e){h=h||e}),r),7);case 7:if(s=v.h,op(e),h)throw h;return b(v,e.wc(d,r),8);case 8:return b(v,l.init(),9);case 9:return op(e),b(v,function(e){var t=null;if(e.g.forEach((function(e,n){e.getCells().forEach((function(e,i){e.hasFixedKeySpace()||t||(t={path:{Ia:n,la:i},la:e})}))})),t)return t;throw new We(2,9,9013,"Could not find a cell that supports add-operations")}(l),10);case 10:return c=v.h,op(e),b(v,function(e,t,n,i,r,a,o,s){var l,c,h,d,p,f,m,g,v,y;return D((function(x){switch(x.g){case 1:return l=function(e,t,n){return{offlineUri:null,originalManifestUri:e,duration:t.presentationTimeline.getDuration(),size:0,expiration:1/0,tracks:t=Zd(t),appMetadata:n}}(r,i,a),c=o.offline.progressCallback,function(e,t,n){e.ie=function(e,t){l.size=t,c(l,e)},e.he=n}(s,0,(function(e,t){p&&o.offline.usePersistentLicense&&f==t&&ki(n,"cenc",e)})),h=i.variants.some((function(e){var t=e.audio&&e.audio.encrypted;return e.video&&e.video.encrypted||t})),d=i.variants.some((function(e){return(e.video?e.video.drmInfos:[]).concat(e.audio?e.audio.drmInfos:[]).some((function(e){return e.initData&&e.initData.length}))})),f=null,(p=h&&!d)&&(m=n.i,f=cp.get(m.keySystem)),_(x),v=g=function(e,t,n,i,r,a,o,s){for(var l=new $d,c=u(r.variants),h=c.next();!h.done;h=c.next()){var d=l,p=(h=h.value).audio,f=h.video;if(p&&!f&&(d.g[p.id]=p.bandwidth||h.bandwidth),!p&&f&&(d.g[f.id]=f.bandwidth||h.bandwidth),p&&f){var m=p.bandwidth||393216,g=f.bandwidth||h.bandwidth-m;0>=g&&(g=h.bandwidth),d.g[p.id]=m,d.g[f.id]=g}}for(d=(c=u(r.textStreams)).next();!d.done;d=c.next())l.g[d.value.id]=52;for(d=(c=u(r.imageStreams)).next();!d.done;d=c.next())d=d.value,l.g[d.id]=d.bandwidth||2048;for((d=new Map).set(null,Promise.resolve(null)),h=new Map,p=up(r),c=new Map,f=(p=u(p)).next();!f.done;f=p.next())m=ap(e,t,n,l,r,f=f.value,s,d,h),c.set(f.id,m);for(h=(e=u(r.variants)).next();!h.done;h=e.next())(t=h.value).audio&&c.get(t.audio.id).variantIds.push(t.id),t.video&&c.get(t.video.id).variantIds.push(t.id);return e=Array.from(c.values()),s=s.offline.usePersistentLicense,(t=i.i)&&s&&(t.initData=[]),{creationTime:Date.now(),originalManifestUri:a,duration:r.presentationTimeline.getDuration(),size:0,expiration:i.Tb(),streams:e,sessionIds:s?Ui(i):[],drmInfo:t,appMetadata:o}}(e,s,t,n,i,r,a,o),b(x,function(e){return D((function(t){return 1==t.g?b(t,Promise.all(e.g.values()),2):t.return(e.Ob.h)}))}(s),4);case 4:if(v.size=x.h,g.expiration=n.Tb(),y=Ui(n),g.sessionIds=o.offline.usePersistentLicense?y:[],h&&o.offline.usePersistentLicense&&!y.length)throw new We(2,9,9007);return x.return(g);case 2:return E(x),b(x,s.destroy(),5);case 5:A(x,0)}}))}(e,c.la,s,d,t,n,r,a),11);case 11:if(p=v.h,op(e),h)throw h;return b(v,c.la.addManifests([p]),12);case 12:return f=v.h,op(e),m=new zd("manifest",c.path.Ia,c.path.la,f[0]),v.return(Jd(m,p));case 3:return E(v),e.Lc=[],b(v,l.destroy(),13);case 13:if(!o){v.v(14);break}return b(v,o.stop(),14);case 14:if(!s){v.v(16);break}return b(v,s.destroy(),16);case 16:A(v,0);break;case 2:if(g=T(v),!c){v.v(18);break}return b(v,c.la.removeSegments(e.Lc,(function(){})),18);case 18:throw h||g}}))}(this,e,t||{},(function(){var t;return D((function(a){return 1==a.g?b(a,er(e,i.O,r.manifest.retryParameters,n||null),2):(t=a.h,a.return(He(t)))}))}),r,a),(function(){return vd(a)}));return o.finally((function(){ie(i.Fd,a)})),o.then=function(e){return Ne("shaka.offline.Storage.store.then","Storage operations now return a shaka.util.AbortableOperation, rather than a promise.  Please update to conform to this new API; you can use the |chain| method instead."),o.promise.then(e)},function(e,t){var n=t.promise;return e.$b.push(n),t.finally((function(){ie(e.$b,n)}))}(this,o)},i.jf=function(){return Ne("shaka.offline.Storage.getStoreInProgress","Multiple concurrent downloads are now supported."),!1},i.wc=function(e,t){var n,i,r,a,o,s,l,c,h,d,p,f,m,g,v,y,x,_,E,A,C,R,L,I,P,N,k,O;return D((function(D){switch(D.g){case 1:for(n={width:1/0,height:1/0},function(e,t,n){e.variants=e.variants.filter((function(e){return fn(e,t,n)}))}(e,t.restrictions,n),mn(e,t.offline.usePersistentLicense),i=[],r=t.preferredAudioChannelCount,a=t.preferredDecodingAttributes,o=t.preferredVideoCodecs,s=t.preferredAudioCodecs,hn(e,o,s,r,a),l=u(e.variants),c=l.next();!c.done;c=l.next())h=c.value,i.push(bn(h));for(d=u(e.textStreams),p=d.next();!p.done;p=d.next())f=p.value,i.push(wn(f));for(m=u(e.imageStreams),g=m.next();!g.done;g=m.next())v=g.value,i.push(Mn(v));return b(D,t.offline.trackSelectionCallback(i),2);case 2:for(y=D.h,x=e.presentationTimeline.getDuration(),_=0,E=u(y),A=E.next();!A.done;A=E.next())C=A.value,R=C.bandwidth*x/8,_+=R;return M(D,3),b(D,t.offline.downloadSizeCallback(_),5);case 5:if(!D.h)throw new We(2,9,9014);S(D,4);break;case 3:if((L=T(D))instanceof We)throw L;throw new We(2,9,9015);case 4:for(I=new Set,P=new Set,N=new Set,k=u(y),A=k.next();!A.done;A=k.next())"variant"==(O=A.value).type&&I.add(O.id),"text"==O.type&&P.add(O.id),"image"==O.type&&N.add(O.id);e.variants=e.variants.filter((function(e){return I.has(e.id)})),e.textStreams=e.textStreams.filter((function(e){return P.has(e.id)})),e.imageStreams=e.imageStreams.filter((function(e){return N.has(e.id)})),function(e){e.variants.map((function(e){return e.video}));var t=new Set(e.variants.map((function(e){return e.audio})));e=e.textStreams;for(var n=u(t),i=n.next();!i.done;i=n.next())for(var r=(i=u(t)).next();!r.done;r=i.next());for(n=(t=u(e)).next();!n.done;n=t.next())for(i=(n=u(e)).next();!i.done;i=n.next());}(e),w(D)}}))},i.remove=function(e){return lp(this,function(e,t){var n,i,r,a,o,s;return D((function(l){switch(l.g){case 1:if(sp(),null==(n=Hd(t))||"manifest"!=n.g)throw new We(2,9,9004,t);return i=n,r=new Rd,_(l),b(l,r.init(),4);case 4:return b(l,Ld(r,i.Ia(),i.la()),5);case 5:return b(l,(a=l.h).getManifests([i.key()]),6);case 6:return o=l.h,s=o[0],b(l,Promise.all([ip(e,s,r),rp(a,i,s)]),2);case 2:return E(l),b(l,r.destroy(),8);case 8:A(l,0)}}))}(this,e))},i.Jf=function(){return lp(this,function(e){var t,n,i,r,a,o,s,l,c,h;return D((function(d){switch(d.g){case 1:return sp(),t=e.O,n=e.o.drm,i=new Rd,r=!1,_(d),b(d,i.init(),4);case 4:a=[],function(e,t){e.g.forEach((function(e){var t;t=e.getEmeSessionCell(),a.push(t)}))}(i),o=u(a),s=o.next();case 5:if(s.done){d.v(2);break}return b(d,(l=s.value).getAll(),8);case 8:return c=d.h,b(d,Kd(n,t,c),9);case 9:return h=d.h,b(d,l.remove(h),10);case 10:h.length!=c.length&&(r=!0),s=o.next(),d.v(5);break;case 2:return E(d),b(d,i.destroy(),11);case 11:A(d,3);break;case 3:return d.return(!r)}}))}(this))},i.list=function(){return lp(this,D((function(i){switch(i.g){case 1:return sp(),e=[],t=new Rd,_(i),b(i,t.init(),4);case 4:return n=Promise.resolve(),function(e,t){e.g.forEach((function(e,n){e.getCells().forEach((function(e,i){t({Ia:n,la:i},e)}))}))}(t,(function(t,i){n=n.then((function(){return D((function(n){if(1==n.g)return b(n,i.getAllManifests(),2);n.h.forEach((function(n,i){var r=Jd(new zd("manifest",t.Ia,t.la,i),n);e.push(r)})),w(n)}))}))})),b(i,n,2);case 2:return E(i),b(i,t.destroy(),6);case 6:A(i,3);break;case 3:return i.return(e)}})));var e,t,n},z("shaka.offline.Storage",ep),ep.deleteAll=function(){var e;return D((function(t){return 1==t.g?(e=new Rd,_(t),b(t,function(e){var t,n;return D((function(i){return 1==i.g?(t=Array.from(e.g.values()),(n=0<t.length)||Pd.forEach((function(e){(e=e())&&t.push(e)})),b(i,Promise.all(t.map((function(e){return e.erase()}))),2)):n?i.v(0):b(i,Promise.all(t.map((function(e){return e.destroy()}))),0)}))}(e),2)):5!=t.g?(E(t),b(t,e.destroy(),5)):A(t,0)}))},ep.prototype.list=ep.prototype.list,ep.prototype.removeEmeSessions=ep.prototype.Jf,ep.prototype.remove=ep.prototype.remove,ep.prototype.getStoreInProgress=ep.prototype.jf,ep.prototype.store=ep.prototype.store,ep.prototype.getNetworkingEngine=ep.prototype.Ub,ep.prototype.getConfiguration=ep.prototype.getConfiguration,ep.prototype.configure=ep.prototype.configure,ep.prototype.destroy=ep.prototype.destroy,ep.support=tp;var cp=(new Map).set("org.w3.clearkey","1077efecc0b24d02ace33c1e52e2fb4b").set("com.widevine.alpha","edef8ba979d64acea3c827dcd51d21ed").set("com.microsoft.playready","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.recommendation","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.software","9a04f07998404286ab92e65be0885f95").set("com.microsoft.playready.hardware","9a04f07998404286ab92e65be0885f95").set("com.adobe.primetime","f239e769efa348509c16a903c6932efb");function hp(){}function dp(e,t){for(var n={priority:t||0,Fe:e},i=u(te(pp)),r=i.next();!r.done;r=i.next()){var a=(r=r.value).ha;if(r.item.priority<n.priority)return void pp.splice(a,0,n)}pp.push(n)}Dl.offline=tp,z("shaka.polyfill",hp),hp.register=dp,hp.installAll=function(){for(var e=u(pp),t=e.next();!t.done;t=e.next()){t=t.value;try{t.Fe()}catch(e){X("Error installing polyfill!",e)}}};var pp=[];function fp(e){var t=e.toLowerCase().replace("aria","aria-");Object.defineProperty(Element.prototype,e,{get:function(){return this.getAttribute(t)},set:function(e){null==e||null==e?this.removeAttribute(t):this.setAttribute(t,e)}})}function mp(e){var t=e.type.replace(/^(webkit|moz|MS)/,"").toLowerCase(),n=document.createEvent("Event");n.initEvent(t,e.bubbles,e.cancelable),e.target.dispatchEvent(n)}function gp(e){var t,n,i,r,a,o,s,l,u,c;return D((function(h){switch(h.g){case 1:return t={supported:!1,powerEfficient:!0,smooth:!0,keySystemAccess:null,configuration:e},!e||e.video&&(n=e.video.contentType,!MediaSource.isTypeSupported(n))||e.audio&&(i=e.audio.contentType,!MediaSource.isTypeSupported(i))?h.return(t):e.keySystemConfiguration?(r=e.keySystemConfiguration,a=[],o=[],r.audio&&(s={robustness:r.audio.robustness||"",contentType:e.audio.contentType},a.push(s)),r.video&&(l={robustness:r.video.robustness||"",contentType:e.video.contentType},o.push(l)),u={initDataTypes:[r.initDataType],distinctiveIdentifier:r.distinctiveIdentifier,persistentState:r.persistentState,sessionTypes:r.sessionTypes},a.length&&(u.audioCapabilities=a),o.length&&(u.videoCapabilities=o),M(h,3),b(h,navigator.requestMediaKeySystemAccess(r.keySystem,[u]),5)):(t.supported=!0,h.return(Promise.resolve(t)));case 5:c=h.h,S(h,4);break;case 3:T(h);case 4:c&&(t.supported=!0,t.keySystemAccess=c);case 2:return h.return(t)}}))}function vp(){var e=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(t){for(var n=[],i=0;i<arguments.length;++i)n[i]=arguments[i];return(n=e.apply(this,n)).abort=function(){},n}}function yp(){ai.call(this),this.type="",this.angle=0}function xp(e,t){try{var n=new Mp(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function bp(e){var t=this.mediaKeys;return t&&t!=e&&Sp(t,null),delete this.mediaKeys,(this.mediaKeys=e)?Sp(e,this):Promise.resolve()}function wp(e){if(Ie(e=Le(e.initData)).getUint32(0,!0)+4!=e.byteLength)throw new RangeError("Malformed FairPlay init data");e=xt(e=vt(e.subarray(4),!0));var t=new Event("encrypted");t.initDataType="skd",t.initData=Re(e),this.dispatchEvent(t)}function Mp(e,t){if(this.keySystem=e,e.startsWith("com.apple.fps"))for(var n=u(t),i=n.next();!i.done;i=n.next()){var r=i.value;if("required"==r.persistentState)i=null;else{i={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:r.initDataTypes,sessionTypes:["temporary"],label:r.label};var a=!1,o=!1;if(r.audioCapabilities)for(var s=u(r.audioCapabilities),l=s.next();!l.done;l=s.next())(l=l.value).contentType&&(a=!0,WebKitMediaKeys.isTypeSupported(this.keySystem,l.contentType.split(";")[0])&&(i.audioCapabilities.push(l),o=!0));if(r.videoCapabilities)for(l=(r=u(r.videoCapabilities)).next();!l.done;l=r.next())(s=l.value).contentType&&(a=!0,WebKitMediaKeys.isTypeSupported(this.keySystem,s.contentType.split(";")[0])&&(i.videoCapabilities.push(s),o=!0));a||(o=WebKitMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),i=o?i:null}if(i)return void(this.g=i)}throw(n=Error("Unsupported keySystem")).name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function _p(e){this.g=new WebKitMediaKeys(e),this.h=new wi}function Sp(e,t){if(e.h.ob(),!t)return Promise.resolve();e.h.A(t,"webkitneedkey",wp);try{return to(t,HTMLMediaElement.HAVE_METADATA,e.h,(function(){t.webkitSetMediaKeys(e.g)})),Promise.resolve()}catch(e){return Promise.reject(e)}}function Tp(e){ai.call(this),this.j=null,this.l=e,this.i=this.g=null,this.h=new wi,this.sessionId="",this.expiration=NaN,this.closed=new pt,this.keyStatuses=new Ap}function Ep(e,t){var n=e.keyStatuses;n.size=null==t?0:1,n.g=t,n=new ri("keystatuseschange"),e.dispatchEvent(n)}function Ap(){this.size=0,this.g=void 0}function Cp(e,t){try{var n=new Lp(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function Rp(e){if(e.initData){var t=new CustomEvent("encrypted");t.initDataType="cenc",t.initData=Re(function(e){if(!e)return e;var t=new Gu(e);if(1>=t.data.length)return e;e=[];for(var n={},i=(t=u(t.data)).next();!i.done;n={ic:n.ic},i=t.next())n.ic=i.value,e.some(function(e){return function(t){return Ae(t,e.ic)}}(n))||e.push(n.ic);return Ct.apply(Mt,c(e))}(e.initData)),this.dispatchEvent(t)}}function Lp(e,t){this.keySystem=e;for(var n=!1,i=u(t),r=i.next();!r.done;r=i.next()){var a={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:(r=r.value).initDataTypes,sessionTypes:["temporary"],label:r.label},o=!1;if(r.audioCapabilities)for(var s=u(r.audioCapabilities),l=s.next();!l.done;l=s.next())(l=l.value).contentType&&(o=!0,MSMediaKeys.isTypeSupported(this.keySystem,l.contentType.split(";")[0])&&(a.audioCapabilities.push(l),n=!0));if(r.videoCapabilities)for(l=(s=u(r.videoCapabilities)).next();!l.done;l=s.next())(l=l.value).contentType&&(o=!0,MSMediaKeys.isTypeSupported(this.keySystem,l.contentType.split(";")[0])&&(a.videoCapabilities.push(l),n=!0));if(o||(n=MSMediaKeys.isTypeSupported(this.keySystem,"video/mp4")),"required"==r.persistentState&&(n=!1),n)return void(this.g=a)}throw(n=Error("Unsupported keySystem")).name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function Ip(e){var t=this.mediaKeys;return t&&t!=e&&Dp(t,null),delete this.mediaKeys,(this.mediaKeys=e)?Dp(e,this):Promise.resolve()}function Pp(e){this.g=new MSMediaKeys(e),this.h=new wi}function Dp(e,t){if(e.h.ob(),!t)return Promise.resolve();e.h.A(t,"msneedkey",Rp);try{return to(t,HTMLMediaElement.HAVE_METADATA,e.h,(function(){t.msSetMediaKeys(e.g)})),Promise.resolve()}catch(e){return Promise.reject(e)}}function Np(e){ai.call(this),this.j=null,this.l=e,this.i=this.g=null,this.h=new wi,this.sessionId="",this.expiration=NaN,this.closed=new pt,this.keyStatuses=new Op}function kp(e,t){var n=e.keyStatuses;n.size=null==t?0:1,n.g=t,n=new ri("keystatuseschange"),e.dispatchEvent(n)}function Op(){this.size=0,this.g=void 0}function Up(){return Promise.reject(Error("The key system specified is not supported."))}function Fp(e){return null==e?Promise.resolve():Promise.reject(Error("MediaKeys not supported."))}function Bp(){throw new TypeError("Illegal constructor.")}function zp(){throw this.keySystem="",new TypeError("Illegal constructor.")}function Hp(e){return Qp?Qp+e.charAt(0).toUpperCase()+e.slice(1):e}function Gp(e,t){try{var n=new Vp(e,t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}}function jp(e){var t=this.mediaKeys;return t&&t!=e&&qp(t,null),delete this.mediaKeys,(this.mediaKeys=e)&&qp(e,this),Promise.resolve()}function Vp(e,t){this.g=this.keySystem=e;var n=!1;"org.w3.clearkey"==e&&(this.g="webkit-org.w3.clearkey",n=!1);var i=!1,r=document.getElementsByTagName("video");r=r.length?r[0]:document.createElement("video");for(var a=u(t),o=a.next();!o.done;o=a.next()){var s={audioCapabilities:[],videoCapabilities:[],persistentState:"optional",distinctiveIdentifier:"optional",initDataTypes:(o=o.value).initDataTypes,sessionTypes:["temporary"],label:o.label},l=!1;if(o.audioCapabilities)for(var c=u(o.audioCapabilities),h=c.next();!h.done;h=c.next())(h=h.value).contentType&&(l=!0,r.canPlayType(h.contentType.split(";")[0],this.g)&&(s.audioCapabilities.push(h),i=!0));if(o.videoCapabilities)for(h=(c=u(o.videoCapabilities)).next();!h.done;h=c.next())(h=h.value).contentType&&(l=!0,r.canPlayType(h.contentType,this.g)&&(s.videoCapabilities.push(h),i=!0));if(l||(i=r.canPlayType("video/mp4",this.g)||r.canPlayType("video/webm",this.g)),"required"==o.persistentState&&(n?(s.persistentState="required",s.sessionTypes=["persistent-license"]):i=!1),i)return void(this.h=s)}throw n="Unsupported keySystem","org.w3.clearkey"!=e&&"com.widevine.alpha"!=e||(n="None of the requested configurations were supported."),(n=Error(n)).name="NotSupportedError",n.code=DOMException.NOT_SUPPORTED_ERR,n}function Wp(e){this.l=e,this.g=null,this.h=new wi,this.i=[],this.j=new Map}function qp(e,t){e.g=t,e.h.ob();var n=Qp;t&&(e.h.A(t,n+"needkey",(function(t){var n=new CustomEvent("encrypted");n.initDataType="cenc",n.initData=Re(t.initData),e.g.dispatchEvent(n)})),e.h.A(t,n+"keymessage",(function(t){var n=Xp(e,t.sessionId);n&&(t=new ri("message",{messageType:null==n.keyStatuses.g?"licenserequest":"licenserenewal",message:t.message}),n.h&&(n.h.resolve(),n.h=null),n.dispatchEvent(t))})),e.h.A(t,n+"keyadded",(function(t){(t=Xp(e,t.sessionId))&&(Zp(t,"usable"),t.g&&t.g.resolve(),t.g=null)})),e.h.A(t,n+"keyerror",(function(t){var n=Xp(e,t.sessionId);n&&n.handleError(t)})))}function Xp(e,t){var n=e.j.get(t);return n||((n=e.i.shift())?(n.sessionId=t,e.j.set(t,n),n):null)}function Kp(e,t,n){ai.call(this),this.j=e,this.m=!1,this.g=this.h=null,this.i=t,this.l=n,this.sessionId="",this.expiration=NaN,this.closed=new pt,this.keyStatuses=new $p}function Yp(e,t,n){if(e.m)return Promise.reject(Error("The session is already initialized."));e.m=!0;try{if("persistent-license"==e.l)if(n)var i=Le(xt("LOAD_SESSION|"+n));else{var r=xt("PERSISTENT|");i=Ct(r,t)}else i=Le(t)}catch(e){return Promise.reject(e)}e.h=new pt;var a=Hp("generateKeyRequest");try{e.j[a](e.i,i)}catch(t){if("InvalidStateError"!=t.name)return e.h=null,Promise.reject(t);new Qt((function(){try{e.j[a](e.i,i)}catch(t){e.h.reject(t),e.h=null}})).S(.01)}return e.h}function Jp(e,t,n){if(e.g)e.g.then((function(){return Jp(e,t,n)})).catch((function(){return Jp(e,t,n)}));else{if(e.g=t,"webkit-org.w3.clearkey"==e.i){var i=gt(n),r=JSON.parse(i);"oct"!=r.keys[0].kty&&(e.g.reject(Error("Response is not a valid JSON Web Key Set.")),e.g=null),i=Tt(r.keys[0].k),r=Tt(r.keys[0].kid)}else i=Le(n),r=null;var a=Hp("addKey");try{e.j[a](e.i,i,r,e.sessionId)}catch(t){e.g.reject(t),e.g=null}}}function Zp(e,t){var n=e.keyStatuses;n.size=null==t?0:1,n.g=t,n=new ri("keystatuseschange"),e.dispatchEvent(n)}function $p(){this.size=0,this.g=void 0}dp((function(){if(!Object.getOwnPropertyDescriptor(Element.prototype,"ariaHidden"))for(var e=u(["ariaHidden","ariaLabel","ariaPressed","ariaSelected"]),t=e.next();!t.done;t=e.next())fp(t.value)})),dp((function(){Mm()}),-2),dp((function(){if(e.Document){var t=Element.prototype;t.requestFullscreen=t.requestFullscreen||t.mozRequestFullScreen||t.msRequestFullscreen||t.webkitRequestFullscreen,(t=Document.prototype).exitFullscreen=t.exitFullscreen||t.mozCancelFullScreen||t.msExitFullscreen||t.webkitCancelFullScreen,"fullscreenElement"in document||(Object.defineProperty(document,"fullscreenElement",{get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitCurrentFullScreenElement||document.webkitFullscreenElement}}),Object.defineProperty(document,"fullscreenEnabled",{get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled}})),document.addEventListener("webkitfullscreenchange",mp),document.addEventListener("webkitfullscreenerror",mp),document.addEventListener("mozfullscreenchange",mp),document.addEventListener("mozfullscreenerror",mp),document.addEventListener("MSFullscreenChange",mp),document.addEventListener("MSFullscreenError",mp)}})),dp((function(){})),dp((function(){!rn()&&navigator.mediaCapabilities||!e.MediaSource||(navigator.mediaCapabilities||(navigator.mediaCapabilities={}),navigator.mediaCapabilities.decodingInfo=gp)}),-1),dp((function(){var t=on();e.MediaSource&&(e.cast&&cast.__platform__&&cast.__platform__.canDisplayType?function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){var n=t.split(/ *; */);return n.shift(),n.some((function(e){return e.startsWith("codecs=")}))?cast.__platform__.canDisplayType(t):e(t)}}():t?(function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){return"mp2t"!=t.split(/ *; */)[0].split("/")[1].toLowerCase()&&e(t)}}(),12>=t?(vp(),function(){var e=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(t,n){return e.call(this,t,n-.001)}}()):vp()):(sn("Tizen 2")||sn("Tizen 3")||sn("Tizen 4"))&&function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){return"opus"!=kt(t)&&e(t)}}()),e.MediaSource&&MediaSource.isTypeSupported('video/webm; codecs="vp9"')&&!MediaSource.isTypeSupported('video/webm; codecs="vp09.00.10.08"')&&function(){var e=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(t){var n=t.split(/ *; */),i=n.findIndex((function(e){return e.startsWith("codecs=")}));if(0>i)return e(t);var r=n[i].replace("codecs=","").replace(/"/g,"").split(/\s*,\s*/),a=r.findIndex((function(e){return e.startsWith("vp09")}));return 0<=a&&(r[a]="vp9",n[i]='codecs="'+r.join(",")+'"',t=n.join("; ")),e(t)}}()})),g(yp,ai),yp.prototype.lock=function(e){function t(e){return screen.lockOrientation?screen.lockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):!!screen.msLockOrientation&&screen.msLockOrientation(e)}var n=!1;switch(e){case"natural":n=t("default");break;case"any":n=!0,this.unlock();break;default:n=t(e)}return n?Promise.resolve():((e=Error("screen.orientation.lock() is not available on this device")).name="NotSupportedError",e.code=DOMException.NOT_SUPPORTED_ERR,Promise.reject(e))},yp.prototype.unlock=function(){screen.unlockOrientation?screen.unlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},dp((function(){screen.orientation||null!=e.orientation&&function(){function t(){switch(e.orientation){case-90:n.type="landscape-secondary",n.angle=270;break;case 0:n.type="portrait-primary",n.angle=0;break;case 90:n.type="landscape-primary",n.angle=90;break;case 180:n.type="portrait-secondary",n.angle=180}}var n=new yp;screen.orientation=n,t(),e.addEventListener("orientationchange",(function(){t();var e=new ri("change",{});n.dispatchEvent(e)}))}()})),Mp.prototype.createMediaKeys=function(){var e=new _p(this.keySystem);return Promise.resolve(e)},Mp.prototype.getConfiguration=function(){return this.g},_p.prototype.createSession=function(e){if("temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new Tp(this.g,e)},_p.prototype.setServerCertificate=function(){return Promise.resolve(!1)},g(Tp,ai),(i=Tp.prototype).generateRequest=function(e,t){var n=this;this.g=new pt;try{var i=this.l.createSession("video/mp4",Le(t));this.j=i,this.sessionId=i.sessionId||"",this.h.A(this.j,"webkitkeymessage",(function(e){n.g&&(n.g.resolve(),n.g=null),e=new ri("message",{messageType:null==n.keyStatuses.g?"license-request":"license-renewal",message:Re(e.message)}),n.dispatchEvent(e)})),this.h.A(i,"webkitkeyadded",(function(){n.i&&(Ep(n,"usable"),n.i.resolve(),n.i=null)})),this.h.A(i,"webkitkeyerror",(function(){var e=Error("EME PatchedMediaKeysApple key error");if(e.errorCode=n.j.error,null!=n.g)n.g.reject(e),n.g=null;else if(null!=n.i)n.i.reject(e),n.i=null;else switch(n.j.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:Ep(n,"output-not-allowed");break;default:Ep(n,"internal-error")}})),Ep(this,"status-pending")}catch(e){this.g.reject(e)}return this.g},i.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},i.update=function(e){this.i=new pt;try{this.j.update(Le(e))}catch(e){this.i.reject(e)}return this.i},i.close=function(){try{this.j.close(),this.closed.resolve(),this.h.ob()}catch(e){this.closed.reject(e)}return this.closed},i.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},(i=Ap.prototype).forEach=function(e){this.g&&e(this.g,$i.value())},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=$i.value();return!(!this.g||!Ae(e,t))},i.entries=function(){},i.keys=function(){},i.values=function(){},dp((function(){e.HTMLVideoElement&&e.WebKitMediaKeys&&(delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=bp,e.MediaKeys=_p,e.MediaKeySystemAccess=Mp,navigator.requestMediaKeySystemAccess=xp)})),Lp.prototype.createMediaKeys=function(){var e=new Pp(this.keySystem);return Promise.resolve(e)},Lp.prototype.getConfiguration=function(){return this.g},Pp.prototype.createSession=function(e){if("temporary"!=(e=e||"temporary"))throw new TypeError("Session type "+e+" is unsupported on this platform.");return new Np(this.g,e)},Pp.prototype.setServerCertificate=function(){return Promise.resolve(!1)},g(Np,ai),(i=Np.prototype).generateRequest=function(e,t){var n=this;this.g=new pt;try{this.j=this.l.createSession("video/mp4",Le(t),null),this.h.A(this.j,"mskeymessage",(function(e){n.g&&(n.g.resolve(),n.g=null),e=new ri("message",{messageType:null==n.keyStatuses.g?"license-request":"license-renewal",message:Re(e.message)}),n.dispatchEvent(e)})),this.h.A(this.j,"mskeyadded",(function(){n.g?(kp(n,"usable"),n.g.resolve(),n.g=null):n.i&&(kp(n,"usable"),n.i.resolve(),n.i=null)})),this.h.A(this.j,"mskeyerror",(function(){var e=Error("EME PatchedMediaKeysMs key error");if(e.errorCode=n.j.error,null!=n.g)n.g.reject(e),n.g=null;else if(null!=n.i)n.i.reject(e),n.i=null;else switch(n.j.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:kp(n,"output-not-allowed");break;default:kp(n,"internal-error")}})),kp(this,"status-pending")}catch(e){this.g.reject(e)}return this.g},i.load=function(){return Promise.reject(Error("MediaKeySession.load not yet supported"))},i.update=function(e){this.i=new pt;try{this.j.update(Le(e))}catch(e){this.i.reject(e)}return this.i},i.close=function(){try{this.j.close(),this.closed.resolve(),this.h.ob()}catch(e){this.closed.reject(e)}return this.closed},i.remove=function(){return Promise.reject(Error("MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform"))},(i=Op.prototype).forEach=function(e){this.g&&e(this.g,$i.value())},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=$i.value();return!(!this.g||!Ae(e,t))},i.entries=function(){},i.keys=function(){},i.values=function(){},dp((function(){!e.HTMLVideoElement||!e.MSMediaKeys||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,e.MediaKeys=Pp,e.MediaKeySystemAccess=Lp,navigator.requestMediaKeySystemAccess=Cp,HTMLMediaElement.prototype.setMediaKeys=Ip)})),Bp.prototype.createSession=function(){},Bp.prototype.setServerCertificate=function(){},zp.prototype.getConfiguration=function(){},zp.prototype.createMediaKeys=function(){},dp((function(){!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(navigator.requestMediaKeySystemAccess=Up,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=Fp,e.MediaKeys=Bp,e.MediaKeySystemAccess=zp)}),-10),Vp.prototype.createMediaKeys=function(){var e=new Wp(this.g);return Promise.resolve(e)},Vp.prototype.getConfiguration=function(){return this.h},Wp.prototype.createSession=function(e){if("temporary"!=(e=e||"temporary")&&"persistent-license"!=e)throw new TypeError("Session type "+e+" is unsupported on this platform.");var t=this.g||document.createElement("video");return t.src||(t.src="about:blank"),e=new Kp(t,this.l,e),this.i.push(e),e},Wp.prototype.setServerCertificate=function(){return Promise.resolve(!1)},g(Kp,ai),(i=Kp.prototype).handleError=function(e){var t=Error("EME v0.1b key error"),n=e.errorCode;n.systemCode=e.systemCode,t.errorCode=n,!e.sessionId&&this.h?(45==e.systemCode&&(t.message="Unsupported session type."),this.h.reject(t),this.h=null):e.sessionId&&this.g?(this.g.reject(t),this.g=null):(t=e.systemCode,e.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Zp(this,"output-restricted"):Zp(this,1==t?"expired":"internal-error"))},i.generateRequest=function(e,t){return Yp(this,t,null)},i.load=function(e){return"persistent-license"==this.l?Yp(this,null,e):Promise.reject(Error("Not a persistent session."))},i.update=function(e){var t=new pt;return Jp(this,t,e),t},i.close=function(){if("persistent-license"!=this.l){if(!this.sessionId)return this.closed.reject(Error("The session is not callable.")),this.closed;var e=Hp("cancelKeyRequest");try{this.j[e](this.i,this.sessionId)}catch(e){}}return this.closed.resolve(),this.closed},i.remove=function(){return"persistent-license"!=this.l?Promise.reject(Error("Not a persistent session.")):this.close()},(i=$p.prototype).forEach=function(e){this.g&&e(this.g,$i.value())},i.get=function(e){if(this.has(e))return this.g},i.has=function(e){var t=$i.value();return!(!this.g||!Ae(e,t))},i.entries=function(){},i.keys=function(){},i.values=function(){};var Qp="";function ef(e){if("picture-in-picture"==(e=e.target).webkitPresentationMode){document.pictureInPictureElement=e;var t=new Event("enterpictureinpicture");e.dispatchEvent(t)}else document.pictureInPictureElement==e&&(document.pictureInPictureElement=null),t=new Event("leavepictureinpicture"),e.dispatchEvent(t)}function tf(){return this.webkitSupportsPresentationMode("picture-in-picture")?(this.webkitSetPresentationMode("picture-in-picture"),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error("PiP not allowed by video element"))}function nf(){var e=document.pictureInPictureElement;return e?(e.webkitSetPresentationMode("inline"),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error("No picture in picture element found"))}function rf(){return!!this.hasAttribute("disablePictureInPicture")||!this.webkitSupportsPresentationMode("picture-in-picture")}function af(e){e?this.setAttribute("disablePictureInPicture",""):this.removeAttribute("disablePictureInPicture")}function of(){return new Promise((function(e,t){navigator.webkitTemporaryStorage.queryUsageAndQuota((function(t,n){e({usage:t,quota:n})}),t)}))}function sf(){return{droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0}}function lf(t,n,i){return new e.TextTrackCue(t,n,i)}function uf(t,n,i){return new e.TextTrackCue(t+"-"+n+"-"+i,t,n,i)}function cf(){}dp((function(){if(!(!e.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)Qp="webkit";else if(!HTMLMediaElement.prototype.generateKeyRequest)return;navigator.requestMediaKeySystemAccess=Gp,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=jp,e.MediaKeys=Wp,e.MediaKeySystemAccess=Vp}})),dp((function(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;t.requestPictureInPicture&&document.exitPictureInPicture||!t.webkitSupportsPresentationMode||(document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,t.requestPictureInPicture=tf,Object.defineProperty(t,"disablePictureInPicture",{get:rf,set:af,enumerable:!0,configurable:!0}),document.exitPictureInPicture=nf,document.addEventListener("webkitpresentationmodechanged",ef,!0))}})),dp((function(){navigator.storage&&navigator.storage.estimate||!navigator.webkitTemporaryStorage||!navigator.webkitTemporaryStorage.queryUsageAndQuota||("storage"in navigator||(navigator.storage={}),navigator.storage.estimate=of)})),dp((function(){if(e.HTMLMediaElement){var t=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var e=t.apply(this);return e&&e.catch((function(){})),e}}})),dp((function(){if(e.HTMLVideoElement){var t=HTMLVideoElement.prototype;!t.getVideoPlaybackQuality&&"webkitDroppedFrameCount"in t&&(t.getVideoPlaybackQuality=sf)}})),dp((function(){if(!e.VTTCue&&e.TextTrackCue){var t=null,n=TextTrackCue.length;if(3==n)t=lf;else if(6==n)t=uf;else{try{var i=!!lf(1,2,"")}catch(e){i=!1}i&&(t=lf)}t&&(e.VTTCue=function(e,n,i){return t(e,n,i)})}})),cf.prototype.parseInit=function(){},cf.prototype.parseMedia=function(e,t){for(var n=null,i=[],r=gt(e).split(/\r?\n/),a=(r=u(r)).next();!a.done;a=r.next())if((a=a.value)&&!/^\s+$/.test(a)&&(a=hf.exec(a))){var o=df.exec(a[1]);a=new oe(o=60*parseInt(o[1],10)+parseFloat(o[2].replace(",",".")),t.segmentEnd?t.segmentEnd:o+2,a[2]),n&&(n.endTime=o,i.push(n)),n=a}return n&&i.push(n),i},z("shaka.text.LrcTextParser",cf),cf.prototype.parseMedia=cf.prototype.parseMedia,cf.prototype.parseInit=cf.prototype.parseInit;var hf=/^\[(\d{1,2}:\d{1,2}(?:[.,]\d{1,3})?)\](.*)/,df=/^(\d+):(\d{1,2}(?:[.,]\d{1,3})?)$/;function pf(){}function ff(e,t,n,i,r,a,o,s,l,c){var h=e.parentNode;if(e.nodeType==Node.TEXT_NODE){var d=document.createElement("span");d.textContent=e.textContent,e=d}if(s="default"==(e.getAttribute("xml:space")||(s?"default":"preserve")),d=/\S/.test(e.textContent),!(e.hasAttribute("begin")||e.hasAttribute("end")||e.hasAttribute("dur")||d||"br"==e.tagName||l&&!s))return null;var p=Mf(e,n);for(d=p.start,p=p.end;h&&h.nodeType==Node.ELEMENT_NODE&&"tt"!=h.tagName;)d=(p=wf(h,n,d,p)).start,p=p.end,h=h.parentNode;if(null==d&&(d=0),d+=t,p=null==p?1/0:p+t,"br"==e.tagName)return(i=new oe(d,p,"")).lineBreak=!0,i;var f="";if(h=[],Array.from(e.childNodes).every((function(e){return e.nodeType==Node.TEXT_NODE})))f=e.textContent,s&&(f=(f=f.trim()).replace(/\s+/g," "));else for(var m=u(e.childNodes),g=m.next();!g.done;g=m.next())(g=ff(g.value,t,n,i,r,a,o,s,!0,c))&&h.push(g);if((t=new oe(d,p,f)).nestedCues=h,c&&(t.cellResolution=c),(a=bf(e,"region",a,"")[0])&&a.getAttribute("xml:id")){var v=a.getAttribute("xml:id");t.region=o.filter((function(e){return e.id==v}))[0]}for(o=null,n=(c=u(Ff)).next();!n.done&&!(o=bf(e,"backgroundImage",i,"#",n.value)[0]);n=c.next());return function(e,t,n,i,r,a,o){if("rtl"==gf(t,n,r,"direction",a=a||o)&&(e.direction="rtl"),"tb"==(o=gf(t,n,r,"writingMode",a))||"tblr"==o?e.writingMode="vertical-lr":"tbrl"==o?e.writingMode="vertical-rl":"rltb"==o||"rl"==o?e.direction="rtl":o&&(e.direction=pe),(o=gf(t,n,r,"textAlign",a))?(e.positionAlign=Uf[o],e.lineAlign=Of[o],e.textAlign=ce[o.toUpperCase()]):e.textAlign="start",(o=gf(t,n,r,"displayAlign",a))&&(e.displayAlign=de[o.toUpperCase()]),(o=gf(t,n,r,"color",a))&&(e.color=o),(o=gf(t,n,r,"backgroundColor",a))&&(e.backgroundColor=o),(o=gf(t,n,r,"border",a))&&(e.border=o),(o=gf(t,n,r,"fontFamily",a))&&(e.fontFamily=o),(o=gf(t,n,r,"fontWeight",a))&&"bold"==o&&(e.fontWeight=700),o=gf(t,n,r,"wrapOption",a),e.wrapLine=!o||"noWrap"!=o,(o=gf(t,n,r,"lineHeight",a))&&o.match(Cf)&&(e.lineHeight=o),(o=gf(t,n,r,"fontSize",a))&&(o.match(Cf)||o.match(Af))&&(e.fontSize=o),(o=gf(t,n,r,"fontStyle",a))&&(e.fontStyle=Me[o.toUpperCase()]),i){o=i.getAttribute("imageType")||i.getAttribute("imagetype");var s=i.getAttribute("encoding");i=i.textContent.trim(),"PNG"==o&&"Base64"==s&&i&&(e.backgroundImage="data:image/png;base64,"+i)}(i=gf(t,n,r,"letterSpacing",a))&&i.match(Cf)&&(e.letterSpacing=i),(i=gf(t,n,r,"linePadding",a))&&i.match(Cf)&&(e.linePadding=i),(a=gf(t,n,r,"opacity",a))&&(e.opacity=parseFloat(a)),(n=vf(n,r,"textDecoration"))&&mf(e,n),(t=yf(t,r,"textDecoration"))&&mf(e,t)}(t,e,a,o,r,l,0==h.length),t}function mf(e,t){for(var n=u(t.split(" ")),i=n.next();!i.done;i=n.next())switch(i.value){case"underline":e.textDecoration.includes("underline")||e.textDecoration.push("underline");break;case"noUnderline":e.textDecoration.includes("underline")&&ie(e.textDecoration,"underline");break;case"lineThrough":e.textDecoration.includes("lineThrough")||e.textDecoration.push("lineThrough");break;case"noLineThrough":e.textDecoration.includes("lineThrough")&&ie(e.textDecoration,"lineThrough");break;case"overline":e.textDecoration.includes("overline")||e.textDecoration.push("overline");break;case"noOverline":e.textDecoration.includes("overline")&&ie(e.textDecoration,"overline")}}function gf(e,t,n,i,r){return r=void 0===r||r,(e=yf(e,n,i))?e:r?vf(t,n,i):null}function vf(e,t,n){return e?Ku(e,"http://www.w3.org/ns/ttml#styling",n)||xf(e,t,n):null}function yf(e,t,n){return Ku(e,"http://www.w3.org/ns/ttml#styling",n)||xf(e,t,n)}function xf(e,t,n){e=bf(e,"style",t,"");for(var i=null,r=0;r<e.length;r++){var a=Ku(e[r],"urn:ebu:tt:style",n);a||(a=Ku(e[r],"http://www.w3.org/ns/ttml#styling",n)),a||(a=yf(e[r],t,n)),a&&(i=a)}return i}function bf(e,t,n,i,r){var a=[];if(!e||1>n.length)return a;var o=e;for(e=null;o&&!(e=r?Ku(o,r,t):o.getAttribute(t))&&(o=o.parentNode)instanceof Element;);if(t=e)for(r=(t=u(t.split(" "))).next();!r.done;r=t.next())for(r=r.value,o=(e=u(n)).next();!o.done;o=e.next())if(i+(o=o.value).getAttribute("xml:id")==r){a.push(o);break}return a}function wf(e,t,n,i){return e=Mf(e,t),null==n?n=e.start:null!=e.start&&(n+=e.start),null==i?i=e.end:null!=e.start&&(i+=e.start),{start:n,end:i}}function Mf(e,t){var n=_f(e.getAttribute("begin"),t),i=_f(e.getAttribute("end"),t),r=_f(e.getAttribute("dur"),t);return null==i&&null!=r&&(i=n+r),{start:n,end:i}}function _f(e,t){var n=null;if(Lf.test(e)){n=Lf.exec(e);var i=Number(n[1]),r=Number(n[2]),a=Number(n[3]),o=Number(n[4]);n=(a+=(o+=(Number(n[5])||0)/t.h)/t.frameRate)+60*r+3600*i}else if(If.test(e))n=Sf(If,e);else if(Pf.test(e))n=Sf(Pf,e);else if(Df.test(e))n=Df.exec(e),n=Number(n[1])/t.frameRate;else if(Nf.test(e))n=Nf.exec(e),n=Number(n[1])/t.g;else if(kf.test(e))n=Sf(kf,e);else if(e)throw new We(2,2,2001,"Could not parse cue time range in TTML");return n}function Sf(e,t){var n=e.exec(t);return null==n||""==n[0]?null:(Number(n[4])||0)/1e3+(Number(n[3])||0)+60*(Number(n[2])||0)+3600*(Number(n[1])||0)}function Tf(e,t,n,i){this.frameRate=Number(e)||30,this.h=Number(t)||1,this.g=Number(i),0==this.g&&(this.g=e?this.frameRate*this.h:1),n&&(e=/^(\d+) (\d+)$/g.exec(n))&&(this.frameRate*=Number(e[1])/Number(e[2]))}Ht["application/x-subtitle-lrc"]=function(){return new cf},pf.prototype.parseInit=function(){},pf.prototype.parseMedia=function(e,t){var n=gt(e),i=[],r=new DOMParser,a=null;if(""==n)return i;try{a=r.parseFromString(n,"text/xml")}catch(e){throw new We(2,2,2005,"Failed to parse TTML.")}if(a){if(n=a.getElementsByTagName("parsererror")[0])throw new We(2,2,2005,n.textContent);var o=a.getElementsByTagName("tt")[0];if(!o)throw new We(2,2,2005,"TTML does not contain <tt> tag.");if(!(r=o.getElementsByTagName("body")[0]))return[];n=Ku(o,"http://www.w3.org/ns/ttml#parameter","frameRate");var s=Ku(o,"http://www.w3.org/ns/ttml#parameter","subFrameRate"),l=Ku(o,"http://www.w3.org/ns/ttml#parameter","frameRateMultiplier"),c=Ku(o,"http://www.w3.org/ns/ttml#parameter","tickRate"),h=Ku(o,"http://www.w3.org/ns/ttml#parameter","cellResolution");a=o.getAttribute("xml:space")||"default";var d=Ku(o,"http://www.w3.org/ns/ttml#styling","extent");if("default"!=a&&"preserve"!=a)throw new We(2,2,2005,"Invalid xml:space value: "+a);a="default"==a,n=new Tf(n,s,l,c),h=h&&(h=/^(\d+) (\d+)$/.exec(h))?{columns:parseInt(h[1],10),rows:parseInt(h[2],10)}:null,s=(s=o.getElementsByTagName("metadata")[0])?function(e){return Array.from(e.childNodes).filter((function(e){return e instanceof Element}))}(s):[],l=Array.from(o.getElementsByTagName("style")),c=[];for(var p=u(o=Array.from(o.getElementsByTagName("region"))),f=p.next();!f.done;f=p.next()){var m=f.value;f=new _e;var g=m.getAttribute("xml:id");if(g){f.id=g;var v,y,x=null;d&&(x=Ef.exec(d)||Rf.exec(d)),g=x?Number(x[1]):null,x=x?Number(x[2]):null,(v=vf(m,l,"extent"))&&null!=(v=(y=Ef.exec(v))||Rf.exec(v))&&(f.width=Number(v[1]),f.height=Number(v[2]),y||(null!=g&&(f.width=100*f.width/g),null!=x&&(f.height=100*f.height/x)),f.widthUnits=y||null!=g?Se:0,f.heightUnits=y||null!=x?Se:0),(m=vf(m,l,"origin"))&&null!=(v=(y=Ef.exec(m))||Rf.exec(m))&&(f.viewportAnchorX=Number(v[1]),f.viewportAnchorY=Number(v[2]),y||(null!=x&&(f.viewportAnchorY=100*f.viewportAnchorY/x),null!=g&&(f.viewportAnchorX=100*f.viewportAnchorX/g)),f.viewportAnchorUnits=y||null!=g?Se:0)}else f=null;f&&c.push(f)}if(qu(r,"p").length)throw new We(2,2,2001,"<p> can only be inside <div> in TTML");for(d=(r=u(qu(r,"div"))).next();!d.done;d=r.next()){if(qu(d=d.value,"span").length)throw new We(2,2,2001,"<span> can only be inside <p> in TTML");if((p=qu(d,"p"))&&p.length)for(p=(d=u(p)).next();!p.done;p=d.next())(p=ff(p.value,t.periodStart,n,s,l,o,c,a,!1,h))&&i.push(p);else(d=ff(d,t.periodStart,n,s,l,o,c,a,!1,h))&&i.push(d)}}return i},z("shaka.text.TtmlTextParser",pf),pf.prototype.parseMedia=pf.prototype.parseMedia,pf.prototype.parseInit=pf.prototype.parseInit;var Ef=/^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,Af=/^(\d{1,2}(?:\.\d+)?|100)%$/,Cf=/^(\d+px|\d+em|\d*\.?\d+c)$/,Rf=/^(\d+)px (\d+)px$/,Lf=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,If=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,Pf=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,Df=/^(\d*(?:\.\d*)?)f$/,Nf=/^(\d*(?:\.\d*)?)t$/,kf=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,Of={left:ge,center:"center",right:"end",start:ge,end:"end"},Uf={left:"line-left",center:"center",right:"line-right"},Ff=["http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt","http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"];function Bf(){this.s=new pf}function zf(){}function Hf(e){for(var t=u(Object.entries(ye)),n=t.next();!n.done;n=t.next()){var i=u(n.value);n=i.next().value,i=i.next().value;var r=new oe(0,0,"");r.color=i,e.set(n,r)}for(n=(t=u(Object.entries(xe))).next();!n.done;n=t.next())n=(i=u(n.value)).next().value,i=i.next().value,(r=new oe(0,0,"")).backgroundColor=i,e.set(n,r)}function Gf(e,t,n){0===n.size&&Hf(n);e:{var i=e;e=[];for(var r=-1,a="",o=0;o<i.length;o++)if("/"===i[o]){var s=i.indexOf(">",o);if(s<=o){e=i;break e}s=i.substring(o+1,s);var l=e.pop();if(l===s)a+="/"+s+">";else{if(!l.startsWith("c.")||"c"!==s){e=i;break e}a+="/"+l+">"}o+=s.length+1}else"<"===i[o]?r=o+1:">"===i[o]&&0<r&&(e.push(i.substr(r,o-r)),r=-1),a+=i[o];e=a}if(r=oc("<span>"+e+"</span>","span")){if(i=[],1==(r=r.childNodes).length&&((a=r[0]).nodeType==Node.TEXT_NODE||a.nodeType==Node.CDATA_SECTION_NODE))return void(t.payload=e);for(r=(e=u(r)).next();!r.done;r=e.next())Vf(r.value,t,i,n);t.nestedCues=i}else t.payload=e}function jf(e,t){return e&&0<e.length?e:t}function Vf(e,t,n,i){var r=t.clone();if(e.nodeType===Node.ELEMENT_NODE&&e.nodeName)for(var a=u(e.nodeName.split(/[ .]+/)),o=a.next();!o.done;o=a.next()){if(o=o.value,i.has(o)){var s=i.get(o);s&&(r.backgroundColor=jf(s.backgroundColor,r.backgroundColor),r.color=jf(s.color,r.color),r.fontFamily=jf(s.fontFamily,r.fontFamily),r.fontSize=jf(s.fontSize,r.fontSize),r.fontWeight=s.fontWeight,r.fontStyle=s.fontStyle,r.opacity=s.opacity,r.wrapLine=s.wrapLine)}switch(o){case"b":r.fontWeight=700;break;case"i":r.fontStyle="italic";break;case"u":r.textDecoration.push("underline")}}if(Ju(e))for(a=!0,i=u(e.textContent.split("\n")),e=i.next();!e.done;e=i.next())e=e.value,a||((a=t.clone()).lineBreak=!0,n.push(a)),0<e.length&&((a=r.clone()).payload=e,n.push(a)),a=!1;else for(e=(t=u(e.childNodes)).next();!e.done;e=t.next())Vf(e.value,r,n,i)}function Wf(e,t,n){var i;(i=/^align:(start|middle|center|end|left|right)$/.exec(t))?(t=i[1],e.textAlign="middle"==t?ue:ce[t.toUpperCase()]):(i=/^vertical:(lr|rl)$/.exec(t))?e.writingMode="lr"==i[1]?"vertical-lr":"vertical-rl":(i=/^size:([\d.]+)%$/.exec(t))?e.size=Number(i[1]):(i=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(t))?(e.position=Number(i[1]),i[2]&&(t=i[2],e.positionAlign="line-left"==t||"start"==t?"line-left":"line-right"==t||"end"==t?"line-right":"center")):(i=/^region:(.*)$/.exec(t))?(t=function(e,t){var n=e.filter((function(e){return e.id==t}));return n.length?n[0]:null}(n,i[1]))&&(e.region=t):(n=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(t))?(e.lineInterpretation=1,e.line=Number(n[1]),n[2]&&(e.lineAlign=ve[n[2].toUpperCase()])):(n=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(t))&&(e.lineInterpretation=me,e.line=Number(n[1]),n[2]&&(e.lineAlign=ve[n[2].toUpperCase()]))}function qf(e){if(null==(e=Sh(e,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g)))return null;var t=Number(e[2]),n=Number(e[3]);return 59<t||59<n?null:Number(e[4])/1e3+n+60*t+3600*(Number(e[1])||0)}function Xf(){this.g=null}function Kf(e,t,n){var i,r,a;return(new lr).box("payl",hr((function(e){i=gt(e)}))).box("iden",hr((function(e){r=gt(e)}))).box("sttg",hr((function(e){a=gt(e)}))).parse(e),i?function(e,t,n,i,r){if(Gf(e,i=new oe(i,r,""),new Map),t&&(i.id=t),n)for(t=Th(e=new Mh(n));t;)Wf(i,t,[]),_h(e),t=Th(e);return i}(i,r,a,t,n):null}function Yf(){}function Jf(e){if(null==(e=Sh(e,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g)))return null;var t=Number(e[2]),n=Number(e[3]);return 59<t||59<n?null:Number(e[4])/1e3+n+60*t+3600*(Number(e[1])||0)}function Zf(){this.s=new zf}function $f(e){var t="WEBVTT\n\n";if(""==e)return t;for(var n=(e=u((e=(e=e.replace(/\r+/g,"")).trim()).split("\n\n"))).next();!n.done;n=e.next())(n=n.value.split(/\n/))[0].match(/\d+/)&&n.shift(),n[0]=n[0].replace(/,/g,"."),t+=n.join("\n")+"\n\n";return t}function Qf(){}function em(e,t){var n=t.Fontname;if(n&&(e.fontFamily=n),(n=t.Fontsize)&&(e.fontSize=n+"px"),(n=t.PrimaryColour)&&(n=tm(n))&&(e.color=n),(n=t.BackColour)&&(n=tm(n))&&(e.backgroundColor=n),t.Bold&&(e.fontWeight=700),t.Italic&&(e.fontStyle="italic"),t.Underline&&e.textDecoration.push("underline"),(n=t.Spacing)&&(e.letterSpacing=n+"px"),n=t.Alignment)switch(parseInt(n,10)){case 1:e.displayAlign=he,e.textAlign="start";break;case 2:e.displayAlign=he,e.textAlign=ue;break;case 3:e.displayAlign=he,e.textAlign="end";break;case 5:e.displayAlign="before",e.textAlign="start";break;case 6:e.displayAlign="before",e.textAlign=ue;break;case 7:e.displayAlign="before",e.textAlign="end";break;case 9:e.displayAlign="center",e.textAlign="start";break;case 10:e.displayAlign="center",e.textAlign=ue;break;case 11:e.displayAlign="center",e.textAlign="end"}(n=t.AlphaLevel)&&(e.opacity=parseFloat(n))}function tm(e){return 0<=(e=parseInt(e.replace("&H",""),16))?"rgba("+(255&e)+","+(e>>8&255)+","+(e>>16&255)+","+(e>>24&255^255)/255+")":null}function nm(e){return 3600*((e=lm.exec(e))[1]?parseInt(e[1].replace(":",""),10):0)+60*parseInt(e[2],10)+parseFloat(e[3])}Ht["application/ttml+xml"]=function(){return new pf},Bf.prototype.parseInit=function(e){var t=!1;if((new lr).box("moov",ur).box("trak",ur).box("mdia",ur).box("minf",ur).box("stbl",ur).V("stsd",cr).box("stpp",(function(e){t=!0,e.parser.stop()})).parse(e),!t)throw new We(2,2,2007)},Bf.prototype.parseMedia=function(e,t){var n=this,i=!1,r=[];if((new lr).box("mdat",hr((function(e){i=!0,r=r.concat(n.s.parseMedia(e,t))}))).parse(e,!1),!i)throw new We(2,2,2007);return r},z("shaka.text.Mp4TtmlParser",Bf),Bf.prototype.parseMedia=Bf.prototype.parseMedia,Bf.prototype.parseInit=Bf.prototype.parseInit,Ht['application/mp4; codecs="stpp"']=function(){return new Bf},Ht['application/mp4; codecs="stpp.ttml.im1t"']=function(){return new Bf},Ht['application/mp4; codecs="stpp.TTML.im1t"']=function(){return new Bf},zf.prototype.parseInit=function(){},zf.prototype.parseMedia=function(e,t){var n=gt(e),i=(n=n.replace(/\r\n|\r(?=[^\n]|$)/gm,"\n")).split(/\n{2,}/m);if(!/^WEBVTT($|[ \t\n])/m.test(i[0]))throw new We(2,2,2e3);if(n=t.periodStart,i[0].includes("X-TIMESTAMP-MAP")){var r=i[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),a=i[0].match(/MPEGTS:(\d+)/m);if(r&&a){if(null==(n=qf(new Mh(r[1]))))throw new We(2,2,2e3);for(a=Number(a[1]),r=t.segmentStart;95443.7176888889<=r;)r-=95443.7176888889,a+=8589934592;n=t.periodStart+a/9e4-n}}a=[];for(var o=(r=u(i[0].split("\n"))).next();!o.done;o=r.next())if(o=o.value,/^Region:/.test(o)){o=new Mh(o);var s=new _e;Th(o),_h(o);for(var l=Th(o);l;){var c=s,h=l;(l=/^id=(.*)$/.exec(h))?c.id=l[1]:(l=/^width=(\d{1,2}|100)%$/.exec(h))?c.width=Number(l[1]):(l=/^lines=(\d+)$/.exec(h))?(c.height=Number(l[1]),c.heightUnits=2):(l=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(h))?(c.regionAnchorX=Number(l[1]),c.regionAnchorY=Number(l[2])):(l=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(h))?(c.viewportAnchorX=Number(l[1]),c.viewportAnchorY=Number(l[2])):/^scroll=up$/.exec(h)&&(c.scroll="up"),_h(o),l=Th(o)}a.push(s)}for(Hf(r=new Map),o=[],s=(i=u(i.slice(1))).next();!s.done;s=i.next()){if((1!=(s=s.value.split("\n")).length||s[0])&&!/^NOTE($|[ \t])/.test(s[0])&&"STYLE"==s[0]&&s[1].includes("::cue")){c="global",(l=s[1].match(/\((.*)\)/))&&(c=l.pop()),l=s.slice(2,-1),s[1].includes("}")&&(h=/\{(.*?)\}/.exec(s[1]))&&(l=h[1].split(";")),h=new oe(0,0,"");for(var d=!1,p=0;p<l.length;p++){var f=/^\s*([^:]+):\s*(.*)/.exec(l[p]);if(f){var m=f[2].trim().replace(";","");switch(f[1].trim()){case"background-color":d=!0,h.backgroundColor=m;break;case"color":d=!0,h.color=m;break;case"font-family":d=!0,h.fontFamily=m;break;case"font-size":d=!0,h.fontSize=m;break;case"font-weight":700<=parseInt(m,10)&&(d=!0,h.fontWeight=700);break;case"font-style":switch(m){case"normal":d=!0,h.fontStyle=we;break;case"italic":d=!0,h.fontStyle="italic";break;case"oblique":d=!0,h.fontStyle="oblique"}break;case"opacity":d=!0,h.opacity=parseFloat(m);break;case"white-space":d=!0,h.wrapLine="noWrap"!=m}}}d&&r.set(c,h)}if(p=n,1==s.length&&!s[0]||/^NOTE($|[ \t])/.test(s[0])||"STYLE"==s[0])s=null;else{if(c=null,s[0].includes("--\x3e")||(c=s[0],s.splice(0,1)),h=qf(l=new Mh(s[0])),f=Sh(l,/[ \t]+--\x3e[ \t]+/g),d=qf(l),null==h||null==f||null==d)throw new We(2,2,2001,"Could not parse cue time range in WebVTT");for(h+=p,d+=p,p=s.slice(1).join("\n").trim(),r.has("global")?((s=r.get("global").clone()).startTime=h,s.endTime=d,s.payload=""):s=new oe(h,d,""),Gf(p,s,r),_h(l),h=Th(l);h;)Wf(s,h,a),_h(l),h=Th(l);null!=c&&(s.id=c)}s&&o.push(s)}return o},z("shaka.text.VttTextParser",zf),zf.prototype.parseMedia=zf.prototype.parseMedia,zf.prototype.parseInit=zf.prototype.parseInit,Ht["text/vtt"]=function(){return new zf},Ht['text/vtt; codecs="vtt"']=function(){return new zf},Ht['text/vtt; codecs="wvtt"']=function(){return new zf},Xf.prototype.parseInit=function(e){var t=this,n=!1;if((new lr).box("moov",ur).box("trak",ur).box("mdia",ur).V("mdhd",(function(e){e=Sa(e.reader,e.version),t.g=e.timescale})).box("minf",ur).box("stbl",ur).V("stsd",cr).box("wvtt",(function(){n=!0})).parse(e),!this.g)throw new We(2,2,2008);if(!n)throw new We(2,2,2008)},Xf.prototype.parseMedia=function(e,t){if(!this.g)throw new We(2,2,2008);var n,i=0,r=[],a=[],o=!1,s=!1,l=!1,c=null;if((new lr).box("moof",ur).box("traf",ur).V("tfdt",(function(e){o=!0,i=_a(e.reader,e.version).hd})).V("tfhd",(function(e){c=Ma(e.reader,e.flags).Yd})).V("trun",(function(e){s=!0,r=Ta(e.reader,e.version,e.flags).pe})).box("mdat",hr((function(e){l=!0,n=e}))).parse(e,!1),!l&&!o&&!s)throw new We(2,2,2008);for(var h=i,d=new ar(n,0),p=u(r),f=p.next();!f.done;f=p.next()){var m=(f=f.value).Jd||c,g=f.Kc?i+f.Kc:h;h=g+(m||0);var v=0;do{var y=d.M();v+=y;var x=null;"vttc"==pr(d.M())?8<y&&(x=d.$a(y-8)):d.skip(y-8),m&&x&&(y=Kf(x,t.periodStart+g/this.g,t.periodStart+h/this.g),a.push(y))}while(f.sampleSize&&v<f.sampleSize)}return a.filter(ze)},z("shaka.text.Mp4VttParser",Xf),Xf.prototype.parseMedia=Xf.prototype.parseMedia,Xf.prototype.parseInit=Xf.prototype.parseInit,Ht['application/mp4; codecs="wvtt"']=function(){return new Xf},Yf.prototype.parseInit=function(){},Yf.prototype.parseMedia=function(e){var t=gt(e).replace(/\r+/g,"");if(e=[],""==(t=t.trim()))return e;for(var n=(t=u(t.split("\n\n"))).next();!n.done;n=t.next()){var i=new Mh((n=n.value.split("\n"))[0]),r=Jf(i),a=Sh(i,/,/g);if(i=Jf(i),null==r||null==a||null==i)throw new We(2,2,2001,"Could not parse cue time range in SubViewer");e.push(new oe(r,i,n.slice(1).join("\n").trim()))}return e},z("shaka.text.SbvTextParser",Yf),Yf.prototype.parseMedia=Yf.prototype.parseMedia,Yf.prototype.parseInit=Yf.prototype.parseInit,Ht["text/x-subviewer"]=function(){return new Yf},Zf.prototype.parseInit=function(){},Zf.prototype.parseMedia=function(e,t){var n=gt(e);return n=Le(xt(n=$f(n))),this.s.parseMedia(n,t)},z("shaka.text.SrtTextParser",Zf),Zf.srt2webvtt=$f,Zf.prototype.parseMedia=Zf.prototype.parseMedia,Zf.prototype.parseInit=Zf.prototype.parseInit,Ht["text/srt"]=function(){return new Zf},Qf.prototype.parseInit=function(){},Qf.prototype.parseMedia=function(e){for(var t="",n="",i=(e=u(e=gt(e).split(/\r?\n\s*\r?\n/))).next();!i.done;i=e.next()){var r=am.exec(i.value);r&&(i=r[1],r=r[2],"V4 Styles"==i||"V4+ Styles"==i?t=r:"Events"==i&&(n=r))}e=[],i=null;for(var a=(t=u(t.split(/\r?\n/))).next();!a.done;a=t.next())if(r=a.value,!/^\s*;/.test(r)&&(a=om.exec(r)))if(r=a[1].trim(),a=a[2].trim(),"Format"==r)i=a.split(sm);else if("Style"==r){r=a.split(sm),a={};for(var o=0;o<i.length&&o<r.length;o++)a[i[o]]=r[o];e.push(a)}for(i=[],t=null,r={},a=(n=u(n.split(/\r?\n/))).next();!a.done;r={cd:r.cd},a=n.next())if(a=a.value,!/^\s*;/.test(a)&&(o=om.exec(a)))if(a=o[1].trim(),o=o[2].trim(),"Format"==a)t=o.split(sm);else if("Dialogue"==a){o=o.split(sm),a={};for(var s=0;s<t.length&&s<o.length;s++)a[t[s]]=o[s];o=new oe(s=nm(a.Start),nm(a.End),o.slice(t.length-1).join(",").replace(/\\N/g,"\n").replace(/\{[^}]+\}/g,"")),r.cd=a.Style,(a=e.find(function(e){return function(t){return t.Name==e.cd}}(r)))&&em(o,a),i.push(o)}return i},z("shaka.text.SsaTextParser",Qf),Qf.prototype.parseMedia=Qf.prototype.parseMedia,Qf.prototype.parseInit=Qf.prototype.parseInit;var im,rm,am=/^\s*\[([^\]]+)\]\r?\n([\s\S]*)/,om=/^\s*([^:]+):\s*(.*)/,sm=/\s*,\s*/,lm=/^(\d+:)?(\d{1,2}):(\d{1,2}(?:[.]\d{1,3})?)?$/;function um(){}function cm(){im?console.debug("EmeEncryptionSchemePolyfill: Already installed."):navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration?(im=navigator.requestMediaKeySystemAccess,console.debug("EmeEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.requestMediaKeySystemAccess=hm):console.debug("EmeEncryptionSchemePolyfill: EME not found")}function hm(e,t){var n,i=this;return D((function(r){return 1==r.g?(console.assert(i==navigator,'bad "this" for requestMediaKeySystemAccess'),b(r,im.call(i,e,t),2)):bm(n=r.h)?(console.debug("EmeEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.requestMediaKeySystemAccess=im,r.return(n)):(console.debug("EmeEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.requestMediaKeySystemAccess=dm,r.return(dm.call(i,e,t)))}))}function dm(e,t){var n,i,r,a,o,s,l,c,h,d,p=this;return D((function(f){if(1==f.g){for(console.assert(p==navigator,'bad "this" for requestMediaKeySystemAccess'),n=xm(e),i=[],r=u(t),a=r.next();!a.done;a=r.next())o=a.value,s=pm(o.videoCapabilities,n),l=pm(o.audioCapabilities,n),o.videoCapabilities&&o.videoCapabilities.length&&!s.length||o.audioCapabilities&&o.audioCapabilities.length&&!l.length||((c=Object.assign({},o)).videoCapabilities=s,c.audioCapabilities=l,i.push(c));if(!i.length)throw(h=Error("Unsupported keySystem or supportedConfigurations.")).name="NotSupportedError",h.code=DOMException.NOT_SUPPORTED_ERR,h;return b(f,im.call(p,e,i),2)}return d=f.h,f.return(new ym(d,n))}))}function pm(e,t){return e?e.filter((function(e){return!e.encryptionScheme||e.encryptionScheme==t})):e}function fm(){}function mm(){rm?console.debug("McEncryptionSchemePolyfill: Already installed."):navigator.mediaCapabilities?(rm=navigator.mediaCapabilities.decodingInfo,console.debug("McEncryptionSchemePolyfill: Waiting to detect encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=gm):console.debug("McEncryptionSchemePolyfill: MediaCapabilities not found")}function gm(e){var t,n,i=this;return D((function(r){return 1==r.g?(console.assert(i==navigator.mediaCapabilities,'bad "this" for decodingInfo'),b(r,rm.call(i,e),2)):(t=r.h,e.keySystemConfiguration?(n=t.keySystemAccess)&&bm(n)?(console.debug("McEncryptionSchemePolyfill: Native encryptionScheme support found."),navigator.mediaCapabilities.decodingInfo=rm,r.return(t)):(console.debug("McEncryptionSchemePolyfill: No native encryptionScheme support found. Patching encryptionScheme support."),navigator.mediaCapabilities.decodingInfo=vm,r.return(vm.call(i,e))):r.return(t))}))}function vm(e){var t,n,i,r,a,o,s,l,u,c=this;return D((function(h){switch(h.g){case 1:return console.assert(c==navigator.mediaCapabilities,'bad "this" for decodingInfo'),t=null,e.keySystemConfiguration&&(n=e.keySystemConfiguration,i=n.keySystem,r=n.audio&&n.audio.encryptionScheme,a=n.video&&n.video.encryptionScheme,t=xm(i),o={powerEfficient:!1,smooth:!1,supported:!1,keySystemAccess:null,configuration:e},r&&r!=t||a&&a!=t)?h.return(o):b(h,rm.call(c,e),2);case 2:if((s=h.h).keySystemAccess){s.keySystemAccess=new ym(s.keySystemAccess,t),h.v(3);break}if(!e.keySystemConfiguration){h.v(3);break}var d=e.keySystemConfiguration,p=[],f=[];return d.audio&&p.push({robustness:d.audio.robustness||"",contentType:e.audio.contentType}),d.video&&f.push({robustness:d.video.robustness||"",contentType:e.video.contentType}),d={initDataTypes:d.initDataType?[d.initDataType]:[],distinctiveIdentifier:d.distinctiveIdentifier,persistentState:d.persistentState,sessionTypes:d.sessionTypes},p.length&&(d.audioCapabilities=p),f.length&&(d.videoCapabilities=f),l=d,u=s,b(h,navigator.requestMediaKeySystemAccess(e.keySystemConfiguration.keySystem,[l]),5);case 5:u.keySystemAccess=h.h;case 3:return h.return(s)}}))}function ym(e,t){this.h=e,this.g=t,this.keySystem=e.keySystem}function xm(e){return e.startsWith("com.widevine")||e.startsWith("com.microsoft")||e.startsWith("com.adobe")||e.startsWith("org.w3")?"cenc":e.startsWith("com.apple")?"cbcs-1-9":(console.warn("EmeEncryptionSchemePolyfill: Unknown key system:",e,"Please contribute!"),null)}function bm(e){var t=(e=e.getConfiguration()).audioCapabilities&&e.audioCapabilities[0];return!(!(e=e.videoCapabilities&&e.videoCapabilities[0]||t)||void 0===e.encryptionScheme)}function wm(){}function Mm(){cm(),mm()}Ht["text/x-ssa"]=function(){return new Qf},z("EmeEncryptionSchemePolyfill",um),um.install=cm,z("McEncryptionSchemePolyfill",fm),fm.install=mm,ym.prototype.getConfiguration=function(){var e=this.h.getConfiguration();if(e.videoCapabilities)for(var t=u(e.videoCapabilities),n=t.next();!n.done;n=t.next())n.value.encryptionScheme=this.g;if(e.audioCapabilities)for(n=(t=u(e.audioCapabilities)).next();!n.done;n=t.next())n.value.encryptionScheme=this.g;return e},ym.prototype.createMediaKeys=function(){return this.h.createMediaKeys()},z("EncryptionSchemePolyfills",wm),wm.install=Mm,void 0!==n&&n.exports&&(n.exports=wm)}.call(i,e,e,void 0),i.shaka)t[r]=i.shaka[r]}()},212:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ACESFilmicToneMapping:()=>ne,AddEquation:()=>T,AddOperation:()=>Z,AdditiveAnimationBlendMode:()=>qt,AdditiveBlending:()=>w,AlphaFormat:()=>Oe,AlwaysDepth:()=>G,AlwaysStencilFunc:()=>Sn,AmbientLight:()=>id,AmbientLightProbe:()=>bd,AnimationClip:()=>Ch,AnimationLoader:()=>Oh,AnimationMixer:()=>Zd,AnimationObjectGroup:()=>Yd,AnimationUtils:()=>mh,ArcCurve:()=>Ju,ArrayCamera:()=>bl,ArrowHelper:()=>zp,Audio:()=>Id,AudioAnalyser:()=>Ud,AudioContext:()=>vd,AudioListener:()=>Ld,AudioLoader:()=>yd,AxesHelper:()=>Hp,AxisHelper:()=>vf,BackSide:()=>m,BasicDepthPacking:()=>an,BasicShadowMap:()=>c,BinaryTextureLoader:()=>Mf,Bone:()=>au,BooleanKeyframeTrack:()=>wh,BoundingBoxHelper:()=>yf,Box2:()=>sp,Box3:()=>gi,Box3Helper:()=>kp,BoxBufferGeometry:()=>_a,BoxGeometry:()=>_a,BoxHelper:()=>Np,BufferAttribute:()=>Br,BufferGeometry:()=>ia,BufferGeometryLoader:()=>cd,ByteType:()=>Te,Cache:()=>Lh,Camera:()=>Ca,CameraHelper:()=>Ip,CanvasRenderer:()=>Sf,CanvasTexture:()=>Ou,CatmullRomCurve3:()=>nc,CineonToneMapping:()=>te,CircleBufferGeometry:()=>Fu,CircleGeometry:()=>Fu,ClampToEdgeWrapping:()=>de,Clock:()=>Sd,Color:()=>kr,ColorKeyframeTrack:()=>Mh,CompressedTexture:()=>ku,CompressedTextureLoader:()=>Uh,ConeBufferGeometry:()=>zu,ConeGeometry:()=>zu,CubeCamera:()=>Ia,CubeReflectionMapping:()=>ae,CubeRefractionMapping:()=>oe,CubeTexture:()=>Pa,CubeTextureLoader:()=>Bh,CubeUVReflectionMapping:()=>ue,CubeUVRefractionMapping:()=>ce,CubicBezierCurve:()=>oc,CubicBezierCurve3:()=>sc,CubicInterpolant:()=>vh,CullFaceBack:()=>s,CullFaceFront:()=>l,CullFaceFrontBack:()=>u,CullFaceNone:()=>o,Curve:()=>Ku,CurvePath:()=>fc,CustomBlending:()=>S,CustomToneMapping:()=>ie,CylinderBufferGeometry:()=>Bu,CylinderGeometry:()=>Bu,Cylindrical:()=>ap,DataTexture:()=>ou,DataTexture2DArray:()=>Ao,DataTexture3D:()=>Do,DataTextureLoader:()=>zh,DataUtils:()=>Wp,DecrementStencilOp:()=>pn,DecrementWrapStencilOp:()=>mn,DefaultLoadingManager:()=>Ph,DepthFormat:()=>Ge,DepthStencilFormat:()=>je,DepthTexture:()=>Uu,DirectionalLight:()=>nd,DirectionalLightHelper:()=>Cp,DiscreteInterpolant:()=>xh,DodecahedronBufferGeometry:()=>Gu,DodecahedronGeometry:()=>Gu,DoubleSide:()=>g,DstAlphaFactor:()=>O,DstColorFactor:()=>F,DynamicBufferAttribute:()=>sf,DynamicCopyUsage:()=>Pn,DynamicDrawUsage:()=>En,DynamicReadUsage:()=>Rn,EdgesGeometry:()=>Xu,EdgesHelper:()=>xf,EllipseCurve:()=>Yu,EqualDepth:()=>W,EqualStencilFunc:()=>xn,EquirectangularReflectionMapping:()=>se,EquirectangularRefractionMapping:()=>le,Euler:()=>er,EventDispatcher:()=>On,ExtrudeBufferGeometry:()=>Vc,ExtrudeGeometry:()=>Vc,FaceColors:()=>Yp,FileLoader:()=>kh,FlatShading:()=>v,Float16BufferAttribute:()=>Xr,Float32Attribute:()=>mf,Float32BufferAttribute:()=>Kr,Float64Attribute:()=>gf,Float64BufferAttribute:()=>Yr,FloatType:()=>Le,Fog:()=>Rl,FogExp2:()=>Cl,Font:()=>If,FontLoader:()=>Lf,FrontSide:()=>f,Frustum:()=>za,GLBufferAttribute:()=>ep,GLSL1:()=>Nn,GLSL3:()=>kn,GammaEncoding:()=>$t,GreaterDepth:()=>X,GreaterEqualDepth:()=>q,GreaterEqualStencilFunc:()=>_n,GreaterStencilFunc:()=>wn,GridHelper:()=>_p,Group:()=>wl,HalfFloatType:()=>Ie,HemisphereLight:()=>jh,HemisphereLightHelper:()=>Mp,HemisphereLightProbe:()=>xd,IcosahedronBufferGeometry:()=>qc,IcosahedronGeometry:()=>qc,ImageBitmapLoader:()=>md,ImageLoader:()=>Fh,ImageUtils:()=>ri,ImmediateRenderObject:()=>Pf,IncrementStencilOp:()=>dn,IncrementWrapStencilOp:()=>fn,InstancedBufferAttribute:()=>cu,InstancedBufferGeometry:()=>ud,InstancedInterleavedBuffer:()=>Qd,InstancedMesh:()=>mu,Int16Attribute:()=>hf,Int16BufferAttribute:()=>jr,Int32Attribute:()=>pf,Int32BufferAttribute:()=>Wr,Int8Attribute:()=>lf,Int8BufferAttribute:()=>zr,IntType:()=>Ce,InterleavedBuffer:()=>Il,InterleavedBufferAttribute:()=>Dl,Interpolant:()=>gh,InterpolateDiscrete:()=>Bt,InterpolateLinear:()=>zt,InterpolateSmooth:()=>Ht,InvertStencilOp:()=>gn,JSONLoader:()=>Tf,KeepStencilOp:()=>cn,KeyframeTrack:()=>bh,LOD:()=>$l,LatheBufferGeometry:()=>Xc,LatheGeometry:()=>Xc,Layers:()=>tr,LensFlare:()=>Af,LessDepth:()=>j,LessEqualDepth:()=>V,LessEqualStencilFunc:()=>bn,LessStencilFunc:()=>yn,Light:()=>Gh,LightProbe:()=>od,Line:()=>Mu,Line3:()=>cp,LineBasicMaterial:()=>gu,LineCurve:()=>lc,LineCurve3:()=>uc,LineDashedMaterial:()=>ph,LineLoop:()=>Eu,LinePieces:()=>Xp,LineSegments:()=>Tu,LineStrip:()=>qp,LinearEncoding:()=>Jt,LinearFilter:()=>xe,LinearInterpolant:()=>yh,LinearMipMapLinearFilter:()=>_e,LinearMipMapNearestFilter:()=>we,LinearMipmapLinearFilter:()=>Me,LinearMipmapNearestFilter:()=>be,LinearToneMapping:()=>Q,Loader:()=>Dh,LoaderUtils:()=>ld,LoadingManager:()=>Ih,LogLuvEncoding:()=>en,LoopOnce:()=>Ot,LoopPingPong:()=>Ft,LoopRepeat:()=>Ut,LuminanceAlphaFormat:()=>ze,LuminanceFormat:()=>Be,MOUSE:()=>r,Material:()=>Cr,MaterialLoader:()=>sd,Math:()=>Yn,MathUtils:()=>Yn,Matrix3:()=>Zn,Matrix4:()=>Vi,MaxEquation:()=>R,Mesh:()=>wa,MeshBasicMaterial:()=>Or,MeshDepthMaterial:()=>fl,MeshDistanceMaterial:()=>ml,MeshFaceMaterial:()=>Zp,MeshLambertMaterial:()=>hh,MeshMatcapMaterial:()=>dh,MeshNormalMaterial:()=>ch,MeshPhongMaterial:()=>lh,MeshPhysicalMaterial:()=>sh,MeshStandardMaterial:()=>oh,MeshToonMaterial:()=>uh,MinEquation:()=>C,MirroredRepeatWrapping:()=>pe,MixOperation:()=>J,MultiMaterial:()=>$p,MultiplyBlending:()=>_,MultiplyOperation:()=>Y,NearestFilter:()=>fe,NearestMipMapLinearFilter:()=>ye,NearestMipMapNearestFilter:()=>ge,NearestMipmapLinearFilter:()=>ve,NearestMipmapNearestFilter:()=>me,NeverDepth:()=>H,NeverStencilFunc:()=>vn,NoBlending:()=>x,NoColors:()=>Kp,NoToneMapping:()=>$,NormalAnimationBlendMode:()=>Wt,NormalBlending:()=>b,NotEqualDepth:()=>K,NotEqualStencilFunc:()=>Mn,NumberKeyframeTrack:()=>_h,Object3D:()=>mr,ObjectLoader:()=>hd,ObjectSpaceNormalMap:()=>ln,OctahedronBufferGeometry:()=>Kc,OctahedronGeometry:()=>Kc,OneFactor:()=>I,OneMinusDstAlphaFactor:()=>U,OneMinusDstColorFactor:()=>B,OneMinusSrcAlphaFactor:()=>k,OneMinusSrcColorFactor:()=>D,OrthographicCamera:()=>Qa,PCFShadowMap:()=>h,PCFSoftShadowMap:()=>d,PMREMGenerator:()=>mo,ParametricGeometry:()=>Cf,Particle:()=>ef,ParticleBasicMaterial:()=>rf,ParticleSystem:()=>tf,ParticleSystemMaterial:()=>af,Path:()=>mc,PerspectiveCamera:()=>Ra,Plane:()=>Ua,PlaneBufferGeometry:()=>ja,PlaneGeometry:()=>ja,PlaneHelper:()=>Op,PointCloud:()=>Qp,PointCloudMaterial:()=>nf,PointLight:()=>ed,PointLightHelper:()=>yp,Points:()=>Pu,PointsMaterial:()=>Au,PolarGridHelper:()=>Sp,PolyhedronBufferGeometry:()=>Hu,PolyhedronGeometry:()=>Hu,PositionalAudio:()=>Od,PropertyBinding:()=>Kd,PropertyMixer:()=>Fd,QuadraticBezierCurve:()=>cc,QuadraticBezierCurve3:()=>hc,Quaternion:()=>di,QuaternionKeyframeTrack:()=>Th,QuaternionLinearInterpolant:()=>Sh,REVISION:()=>i,RGBADepthPacking:()=>on,RGBAFormat:()=>Fe,RGBAIntegerFormat:()=>Ye,RGBA_ASTC_10x10_Format:()=>yt,RGBA_ASTC_10x5_Format:()=>mt,RGBA_ASTC_10x6_Format:()=>gt,RGBA_ASTC_10x8_Format:()=>vt,RGBA_ASTC_12x10_Format:()=>xt,RGBA_ASTC_12x12_Format:()=>bt,RGBA_ASTC_4x4_Format:()=>st,RGBA_ASTC_5x4_Format:()=>lt,RGBA_ASTC_5x5_Format:()=>ut,RGBA_ASTC_6x5_Format:()=>ct,RGBA_ASTC_6x6_Format:()=>ht,RGBA_ASTC_8x5_Format:()=>dt,RGBA_ASTC_8x6_Format:()=>pt,RGBA_ASTC_8x8_Format:()=>ft,RGBA_BPTC_Format:()=>wt,RGBA_ETC2_EAC_Format:()=>ot,RGBA_PVRTC_2BPPV1_Format:()=>it,RGBA_PVRTC_4BPPV1_Format:()=>nt,RGBA_S3TC_DXT1_Format:()=>Ze,RGBA_S3TC_DXT3_Format:()=>$e,RGBA_S3TC_DXT5_Format:()=>Qe,RGBDEncoding:()=>rn,RGBEEncoding:()=>Qt,RGBEFormat:()=>He,RGBFormat:()=>Ue,RGBIntegerFormat:()=>Ke,RGBM16Encoding:()=>nn,RGBM7Encoding:()=>tn,RGB_ETC1_Format:()=>rt,RGB_ETC2_Format:()=>at,RGB_PVRTC_2BPPV1_Format:()=>tt,RGB_PVRTC_4BPPV1_Format:()=>et,RGB_S3TC_DXT1_Format:()=>Je,RGFormat:()=>qe,RGIntegerFormat:()=>Xe,RawShaderMaterial:()=>eo,Ray:()=>ji,Raycaster:()=>tp,RectAreaLight:()=>rd,RedFormat:()=>Ve,RedIntegerFormat:()=>We,ReinhardToneMapping:()=>ee,RepeatWrapping:()=>he,ReplaceStencilOp:()=>hn,ReverseSubtractEquation:()=>A,RingBufferGeometry:()=>Yc,RingGeometry:()=>Yc,SRGB8_ALPHA8_ASTC_10x10_Format:()=>Dt,SRGB8_ALPHA8_ASTC_10x5_Format:()=>Lt,SRGB8_ALPHA8_ASTC_10x6_Format:()=>It,SRGB8_ALPHA8_ASTC_10x8_Format:()=>Pt,SRGB8_ALPHA8_ASTC_12x10_Format:()=>Nt,SRGB8_ALPHA8_ASTC_12x12_Format:()=>kt,SRGB8_ALPHA8_ASTC_4x4_Format:()=>Mt,SRGB8_ALPHA8_ASTC_5x4_Format:()=>_t,SRGB8_ALPHA8_ASTC_5x5_Format:()=>St,SRGB8_ALPHA8_ASTC_6x5_Format:()=>Tt,SRGB8_ALPHA8_ASTC_6x6_Format:()=>Et,SRGB8_ALPHA8_ASTC_8x5_Format:()=>At,SRGB8_ALPHA8_ASTC_8x6_Format:()=>Ct,SRGB8_ALPHA8_ASTC_8x8_Format:()=>Rt,Scene:()=>Ll,SceneUtils:()=>Ef,ShaderChunk:()=>Va,ShaderLib:()=>qa,ShaderMaterial:()=>Aa,ShadowMaterial:()=>ah,Shape:()=>gc,ShapeBufferGeometry:()=>Jc,ShapeGeometry:()=>Jc,ShapePath:()=>Gp,ShapeUtils:()=>Hc,ShortType:()=>Ee,Skeleton:()=>uu,SkeletonHelper:()=>gp,SkinnedMesh:()=>ru,SmoothShading:()=>y,Sphere:()=>ki,SphereBufferGeometry:()=>Zc,SphereGeometry:()=>Zc,Spherical:()=>rp,SphericalHarmonics3:()=>ad,SplineCurve:()=>dc,SpotLight:()=>Yh,SpotLightHelper:()=>dp,Sprite:()=>Kl,SpriteMaterial:()=>Nl,SrcAlphaFactor:()=>N,SrcAlphaSaturateFactor:()=>z,SrcColorFactor:()=>P,StaticCopyUsage:()=>In,StaticDrawUsage:()=>Tn,StaticReadUsage:()=>Cn,StereoCamera:()=>_d,StreamCopyUsage:()=>Dn,StreamDrawUsage:()=>An,StreamReadUsage:()=>Ln,StringKeyframeTrack:()=>Eh,SubtractEquation:()=>E,SubtractiveBlending:()=>M,TOUCH:()=>a,TangentSpaceNormalMap:()=>sn,TetrahedronBufferGeometry:()=>$c,TetrahedronGeometry:()=>$c,TextGeometry:()=>Rf,Texture:()=>oi,TextureLoader:()=>Hh,TorusBufferGeometry:()=>Qc,TorusGeometry:()=>Qc,TorusKnotBufferGeometry:()=>eh,TorusKnotGeometry:()=>eh,Triangle:()=>Er,TriangleFanDrawMode:()=>Yt,TriangleStripDrawMode:()=>Kt,TrianglesDrawMode:()=>Xt,TubeBufferGeometry:()=>th,TubeGeometry:()=>th,UVMapping:()=>re,Uint16Attribute:()=>df,Uint16BufferAttribute:()=>Vr,Uint32Attribute:()=>ff,Uint32BufferAttribute:()=>qr,Uint8Attribute:()=>uf,Uint8BufferAttribute:()=>Hr,Uint8ClampedAttribute:()=>cf,Uint8ClampedBufferAttribute:()=>Gr,Uniform:()=>$d,UniformsLib:()=>Wa,UniformsUtils:()=>Ea,UnsignedByteType:()=>Se,UnsignedInt248Type:()=>ke,UnsignedIntType:()=>Re,UnsignedShort4444Type:()=>Pe,UnsignedShort5551Type:()=>De,UnsignedShort565Type:()=>Ne,UnsignedShortType:()=>Ae,VSMShadowMap:()=>p,Vector2:()=>Jn,Vector3:()=>pi,Vector4:()=>li,VectorKeyframeTrack:()=>Ah,Vertex:()=>of,VertexColors:()=>Jp,VideoTexture:()=>Nu,WebGL1Renderer:()=>Al,WebGLCubeRenderTarget:()=>Da,WebGLMultipleRenderTargets:()=>ci,WebGLMultisampleRenderTarget:()=>hi,WebGLRenderTarget:()=>ui,WebGLRenderTargetCube:()=>_f,WebGLRenderer:()=>El,WebGLUtils:()=>xl,WireframeGeometry:()=>nh,WireframeHelper:()=>bf,WrapAroundEnding:()=>Vt,XHRLoader:()=>wf,ZeroCurvatureEnding:()=>Gt,ZeroFactor:()=>L,ZeroSlopeEnding:()=>jt,ZeroStencilOp:()=>un,sRGBEncoding:()=>Zt});const i="134",r={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},a={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,s=1,l=2,u=3,c=0,h=1,d=2,p=3,f=0,m=1,g=2,v=1,y=2,x=0,b=1,w=2,M=3,_=4,S=5,T=100,E=101,A=102,C=103,R=104,L=200,I=201,P=202,D=203,N=204,k=205,O=206,U=207,F=208,B=209,z=210,H=0,G=1,j=2,V=3,W=4,q=5,X=6,K=7,Y=0,J=1,Z=2,$=0,Q=1,ee=2,te=3,ne=4,ie=5,re=300,ae=301,oe=302,se=303,le=304,ue=306,ce=307,he=1e3,de=1001,pe=1002,fe=1003,me=1004,ge=1004,ve=1005,ye=1005,xe=1006,be=1007,we=1007,Me=1008,_e=1008,Se=1009,Te=1010,Ee=1011,Ae=1012,Ce=1013,Re=1014,Le=1015,Ie=1016,Pe=1017,De=1018,Ne=1019,ke=1020,Oe=1021,Ue=1022,Fe=1023,Be=1024,ze=1025,He=Fe,Ge=1026,je=1027,Ve=1028,We=1029,qe=1030,Xe=1031,Ke=1032,Ye=1033,Je=33776,Ze=33777,$e=33778,Qe=33779,et=35840,tt=35841,nt=35842,it=35843,rt=36196,at=37492,ot=37496,st=37808,lt=37809,ut=37810,ct=37811,ht=37812,dt=37813,pt=37814,ft=37815,mt=37816,gt=37817,vt=37818,yt=37819,xt=37820,bt=37821,wt=36492,Mt=37840,_t=37841,St=37842,Tt=37843,Et=37844,At=37845,Ct=37846,Rt=37847,Lt=37848,It=37849,Pt=37850,Dt=37851,Nt=37852,kt=37853,Ot=2200,Ut=2201,Ft=2202,Bt=2300,zt=2301,Ht=2302,Gt=2400,jt=2401,Vt=2402,Wt=2500,qt=2501,Xt=0,Kt=1,Yt=2,Jt=3e3,Zt=3001,$t=3007,Qt=3002,en=3003,tn=3004,nn=3005,rn=3006,an=3200,on=3201,sn=0,ln=1,un=0,cn=7680,hn=7681,dn=7682,pn=7683,fn=34055,mn=34056,gn=5386,vn=512,yn=513,xn=514,bn=515,wn=516,Mn=517,_n=518,Sn=519,Tn=35044,En=35048,An=35040,Cn=35045,Rn=35049,Ln=35041,In=35046,Pn=35050,Dn=35042,Nn="100",kn="300 es";class On{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}}let Un=1234567;const Fn=Math.PI/180,Bn=180/Math.PI,zn=[];for(let e=0;e<256;e++)zn[e]=(e<16?"0":"")+e.toString(16);const Hn="undefined"!=typeof crypto&&"randomUUID"in crypto;function Gn(){if(Hn)return crypto.randomUUID().toUpperCase();const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(zn[255&e]+zn[e>>8&255]+zn[e>>16&255]+zn[e>>24&255]+"-"+zn[255&t]+zn[t>>8&255]+"-"+zn[t>>16&15|64]+zn[t>>24&255]+"-"+zn[63&n|128]+zn[n>>8&255]+"-"+zn[n>>16&255]+zn[n>>24&255]+zn[255&i]+zn[i>>8&255]+zn[i>>16&255]+zn[i>>24&255]).toUpperCase()}function jn(e,t,n){return Math.max(t,Math.min(n,e))}function Vn(e,t){return(e%t+t)%t}function Wn(e,t,n){return(1-n)*e+n*t}function qn(e){return 0==(e&e-1)&&0!==e}function Xn(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Kn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Yn=Object.freeze({__proto__:null,DEG2RAD:Fn,RAD2DEG:Bn,generateUUID:Gn,clamp:jn,euclideanModulo:Vn,mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Wn,damp:function(e,t,n,i){return Wn(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(Vn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Un=e%2147483647),Un=16807*Un%2147483647,(Un-1)/2147483646},degToRad:function(e){return e*Fn},radToDeg:function(e){return e*Bn},isPowerOfTwo:qn,ceilPowerOfTwo:Xn,floorPowerOfTwo:Kn,setQuaternionFromProperEuler:function(e,t,n,i,r){const a=Math.cos,o=Math.sin,s=a(n/2),l=o(n/2),u=a((t+i)/2),c=o((t+i)/2),h=a((t-i)/2),d=o((t-i)/2),p=a((i-t)/2),f=o((i-t)/2);switch(r){case"XYX":e.set(s*c,l*h,l*d,s*u);break;case"YZY":e.set(l*d,s*c,l*h,s*u);break;case"ZXZ":e.set(l*h,l*d,s*c,s*u);break;case"XZX":e.set(s*c,l*f,l*p,s*u);break;case"YXY":e.set(l*p,s*c,l*f,s*u);break;case"ZYZ":e.set(l*f,l*p,s*c,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}});class Jn{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Jn.prototype.isVector2=!0;class Zn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,a,o,s,l){const u=this.elements;return u[0]=e,u[1]=i,u[2]=o,u[3]=t,u[4]=r,u[5]=s,u[6]=n,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],u=n[4],c=n[7],h=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],x=i[7],b=i[2],w=i[5],M=i[8];return r[0]=a*f+o*v+s*b,r[3]=a*m+o*y+s*w,r[6]=a*g+o*x+s*M,r[1]=l*f+u*v+c*b,r[4]=l*m+u*y+c*w,r[7]=l*g+u*x+c*M,r[2]=h*f+d*v+p*b,r[5]=h*m+d*y+p*w,r[8]=h*g+d*x+p*M,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*a*u-t*o*l-n*r*u+n*o*s+i*r*l-i*a*s}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=u*a-o*l,h=o*s-u*r,d=l*r-a*s,p=t*c+n*h+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=c*f,e[1]=(i*l-u*n)*f,e[2]=(o*n-i*a)*f,e[3]=h*f,e[4]=(u*t-i*s)*f,e[5]=(i*r-o*t)*f,e[6]=d*f,e[7]=(n*s-l*t)*f,e[8]=(a*t-n*r)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,r,a,o){const s=Math.cos(r),l=Math.sin(r);return this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-i*l,i*s,-i*(-l*a+s*o)+o+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,r=i[0],a=i[3],o=i[6],s=i[1],l=i[4],u=i[7];return i[0]=t*r+n*s,i[3]=t*a+n*l,i[6]=t*o+n*u,i[1]=-n*r+t*s,i[4]=-n*a+t*l,i[7]=-n*o+t*u,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function $n(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}Zn.prototype.isMatrix3=!0;const Qn={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ei(e,t){return new Qn[e](t)}function ti(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function ni(e,t=0){let n=3735928559^t,i=1103547991^t;for(let t,r=0;r<e.length;r++)t=e.charCodeAt(r),n=Math.imul(n^t,2654435761),i=Math.imul(i^t,1597334677);return n=Math.imul(n^n>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),4294967296*(2097151&i)+(n>>>0)}let ii;class ri{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===ii&&(ii=ti("canvas")),ii.width=e.width,ii.height=e.height;const n=ii.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=ii}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let ai=0;class oi extends On{constructor(e=oi.DEFAULT_IMAGE,t=oi.DEFAULT_MAPPING,n=de,i=de,r=xe,a=Me,o=Fe,s=Se,l=1,u=Jt){super(),Object.defineProperty(this,"id",{value:ai++}),this.uuid=Gn(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new Jn(0,0),this.repeat=new Jn(1,1),this.center=new Jn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Zn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=Gn()),!t&&void 0===e.images[i.uuid]){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(si(i[e].image)):t.push(si(i[e]))}else t=si(i);e.images[i.uuid]={uuid:i.uuid,url:t}}n.image=i.uuid}return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==re)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case he:e.x=e.x-Math.floor(e.x);break;case de:e.x=e.x<0?0:1;break;case pe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case he:e.y=e.y-Math.floor(e.y);break;case de:e.y=e.y<0?0:1;break;case pe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function si(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?ri.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}oi.DEFAULT_IMAGE=void 0,oi.DEFAULT_MAPPING=re,oi.prototype.isTexture=!0;class li{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,r;const a=.01,o=.1,s=e.elements,l=s[0],u=s[4],c=s[8],h=s[1],d=s[5],p=s[9],f=s[2],m=s[6],g=s[10];if(Math.abs(u-h)<a&&Math.abs(c-f)<a&&Math.abs(p-m)<a){if(Math.abs(u+h)<o&&Math.abs(c+f)<o&&Math.abs(p+m)<o&&Math.abs(l+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,s=(d+1)/2,v=(g+1)/2,y=(u+h)/4,x=(c+f)/4,b=(p+m)/4;return e>s&&e>v?e<a?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(e),i=y/n,r=x/n):s>v?s<a?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(s),n=y/i,r=b/i):v<a?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(v),n=x/r,i=b/r),this.set(n,i,r,t),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(h-u)*(h-u));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(h-u)/v,this.w=Math.acos((l+d+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}li.prototype.isVector4=!0;class ui extends On{constructor(e,t,n={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new li(0,0,e,t),this.scissorTest=!1,this.viewport=new li(0,0,e,t),this.texture=new oi(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:xe,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}ui.prototype.isWebGLRenderTarget=!0;class ci extends ui{constructor(e,t,n){super(e,t);const i=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=i.clone()}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}ci.prototype.isWebGLMultipleRenderTargets=!0;class hi extends ui{constructor(e,t,n){super(e,t,n),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}hi.prototype.isWebGLMultisampleRenderTarget=!0;class di{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,r,a,o){let s=n[i+0],l=n[i+1],u=n[i+2],c=n[i+3];const h=r[a+0],d=r[a+1],p=r[a+2],f=r[a+3];if(0===o)return e[t+0]=s,e[t+1]=l,e[t+2]=u,void(e[t+3]=c);if(1===o)return e[t+0]=h,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(c!==f||s!==h||l!==d||u!==p){let e=1-o;const t=s*h+l*d+u*p+c*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const r=Math.sqrt(i),a=Math.atan2(r,t*n);e=Math.sin(e*a)/r,o=Math.sin(o*a)/r}const r=o*n;if(s=s*e+h*r,l=l*e+d*r,u=u*e+p*r,c=c*e+f*r,e===1-o){const e=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=e,l*=e,u*=e,c*=e}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}static multiplyQuaternionsFlat(e,t,n,i,r,a){const o=n[i],s=n[i+1],l=n[i+2],u=n[i+3],c=r[a],h=r[a+1],d=r[a+2],p=r[a+3];return e[t]=o*p+u*c+s*d-l*h,e[t+1]=s*p+u*h+l*c-o*d,e[t+2]=l*p+u*d+o*h-s*c,e[t+3]=u*p-o*c-s*h-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,r=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),u=o(i/2),c=o(r/2),h=s(n/2),d=s(i/2),p=s(r/2);switch(a){case"XYZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"YXZ":this._x=h*u*c+l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"ZXY":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c-h*d*p;break;case"ZYX":this._x=h*u*c-l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c+h*d*p;break;case"YZX":this._x=h*u*c+l*d*p,this._y=l*d*c+h*u*p,this._z=l*u*p-h*d*c,this._w=l*u*c-h*d*p;break;case"XZY":this._x=h*u*c-l*d*p,this._y=l*d*c-h*u*p,this._z=l*u*p+h*d*c,this._w=l*u*c+h*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],r=t[8],a=t[1],o=t[5],s=t[9],l=t[2],u=t[6],c=t[10],h=n+o+c;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(u-s)*e,this._y=(r-l)*e,this._z=(a-i)*e}else if(n>o&&n>c){const e=2*Math.sqrt(1+n-o-c);this._w=(u-s)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(r+l)/e}else if(o>c){const e=2*Math.sqrt(1+o-n-c);this._w=(r-l)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(s+u)/e}else{const e=2*Math.sqrt(1+c-n-o);this._w=(a-i)/e,this._x=(r+l)/e,this._y=(s+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(jn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+a*o+i*l-r*s,this._y=i*u+a*s+r*o-n*l,this._z=r*u+a*l+n*s-i*o,this._w=a*u-n*o-i*s-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,r=this._z,a=this._w;let o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;const s=1-o*o;if(s<=Number.EPSILON){const e=1-t;return this._w=e*a+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(s),u=Math.atan2(l,o),c=Math.sin((1-t)*u)/l,h=Math.sin(t*u)/l;return this._w=a*c+this._w*h,this._x=n*c+this._x*h,this._y=i*c+this._y*h,this._z=r*c+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(r),n*Math.cos(r),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}di.prototype.isQuaternion=!0;class pi{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(mi.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(mi.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*i-o*n,u=s*n+o*t-r*i,c=s*i+r*n-a*t,h=-r*t-a*n-o*i;return this.x=l*s+h*-r+u*-o-c*-a,this.y=u*s+h*-a+c*-r-l*-o,this.z=c*s+h*-o+l*-a-u*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return fi.copy(this).projectOnVector(e),this.sub(fi)}reflect(e){return this.sub(fi.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(jn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}pi.prototype.isVector3=!0;const fi=new pi,mi=new di;class gi{constructor(e=new pi(1/0,1/0,1/0),t=new pi(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0;for(let s=0,l=e.length;s<l;s+=3){const l=e[s],u=e[s+1],c=e[s+2];l<t&&(t=l),u<n&&(n=u),c<i&&(i=c),l>r&&(r=l),u>a&&(a=u),c>o&&(o=c)}return this.min.set(t,n,i),this.max.set(r,a,o),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,r=-1/0,a=-1/0,o=-1/0;for(let s=0,l=e.count;s<l;s++){const l=e.getX(s),u=e.getY(s),c=e.getZ(s);l<t&&(t=l),u<n&&(n=u),c<i&&(i=c),l>r&&(r=l),u>a&&(a=u),c>o&&(o=c)}return this.min.set(t,n,i),this.max.set(r,a,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=yi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),xi.copy(t.boundingBox),xi.applyMatrix4(e.matrixWorld),this.union(xi));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,yi),yi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Ei),Ai.subVectors(this.max,Ei),bi.subVectors(e.a,Ei),wi.subVectors(e.b,Ei),Mi.subVectors(e.c,Ei),_i.subVectors(wi,bi),Si.subVectors(Mi,wi),Ti.subVectors(bi,Mi);let t=[0,-_i.z,_i.y,0,-Si.z,Si.y,0,-Ti.z,Ti.y,_i.z,0,-_i.x,Si.z,0,-Si.x,Ti.z,0,-Ti.x,-_i.y,_i.x,0,-Si.y,Si.x,0,-Ti.y,Ti.x,0];return!!Li(t,bi,wi,Mi,Ai)&&(t=[1,0,0,0,1,0,0,0,1],!!Li(t,bi,wi,Mi,Ai)&&(Ci.crossVectors(_i,Si),t=[Ci.x,Ci.y,Ci.z],Li(t,bi,wi,Mi,Ai)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return yi.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(yi).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(vi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),vi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),vi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),vi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),vi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),vi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),vi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),vi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(vi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}gi.prototype.isBox3=!0;const vi=[new pi,new pi,new pi,new pi,new pi,new pi,new pi,new pi],yi=new pi,xi=new gi,bi=new pi,wi=new pi,Mi=new pi,_i=new pi,Si=new pi,Ti=new pi,Ei=new pi,Ai=new pi,Ci=new pi,Ri=new pi;function Li(e,t,n,i,r){for(let a=0,o=e.length-3;a<=o;a+=3){Ri.fromArray(e,a);const o=r.x*Math.abs(Ri.x)+r.y*Math.abs(Ri.y)+r.z*Math.abs(Ri.z),s=t.dot(Ri),l=n.dot(Ri),u=i.dot(Ri);if(Math.max(-Math.max(s,l,u),Math.min(s,l,u))>o)return!1}return!0}const Ii=new gi,Pi=new pi,Di=new pi,Ni=new pi;class ki{constructor(e=new pi,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Ii.setFromPoints(e).getCenter(n);let i=0;for(let t=0,r=e.length;t<r;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Ni.subVectors(e,this.center);const t=Ni.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(Ni.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return Di.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Pi.copy(e.center).add(Di)),this.expandByPoint(Pi.copy(e.center).sub(Di)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Oi=new pi,Ui=new pi,Fi=new pi,Bi=new pi,zi=new pi,Hi=new pi,Gi=new pi;class ji{constructor(e=new pi,t=new pi(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Oi)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Oi.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Oi.copy(this.direction).multiplyScalar(t).add(this.origin),Oi.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Ui.copy(e).add(t).multiplyScalar(.5),Fi.copy(t).sub(e).normalize(),Bi.copy(this.origin).sub(Ui);const r=.5*e.distanceTo(t),a=-this.direction.dot(Fi),o=Bi.dot(this.direction),s=-Bi.dot(Fi),l=Bi.lengthSq(),u=Math.abs(1-a*a);let c,h,d,p;if(u>0)if(c=a*s-o,h=a*o-s,p=r*u,c>=0)if(h>=-p)if(h<=p){const e=1/u;c*=e,h*=e,d=c*(c+a*h+2*o)+h*(a*c+h+2*s)+l}else h=r,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+l;else h=-r,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+l;else h<=-p?(c=Math.max(0,-(-a*r+o)),h=c>0?-r:Math.min(Math.max(-r,-s),r),d=-c*c+h*(h+2*s)+l):h<=p?(c=0,h=Math.min(Math.max(-r,-s),r),d=h*(h+2*s)+l):(c=Math.max(0,-(a*r+o)),h=c>0?r:Math.min(Math.max(-r,-s),r),d=-c*c+h*(h+2*s)+l);else h=a>0?-r:r,c=Math.max(0,-(a*h+o)),d=-c*c+h*(h+2*s)+l;return n&&n.copy(this.direction).multiplyScalar(c).add(this.origin),i&&i.copy(Fi).multiplyScalar(h).add(Ui),d}intersectSphere(e,t){Oi.subVectors(e.center,this.origin);const n=Oi.dot(this.direction),i=Oi.dot(Oi)-n*n,r=e.radius*e.radius;if(i>r)return null;const a=Math.sqrt(r-i),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,r,a,o,s;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,i=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,i=(e.min.x-h.x)*l),u>=0?(r=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(r=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),n>a||r>i?null:((r>n||n!=n)&&(n=r),(a<i||i!=i)&&(i=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>i?null:((o>n||n!=n)&&(n=o),(s<i||i!=i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,Oi)}intersectTriangle(e,t,n,i,r){zi.subVectors(t,e),Hi.subVectors(n,e),Gi.crossVectors(zi,Hi);let a,o=this.direction.dot(Gi);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Bi.subVectors(this.origin,e);const s=a*this.direction.dot(Hi.crossVectors(Bi,Hi));if(s<0)return null;const l=a*this.direction.dot(zi.cross(Bi));if(l<0)return null;if(s+l>o)return null;const u=-a*Bi.dot(Gi);return u<0?null:this.at(u/o,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Vi{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,r,a,o,s,l,u,c,h,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=a,g[9]=o,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=h,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Vi).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Wi.setFromMatrixColumn(e,0).length(),r=1/Wi.setFromMatrixColumn(e,1).length(),a=1/Wi.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*r,t[5]=n[5]*r,t[6]=n[6]*r,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),l=Math.sin(i),u=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){const e=a*u,n=a*c,i=o*u,r=o*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=n+i*l,t[5]=e-r*l,t[9]=-o*s,t[2]=r-e*l,t[6]=i+n*l,t[10]=a*s}else if("YXZ"===e.order){const e=s*u,n=s*c,i=l*u,r=l*c;t[0]=e+r*o,t[4]=i*o-n,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-o,t[2]=n*o-i,t[6]=r+e*o,t[10]=a*s}else if("ZXY"===e.order){const e=s*u,n=s*c,i=l*u,r=l*c;t[0]=e-r*o,t[4]=-a*c,t[8]=i+n*o,t[1]=n+i*o,t[5]=a*u,t[9]=r-e*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){const e=a*u,n=a*c,i=o*u,r=o*c;t[0]=s*u,t[4]=i*l-n,t[8]=e*l+r,t[1]=s*c,t[5]=r*l+e,t[9]=n*l-i,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){const e=a*s,n=a*l,i=o*s,r=o*l;t[0]=s*u,t[4]=r-e*c,t[8]=i*c+n,t[1]=c,t[5]=a*u,t[9]=-o*u,t[2]=-l*u,t[6]=n*c+i,t[10]=e-r*c}else if("XZY"===e.order){const e=a*s,n=a*l,i=o*s,r=o*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=e*c+r,t[5]=a*u,t[9]=n*c-i,t[2]=i*c-n,t[6]=o*u,t[10]=r*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Xi,e,Ki)}lookAt(e,t,n){const i=this.elements;return Zi.subVectors(e,t),0===Zi.lengthSq()&&(Zi.z=1),Zi.normalize(),Yi.crossVectors(n,Zi),0===Yi.lengthSq()&&(1===Math.abs(n.z)?Zi.x+=1e-4:Zi.z+=1e-4,Zi.normalize(),Yi.crossVectors(n,Zi)),Yi.normalize(),Ji.crossVectors(Zi,Yi),i[0]=Yi.x,i[4]=Ji.x,i[8]=Zi.x,i[1]=Yi.y,i[5]=Ji.y,i[9]=Zi.y,i[2]=Yi.z,i[6]=Ji.z,i[10]=Zi.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],x=n[11],b=n[15],w=i[0],M=i[4],_=i[8],S=i[12],T=i[1],E=i[5],A=i[9],C=i[13],R=i[2],L=i[6],I=i[10],P=i[14],D=i[3],N=i[7],k=i[11],O=i[15];return r[0]=a*w+o*T+s*R+l*D,r[4]=a*M+o*E+s*L+l*N,r[8]=a*_+o*A+s*I+l*k,r[12]=a*S+o*C+s*P+l*O,r[1]=u*w+c*T+h*R+d*D,r[5]=u*M+c*E+h*L+d*N,r[9]=u*_+c*A+h*I+d*k,r[13]=u*S+c*C+h*P+d*O,r[2]=p*w+f*T+m*R+g*D,r[6]=p*M+f*E+m*L+g*N,r[10]=p*_+f*A+m*I+g*k,r[14]=p*S+f*C+m*P+g*O,r[3]=v*w+y*T+x*R+b*D,r[7]=v*M+y*E+x*L+b*N,r[11]=v*_+y*A+x*I+b*k,r[15]=v*S+y*C+x*P+b*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],d=e[14];return e[3]*(+r*s*c-i*l*c-r*o*h+n*l*h+i*o*d-n*s*d)+e[7]*(+t*s*d-t*l*h+r*a*h-i*a*d+i*l*u-r*s*u)+e[11]*(+t*l*c-t*o*d-r*a*c+n*a*d+r*o*u-n*l*u)+e[15]*(-i*o*u-t*s*c+t*o*h+i*a*c-n*a*h+n*s*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=c*m*l-f*h*l+f*s*d-o*m*d-c*s*g+o*h*g,y=p*h*l-u*m*l-p*s*d+a*m*d+u*s*g-a*h*g,x=u*f*l-p*c*l+p*o*d-a*f*d-u*o*g+a*c*g,b=p*c*s-u*f*s-p*o*h+a*f*h+u*o*m-a*c*m,w=t*v+n*y+i*x+r*b;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/w;return e[0]=v*M,e[1]=(f*h*r-c*m*r-f*i*d+n*m*d+c*i*g-n*h*g)*M,e[2]=(o*m*r-f*s*r+f*i*l-n*m*l-o*i*g+n*s*g)*M,e[3]=(c*s*r-o*h*r-c*i*l+n*h*l+o*i*d-n*s*d)*M,e[4]=y*M,e[5]=(u*m*r-p*h*r+p*i*d-t*m*d-u*i*g+t*h*g)*M,e[6]=(p*s*r-a*m*r-p*i*l+t*m*l+a*i*g-t*s*g)*M,e[7]=(a*h*r-u*s*r+u*i*l-t*h*l-a*i*d+t*s*d)*M,e[8]=x*M,e[9]=(p*c*r-u*f*r-p*n*d+t*f*d+u*n*g-t*c*g)*M,e[10]=(a*f*r-p*o*r+p*n*l-t*f*l-a*n*g+t*o*g)*M,e[11]=(u*o*r-a*c*r-u*n*l+t*c*l+a*n*d-t*o*d)*M,e[12]=b*M,e[13]=(u*f*i-p*c*i+p*n*h-t*f*h-u*n*m+t*c*m)*M,e[14]=(p*o*i-a*f*i-p*n*s+t*f*s+a*n*m-t*o*m)*M,e[15]=(a*c*i-u*o*i+u*n*s-t*c*s-a*n*h+t*o*h)*M,this}scale(e){const t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,l=r*a,u=r*o;return this.set(l*a+n,l*o-i*s,l*s+i*o,0,l*o+i*s,u*o+n,u*s-i*a,0,l*s-i*o,u*s+i*a,r*s*s+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,r,a){return this.set(1,n,r,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,r=t._x,a=t._y,o=t._z,s=t._w,l=r+r,u=a+a,c=o+o,h=r*l,d=r*u,p=r*c,f=a*u,m=a*c,g=o*c,v=s*l,y=s*u,x=s*c,b=n.x,w=n.y,M=n.z;return i[0]=(1-(f+g))*b,i[1]=(d+x)*b,i[2]=(p-y)*b,i[3]=0,i[4]=(d-x)*w,i[5]=(1-(h+g))*w,i[6]=(m+v)*w,i[7]=0,i[8]=(p+y)*M,i[9]=(m-v)*M,i[10]=(1-(h+f))*M,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let r=Wi.set(i[0],i[1],i[2]).length();const a=Wi.set(i[4],i[5],i[6]).length(),o=Wi.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),e.x=i[12],e.y=i[13],e.z=i[14],qi.copy(this);const s=1/r,l=1/a,u=1/o;return qi.elements[0]*=s,qi.elements[1]*=s,qi.elements[2]*=s,qi.elements[4]*=l,qi.elements[5]*=l,qi.elements[6]*=l,qi.elements[8]*=u,qi.elements[9]*=u,qi.elements[10]*=u,t.setFromRotationMatrix(qi),n.x=r,n.y=a,n.z=o,this}makePerspective(e,t,n,i,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,s=2*r/(t-e),l=2*r/(n-i),u=(t+e)/(t-e),c=(n+i)/(n-i),h=-(a+r)/(a-r),d=-2*a*r/(a-r);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,i,r,a){const o=this.elements,s=1/(t-e),l=1/(n-i),u=1/(a-r),c=(t+e)*s,h=(n+i)*l,d=(a+r)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}Vi.prototype.isMatrix4=!0;const Wi=new pi,qi=new Vi,Xi=new pi(0,0,0),Ki=new pi(1,1,1),Yi=new pi,Ji=new pi,Zi=new pi,$i=new Vi,Qi=new di;class er{constructor(e=0,t=0,n=0,i=er.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,r=i[0],a=i[4],o=i[8],s=i[1],l=i[5],u=i[9],c=i[2],h=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(jn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-jn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(s,l)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(jn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(s,r));break;case"ZYX":this._y=Math.asin(-jn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(s,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(jn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-jn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return $i.makeRotationFromQuaternion(e),this.setFromRotationMatrix($i,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Qi.setFromEuler(this),this.setFromQuaternion(Qi,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new pi(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}er.prototype.isEuler=!0,er.DefaultOrder="XYZ",er.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class tr{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let nr=0;const ir=new pi,rr=new di,ar=new Vi,or=new pi,sr=new pi,lr=new pi,ur=new di,cr=new pi(1,0,0),hr=new pi(0,1,0),dr=new pi(0,0,1),pr={type:"added"},fr={type:"removed"};class mr extends On{constructor(){super(),Object.defineProperty(this,"id",{value:nr++}),this.uuid=Gn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=mr.DefaultUp.clone();const e=new pi,t=new er,n=new di,i=new pi(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Vi},normalMatrix:{value:new Zn}}),this.matrix=new Vi,this.matrixWorld=new Vi,this.matrixAutoUpdate=mr.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new tr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return rr.setFromAxisAngle(e,t),this.quaternion.multiply(rr),this}rotateOnWorldAxis(e,t){return rr.setFromAxisAngle(e,t),this.quaternion.premultiply(rr),this}rotateX(e){return this.rotateOnAxis(cr,e)}rotateY(e){return this.rotateOnAxis(hr,e)}rotateZ(e){return this.rotateOnAxis(dr,e)}translateOnAxis(e,t){return ir.copy(e).applyQuaternion(this.quaternion),this.position.add(ir.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(cr,e)}translateY(e){return this.translateOnAxis(hr,e)}translateZ(e){return this.translateOnAxis(dr,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(ar.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?or.copy(e):or.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),sr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ar.lookAt(sr,or,this.up):ar.lookAt(or,sr,this.up),this.quaternion.setFromRotationMatrix(ar),i&&(ar.extractRotation(i.matrixWorld),rr.setFromRotationMatrix(ar),this.quaternion.premultiply(rr.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(pr)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(fr)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(fr)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),ar.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ar.multiply(e.parent.matrixWorld)),e.applyMatrix4(ar),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(sr,e,lr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(sr,ur,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];r(e.shapes,i)}else r(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(r(e.materials,this.material[n]));i.material=t}else i.material=r(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(r(e.animations,n))}}if(t){const t=a(e.geometries),i=a(e.materials),r=a(e.textures),o=a(e.images),s=a(e.shapes),l=a(e.skeletons),u=a(e.animations);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),s.length>0&&(n.shapes=s),l.length>0&&(n.skeletons=l),u.length>0&&(n.animations=u)}return n.object=i,n;function a(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}mr.DefaultUp=new pi(0,1,0),mr.DefaultMatrixAutoUpdate=!0,mr.prototype.isObject3D=!0;const gr=new pi,vr=new pi,yr=new pi,xr=new pi,br=new pi,wr=new pi,Mr=new pi,_r=new pi,Sr=new pi,Tr=new pi;class Er{constructor(e=new pi,t=new pi,n=new pi){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),gr.subVectors(e,t),i.cross(gr);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(e,t,n,i,r){gr.subVectors(i,t),vr.subVectors(n,t),yr.subVectors(e,t);const a=gr.dot(gr),o=gr.dot(vr),s=gr.dot(yr),l=vr.dot(vr),u=vr.dot(yr),c=a*l-o*o;if(0===c)return r.set(-2,-1,-1);const h=1/c,d=(l*s-o*u)*h,p=(a*u-o*s)*h;return r.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,xr),xr.x>=0&&xr.y>=0&&xr.x+xr.y<=1}static getUV(e,t,n,i,r,a,o,s){return this.getBarycoord(e,t,n,i,xr),s.set(0,0),s.addScaledVector(r,xr.x),s.addScaledVector(a,xr.y),s.addScaledVector(o,xr.z),s}static isFrontFacing(e,t,n,i){return gr.subVectors(n,t),vr.subVectors(e,t),gr.cross(vr).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return gr.subVectors(this.c,this.b),vr.subVectors(this.a,this.b),.5*gr.cross(vr).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Er.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Er.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,r){return Er.getUV(e,this.a,this.b,this.c,t,n,i,r)}containsPoint(e){return Er.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Er.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,r=this.c;let a,o;br.subVectors(i,n),wr.subVectors(r,n),_r.subVectors(e,n);const s=br.dot(_r),l=wr.dot(_r);if(s<=0&&l<=0)return t.copy(n);Sr.subVectors(e,i);const u=br.dot(Sr),c=wr.dot(Sr);if(u>=0&&c<=u)return t.copy(i);const h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return a=s/(s-u),t.copy(n).addScaledVector(br,a);Tr.subVectors(e,r);const d=br.dot(Tr),p=wr.dot(Tr);if(p>=0&&d<=p)return t.copy(r);const f=d*l-s*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(n).addScaledVector(wr,o);const m=u*p-d*c;if(m<=0&&c-u>=0&&d-p>=0)return Mr.subVectors(r,i),o=(c-u)/(c-u+(d-p)),t.copy(i).addScaledVector(Mr,o);const g=1/(m+f+h);return a=f*g,o=h*g,t.copy(n).addScaledVector(br,a).addScaledVector(wr,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let Ar=0;class Cr extends On{constructor(){super(),Object.defineProperty(this,"id",{value:Ar++}),this.uuid=Gn(),this.name="",this.type="Material",this.fog=!0,this.blending=b,this.side=f,this.vertexColors=!1,this.opacity=1,this.format=Fe,this.transparent=!1,this.blendSrc=N,this.blendDst=k,this.blendEquation=T,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=V,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Sn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=cn,this.stencilZFail=cn,this.stencilZPass=cn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===v;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==b&&(n.blending=this.blending),this.side!==f&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.format!==Fe&&(n.format=this.format),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),r=i(e.images);t.length>0&&(n.textures=t),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Cr.prototype.isMaterial=!0;const Rr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Lr={h:0,s:0,l:0},Ir={h:0,s:0,l:0};function Pr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Dr(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Nr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class kr{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Vn(e,1),t=jn(t,0,1),n=jn(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,r=2*n-i;this.r=Pr(r,i,e+1/3),this.g=Pr(r,i,e),this.b=Pr(r,i,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const i=n[1],r=n[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const n=parseFloat(e[1])/360,i=parseInt(e[2],10)/100,r=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,i,r)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Rr[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=Dr(e.r),this.g=Dr(e.g),this.b=Dr(e.b),this}copyLinearToSRGB(e){return this.r=Nr(e.r),this.g=Nr(e.g),this.b=Nr(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,n=this.g,i=this.b,r=Math.max(t,n,i),a=Math.min(t,n,i);let o,s;const l=(a+r)/2;if(a===r)o=0,s=0;else{const e=r-a;switch(s=l<=.5?e/(r+a):e/(2-r-a),r){case t:o=(n-i)/e+(n<i?6:0);break;case n:o=(i-t)/e+2;break;case i:o=(t-n)/e+4}o/=6}return e.h=o,e.s=s,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(Lr),Lr.h+=e,Lr.s+=t,Lr.l+=n,this.setHSL(Lr.h,Lr.s,Lr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Lr),e.getHSL(Ir);const n=Wn(Lr.h,Ir.h,t),i=Wn(Lr.s,Ir.s,t),r=Wn(Lr.l,Ir.l,t);return this.setHSL(n,i,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}kr.NAMES=Rr,kr.prototype.isColor=!0,kr.prototype.r=1,kr.prototype.g=1,kr.prototype.b=1;class Or extends Cr{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new kr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Or.prototype.isMeshBasicMaterial=!0;const Ur=new pi,Fr=new Jn;class Br{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=Tn,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new kr),t[n++]=r.r,t[n++]=r.g,t[n++]=r.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new Jn),t[n++]=r.x,t[n++]=r.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new pi),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let i=0,r=e.length;i<r;i++){let r=e[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new li),t[n++]=r.x,t[n++]=r.y,t[n++]=r.z,t[n++]=r.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Fr.fromBufferAttribute(this,t),Fr.applyMatrix3(e),this.setXY(t,Fr.x,Fr.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Ur.fromBufferAttribute(this,t),Ur.applyMatrix3(e),this.setXYZ(t,Ur.x,Ur.y,Ur.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ur.x=this.getX(t),Ur.y=this.getY(t),Ur.z=this.getZ(t),Ur.applyMatrix4(e),this.setXYZ(t,Ur.x,Ur.y,Ur.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ur.x=this.getX(t),Ur.y=this.getY(t),Ur.z=this.getZ(t),Ur.applyNormalMatrix(e),this.setXYZ(t,Ur.x,Ur.y,Ur.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ur.x=this.getX(t),Ur.y=this.getY(t),Ur.z=this.getZ(t),Ur.transformDirection(e),this.setXYZ(t,Ur.x,Ur.y,Ur.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Tn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}Br.prototype.isBufferAttribute=!0;class zr extends Br{constructor(e,t,n){super(new Int8Array(e),t,n)}}class Hr extends Br{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class Gr extends Br{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class jr extends Br{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Vr extends Br{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Wr extends Br{constructor(e,t,n){super(new Int32Array(e),t,n)}}class qr extends Br{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Xr extends Br{constructor(e,t,n){super(new Uint16Array(e),t,n)}}Xr.prototype.isFloat16BufferAttribute=!0;class Kr extends Br{constructor(e,t,n){super(new Float32Array(e),t,n)}}class Yr extends Br{constructor(e,t,n){super(new Float64Array(e),t,n)}}let Jr=0;const Zr=new Vi,$r=new mr,Qr=new pi,ea=new gi,ta=new gi,na=new pi;class ia extends On{constructor(){super(),Object.defineProperty(this,"id",{value:Jr++}),this.uuid=Gn(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new($n(e)>65535?qr:Vr)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Zn).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Zr.makeRotationFromQuaternion(e),this.applyMatrix4(Zr),this}rotateX(e){return Zr.makeRotationX(e),this.applyMatrix4(Zr),this}rotateY(e){return Zr.makeRotationY(e),this.applyMatrix4(Zr),this}rotateZ(e){return Zr.makeRotationZ(e),this.applyMatrix4(Zr),this}translate(e,t,n){return Zr.makeTranslation(e,t,n),this.applyMatrix4(Zr),this}scale(e,t,n){return Zr.makeScale(e,t,n),this.applyMatrix4(Zr),this}lookAt(e){return $r.lookAt(e),$r.updateMatrix(),this.applyMatrix4($r.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Qr).negate(),this.translate(Qr.x,Qr.y,Qr.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Kr(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new gi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new pi(-1/0,-1/0,-1/0),new pi(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];ea.setFromBufferAttribute(n),this.morphTargetsRelative?(na.addVectors(this.boundingBox.min,ea.min),this.boundingBox.expandByPoint(na),na.addVectors(this.boundingBox.max,ea.max),this.boundingBox.expandByPoint(na)):(this.boundingBox.expandByPoint(ea.min),this.boundingBox.expandByPoint(ea.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ki);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new pi,1/0);if(e){const n=this.boundingSphere.center;if(ea.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];ta.setFromBufferAttribute(n),this.morphTargetsRelative?(na.addVectors(ea.min,ta.min),ea.expandByPoint(na),na.addVectors(ea.max,ta.max),ea.expandByPoint(na)):(ea.expandByPoint(ta.min),ea.expandByPoint(ta.max))}ea.getCenter(n);let i=0;for(let t=0,r=e.count;t<r;t++)na.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(na));if(t)for(let r=0,a=t.length;r<a;r++){const a=t[r],o=this.morphTargetsRelative;for(let t=0,r=a.count;t<r;t++)na.fromBufferAttribute(a,t),o&&(Qr.fromBufferAttribute(e,t),na.add(Qr)),i=Math.max(i,n.distanceToSquared(na))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,r=t.normal.array,a=t.uv.array,o=i.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Br(new Float32Array(4*o),4));const s=t.tangent.array,l=[],u=[];for(let e=0;e<o;e++)l[e]=new pi,u[e]=new pi;const c=new pi,h=new pi,d=new pi,p=new Jn,f=new Jn,m=new Jn,g=new pi,v=new pi;function y(e,t,n){c.fromArray(i,3*e),h.fromArray(i,3*t),d.fromArray(i,3*n),p.fromArray(a,2*e),f.fromArray(a,2*t),m.fromArray(a,2*n),h.sub(c),d.sub(c),f.sub(p),m.sub(p);const r=1/(f.x*m.y-m.x*f.y);isFinite(r)&&(g.copy(h).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(r),v.copy(d).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[n].add(g),u[e].add(v),u[t].add(v),u[n].add(v))}let x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(let e=0,t=x.length;e<t;++e){const t=x[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)y(n[e+0],n[e+1],n[e+2])}const b=new pi,w=new pi,M=new pi,_=new pi;function S(e){M.fromArray(r,3*e),_.copy(M);const t=l[e];b.copy(t),b.sub(M.multiplyScalar(M.dot(t))).normalize(),w.crossVectors(_,t);const n=w.dot(u[e])<0?-1:1;s[4*e]=b.x,s[4*e+1]=b.y,s[4*e+2]=b.z,s[4*e+3]=n}for(let e=0,t=x.length;e<t;++e){const t=x[e],i=t.start;for(let e=i,r=i+t.count;e<r;e+=3)S(n[e+0]),S(n[e+1]),S(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Br(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new pi,r=new pi,a=new pi,o=new pi,s=new pi,l=new pi,u=new pi,c=new pi;if(e)for(let h=0,d=e.count;h<d;h+=3){const d=e.getX(h+0),p=e.getX(h+1),f=e.getX(h+2);i.fromBufferAttribute(t,d),r.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),u.subVectors(a,r),c.subVectors(i,r),u.cross(c),o.fromBufferAttribute(n,d),s.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(u),s.add(u),l.add(u),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,s.x,s.y,s.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)i.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),u.subVectors(a,r),c.subVectors(i,r),u.cross(c),n.setXYZ(e+0,u.x,u.y,u.z),n.setXYZ(e+1,u.x,u.y,u.z),n.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const r=n[i].array,a=e.attributes[i],o=a.array,s=a.itemSize*t,l=Math.min(o.length,r.length-s);for(let e=0,t=s;e<l;e++,t++)r[t]=o[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)na.fromBufferAttribute(e,t),na.normalize(),e.setXYZ(t,na.x,na.y,na.z)}toNonIndexed(){function e(e,t){const n=e.array,i=e.itemSize,r=e.normalized,a=new n.constructor(t.length*i);let o=0,s=0;for(let r=0,l=t.length;r<l;r++){o=e.isInterleavedBufferAttribute?t[r]*e.data.stride+e.offset:t[r]*i;for(let e=0;e<i;e++)a[s++]=n[o++]}return new Br(a,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ia,n=this.index.array,i=this.attributes;for(const r in i){const a=e(i[r],n);t.setAttribute(r,a)}const r=this.morphAttributes;for(const i in r){const a=[],o=r[i];for(let t=0,i=o.length;t<i;t++){const i=e(o[t],n);a.push(i)}t.morphAttributes[i]=a}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let e=0,n=a.length;e<n;e++){const n=a[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let r=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],a=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];a.push(i.toJSON(e.data))}a.length>0&&(i[t]=a,r=!0)}r&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const r=e.morphAttributes;for(const e in r){const n=[],i=r[e];for(let e=0,r=i.length;e<r;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let e=0,t=a.length;e<t;e++){const t=a[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const s=e.boundingSphere;return null!==s&&(this.boundingSphere=s.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}ia.prototype.isBufferGeometry=!0;const ra=new Vi,aa=new ji,oa=new ki,sa=new pi,la=new pi,ua=new pi,ca=new pi,ha=new pi,da=new pi,pa=new pi,fa=new pi,ma=new pi,ga=new Jn,va=new Jn,ya=new Jn,xa=new pi,ba=new pi;class wa extends mr{constructor(e=new ia,t=new Or){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),oa.copy(n.boundingSphere),oa.applyMatrix4(r),!1===e.ray.intersectsSphere(oa))return;if(ra.copy(r).invert(),aa.copy(e.ray).applyMatrix4(ra),null!==n.boundingBox&&!1===aa.intersectsBox(n.boundingBox))return;let a;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position,s=n.morphAttributes.position,l=n.morphTargetsRelative,u=n.attributes.uv,c=n.attributes.uv2,h=n.groups,d=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,p=h.length;n<p;n++){const p=h[n],f=i[p.materialIndex];for(let n=Math.max(p.start,d.start),i=Math.min(r.count,Math.min(p.start+p.count,d.start+d.count));n<i;n+=3){const i=r.getX(n),h=r.getX(n+1),d=r.getX(n+2);a=Ma(this,f,e,aa,o,s,l,u,c,i,h,d),a&&(a.faceIndex=Math.floor(n/3),a.face.materialIndex=p.materialIndex,t.push(a))}}else for(let n=Math.max(0,d.start),h=Math.min(r.count,d.start+d.count);n<h;n+=3){const h=r.getX(n),d=r.getX(n+1),p=r.getX(n+2);a=Ma(this,i,e,aa,o,s,l,u,c,h,d,p),a&&(a.faceIndex=Math.floor(n/3),t.push(a))}else if(void 0!==o)if(Array.isArray(i))for(let n=0,r=h.length;n<r;n++){const r=h[n],p=i[r.materialIndex];for(let n=Math.max(r.start,d.start),i=Math.min(o.count,Math.min(r.start+r.count,d.start+d.count));n<i;n+=3)a=Ma(this,p,e,aa,o,s,l,u,c,n,n+1,n+2),a&&(a.faceIndex=Math.floor(n/3),a.face.materialIndex=r.materialIndex,t.push(a))}else for(let n=Math.max(0,d.start),r=Math.min(o.count,d.start+d.count);n<r;n+=3)a=Ma(this,i,e,aa,o,s,l,u,c,n,n+1,n+2),a&&(a.faceIndex=Math.floor(n/3),t.push(a))}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Ma(e,t,n,i,r,a,o,s,l,u,c,h){sa.fromBufferAttribute(r,u),la.fromBufferAttribute(r,c),ua.fromBufferAttribute(r,h);const d=e.morphTargetInfluences;if(a&&d){pa.set(0,0,0),fa.set(0,0,0),ma.set(0,0,0);for(let e=0,t=a.length;e<t;e++){const t=d[e],n=a[e];0!==t&&(ca.fromBufferAttribute(n,u),ha.fromBufferAttribute(n,c),da.fromBufferAttribute(n,h),o?(pa.addScaledVector(ca,t),fa.addScaledVector(ha,t),ma.addScaledVector(da,t)):(pa.addScaledVector(ca.sub(sa),t),fa.addScaledVector(ha.sub(la),t),ma.addScaledVector(da.sub(ua),t)))}sa.add(pa),la.add(fa),ua.add(ma)}e.isSkinnedMesh&&(e.boneTransform(u,sa),e.boneTransform(c,la),e.boneTransform(h,ua));const p=function(e,t,n,i,r,a,o,s){let l;if(l=t.side===m?i.intersectTriangle(o,a,r,!0,s):i.intersectTriangle(r,a,o,t.side!==g,s),null===l)return null;ba.copy(s),ba.applyMatrix4(e.matrixWorld);const u=n.ray.origin.distanceTo(ba);return u<n.near||u>n.far?null:{distance:u,point:ba.clone(),object:e}}(e,t,n,i,sa,la,ua,xa);if(p){s&&(ga.fromBufferAttribute(s,u),va.fromBufferAttribute(s,c),ya.fromBufferAttribute(s,h),p.uv=Er.getUV(xa,sa,la,ua,ga,va,ya,new Jn)),l&&(ga.fromBufferAttribute(l,u),va.fromBufferAttribute(l,c),ya.fromBufferAttribute(l,h),p.uv2=Er.getUV(xa,sa,la,ua,ga,va,ya,new Jn));const e={a:u,b:c,c:h,normal:new pi,materialIndex:0};Er.getNormal(sa,la,ua,e.normal),p.face=e}return p}wa.prototype.isMesh=!0;class _a extends ia{constructor(e=1,t=1,n=1,i=1,r=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};const o=this;i=Math.floor(i),r=Math.floor(r),a=Math.floor(a);const s=[],l=[],u=[],c=[];let h=0,d=0;function p(e,t,n,i,r,a,p,f,m,g,v){const y=a/m,x=p/g,b=a/2,w=p/2,M=f/2,_=m+1,S=g+1;let T=0,E=0;const A=new pi;for(let a=0;a<S;a++){const o=a*x-w;for(let s=0;s<_;s++){const h=s*y-b;A[e]=h*i,A[t]=o*r,A[n]=M,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,u.push(A.x,A.y,A.z),c.push(s/m),c.push(1-a/g),T+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=h+t+_*e,i=h+t+_*(e+1),r=h+(t+1)+_*(e+1),a=h+(t+1)+_*e;s.push(n,i,a),s.push(i,r,a),E+=6}o.addGroup(d,E,v),d+=E,h+=T}p("z","y","x",-1,-1,n,t,e,a,r,0),p("z","y","x",1,-1,n,t,-e,a,r,1),p("x","z","y",1,1,e,n,t,i,a,2),p("x","z","y",1,-1,e,n,-t,i,a,3),p("x","y","z",1,-1,e,t,n,i,r,4),p("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(s),this.setAttribute("position",new Kr(l,3)),this.setAttribute("normal",new Kr(u,3)),this.setAttribute("uv",new Kr(c,2))}static fromJSON(e){return new _a(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Sa(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}function Ta(e){const t={};for(let n=0;n<e.length;n++){const i=Sa(e[n]);for(const e in i)t[e]=i[e]}return t}const Ea={clone:Sa,merge:Ta};class Aa extends Cr{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Sa(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}Aa.prototype.isShaderMaterial=!0;class Ca extends mr{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Vi,this.projectionMatrix=new Vi,this.projectionMatrixInverse=new Vi}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Ca.prototype.isCamera=!0;class Ra extends Ca{constructor(e=50,t=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Bn*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Fn*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Bn*Math.atan(Math.tan(.5*Fn*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Fn*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i;const a=this.view;if(null!==this.view&&this.view.enabled){const e=a.fullWidth,o=a.fullHeight;r+=a.offsetX*i/e,t-=a.offsetY*n/o,i*=a.width/e,n*=a.height/o}const o=this.filmOffset;0!==o&&(r+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Ra.prototype.isPerspectiveCamera=!0;const La=90;class Ia extends mr{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new Ra(La,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new pi(1,0,0)),this.add(i);const r=new Ra(La,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new pi(-1,0,0)),this.add(r);const a=new Ra(La,1,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new pi(0,1,0)),this.add(a);const o=new Ra(La,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new pi(0,-1,0)),this.add(o);const s=new Ra(La,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new pi(0,0,1)),this.add(s);const l=new Ra(La,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new pi(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,a,o,s,l]=this.children,u=e.xr.enabled,c=e.getRenderTarget();e.xr.enabled=!1;const h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,r),e.setRenderTarget(n,2),e.render(t,a),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.xr.enabled=u}}class Pa extends oi{constructor(e,t,n,i,r,a,o,s,l,u){super(e=void 0!==e?e:[],t=void 0!==t?t:ae,n,i,r,a,o,s,l,u),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Pa.prototype.isCubeTexture=!0;class Da extends ui{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),t=t||{},this.texture=new Pa(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:xe,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Fe,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={tEquirect:{value:null}},i="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new _a(5,5,5),o=new Aa({name:"CubemapFromEquirect",uniforms:Sa(n),vertexShader:i,fragmentShader:r,side:m,blending:x});o.uniforms.tEquirect.value=t;const s=new wa(a,o),l=t.minFilter;return t.minFilter===Me&&(t.minFilter=xe),new Ia(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,i){const r=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(r)}}Da.prototype.isWebGLCubeRenderTarget=!0;const Na=new pi,ka=new pi,Oa=new Zn;class Ua{constructor(e=new pi(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Na.subVectors(n,t).cross(ka.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(Na),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const r=-(e.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:t.copy(n).multiplyScalar(r).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Oa.getNormalMatrix(e),i=this.coplanarPoint(Na).applyMatrix4(e),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Ua.prototype.isPlane=!0;const Fa=new ki,Ba=new pi;class za{constructor(e=new Ua,t=new Ua,n=new Ua,i=new Ua,r=new Ua,a=new Ua){this.planes=[e,t,n,i,r,a]}set(e,t,n,i,r,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],l=n[5],u=n[6],c=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(o-i,c-s,f-h,y-m).normalize(),t[1].setComponents(o+i,c+s,f+h,y+m).normalize(),t[2].setComponents(o+r,c+l,f+d,y+g).normalize(),t[3].setComponents(o-r,c-l,f-d,y-g).normalize(),t[4].setComponents(o-a,c-u,f-p,y-v).normalize(),t[5].setComponents(o+a,c+u,f+p,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Fa.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Fa)}intersectsSprite(e){return Fa.center.set(0,0,0),Fa.radius=.7071067811865476,Fa.applyMatrix4(e.matrixWorld),this.intersectsSphere(Fa)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++)if(t[e].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Ba.x=i.normal.x>0?e.max.x:e.min.x,Ba.y=i.normal.y>0?e.max.y:e.min.y,Ba.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Ba)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Ha(){let e=null,t=!1,n=null,i=null;function r(t,a){n(t,a),i=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Ga(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const a=i.get(t);void 0===a?i.set(t,function(t,i){const r=t.array,a=t.usage,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,r,a),t.onUploadCallback();let s=5126;return r instanceof Float32Array?s=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:r instanceof Int16Array?s=5122:r instanceof Uint32Array?s=5125:r instanceof Int32Array?s=5124:r instanceof Int8Array?s=5120:(r instanceof Uint8Array||r instanceof Uint8ClampedArray)&&(s=5121),{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,r)):a.version<t.version&&(function(t,i,r){const a=i.array,o=i.updateRange;e.bindBuffer(r,t),-1===o.count?e.bufferSubData(r,0,a):(n?e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(r,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(a.buffer,t,r),a.version=t.version)}}}class ja extends ia{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const r=e/2,a=t/2,o=Math.floor(n),s=Math.floor(i),l=o+1,u=s+1,c=e/o,h=t/s,d=[],p=[],f=[],m=[];for(let e=0;e<u;e++){const t=e*h-a;for(let n=0;n<l;n++){const i=n*c-r;p.push(i,-t,0),f.push(0,0,1),m.push(n/o),m.push(1-e/s)}}for(let e=0;e<s;e++)for(let t=0;t<o;t++){const n=t+l*e,i=t+l*(e+1),r=t+1+l*(e+1),a=t+1+l*e;d.push(n,i,a),d.push(i,r,a)}this.setIndex(d),this.setAttribute("position",new Kr(p,3)),this.setAttribute("normal",new Kr(f,3)),this.setAttribute("uv",new Kr(m,2))}static fromJSON(e){return new ja(e.width,e.height,e.widthSegments,e.heightSegments)}}const Va={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Wa={common:{diffuse:{value:new kr(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Zn},uv2Transform:{value:new Zn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Jn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new kr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new kr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Zn}},sprite:{diffuse:{value:new kr(16777215)},opacity:{value:1},center:{value:new Jn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Zn}}},qa={basic:{uniforms:Ta([Wa.common,Wa.specularmap,Wa.envmap,Wa.aomap,Wa.lightmap,Wa.fog]),vertexShader:Va.meshbasic_vert,fragmentShader:Va.meshbasic_frag},lambert:{uniforms:Ta([Wa.common,Wa.specularmap,Wa.envmap,Wa.aomap,Wa.lightmap,Wa.emissivemap,Wa.fog,Wa.lights,{emissive:{value:new kr(0)}}]),vertexShader:Va.meshlambert_vert,fragmentShader:Va.meshlambert_frag},phong:{uniforms:Ta([Wa.common,Wa.specularmap,Wa.envmap,Wa.aomap,Wa.lightmap,Wa.emissivemap,Wa.bumpmap,Wa.normalmap,Wa.displacementmap,Wa.fog,Wa.lights,{emissive:{value:new kr(0)},specular:{value:new kr(1118481)},shininess:{value:30}}]),vertexShader:Va.meshphong_vert,fragmentShader:Va.meshphong_frag},standard:{uniforms:Ta([Wa.common,Wa.envmap,Wa.aomap,Wa.lightmap,Wa.emissivemap,Wa.bumpmap,Wa.normalmap,Wa.displacementmap,Wa.roughnessmap,Wa.metalnessmap,Wa.fog,Wa.lights,{emissive:{value:new kr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Va.meshphysical_vert,fragmentShader:Va.meshphysical_frag},toon:{uniforms:Ta([Wa.common,Wa.aomap,Wa.lightmap,Wa.emissivemap,Wa.bumpmap,Wa.normalmap,Wa.displacementmap,Wa.gradientmap,Wa.fog,Wa.lights,{emissive:{value:new kr(0)}}]),vertexShader:Va.meshtoon_vert,fragmentShader:Va.meshtoon_frag},matcap:{uniforms:Ta([Wa.common,Wa.bumpmap,Wa.normalmap,Wa.displacementmap,Wa.fog,{matcap:{value:null}}]),vertexShader:Va.meshmatcap_vert,fragmentShader:Va.meshmatcap_frag},points:{uniforms:Ta([Wa.points,Wa.fog]),vertexShader:Va.points_vert,fragmentShader:Va.points_frag},dashed:{uniforms:Ta([Wa.common,Wa.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Va.linedashed_vert,fragmentShader:Va.linedashed_frag},depth:{uniforms:Ta([Wa.common,Wa.displacementmap]),vertexShader:Va.depth_vert,fragmentShader:Va.depth_frag},normal:{uniforms:Ta([Wa.common,Wa.bumpmap,Wa.normalmap,Wa.displacementmap,{opacity:{value:1}}]),vertexShader:Va.meshnormal_vert,fragmentShader:Va.meshnormal_frag},sprite:{uniforms:Ta([Wa.sprite,Wa.fog]),vertexShader:Va.sprite_vert,fragmentShader:Va.sprite_frag},background:{uniforms:{uvTransform:{value:new Zn},t2D:{value:null}},vertexShader:Va.background_vert,fragmentShader:Va.background_frag},cube:{uniforms:Ta([Wa.envmap,{opacity:{value:1}}]),vertexShader:Va.cube_vert,fragmentShader:Va.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Va.equirect_vert,fragmentShader:Va.equirect_frag},distanceRGBA:{uniforms:Ta([Wa.common,Wa.displacementmap,{referencePosition:{value:new pi},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Va.distanceRGBA_vert,fragmentShader:Va.distanceRGBA_frag},shadow:{uniforms:Ta([Wa.lights,Wa.fog,{color:{value:new kr(0)},opacity:{value:1}}]),vertexShader:Va.shadow_vert,fragmentShader:Va.shadow_frag}};function Xa(e,t,n,i,r){const a=new kr(0);let o,s,l=0,u=null,c=0,h=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,r)}return{getClearColor:function(){return a},setClearColor:function(e,t=1){a.set(e),l=t,d(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,d(a,l)},render:function(n,r){let p=!1,g=!0===r.isScene?r.background:null;g&&g.isTexture&&(g=t.get(g));const v=e.xr,y=v.getSession&&v.getSession();y&&"additive"===y.environmentBlendMode&&(g=null),null===g?d(a,l):g&&g.isColor&&(d(g,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===ue)?(void 0===s&&(s=new wa(new _a(1,1,1),new Aa({name:"BackgroundCubeMaterial",uniforms:Sa(qa.cube.uniforms),vertexShader:qa.cube.vertexShader,fragmentShader:qa.cube.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),s.geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(s)),s.material.uniforms.envMap.value=g,s.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1,u===g&&c===g.version&&h===e.toneMapping||(s.material.needsUpdate=!0,u=g,c=g.version,h=e.toneMapping),n.unshift(s,s.geometry,s.material,0,0,null)):g&&g.isTexture&&(void 0===o&&(o=new wa(new ja(2,2),new Aa({name:"BackgroundMaterial",uniforms:Sa(qa.background.uniforms),vertexShader:qa.background.vertexShader,fragmentShader:qa.background.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(o)),o.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),o.material.uniforms.uvTransform.value.copy(g.matrix),u===g&&c===g.version&&h===e.toneMapping||(o.material.needsUpdate=!0,u=g,c=g.version,h=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function Ka(e,t,n,i){const r=e.getParameter(34921),a=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==a,s={},l=d(null);let u=l;function c(t){return i.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return i.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function d(e){const t=[],n=[],i=[];for(let e=0;e<r;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function p(){const e=u.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){m(e,0)}function m(n,r){const a=u.newAttributes,o=u.enabledAttributes,s=u.attributeDivisors;a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==r&&((i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),s[n]=r)}function g(){const t=u.newAttributes,n=u.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function v(t,n,r,a,o,s){!0!==i.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,n,r,a,o,s):e.vertexAttribIPointer(t,n,r,o,s)}function y(){x(),u!==l&&(u=l,c(u.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,h,y,x){let b=!1;if(o){const t=function(t,n,r){const o=!0===r.wireframe;let l=s[t.id];void 0===l&&(l={},s[t.id]=l);let u=l[n.id];void 0===u&&(u={},l[n.id]=u);let c=u[o];return void 0===c&&(c=d(i.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),u[o]=c),c}(y,h,l);u!==t&&(u=t,c(u.object)),b=function(e,t){const n=u.attributes,i=e.attributes;let r=0;for(const e in i){const t=n[e],a=i[e];if(void 0===t)return!0;if(t.attribute!==a)return!0;if(t.data!==a.data)return!0;r++}return u.attributesNum!==r||u.index!==t}(y,x),b&&function(e,t){const n={},i=e.attributes;let r=0;for(const e in i){const t=i[e],a={};a.attribute=t,t.data&&(a.data=t.data),n[e]=a,r++}u.attributes=n,u.attributesNum=r,u.index=t}(y,x)}else{const e=!0===l.wireframe;u.geometry===y.id&&u.program===h.id&&u.wireframe===e||(u.geometry=y.id,u.program=h.id,u.wireframe=e,b=!0)}!0===r.isInstancedMesh&&(b=!0),null!==x&&n.update(x,34963),b&&(function(r,a,o,s){if(!1===i.isWebGL2&&(r.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=s.attributes,u=o.getAttributes(),c=a.defaultAttributeValues;for(const t in u){const i=u[t];if(i.location>=0){let a=l[t];if(void 0===a&&("instanceMatrix"===t&&r.instanceMatrix&&(a=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(a=r.instanceColor)),void 0!==a){const t=a.normalized,o=a.itemSize,l=n.get(a);if(void 0===l)continue;const u=l.buffer,c=l.type,h=l.bytesPerElement;if(a.isInterleavedBufferAttribute){const n=a.data,l=n.stride,d=a.offset;if(n&&n.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)m(i.location+e,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<i.locationSize;e++)f(i.location+e);e.bindBuffer(34962,u);for(let e=0;e<i.locationSize;e++)v(i.location+e,o/i.locationSize,c,t,l*h,(d+o/i.locationSize*e)*h)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)m(i.location+e,a.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<i.locationSize;e++)f(i.location+e);e.bindBuffer(34962,u);for(let e=0;e<i.locationSize;e++)v(i.location+e,o/i.locationSize,c,t,o*h,o/i.locationSize*e*h)}}else if(void 0!==c){const n=c[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i.location,n);break;case 3:e.vertexAttrib3fv(i.location,n);break;case 4:e.vertexAttrib4fv(i.location,n);break;default:e.vertexAttrib1fv(i.location,n)}}}}g()}(r,l,h,y),null!==x&&e.bindBuffer(34963,n.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){y();for(const e in s){const t=s[e];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0===s[e.id])return;const t=s[e.id];for(const e in t){const n=t[e];for(const e in n)h(n[e].object),delete n[e];delete t[e]}delete s[e.id]},releaseStatesOfProgram:function(e){for(const t in s){const n=s[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)h(i[e].object),delete i[e];delete n[e.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function Ya(e,t,n,i){const r=i.isWebGL2;let a;this.setMode=function(e){a=e},this.render=function(t,i){e.drawArrays(a,t,i),n.update(i,a,1)},this.renderInstances=function(i,o,s){if(0===s)return;let l,u;if(r)l=e,u="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),u="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[u](a,i,o,s),n.update(o,a,s)}}function Ja(e,t,n){let i;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==n.precision?n.precision:"highp";const s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);const l=a||t.has("WEBGL_draw_buffers"),u=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),d=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=h>0,x=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:u,maxTextures:c,maxVertexTextures:h,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:a?e.getParameter(36183):0}}function Za(e){const t=this;let n=null,i=0,r=!1,a=!1;const o=new Ua,s=new Zn,l={value:null,needsUpdate:!1};function u(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function c(e,n,i,r){const a=null!==e?e.length:0;let u=null;if(0!==a){if(u=l.value,!0!==r||null===u){const t=i+4*a,r=n.matrixWorldInverse;s.getNormalMatrix(r),(null===u||u.length<t)&&(u=new Float32Array(t));for(let t=0,n=i;t!==a;++t,n+=4)o.copy(e[t]).applyMatrix4(r,s),o.normal.toArray(u,n),u[n+3]=o.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){const o=0!==e.length||t||0!==i||r;return r=t,n=c(e,a,0),i=e.length,o},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1,u()},this.setState=function(t,o,s){const h=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!r||null===h||0===h.length||a&&!p)a?c(null):u();else{const e=a?0:i,t=4*e;let r=f.clippingState||null;l.value=r,r=c(h,o,t,s);for(let e=0;e!==t;++e)r[e]=n[e];f.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function $a(e){let t=new WeakMap;function n(e,t){return t===se?e.mapping=ae:t===le&&(e.mapping=oe),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const a=r.mapping;if(a===se||a===le){if(t.has(r))return n(t.get(r).texture,r.mapping);{const a=r.image;if(a&&a.height>0){const o=e.getRenderTarget(),s=new Da(a.height/2);return s.fromEquirectangularTexture(e,r),t.set(r,s),e.setRenderTarget(o),r.addEventListener("dispose",i),n(s.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}qa.physical={uniforms:Ta([qa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Jn(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new kr(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Jn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new kr(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new kr(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Va.meshphysical_vert,fragmentShader:Va.meshphysical_frag};class Qa extends Ca{constructor(e=-1,t=1,n=1,i=-1,r=.1,a=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,a=r+e*this.view.width,o-=t*this.view.offsetY,s=o-t*this.view.height}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Qa.prototype.isOrthographicCamera=!0;class eo extends Aa{constructor(e){super(e),this.type="RawShaderMaterial"}}eo.prototype.isRawShaderMaterial=!0;const to=Math.pow(2,8),no=[.125,.215,.35,.446,.526,.582],io=5+no.length,ro={[Jt]:0,[Zt]:1,[Qt]:2,[tn]:3,[nn]:4,[rn]:5,[$t]:6},ao=new Qa,{_lodPlanes:oo,_sizeLods:so,_sigmas:lo}=vo(),uo=new kr;let co=null;const ho=(1+Math.sqrt(5))/2,po=1/ho,fo=[new pi(1,1,1),new pi(-1,1,1),new pi(1,1,-1),new pi(-1,1,-1),new pi(0,ho,po),new pi(0,ho,-po),new pi(po,0,ho),new pi(-po,0,ho),new pi(ho,po,0),new pi(-ho,po,0)];class mo{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(20),n=new pi(0,1,0);return new eo({name:"SphericalGaussianBlur",defines:{n:20},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:ro[Jt]},outputEncoding:{value:ro[Jt]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:x,depthTest:!1,depthWrite:!1})}(),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){co=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(e,n,i,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=wo(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=bo(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<oo.length;e++)oo[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(co),e.scissorTest=!1,xo(e,0,0,e.width,e.height)}_fromTexture(e){co=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:fe,minFilter:fe,generateMipmaps:!1,type:Se,format:He,encoding:go(e)?e.encoding:Qt,depthBuffer:!1},n=yo(t);return n.depthBuffer=!e,this._pingPongRenderTarget=yo(t),n}_compileMaterial(e){const t=new wa(oo[0],e);this._renderer.compile(t,ao)}_sceneToCubeUV(e,t,n,i){const r=new Ra(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,l=s.autoClear,u=s.outputEncoding,c=s.toneMapping;s.getClearColor(uo),s.toneMapping=$,s.outputEncoding=Jt,s.autoClear=!1;const h=new Or({name:"PMREM.Background",side:m,depthWrite:!1,depthTest:!1}),d=new wa(new _a,h);let p=!1;const f=e.background;f?f.isColor&&(h.color.copy(f),e.background=null,p=!0):(h.color.copy(uo),p=!0);for(let t=0;t<6;t++){const n=t%3;0==n?(r.up.set(0,a[t],0),r.lookAt(o[t],0,0)):1==n?(r.up.set(0,0,a[t]),r.lookAt(0,o[t],0)):(r.up.set(0,a[t],0),r.lookAt(0,0,o[t])),xo(i,n*to,t>2?to:0,to,to),s.setRenderTarget(i),p&&s.render(d,r),s.render(e,r)}d.geometry.dispose(),d.material.dispose(),s.toneMapping=c,s.outputEncoding=u,s.autoClear=l,e.background=f}_setEncoding(e,t){!0===this._renderer.capabilities.isWebGL2&&t.format===Fe&&t.type===Se&&t.encoding===Zt?e.value=ro[Jt]:e.value=ro[t.encoding]}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===ae||e.mapping===oe;i?null==this._cubemapShader&&(this._cubemapShader=wo()):null==this._equirectShader&&(this._equirectShader=bo());const r=i?this._cubemapShader:this._equirectShader,a=new wa(oo[0],r),o=r.uniforms;o.envMap.value=e,i||o.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(o.inputEncoding,e),this._setEncoding(o.outputEncoding,t.texture),xo(t,0,0,3*to,2*to),n.setRenderTarget(t),n.render(a,ao)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<io;t++){const n=Math.sqrt(lo[t]*lo[t]-lo[t-1]*lo[t-1]),i=fo[(t-1)%fo.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,i,r){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",r),this._halfBlur(a,e,n,n,i,"longitudinal",r)}_halfBlur(e,t,n,i,r,a,o){const s=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new wa(oo[i],l),c=l.uniforms,h=so[n]-1,d=isFinite(r)?Math.PI/(2*h):2*Math.PI/39,p=r/d,f=isFinite(r)?1+Math.floor(3*p):20;f>20&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const m=[];let g=0;for(let e=0;e<20;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0==e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o),c.dTheta.value=d,c.mipInt.value=8-n,this._setEncoding(c.inputEncoding,e.texture),this._setEncoding(c.outputEncoding,e.texture);const v=so[i];xo(t,3*Math.max(0,to-2*v),(0===i?0:2*to)+2*v*(i>4?i-8+4:0),3*v,2*v),s.setRenderTarget(t),s.render(u,ao)}}function go(e){return void 0!==e&&e.type===Se&&(e.encoding===Jt||e.encoding===Zt||e.encoding===$t)}function vo(){const e=[],t=[],n=[];let i=8;for(let r=0;r<io;r++){const a=Math.pow(2,i);t.push(a);let o=1/a;r>4?o=no[r-8+4-1]:0==r&&(o=0),n.push(o);const s=1/(a-1),l=-s/2,u=1+s/2,c=[l,l,u,l,u,u,l,l,u,u,l,u],h=6,d=6,p=3,f=2,m=1,g=new Float32Array(p*d*h),v=new Float32Array(f*d*h),y=new Float32Array(m*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,i=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];g.set(i,p*d*e),v.set(c,f*d*e);const r=[e,e,e,e,e,e];y.set(r,m*d*e)}const x=new ia;x.setAttribute("position",new Br(g,p)),x.setAttribute("uv",new Br(v,f)),x.setAttribute("faceIndex",new Br(y,m)),e.push(x),i>4&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function yo(e){const t=new ui(3*to,3*to,e);return t.texture.mapping=ue,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function xo(e,t,n,i,r){e.viewport.set(t,n,i,r),e.scissor.set(t,n,i,r)}function bo(){const e=new Jn(1,1);return new eo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:ro[Jt]},outputEncoding:{value:ro[Jt]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:x,depthTest:!1,depthWrite:!1})}function wo(){return new eo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ro[Jt]},outputEncoding:{value:ro[Jt]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:x,depthTest:!1,depthWrite:!1})}function Mo(e){let t=new WeakMap,n=null;function i(e){const n=e.target;n.removeEventListener("dispose",i);const r=t.get(n);void 0!==r&&(t.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const a=r.mapping,o=a===se||a===le,s=a===ae||a===oe;if(o||s){if(t.has(r))return t.get(r).texture;{const a=r.image;if(o&&a&&a.height>0||s&&a&&function(e){let t=0;for(let n=0;n<6;n++)void 0!==e[n]&&t++;return 6===t}(a)){const a=e.getRenderTarget();null===n&&(n=new mo(e));const s=o?n.fromEquirectangular(r):n.fromCubemap(r);return t.set(r,s),e.setRenderTarget(a),r.addEventListener("dispose",i),s.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function _o(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function So(e,t,n,i){const r={},a=new WeakMap;function o(e){const s=e.target;null!==s.index&&t.remove(s.index);for(const e in s.attributes)t.remove(s.attributes[e]);s.removeEventListener("dispose",o),delete r[s.id];const l=a.get(s);l&&(t.remove(l),a.delete(s)),i.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){const n=[],i=e.index,r=e.attributes.position;let o=0;if(null!==i){const e=i.array;o=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],r=e[t+1],a=e[t+2];n.push(i,r,r,a,a,i)}}else{const e=r.array;o=r.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,r=t+2;n.push(e,i,i,r,r,e)}}const s=new($n(n)>65535?qr:Vr)(n,1);s.version=o;const l=a.get(e);l&&t.remove(l),a.set(e,s)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",o),r[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const i=e.morphAttributes;for(const e in i){const n=i[e];for(let e=0,i=n.length;e<i;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=a.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function To(e,t,n,i){const r=i.isWebGL2;let a,o,s;this.setMode=function(e){a=e},this.setIndex=function(e){o=e.type,s=e.bytesPerElement},this.render=function(t,i){e.drawElements(a,i,o,t*s),n.update(i,a,1)},this.renderInstances=function(i,l,u){if(0===u)return;let c,h;if(r)c=e,h="drawElementsInstanced";else if(c=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===c)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](a,l,o,i*s,u),n.update(l,a,u)}}function Eo(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,i){switch(t.calls++,n){case 4:t.triangles+=i*(e/3);break;case 1:t.lines+=i*(e/2);break;case 3:t.lines+=i*(e-1);break;case 2:t.lines+=i*e;break;case 0:t.points+=i*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}class Ao extends oi{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=fe,this.minFilter=fe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function Co(e,t){return e[0]-t[0]}function Ro(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Lo(e,t){let n=1;const i=t.isInterleavedBufferAttribute?t.data.array:t.array;i instanceof Int8Array?n=127:i instanceof Int16Array?n=32767:i instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),e.divideScalar(n)}function Io(e,t,n){const i={},r=new Float32Array(8),a=new WeakMap,o=new pi,s=[];for(let e=0;e<8;e++)s[e]=[e,0];return{update:function(l,u,c,h){const d=l.morphTargetInfluences;if(!0===t.isWebGL2){const i=u.morphAttributes.position.length;let r=a.get(u);if(void 0===r||r.count!==i){void 0!==r&&r.texture.dispose();const e=void 0!==u.morphAttributes.normal,n=u.morphAttributes.position,s=u.morphAttributes.normal||[],l=!0===e?2:1;let c=u.attributes.position.count*l,h=1;c>t.maxTextureSize&&(h=Math.ceil(c/t.maxTextureSize),c=t.maxTextureSize);const d=new Float32Array(c*h*4*i),p=new Ao(d,c,h,i);p.format=Fe,p.type=Le;const f=4*l;for(let t=0;t<i;t++){const i=n[t],r=s[t],a=c*h*4*t;for(let t=0;t<i.count;t++){o.fromBufferAttribute(i,t),!0===i.normalized&&Lo(o,i);const n=t*f;d[a+n+0]=o.x,d[a+n+1]=o.y,d[a+n+2]=o.z,d[a+n+3]=0,!0===e&&(o.fromBufferAttribute(r,t),!0===r.normalized&&Lo(o,r),d[a+n+4]=o.x,d[a+n+5]=o.y,d[a+n+6]=o.z,d[a+n+7]=0)}}r={count:i,texture:p,size:new Jn(c,h)},a.set(u,r)}let s=0;for(let e=0;e<d.length;e++)s+=d[e];const l=u.morphTargetsRelative?1:1-s;h.getUniforms().setValue(e,"morphTargetBaseInfluence",l),h.getUniforms().setValue(e,"morphTargetInfluences",d),h.getUniforms().setValue(e,"morphTargetsTexture",r.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",r.size)}else{const t=void 0===d?0:d.length;let n=i[u.id];if(void 0===n||n.length!==t){n=[];for(let e=0;e<t;e++)n[e]=[e,0];i[u.id]=n}for(let e=0;e<t;e++){const t=n[e];t[0]=e,t[1]=d[e]}n.sort(Ro);for(let e=0;e<8;e++)e<t&&n[e][1]?(s[e][0]=n[e][0],s[e][1]=n[e][1]):(s[e][0]=Number.MAX_SAFE_INTEGER,s[e][1]=0);s.sort(Co);const a=u.morphAttributes.position,o=u.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=s[e],n=t[0],i=t[1];n!==Number.MAX_SAFE_INTEGER&&i?(a&&u.getAttribute("morphTarget"+e)!==a[n]&&u.setAttribute("morphTarget"+e,a[n]),o&&u.getAttribute("morphNormal"+e)!==o[n]&&u.setAttribute("morphNormal"+e,o[n]),r[e]=i,l+=i):(a&&!0===u.hasAttribute("morphTarget"+e)&&u.deleteAttribute("morphTarget"+e),o&&!0===u.hasAttribute("morphNormal"+e)&&u.deleteAttribute("morphNormal"+e),r[e]=0)}const c=u.morphTargetsRelative?1:1-l;h.getUniforms().setValue(e,"morphTargetBaseInfluence",c),h.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function Po(e,t,n,i){let r=new WeakMap;function a(e){const t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const o=i.render.frame,s=e.geometry,l=t.get(e,s);return r.get(l)!==o&&(t.update(l),r.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}Ao.prototype.isDataTexture2DArray=!0;class Do extends oi{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=fe,this.minFilter=fe,this.wrapR=de,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}Do.prototype.isDataTexture3D=!0;const No=new oi,ko=new Ao,Oo=new Do,Uo=new Pa,Fo=[],Bo=[],zo=new Float32Array(16),Ho=new Float32Array(9),Go=new Float32Array(4);function jo(e,t,n){const i=e[0];if(i<=0||i>0)return e;const r=t*n;let a=Fo[r];if(void 0===a&&(a=new Float32Array(r),Fo[r]=a),0!==t){i.toArray(a,0);for(let i=1,r=0;i!==t;++i)r+=n,e[i].toArray(a,r)}return a}function Vo(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function Wo(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function qo(e,t){let n=Bo[t];void 0===n&&(n=new Int32Array(t),Bo[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Xo(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Ko(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Vo(n,t))return;e.uniform2fv(this.addr,t),Wo(n,t)}}function Yo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Vo(n,t))return;e.uniform3fv(this.addr,t),Wo(n,t)}}function Jo(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Vo(n,t))return;e.uniform4fv(this.addr,t),Wo(n,t)}}function Zo(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Vo(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Wo(n,t)}else{if(Vo(n,i))return;Go.set(i),e.uniformMatrix2fv(this.addr,!1,Go),Wo(n,i)}}function $o(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Vo(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Wo(n,t)}else{if(Vo(n,i))return;Ho.set(i),e.uniformMatrix3fv(this.addr,!1,Ho),Wo(n,i)}}function Qo(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Vo(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Wo(n,t)}else{if(Vo(n,i))return;zo.set(i),e.uniformMatrix4fv(this.addr,!1,zo),Wo(n,i)}}function es(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function ts(e,t){const n=this.cache;Vo(n,t)||(e.uniform2iv(this.addr,t),Wo(n,t))}function ns(e,t){const n=this.cache;Vo(n,t)||(e.uniform3iv(this.addr,t),Wo(n,t))}function is(e,t){const n=this.cache;Vo(n,t)||(e.uniform4iv(this.addr,t),Wo(n,t))}function rs(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function as(e,t){const n=this.cache;Vo(n,t)||(e.uniform2uiv(this.addr,t),Wo(n,t))}function os(e,t){const n=this.cache;Vo(n,t)||(e.uniform3uiv(this.addr,t),Wo(n,t))}function ss(e,t){const n=this.cache;Vo(n,t)||(e.uniform4uiv(this.addr,t),Wo(n,t))}function ls(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTexture2D(t||No,r)}function us(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(t||Oo,r)}function cs(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.safeSetTextureCube(t||Uo,r)}function hs(e,t,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(e.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(t||ko,r)}function ds(e,t){e.uniform1fv(this.addr,t)}function ps(e,t){const n=jo(t,this.size,2);e.uniform2fv(this.addr,n)}function fs(e,t){const n=jo(t,this.size,3);e.uniform3fv(this.addr,n)}function ms(e,t){const n=jo(t,this.size,4);e.uniform4fv(this.addr,n)}function gs(e,t){const n=jo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function vs(e,t){const n=jo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ys(e,t){const n=jo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function xs(e,t){e.uniform1iv(this.addr,t)}function bs(e,t){e.uniform2iv(this.addr,t)}function ws(e,t){e.uniform3iv(this.addr,t)}function Ms(e,t){e.uniform4iv(this.addr,t)}function _s(e,t){e.uniform1uiv(this.addr,t)}function Ss(e,t){e.uniform2uiv(this.addr,t)}function Ts(e,t){e.uniform3uiv(this.addr,t)}function Es(e,t){e.uniform4uiv(this.addr,t)}function As(e,t,n){const i=t.length,r=qo(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.safeSetTexture2D(t[e]||No,r[e])}function Cs(e,t,n){const i=t.length,r=qo(n,i);e.uniform1iv(this.addr,r);for(let e=0;e!==i;++e)n.safeSetTextureCube(t[e]||Uo,r[e])}function Rs(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Xo;case 35664:return Ko;case 35665:return Yo;case 35666:return Jo;case 35674:return Zo;case 35675:return $o;case 35676:return Qo;case 5124:case 35670:return es;case 35667:case 35671:return ts;case 35668:case 35672:return ns;case 35669:case 35673:return is;case 5125:return rs;case 36294:return as;case 36295:return os;case 36296:return ss;case 35678:case 36198:case 36298:case 36306:case 35682:return ls;case 35679:case 36299:case 36307:return us;case 35680:case 36300:case 36308:case 36293:return cs;case 36289:case 36303:case 36311:case 36292:return hs}}(t.type)}function Ls(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return ds;case 35664:return ps;case 35665:return fs;case 35666:return ms;case 35674:return gs;case 35675:return vs;case 35676:return ys;case 5124:case 35670:return xs;case 35667:case 35671:return bs;case 35668:case 35672:return ws;case 35669:case 35673:return Ms;case 5125:return _s;case 36294:return Ss;case 36295:return Ts;case 36296:return Es;case 35678:case 36198:case 36298:case 36306:case 35682:return As;case 35680:case 36300:case 36308:case 36293:return Cs}}(t.type)}function Is(e){this.id=e,this.seq=[],this.map={}}Ls.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Wo(t,e)},Is.prototype.setValue=function(e,t,n){const i=this.seq;for(let r=0,a=i.length;r!==a;++r){const a=i[r];a.setValue(e,t[a.id],n)}};const Ps=/(\w+)(\])?(\[|\.)?/g;function Ds(e,t){e.seq.push(t),e.map[t.id]=t}function Ns(e,t,n){const i=e.name,r=i.length;for(Ps.lastIndex=0;;){const a=Ps.exec(i),o=Ps.lastIndex;let s=a[1];const l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===r){Ds(n,void 0===u?new Rs(s,e,t):new Ls(s,e,t));break}{let e=n.map[s];void 0===e&&(e=new Is(s),Ds(n,e)),n=e}}}function ks(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);Ns(n,e.getUniformLocation(t,n.name),this)}}function Os(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}ks.prototype.setValue=function(e,t,n,i){const r=this.map[t];void 0!==r&&r.setValue(e,n,i)},ks.prototype.setOptional=function(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)},ks.upload=function(e,t,n,i){for(let r=0,a=t.length;r!==a;++r){const a=t[r],o=n[a.id];!1!==o.needsUpdate&&a.setValue(e,o.value,i)}},ks.seqWithValue=function(e,t){const n=[];for(let i=0,r=e.length;i!==r;++i){const r=e[i];r.id in t&&n.push(r)}return n};let Us=0;function Fs(e){switch(e){case Jt:return["Linear","( value )"];case Zt:return["sRGB","( value )"];case Qt:return["RGBE","( value )"];case tn:return["RGBM","( value, 7.0 )"];case nn:return["RGBM","( value, 16.0 )"];case rn:return["RGBD","( value, 256.0 )"];case $t:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case en:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Bs(e,t,n){const i=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();return i&&""===r?"":n.toUpperCase()+"\n\n"+r+"\n\n"+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function zs(e,t){const n=Fs(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Hs(e,t){const n=Fs(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Gs(e,t){let n;switch(t){case Q:n="Linear";break;case ee:n="Reinhard";break;case te:n="OptimizedCineon";break;case ne:n="ACESFilmic";break;case ie:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function js(e){return""!==e}function Vs(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ws(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const qs=/^[ \t]*#include +<([\w\d./]+)>/gm;function Xs(e){return e.replace(qs,Ks)}function Ks(e,t){const n=Va[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Xs(n)}const Ys=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Js=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Zs(e){return e.replace(Js,Qs).replace(Ys,$s)}function $s(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Qs(0,t,n,i)}function Qs(e,t,n,i){let r="";for(let e=parseInt(t);e<parseInt(n);e++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return r}function el(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function tl(e,t,n,i){const r=e.getContext(),a=n.defines;let o=n.vertexShader,s=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===h?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===d?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===p&&(t="SHADOWMAP_TYPE_VSM"),t}(n),u=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case ae:case oe:t="ENVMAP_TYPE_CUBE";break;case ue:case ce:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),c=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case oe:case ce:t="ENVMAP_MODE_REFRACTION"}return t}(n),f=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Y:t="ENVMAP_BLENDING_MULTIPLY";break;case J:t="ENVMAP_BLENDING_MIX";break;case Z:t="ENVMAP_BLENDING_ADD"}return t}(n),m=e.gammaFactor>0?e.gammaFactor:1,g=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(js).join("\n")}(n),v=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(a),y=r.createProgram();let x,b,w=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(x=[v].filter(js).join("\n"),x.length>0&&(x+="\n"),b=[g,v].filter(js).join("\n"),b.length>0&&(b+="\n")):(x=[el(n),"#define SHADER_NAME "+n.shaderName,v,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+m,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargets&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(js).join("\n"),b=[g,el(n),"#define SHADER_NAME "+n.shaderName,v,"#define GAMMA_FACTOR "+m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.envMap?"#define "+c:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==$?"#define TONE_MAPPING":"",n.toneMapping!==$?Va.tonemapping_pars_fragment:"",n.toneMapping!==$?Gs("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.format===Ue?"#define OPAQUE":"",Va.encodings_pars_fragment,n.map?zs("mapTexelToLinear",n.mapEncoding):"",n.matcap?zs("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?zs("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?zs("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.specularColorMap?zs("specularColorMapTexelToLinear",n.specularColorMapEncoding):"",n.sheenColorMap?zs("sheenColorMapTexelToLinear",n.sheenColorMapEncoding):"",n.lightMap?zs("lightMapTexelToLinear",n.lightMapEncoding):"",Hs("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(js).join("\n")),o=Xs(o),o=Vs(o,n),o=Ws(o,n),s=Xs(s),s=Vs(s,n),s=Ws(s,n),o=Zs(o),s=Zs(s),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(w="#version 300 es\n",x=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,b=["#define varying in",n.glslVersion===kn?"":"out highp vec4 pc_fragColor;",n.glslVersion===kn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const M=w+b+s,_=Os(r,35633,w+x+o),S=Os(r,35632,M);if(r.attachShader(y,_),r.attachShader(y,S),void 0!==n.index0AttributeName?r.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&r.bindAttribLocation(y,0,"position"),r.linkProgram(y),e.debug.checkShaderErrors){const e=r.getProgramInfoLog(y).trim(),t=r.getShaderInfoLog(_).trim(),n=r.getShaderInfoLog(S).trim();let i=!0,a=!0;if(!1===r.getProgramParameter(y,35714)){i=!1;const t=Bs(r,_,"vertex"),n=Bs(r,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(y,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+n)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==n||(a=!1);a&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:x},fragmentShader:{log:n,prefix:b}})}let T,E;return r.deleteShader(_),r.deleteShader(S),this.getUniforms=function(){return void 0===T&&(T=new ks(r,y)),T},this.getAttributes=function(){return void 0===E&&(E=function(e,t){const n={},i=e.getProgramParameter(t,35721);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r),a=i.name;let o=1;35674===i.type&&(o=2),35675===i.type&&(o=3),35676===i.type&&(o=4),n[a]={type:i.type,location:e.getAttribLocation(t,a),locationSize:o}}return n}(r,y)),E},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=Us++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=_,this.fragmentShader=S,this}function nl(e,t,n,i,r,a,o){const s=[],l=r.isWebGL2,u=r.logarithmicDepthBuffer,c=r.floatVertexTextures,h=r.maxVertexUniforms,d=r.vertexTextures;let p=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},v=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function y(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=Jt,l&&e&&e.isTexture&&e.format===Fe&&e.type===Se&&e.encoding===Zt&&(t=Jt),t}return{getParameters:function(a,s,v,x,b){const w=x.fog,M=a.isMeshStandardMaterial?x.environment:null,_=(a.isMeshStandardMaterial?n:t).get(a.envMap||M),S=f[a.type],T=b.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(c)return 1024;{const e=h,n=Math.floor((e-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}}(b):0;let E,A;if(null!==a.precision&&(p=r.getMaxPrecision(a.precision),p!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",p,"instead.")),S){const e=qa[S];E=e.vertexShader,A=e.fragmentShader}else E=a.vertexShader,A=a.fragmentShader;const C=e.getRenderTarget(),R=a.alphaTest>0,L=a.clearcoat>0;return{isWebGL2:l,shaderID:S,shaderName:a.type,vertexShader:E,fragmentShader:A,defines:a.defines,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,instancing:!0===b.isInstancedMesh,instancingColor:!0===b.isInstancedMesh&&null!==b.instanceColor,supportsVertexTextures:d,outputEncoding:null!==C?y(C.texture):e.outputEncoding,map:!!a.map,mapEncoding:y(a.map),matcap:!!a.matcap,matcapEncoding:y(a.matcap),envMap:!!_,envMapMode:_&&_.mapping,envMapEncoding:y(_),envMapCubeUV:!!_&&(_.mapping===ue||_.mapping===ce),lightMap:!!a.lightMap,lightMapEncoding:y(a.lightMap),aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,emissiveMapEncoding:y(a.emissiveMap),bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:a.normalMapType===ln,tangentSpaceNormalMap:a.normalMapType===sn,clearcoat:L,clearcoatMap:L&&!!a.clearcoatMap,clearcoatRoughnessMap:L&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:L&&!!a.clearcoatNormalMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,specularColorMapEncoding:y(a.specularColorMap),alphaMap:!!a.alphaMap,alphaTest:R,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenColorMapEncoding:y(a.sheenColorMap),sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!b.geometry&&!!b.geometry.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!b.geometry&&!!b.geometry.attributes.color&&4===b.geometry.attributes.color.itemSize,vertexUvs:!!a.map||!!a.bumpMap||!!a.normalMap||!!a.specularMap||!!a.alphaMap||!!a.emissiveMap||!!a.roughnessMap||!!a.metalnessMap||!!a.clearcoatMap||!!a.clearcoatRoughnessMap||!!a.clearcoatNormalMap||!!a.displacementMap||!!a.transmissionMap||!!a.thicknessMap||!!a.specularIntensityMap||!!a.specularColorMap||!!a.sheenColorMap||a.sheenRoughnessMap,uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||!!a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap||!a.displacementMap),fog:!!w,useFog:a.fog,fogExp2:w&&w.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===b.isSkinnedMesh&&T>0,maxBones:T,useVertexTexture:c,morphTargets:!!b.geometry&&!!b.geometry.morphAttributes.position,morphNormals:!!b.geometry&&!!b.geometry.morphAttributes.normal,morphTargetsCount:b.geometry&&b.geometry.morphAttributes.position?b.geometry.morphAttributes.position.length:0,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:a.format,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&v.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:$,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===g,flipSided:a.side===m,depthPacking:void 0!==a.depthPacking&&a.depthPacking,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||i.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(ni(t.fragmentShader)),n.push(ni(t.vertexShader))),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<v.length;e++)n.push(t[v[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=qa[t];n=Ea.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=s.length;e<t;e++){const t=s[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new tl(e,n,t,a),s.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=s.indexOf(e);s[t]=s[s.length-1],s.pop(),e.destroy()}},programs:s}}function il(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function rl(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function al(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function ol(e){const t=[];let n=0;const i=[],r=[],a=[],o={id:-1};function s(i,r,a,s,l,u){let c=t[n];const h=e.get(a);return void 0===c?(c={id:i.id,object:i,geometry:r,material:a,program:h.program||o,groupOrder:s,renderOrder:i.renderOrder,z:l,group:u},t[n]=c):(c.id=i.id,c.object=i,c.geometry=r,c.material=a,c.program=h.program||o,c.groupOrder=s,c.renderOrder=i.renderOrder,c.z=l,c.group=u),n++,c}return{opaque:i,transmissive:r,transparent:a,init:function(){n=0,i.length=0,r.length=0,a.length=0},push:function(e,t,n,o,l,u){const c=s(e,t,n,o,l,u);n.transmission>0?r.push(c):!0===n.transparent?a.push(c):i.push(c)},unshift:function(e,t,n,o,l,u){const c=s(e,t,n,o,l,u);n.transmission>0?r.unshift(c):!0===n.transparent?a.unshift(c):i.unshift(c)},finish:function(){for(let e=n,i=t.length;e<i;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){i.length>1&&i.sort(e||rl),r.length>1&&r.sort(t||al),a.length>1&&a.sort(t||al)}}}function sl(e){let t=new WeakMap;return{get:function(n,i){let r;return!1===t.has(n)?(r=new ol(e),t.set(n,[r])):i>=t.get(n).length?(r=new ol(e),t.get(n).push(r)):r=t.get(n)[i],r},dispose:function(){t=new WeakMap}}}function ll(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new pi,color:new kr};break;case"SpotLight":n={position:new pi,direction:new pi,color:new kr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new pi,color:new kr,distance:0,decay:0};break;case"HemisphereLight":n={direction:new pi,skyColor:new kr,groundColor:new kr};break;case"RectAreaLight":n={color:new kr,position:new pi,halfWidth:new pi,halfHeight:new pi}}return e[t.id]=n,n}}}let ul=0;function cl(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function hl(e,t){const n=new ll,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Jn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Jn,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)r.probe.push(new pi);const a=new pi,o=new Vi,s=new Vi;return{setup:function(a,o){let s=0,l=0,u=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let c=0,h=0,d=0,p=0,f=0,m=0,g=0,v=0;a.sort(cl);const y=!0!==o?Math.PI:1;for(let e=0,t=a.length;e<t;e++){const t=a[e],o=t.color,x=t.intensity,b=t.distance,w=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)s+=o.r*x*y,l+=o.g*x*y,u+=o.b*x*y;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],x);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.directionalShadow[c]=n,r.directionalShadowMap[c]=w,r.directionalShadowMatrix[c]=t.shadow.matrix,m++}r.directional[c]=e,c++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(x*y),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,r.spotShadow[d]=n,r.spotShadowMap[d]=w,r.spotShadowMatrix[d]=t.shadow.matrix,v++}r.spot[d]=e,d++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(o).multiplyScalar(x),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,r.pointShadow[h]=n,r.pointShadowMap[h]=w,r.pointShadowMatrix[h]=t.shadow.matrix,g++}r.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(x*y),e.groundColor.copy(t.groundColor).multiplyScalar(x*y),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Wa.LTC_FLOAT_1,r.rectAreaLTC2=Wa.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Wa.LTC_HALF_1,r.rectAreaLTC2=Wa.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=s,r.ambient[1]=l,r.ambient[2]=u;const x=r.hash;x.directionalLength===c&&x.pointLength===h&&x.spotLength===d&&x.rectAreaLength===p&&x.hemiLength===f&&x.numDirectionalShadows===m&&x.numPointShadows===g&&x.numSpotShadows===v||(r.directional.length=c,r.spot.length=d,r.rectArea.length=p,r.point.length=h,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotShadowMatrix.length=v,x.directionalLength=c,x.pointLength=h,x.spotLength=d,x.rectAreaLength=p,x.hemiLength=f,x.numDirectionalShadows=m,x.numPointShadows=g,x.numSpotShadows=v,r.version=ul++)},setupView:function(e,t){let n=0,i=0,l=0,u=0,c=0;const h=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),n++}else if(d.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(d.matrixWorld),a.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(h),l++}else if(d.isRectAreaLight){const e=r.rectArea[u];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),s.identity(),o.copy(d.matrixWorld),o.premultiply(h),s.extractRotation(o),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(s),e.halfHeight.applyMatrix4(s),u++}else if(d.isPointLight){const e=r.point[i];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(h),i++}else if(d.isHemisphereLight){const e=r.hemi[c];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),c++}}},state:r}}function dl(e,t){const n=new hl(e,t),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(e){n.setup(i,e)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){r.push(e)}}}function pl(e,t){let n=new WeakMap;return{get:function(i,r=0){let a;return!1===n.has(i)?(a=new dl(e,t),n.set(i,[a])):r>=n.get(i).length?(a=new dl(e,t),n.get(i).push(a)):a=n.get(i)[r],a},dispose:function(){n=new WeakMap}}}class fl extends Cr{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=an,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}fl.prototype.isMeshDepthMaterial=!0;class ml extends Cr{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new pi,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function gl(e,t,n){let i=new za;const r=new Jn,a=new Jn,o=new li,s=new fl({depthPacking:on}),l=new ml,u={},c=n.maxTextureSize,d={0:m,1:f,2:g},v=new Aa({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Jn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const b=new ia;b.setAttribute("position",new Br(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new wa(b,v),M=this;function _(n,i){const r=t.update(w);v.defines.VSM_SAMPLES!==n.blurSamples&&(v.defines.VSM_SAMPLES=n.blurSamples,y.defines.VSM_SAMPLES=n.blurSamples,v.needsUpdate=!0,y.needsUpdate=!0),v.uniforms.shadow_pass.value=n.map.texture,v.uniforms.resolution.value=n.mapSize,v.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,r,v,w,null),y.uniforms.shadow_pass.value=n.mapPass.texture,y.uniforms.resolution.value=n.mapSize,y.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,r,y,w,null)}function S(t,n,i,r,a,o,c){let h=null;const f=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(h=void 0!==f?f:!0===r.isPointLight?l:s,e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const e=h.uuid,t=i.uuid;let n=u[e];void 0===n&&(n={},u[e]=n);let r=n[t];void 0===r&&(r=h.clone(),n[t]=r),h=r}return h.visible=i.visible,h.wireframe=i.wireframe,h.side=c===p?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:d[i.side],h.alphaMap=i.alphaMap,h.alphaTest=i.alphaTest,h.clipShadows=i.clipShadows,h.clippingPlanes=i.clippingPlanes,h.clipIntersection=i.clipIntersection,h.displacementMap=i.displacementMap,h.displacementScale=i.displacementScale,h.displacementBias=i.displacementBias,h.wireframeLinewidth=i.wireframeLinewidth,h.linewidth=i.linewidth,!0===r.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(r.matrixWorld),h.nearDistance=a,h.farDistance=o),h}function T(n,r,a,o,s){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===p)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);const i=t.update(n),r=n.material;if(Array.isArray(r)){const t=i.groups;for(let l=0,u=t.length;l<u;l++){const u=t[l],c=r[u.materialIndex];if(c&&c.visible){const t=S(n,0,c,o,a.near,a.far,s);e.renderBufferDirect(a,null,i,t,n,u)}}}else if(r.visible){const t=S(n,0,r,o,a.near,a.far,s);e.renderBufferDirect(a,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)T(l[e],r,a,o,s)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(t,n,s){if(!1===M.enabled)return;if(!1===M.autoUpdate&&!1===M.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),u=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),d=e.state;d.setBlending(x),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,u=t.length;l<u;l++){const u=t[l],h=u.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;r.copy(h.mapSize);const f=h.getFrameExtents();if(r.multiply(f),a.copy(h.mapSize),(r.x>c||r.y>c)&&(r.x>c&&(a.x=Math.floor(c/f.x),r.x=a.x*f.x,h.mapSize.x=a.x),r.y>c&&(a.y=Math.floor(c/f.y),r.y=a.y*f.y,h.mapSize.y=a.y)),null===h.map&&!h.isPointLightShadow&&this.type===p){const e={minFilter:xe,magFilter:xe,format:Fe};h.map=new ui(r.x,r.y,e),h.map.texture.name=u.name+".shadowMap",h.mapPass=new ui(r.x,r.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:fe,magFilter:fe,format:Fe};h.map=new ui(r.x,r.y,e),h.map.texture.name=u.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const m=h.getViewportCount();for(let e=0;e<m;e++){const t=h.getViewport(e);o.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),d.viewport(o),h.updateMatrices(u,e),i=h.getFrustum(),T(n,s,h.camera,u,this.type)}h.isPointLightShadow||this.type!==p||_(h,s),h.needsUpdate=!1}M.needsUpdate=!1,e.setRenderTarget(l,u,h)}}function vl(e,t,n){const i=n.isWebGL2,r=new function(){let t=!1;const n=new li;let i=null;const r=new li(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,a,o,s){!0===s&&(t*=o,i*=o,a*=o),n.set(t,i,a,o),!1===r.equals(n)&&(e.clearColor(t,i,a,o),r.copy(n))},reset:function(){t=!1,i=null,r.set(-1,0,0,0)}}},a=new function(){let t=!1,n=null,i=null,r=null;return{setTest:function(e){e?ye(2929):xe(2929)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case H:e.depthFunc(512);break;case G:e.depthFunc(519);break;case j:e.depthFunc(513);break;case V:e.depthFunc(515);break;case W:e.depthFunc(514);break;case q:e.depthFunc(518);break;case X:e.depthFunc(516);break;case K:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}},u=new function(){let t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(e){t||(e?ye(2960):xe(2960))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&a===o||(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){o===t&&s===n&&l===i||(e.stencilOp(t,n,i),o=t,s=n,l=i)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,l=null,u=null}}};let c={},h=null,d={},p=null,f=!1,v=null,y=null,Y=null,J=null,Z=null,$=null,Q=null,ee=!1,te=null,ne=null,ie=null,re=null,ae=null;const oe=e.getParameter(35661);let se=!1,le=0;const ue=e.getParameter(7938);-1!==ue.indexOf("WebGL")?(le=parseFloat(/^WebGL (\d)/.exec(ue)[1]),se=le>=1):-1!==ue.indexOf("OpenGL ES")&&(le=parseFloat(/^OpenGL ES (\d)/.exec(ue)[1]),se=le>=2);let ce=null,he={};const de=e.getParameter(3088),pe=e.getParameter(2978),fe=(new li).fromArray(de),me=(new li).fromArray(pe);function ge(t,n,i){const r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<i;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,r);return a}const ve={};function ye(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function xe(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}ve[3553]=ge(3553,3553,1),ve[34067]=ge(34067,34069,6),r.setClear(0,0,0,1),a.setClear(1),u.setClear(0),ye(2929),a.setFunc(V),_e(!1),Se(s),ye(2884),Me(x);const be={[T]:32774,[E]:32778,[A]:32779};if(i)be[C]=32775,be[R]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(be[C]=e.MIN_EXT,be[R]=e.MAX_EXT)}const we={[L]:0,[I]:1,[P]:768,[N]:770,[z]:776,[F]:774,[O]:772,[D]:769,[k]:771,[B]:775,[U]:773};function Me(t,n,i,r,a,o,s,l){if(t!==x){if(!1===f&&(ye(3042),f=!0),t===S)a=a||n,o=o||i,s=s||r,n===y&&a===Z||(e.blendEquationSeparate(be[n],be[a]),y=n,Z=a),i===Y&&r===J&&o===$&&s===Q||(e.blendFuncSeparate(we[i],we[r],we[o],we[s]),Y=i,J=r,$=o,Q=s),v=t,ee=null;else if(t!==v||l!==ee){if(y===T&&Z===T||(e.blendEquation(32774),y=T,Z=T),l)switch(t){case b:e.blendFuncSeparate(1,771,1,771);break;case w:e.blendFunc(1,1);break;case M:e.blendFuncSeparate(0,0,769,771);break;case _:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case b:e.blendFuncSeparate(770,771,1,771);break;case w:e.blendFunc(770,1);break;case M:e.blendFunc(0,769);break;case _:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Y=null,J=null,$=null,Q=null,v=t,ee=l}}else!0===f&&(xe(3042),f=!1)}function _e(t){te!==t&&(t?e.frontFace(2304):e.frontFace(2305),te=t)}function Se(t){t!==o?(ye(2884),t!==ne&&(t===s?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):xe(2884),ne=t}function Te(t,n,i){t?(ye(32823),re===n&&ae===i||(e.polygonOffset(n,i),re=n,ae=i)):xe(32823)}function Ee(t){void 0===t&&(t=33984+oe-1),ce!==t&&(e.activeTexture(t),ce=t)}return{buffers:{color:r,depth:a,stencil:u},enable:ye,disable:xe,bindFramebuffer:function(t,n){return null===n&&null!==h&&(n=h),d[t]!==n&&(e.bindFramebuffer(t,n),d[t]=n,i&&(36009===t&&(d[36160]=n),36160===t&&(d[36009]=n)),!0)},bindXRFramebuffer:function(t){t!==h&&(e.bindFramebuffer(36160,t),h=t)},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:Me,setMaterial:function(e,t){e.side===g?xe(2884):ye(2884);let n=e.side===m;t&&(n=!n),_e(n),e.blending===b&&!1===e.transparent?Me(x):Me(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),r.setMask(e.colorWrite);const i=e.stencilWrite;u.setTest(i),i&&(u.setMask(e.stencilWriteMask),u.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),u.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Te(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?ye(32926):xe(32926)},setFlipSided:_e,setCullFace:Se,setLineWidth:function(t){t!==ie&&(se&&e.lineWidth(t),ie=t)},setPolygonOffset:Te,setScissorTest:function(e){e?ye(3089):xe(3089)},activeTexture:Ee,bindTexture:function(t,n){null===ce&&Ee();let i=he[ce];void 0===i&&(i={type:void 0,texture:void 0},he[ce]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||ve[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=he[ce];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===fe.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),fe.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},ce=null,he={},h=null,d={},p=null,f=!1,v=null,y=null,Y=null,J=null,Z=null,$=null,Q=null,ee=!1,te=null,ne=null,ie=null,re=null,ae=null,fe.set(0,0,e.canvas.width,e.canvas.height),me.set(0,0,e.canvas.width,e.canvas.height),r.reset(),a.reset(),u.reset()}}}function yl(e,t,n,i,r,a,o){const s=r.isWebGL2,l=r.maxTextures,u=r.maxCubemapSize,c=r.maxTextureSize,h=r.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return f?new OffscreenCanvas(e,t):ti("canvas")}function g(e,t,n,i){let r=1;if((e.width>i||e.height>i)&&(r=i/Math.max(e.width,e.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?Kn:Math.floor,a=i(r*e.width),o=i(r*e.height);void 0===p&&(p=m(a,o));const s=n?m(a,o):p;return s.width=a,s.height=o,s.getContext("2d").drawImage(e,0,0,a,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+o+")."),s}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return qn(e.width)&&qn(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==fe&&e.minFilter!==xe}function x(t,n,r,a,o=1){e.generateMipmap(t),i.get(n).__maxMipLevel=Math.log2(Math.max(r,a,o))}function b(n,i,r,a){if(!1===s)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let o=i;return 6403===i&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),6407===i&&(5126===r&&(o=34837),5131===r&&(o=34843),5121===r&&(o=32849)),6408===i&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=a===Zt?35907:32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function w(e){return e===fe||e===me||e===ve?9728:9729}function M(t){const n=t.target;n.removeEventListener("dispose",M),function(t){const n=i.get(t);void 0!==n.__webglInit&&(e.deleteTexture(n.__webglTexture),i.remove(t))}(n),n.isVideoTexture&&d.delete(n),o.memory.textures--}function _(t){const n=t.target;n.removeEventListener("dispose",_),function(t){const n=t.texture,r=i.get(t),a=i.get(n);if(t){if(void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(r.__webglFramebuffer[t]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[t]);else e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&e.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);r.__webglTexture&&(e.deleteTexture(r.__webglTexture),o.memory.textures--),i.remove(n[t])}i.remove(n),i.remove(t)}}(n)}let S=0;function T(e,t){const r=i.get(e);if(e.isVideoTexture&&function(e){const t=o.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(e),e.version>0&&r.__version!==e.version){const n=e.image;if(void 0===n)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==n.complete)return void I(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,r.__webglTexture)}function E(t,r){const o=i.get(t);t.version>0&&o.__version!==t.version?function(t,i,r){if(6!==i.image.length)return;L(t,i),n.activeTexture(33984+r),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const o=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),l=i.image[0]&&i.image[0].isDataTexture,c=[];for(let e=0;e<6;e++)c[e]=o||l?l?i.image[e].image:i.image[e]:g(i.image[e],!1,!0,u);const h=c[0],d=v(h)||s,p=a.convert(i.format),f=a.convert(i.type),m=b(i.internalFormat,p,f,i.encoding);let w;if(R(34067,i,d),o){for(let e=0;e<6;e++){w=c[e].mipmaps;for(let t=0;t<w.length;t++){const r=w[t];i.format!==Fe&&i.format!==Ue?null!==p?n.compressedTexImage2D(34069+e,t,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+e,t,m,r.width,r.height,0,p,f,r.data)}}t.__maxMipLevel=w.length-1}else{w=i.mipmaps;for(let e=0;e<6;e++)if(l){n.texImage2D(34069+e,0,m,c[e].width,c[e].height,0,p,f,c[e].data);for(let t=0;t<w.length;t++){const i=w[t].image[e].image;n.texImage2D(34069+e,t+1,m,i.width,i.height,0,p,f,i.data)}}else{n.texImage2D(34069+e,0,m,p,f,c[e]);for(let t=0;t<w.length;t++){const i=w[t];n.texImage2D(34069+e,t+1,m,p,f,i.image[e])}}t.__maxMipLevel=w.length}y(i,d)&&x(34067,i,h.width,h.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}(o,t,r):(n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture))}const A={[he]:10497,[de]:33071,[pe]:33648},C={[fe]:9728,[me]:9984,[ve]:9986,[xe]:9729,[be]:9985,[Me]:9987};function R(n,a,o){if(o?(e.texParameteri(n,10242,A[a.wrapS]),e.texParameteri(n,10243,A[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,A[a.wrapR]),e.texParameteri(n,10240,C[a.magFilter]),e.texParameteri(n,10241,C[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS===de&&a.wrapT===de||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,w(a.magFilter)),e.texParameteri(n,10241,w(a.minFilter)),a.minFilter!==fe&&a.minFilter!==xe&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(a.type===Le&&!1===t.has("OES_texture_float_linear"))return;if(!1===s&&a.type===Ie&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||i.get(a).__currentAnisotropy)&&(e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),i.get(a).__currentAnisotropy=a.anisotropy)}}function L(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",M),t.__webglTexture=e.createTexture(),o.memory.textures++)}function I(t,i,r){let o=3553;i.isDataTexture2DArray&&(o=35866),i.isDataTexture3D&&(o=32879),L(t,i),n.activeTexture(33984+r),n.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!s&&(e.wrapS!==de||e.wrapT!==de||e.minFilter!==fe&&e.minFilter!==xe)}(i)&&!1===v(i.image),u=g(i.image,l,!1,c),h=v(u)||s,d=a.convert(i.format);let p,f=a.convert(i.type),m=b(i.internalFormat,d,f,i.encoding);R(o,i,h);const w=i.mipmaps;if(i.isDepthTexture)m=6402,s?m=i.type===Le?36012:i.type===Re?33190:i.type===ke?35056:33189:i.type===Le&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Ge&&6402===m&&i.type!==Ae&&i.type!==Re&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Ae,f=a.convert(i.type)),i.format===je&&6402===m&&(m=34041,i.type!==ke&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=ke,f=a.convert(i.type))),n.texImage2D(3553,0,m,u.width,u.height,0,d,f,null);else if(i.isDataTexture)if(w.length>0&&h){for(let e=0,t=w.length;e<t;e++)p=w[e],n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,u.width,u.height,0,d,f,u.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(let e=0,t=w.length;e<t;e++)p=w[e],i.format!==Fe&&i.format!==Ue?null!==d?n.compressedTexImage2D(3553,e,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,e,m,p.width,p.height,0,d,f,p.data);t.__maxMipLevel=w.length-1}else if(i.isDataTexture2DArray)n.texImage3D(35866,0,m,u.width,u.height,u.depth,0,d,f,u.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(32879,0,m,u.width,u.height,u.depth,0,d,f,u.data),t.__maxMipLevel=0;else if(w.length>0&&h){for(let e=0,t=w.length;e<t;e++)p=w[e],n.texImage2D(3553,e,m,d,f,p);i.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,m,d,f,u),t.__maxMipLevel=0;y(i,h)&&x(o,i,u.width,u.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function P(t,r,o,s,l){const u=a.convert(o.format),c=a.convert(o.type),h=b(o.internalFormat,u,c,o.encoding);32879===l||35866===l?n.texImage3D(l,0,h,r.width,r.height,r.depth,0,u,c,null):n.texImage2D(l,0,h,r.width,r.height,0,u,c,null),n.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,s,l,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function D(t,n,i){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===Le?r=36012:t.type===Re&&(r=33190));const i=N(n);e.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else e.renderbufferStorage(36161,r,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){const t=N(n);e.renderbufferStorageMultisample(36161,t,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,r=a.convert(t.format),o=a.convert(t.type),s=b(t.internalFormat,r,o,t.encoding);if(i){const t=N(n);e.renderbufferStorageMultisample(36161,t,s,n.width,n.height)}else e.renderbufferStorage(36161,s,n.width,n.height)}e.bindRenderbuffer(36161,null)}function N(e){return s&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}let k=!1,O=!1;this.allocateTextureUnit=function(){const e=S;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),S+=1,e},this.resetTextureUnits=function(){S=0},this.setTexture2D=T,this.setTexture2DArray=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?I(r,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(e,t){const r=i.get(e);e.version>0&&r.__version!==e.version?I(r,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(t){const l=t.texture,u=i.get(t),c=i.get(l);t.addEventListener("dispose",_),!0!==t.isWebGLMultipleRenderTargets&&(c.__webglTexture=e.createTexture(),c.__version=l.version,o.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=!0===t.isWebGLMultisampleRenderTarget,f=l.isDataTexture3D||l.isDataTexture2DArray,m=v(t)||s;if(!s||l.format!==Ue||l.type!==Le&&l.type!==Ie||(l.format=Fe,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){u.__webglFramebuffer=[];for(let t=0;t<6;t++)u.__webglFramebuffer[t]=e.createFramebuffer()}else if(u.__webglFramebuffer=e.createFramebuffer(),d)if(r.drawBuffers){const n=t.texture;for(let t=0,r=n.length;t<r;t++){const r=i.get(n[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(p)if(s){u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,u.__webglColorRenderbuffer);const i=a.convert(l.format),r=a.convert(l.type),o=b(l.internalFormat,i,r,l.encoding),s=N(t);e.renderbufferStorageMultisample(36161,s,o,t.width,t.height),n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,u.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),D(u.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){n.bindTexture(34067,c.__webglTexture),R(34067,l,m);for(let e=0;e<6;e++)P(u.__webglFramebuffer[e],t,l,36064,34069+e);y(l,m)&&x(34067,l,t.width,t.height),n.unbindTexture()}else if(d){const e=t.texture;for(let r=0,a=e.length;r<a;r++){const a=e[r],o=i.get(a);n.bindTexture(3553,o.__webglTexture),R(3553,a,m),P(u.__webglFramebuffer,t,a,36064+r,3553),y(a,m)&&x(3553,a,t.width,t.height)}n.unbindTexture()}else{let e=3553;f&&(s?e=l.isDataTexture3D?32879:35866:console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.")),n.bindTexture(e,c.__webglTexture),R(e,l,m),P(u.__webglFramebuffer,t,l,36064,e),y(l,m)&&x(e,l,t.width,t.height,t.depth),n.unbindTexture()}t.depthBuffer&&function(t){const r=i.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),T(r.depthTexture,0);const a=i.get(r.depthTexture).__webglTexture;if(r.depthTexture.format===Ge)e.framebufferTexture2D(36160,36096,3553,a,0);else{if(r.depthTexture.format!==je)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,a,0)}}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=e.createRenderbuffer(),D(r.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),D(r.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}(t)},this.updateRenderTargetMipmap=function(e){const t=v(e)||s,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let a=0,o=r.length;a<o;a++){const o=r[a];if(y(o,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,r=i.get(o).__webglTexture;n.bindTexture(t,r),x(t,o,e.width,e.height),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(s){const r=t.width,a=t.height;let o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024);const s=i.get(t);n.bindFramebuffer(36008,s.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,s.__webglFramebuffer),e.blitFramebuffer(0,0,r,a,0,0,r,a,o,9728),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),e=e.texture),T(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===O&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),O=!0),e=e.texture),E(e,t)}}function xl(e,t,n){const i=n.isWebGL2;return{convert:function(e){let n;if(e===Se)return 5121;if(e===Pe)return 32819;if(e===De)return 32820;if(e===Ne)return 33635;if(e===Te)return 5120;if(e===Ee)return 5122;if(e===Ae)return 5123;if(e===Ce)return 5124;if(e===Re)return 5125;if(e===Le)return 5126;if(e===Ie)return i?5131:(n=t.get("OES_texture_half_float"),null!==n?n.HALF_FLOAT_OES:null);if(e===Oe)return 6406;if(e===Ue)return 6407;if(e===Fe)return 6408;if(e===Be)return 6409;if(e===ze)return 6410;if(e===Ge)return 6402;if(e===je)return 34041;if(e===Ve)return 6403;if(e===We)return 36244;if(e===qe)return 33319;if(e===Xe)return 33320;if(e===Ke)return 36248;if(e===Ye)return 36249;if(e===Je||e===Ze||e===$e||e===Qe){if(n=t.get("WEBGL_compressed_texture_s3tc"),null===n)return null;if(e===Je)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ze)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===$e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Qe)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===nt||e===it){if(n=t.get("WEBGL_compressed_texture_pvrtc"),null===n)return null;if(e===et)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===nt)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===it)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===rt)return n=t.get("WEBGL_compressed_texture_etc1"),null!==n?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===at||e===ot)&&(n=t.get("WEBGL_compressed_texture_etc"),null!==n)){if(e===at)return n.COMPRESSED_RGB8_ETC2;if(e===ot)return n.COMPRESSED_RGBA8_ETC2_EAC}return e===st||e===lt||e===ut||e===ct||e===ht||e===dt||e===pt||e===ft||e===mt||e===gt||e===vt||e===yt||e===xt||e===bt||e===Mt||e===_t||e===St||e===Tt||e===Et||e===At||e===Ct||e===Rt||e===Lt||e===It||e===Pt||e===Dt||e===Nt||e===kt?(n=t.get("WEBGL_compressed_texture_astc"),null!==n?e:null):e===wt?(n=t.get("EXT_texture_compression_bptc"),null!==n?e:null):e===ke?i?34042:(n=t.get("WEBGL_depth_texture"),null!==n?n.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}ml.prototype.isMeshDistanceMaterial=!0;class bl extends Ra{constructor(e=[]){super(),this.cameras=e}}bl.prototype.isArrayCamera=!0;class wl extends mr{constructor(){super(),this.type="Group"}}wl.prototype.isGroup=!0;const Ml={type:"move"};class _l{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new wl,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new wl,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new pi,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new pi),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new wl,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new pi,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new pi),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let i=null,r=null,a=null;const o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&(i=t.getPose(e.targetRaySpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Ml))),l&&e.hand){a=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n);if(void 0===l.joints[i.jointName]){const e=new wl;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[i.jointName]=e,l.add(e)}const r=l.joints[i.jointName];null!==e&&(r.matrix.fromArray(e.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=e.radius),r.visible=null!==e}const i=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],o=i.position.distanceTo(r.position),s=.02,u=.005;l.inputState.pinching&&o>s+u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=s-u&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&(r=t.getPose(e.gripSpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==i),null!==s&&(s.visible=null!==r),null!==l&&(l.visible=null!==a),this}}class Sl extends On{constructor(e,t){super();const n=this,i=e.state;let r=null,a=1,o=null,s="local-floor",l=null,u=null,c=null,h=null,d=null,p=!1,f=null,m=null,g=null,v=null,y=null,x=null;const b=[],w=new Map,M=new Ra;M.layers.enable(1),M.viewport=new li;const _=new Ra;_.layers.enable(2),_.viewport=new li;const S=[M,_],T=new bl;T.layers.enable(1),T.layers.enable(2);let E=null,A=null;function C(e){const t=w.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function R(){w.forEach((function(e,t){e.disconnect(t)})),w.clear(),E=null,A=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),c&&t.deleteFramebuffer(c),f&&t.deleteFramebuffer(f),m&&t.deleteRenderbuffer(m),g&&t.deleteRenderbuffer(g),c=null,f=null,m=null,g=null,d=null,h=null,u=null,r=null,k.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function L(e){const t=r.inputSources;for(let e=0;e<b.length;e++)w.set(t[e],b[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=w.get(n);i&&(i.dispatchEvent({type:"disconnected",data:n}),w.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],i=w.get(n);i&&i.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=b[e];return void 0===t&&(t=new _l,b[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=b[e];return void 0===t&&(t=new _l,b[e]=t),t.getGripSpace()},this.getHand=function(e){let t=b[e];return void 0===t&&(t=new _l,b[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return null!==h?h:d},this.getBinding=function(){return u},this.getFrame=function(){return v},this.getSession=function(){return r},this.setSession=async function(e){if(r=e,null!==r){r.addEventListener("select",C),r.addEventListener("selectstart",C),r.addEventListener("selectend",C),r.addEventListener("squeeze",C),r.addEventListener("squeezestart",C),r.addEventListener("squeezeend",C),r.addEventListener("end",R),r.addEventListener("inputsourceschange",L);const e=t.getContextAttributes();if(!0!==e.xrCompatible&&await t.makeXRCompatible(),void 0===r.renderState.layers){const n={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:a};d=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:d})}else if(t instanceof WebGLRenderingContext){const n={antialias:!0,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:a};d=new XRWebGLLayer(r,t,n),r.updateRenderState({layers:[d]})}else{p=e.antialias;let n=null;e.depth&&(x=256,e.stencil&&(x|=1024),y=e.stencil?33306:36096,n=e.stencil?35056:33190);const o={colorFormat:e.alpha?32856:32849,depthFormat:n,scaleFactor:a};u=new XRWebGLBinding(r,t),h=u.createProjectionLayer(o),c=t.createFramebuffer(),r.updateRenderState({layers:[h]}),p&&(f=t.createFramebuffer(),m=t.createRenderbuffer(),t.bindRenderbuffer(36161,m),t.renderbufferStorageMultisample(36161,4,32856,h.textureWidth,h.textureHeight),i.bindFramebuffer(36160,f),t.framebufferRenderbuffer(36160,36064,36161,m),t.bindRenderbuffer(36161,null),null!==n&&(g=t.createRenderbuffer(),t.bindRenderbuffer(36161,g),t.renderbufferStorageMultisample(36161,4,n,h.textureWidth,h.textureHeight),t.framebufferRenderbuffer(36160,y,36161,g),t.bindRenderbuffer(36161,null)),i.bindFramebuffer(36160,null))}o=await r.requestReferenceSpace(s),k.setContext(r),k.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const I=new pi,P=new pi;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;T.near=_.near=M.near=e.near,T.far=_.far=M.far=e.far,E===T.near&&A===T.far||(r.updateRenderState({depthNear:T.near,depthFar:T.far}),E=T.near,A=T.far);const t=e.parent,n=T.cameras;D(T,t);for(let e=0;e<n.length;e++)D(n[e],t);T.matrixWorld.decompose(T.position,T.quaternion,T.scale),e.position.copy(T.position),e.quaternion.copy(T.quaternion),e.scale.copy(T.scale),e.matrix.copy(T.matrix),e.matrixWorld.copy(T.matrixWorld);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){I.setFromMatrixPosition(t.matrixWorld),P.setFromMatrixPosition(n.matrixWorld);const i=I.distanceTo(P),r=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=r[14]/(r[10]-1),s=r[14]/(r[10]+1),l=(r[9]+1)/r[5],u=(r[9]-1)/r[5],c=(r[8]-1)/r[0],h=(a[8]+1)/a[0],d=o*c,p=o*h,f=i/(-c+h),m=f*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+f,v=s+f,y=d-m,x=p+(i-m),b=l*s/v*g,w=u*s/v*g;e.projectionMatrix.makePerspective(y,x,b,w,g,v)}(T,M,_):T.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return T},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==d?d.fixedFoveation:void 0},this.setFoveation=function(e){null!==h&&(h.fixedFoveation=e),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=e)};let N=null;const k=new Ha;k.setAnimationLoop((function(e,n){if(l=n.getViewerPose(o),v=n,null!==l){const e=l.views;null!==d&&i.bindXRFramebuffer(d.framebuffer);let n=!1;e.length!==T.cameras.length&&(T.cameras.length=0,n=!0);for(let r=0;r<e.length;r++){const a=e[r];let o=null;if(null!==d)o=d.getViewport(a);else{const e=u.getViewSubImage(h,a);i.bindXRFramebuffer(c),void 0!==e.depthStencilTexture&&t.framebufferTexture2D(36160,y,3553,e.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,e.colorTexture,0),o=e.viewport}const s=S[r];s.matrix.fromArray(a.transform.matrix),s.projectionMatrix.fromArray(a.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===r&&T.matrix.copy(s.matrix),!0===n&&T.cameras.push(s)}p&&(i.bindXRFramebuffer(f),null!==x&&t.clear(x))}const a=r.inputSources;for(let e=0;e<b.length;e++){const t=b[e],i=a[e];t.update(i,n,o)}if(N&&N(e,n),p){const e=h.textureWidth,n=h.textureHeight;i.bindFramebuffer(36008,f),i.bindFramebuffer(36009,c),t.invalidateFramebuffer(36008,[y]),t.invalidateFramebuffer(36009,[y]),t.blitFramebuffer(0,0,e,n,0,0,e,n,16384,9728),t.invalidateFramebuffer(36008,[36064]),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),i.bindFramebuffer(36160,f)}v=null})),this.setAnimationLoop=function(e){N=e},this.dispose=function(){}}}function Tl(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap),n.alphaTest>0&&(t.alphaTest.value=n.alphaTest);const i=e.get(n).envMap;if(i){t.envMap.value=i,t.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,t.reflectivity.value=n.reflectivity,t.ior.value=n.ior,t.refractionRatio.value=n.refractionRatio;const r=e.get(i).__maxMipLevel;void 0!==r&&(t.maxMipLevel.value=r)}let r,a;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap?r=n.clearcoatRoughnessMap:n.specularIntensityMap?r=n.specularIntensityMap:n.specularColorMap?r=n.specularColorMap:n.transmissionMap?r=n.transmissionMap:n.thicknessMap?r=n.thicknessMap:n.sheenColorMap?r=n.sheenColorMap:n.sheenRoughnessMap&&(r=n.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),n.aoMap?a=n.aoMap:n.lightMap&&(a=n.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),t.uv2Transform.value.copy(a.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,n.side===m&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),n.side===m&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,r,a,o){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t,i){n(e,t),e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap)),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===m&&e.clearcoatNormalScale.value.negate())),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,i,o):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDistanceMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===m&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===m&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,i,r,a):i.isSpriteMaterial?function(e,t){let n;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?n=t.map:t.alphaMap&&(n=t.alphaMap),void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function El(e={}){const t=void 0!==e.canvas?e.canvas:function(){const e=ti("canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,d=null;const p=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Jt,this.physicallyCorrectLights=!1,this.toneMapping=$,this.toneMappingExposure=1;const y=this;let x=!1,b=0,w=0,M=null,_=-1,S=null;const T=new li,E=new li;let A=null,C=t.width,R=t.height,L=1,I=null,P=null;const D=new li(0,0,C,R),N=new li(0,0,C,R);let k=!1;const O=[],U=new za;let F=!1,B=!1,z=null;const H=new Vi,G=new pi,j={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function V(){return null===M?L:1}let W,q,X,K,Y,J,Z,Q,ee,te,ne,ie,re,ae,oe,se,le,ue,ce,he,pe,me,ge,ve=n;function ye(e,n){for(let i=0;i<e.length;i++){const r=e[i],a=t.getContext(r,n);if(null!==a)return a}return null}try{const e={alpha:i,depth:r,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:c};if(t.addEventListener("webglcontextlost",we,!1),t.addEventListener("webglcontextrestored",_e,!1),null===ve){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),ve=ye(t,e),null===ve)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ve.getShaderPrecisionFormat&&(ve.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function xe(){W=new _o(ve),q=new Ja(ve,W,e),W.init(q),me=new xl(ve,W,q),X=new vl(ve,W,q),O[0]=1029,K=new Eo(ve),Y=new il,J=new yl(ve,W,X,Y,q,me,K),Z=new $a(y),Q=new Mo(y),ee=new Ga(ve,q),ge=new Ka(ve,W,ee,q),te=new So(ve,ee,K,ge),ne=new Po(ve,te,ee,K),ce=new Io(ve,q,J),se=new Za(Y),ie=new nl(y,Z,Q,W,q,ge,se),re=new Tl(Y),ae=new sl(Y),oe=new pl(W,q),ue=new Xa(y,Z,X,ne,s),le=new gl(y,ne,q),he=new Ya(ve,W,K,q),pe=new To(ve,W,K,q),K.programs=ie.programs,y.capabilities=q,y.extensions=W,y.properties=Y,y.renderLists=ae,y.shadowMap=le,y.state=X,y.info=K}xe();const be=new Sl(y,ve);function we(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function _e(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const e=K.autoReset,t=le.enabled,n=le.autoUpdate,i=le.needsUpdate,r=le.type;xe(),K.autoReset=e,le.enabled=t,le.autoUpdate=n,le.needsUpdate=i,le.type=r}function Te(e){const t=e.target;t.removeEventListener("dispose",Te),function(e){(function(e){const t=Y.get(e).programs;void 0!==t&&t.forEach((function(e){ie.releaseProgram(e)}))})(e),Y.remove(e)}(t)}this.xr=be,this.getContext=function(){return ve},this.getContextAttributes=function(){return ve.getContextAttributes()},this.forceContextLoss=function(){const e=W.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=W.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function(e){void 0!==e&&(L=e,this.setSize(C,R,!1))},this.getSize=function(e){return e.set(C,R)},this.setSize=function(e,n,i){be.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(C=e,R=n,t.width=Math.floor(e*L),t.height=Math.floor(n*L),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(C*L,R*L).floor()},this.setDrawingBufferSize=function(e,n,i){C=e,R=n,L=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(T)},this.getViewport=function(e){return e.copy(D)},this.setViewport=function(e,t,n,i){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,n,i),X.viewport(T.copy(D).multiplyScalar(L).floor())},this.getScissor=function(e){return e.copy(N)},this.setScissor=function(e,t,n,i){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,i),X.scissor(E.copy(N).multiplyScalar(L).floor())},this.getScissorTest=function(){return k},this.setScissorTest=function(e){X.setScissorTest(k=e)},this.setOpaqueSort=function(e){I=e},this.setTransparentSort=function(e){P=e},this.getClearColor=function(e){return e.copy(ue.getClearColor())},this.setClearColor=function(){ue.setClearColor.apply(ue,arguments)},this.getClearAlpha=function(){return ue.getClearAlpha()},this.setClearAlpha=function(){ue.setClearAlpha.apply(ue,arguments)},this.clear=function(e,t,n){let i=0;(void 0===e||e)&&(i|=16384),(void 0===t||t)&&(i|=256),(void 0===n||n)&&(i|=1024),ve.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",we,!1),t.removeEventListener("webglcontextrestored",_e,!1),ae.dispose(),oe.dispose(),Y.dispose(),Z.dispose(),Q.dispose(),ne.dispose(),ge.dispose(),be.dispose(),be.removeEventListener("sessionstart",Ae),be.removeEventListener("sessionend",Ce),z&&(z.dispose(),z=null),Re.stop()},this.renderBufferDirect=function(e,t,n,i,r,a){null===t&&(t=j);const o=r.isMesh&&r.matrixWorld.determinant()<0,s=function(e,t,n,i,r){!0!==t.isScene&&(t=j),J.resetTextureUnits();const a=t.fog,o=i.isMeshStandardMaterial?t.environment:null,s=null===M?y.outputEncoding:M.texture.encoding,l=(i.isMeshStandardMaterial?Q:Z).get(i.envMap||o),u=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!i.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,p=!!n.morphAttributes.normal,f=n.morphAttributes.position?n.morphAttributes.position.length:0,m=Y.get(i),g=d.state.lights;if(!0===F&&(!0===B||e!==S)){const t=e===S&&i.id===_;se.setState(i,e,t)}let v=!1;i.version===m.__version?m.needsLights&&m.lightsStateVersion!==g.state.version||m.outputEncoding!==s||r.isInstancedMesh&&!1===m.instancing?v=!0:r.isInstancedMesh||!0!==m.instancing?r.isSkinnedMesh&&!1===m.skinning?v=!0:r.isSkinnedMesh||!0!==m.skinning?m.envMap!==l||i.fog&&m.fog!==a?v=!0:void 0===m.numClippingPlanes||m.numClippingPlanes===se.numPlanes&&m.numIntersection===se.numIntersection?(m.vertexAlphas!==u||m.vertexTangents!==c||m.morphTargets!==h||m.morphNormals!==p||!0===q.isWebGL2&&m.morphTargetsCount!==f)&&(v=!0):v=!0:v=!0:v=!0:(v=!0,m.__version=i.version);let x=m.currentProgram;!0===v&&(x=Oe(i,t,r));let b=!1,w=!1,T=!1;const E=x.getUniforms(),A=m.uniforms;if(X.useProgram(x.program)&&(b=!0,w=!0,T=!0),i.id!==_&&(_=i.id,w=!0),b||S!==e){if(E.setValue(ve,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&E.setValue(ve,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),S!==e&&(S=e,w=!0,T=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const t=E.map.cameraPosition;void 0!==t&&t.setValue(ve,G.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&E.setValue(ve,"isOrthographic",!0===e.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&E.setValue(ve,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){E.setOptional(ve,r,"bindMatrix"),E.setOptional(ve,r,"bindMatrixInverse");const e=r.skeleton;e&&(q.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),E.setValue(ve,"boneTexture",e.boneTexture,J),E.setValue(ve,"boneTextureSize",e.boneTextureSize)):E.setOptional(ve,e,"boneMatrices"))}var C,I;return!n||void 0===n.morphAttributes.position&&void 0===n.morphAttributes.normal||ce.update(r,n,i,x),(w||m.receiveShadow!==r.receiveShadow)&&(m.receiveShadow=r.receiveShadow,E.setValue(ve,"receiveShadow",r.receiveShadow)),w&&(E.setValue(ve,"toneMappingExposure",y.toneMappingExposure),m.needsLights&&(I=T,(C=A).ambientLightColor.needsUpdate=I,C.lightProbe.needsUpdate=I,C.directionalLights.needsUpdate=I,C.directionalLightShadows.needsUpdate=I,C.pointLights.needsUpdate=I,C.pointLightShadows.needsUpdate=I,C.spotLights.needsUpdate=I,C.spotLightShadows.needsUpdate=I,C.rectAreaLights.needsUpdate=I,C.hemisphereLights.needsUpdate=I),a&&i.fog&&re.refreshFogUniforms(A,a),re.refreshMaterialUniforms(A,i,L,R,z),ks.upload(ve,m.uniformsList,A,J)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(ks.upload(ve,m.uniformsList,A,J),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&E.setValue(ve,"center",r.center),E.setValue(ve,"modelViewMatrix",r.modelViewMatrix),E.setValue(ve,"normalMatrix",r.normalMatrix),E.setValue(ve,"modelMatrix",r.matrixWorld),x}(e,t,n,i,r);X.setMaterial(i,o);let l=n.index;const u=n.attributes.position;if(null===l){if(void 0===u||0===u.count)return}else if(0===l.count)return;let c,h=1;!0===i.wireframe&&(l=te.getWireframeAttribute(n),h=2),ge.setup(r,i,s,n,l);let p=he;null!==l&&(c=ee.get(l),p=pe,p.setIndex(c));const f=null!==l?l.count:u.count,m=n.drawRange.start*h,g=n.drawRange.count*h,v=null!==a?a.start*h:0,x=null!==a?a.count*h:1/0,b=Math.max(m,v),w=Math.min(f,m+g,v+x)-1,T=Math.max(0,w-b+1);if(0!==T){if(r.isMesh)!0===i.wireframe?(X.setLineWidth(i.wireframeLinewidth*V()),p.setMode(1)):p.setMode(4);else if(r.isLine){let e=i.linewidth;void 0===e&&(e=1),X.setLineWidth(e*V()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(b,T,r.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);p.renderInstances(b,T,e)}else p.render(b,T)}},this.compile=function(e,t){d=oe.get(e),d.init(),v.push(d),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(y.physicallyCorrectLights),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++)Oe(n[i],e,t);else Oe(n,e,t)})),v.pop(),d=null};let Ee=null;function Ae(){Re.stop()}function Ce(){Re.start()}const Re=new Ha;function Pe(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){i&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=ne.update(e),r=e.material;r.visible&&h.push(e,t,r,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==K.render.frame&&(e.skeleton.update(),e.skeleton.frame=K.render.frame),!e.frustumCulled||U.intersectsObject(e))){i&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=ne.update(e),r=e.material;if(Array.isArray(r)){const i=t.groups;for(let a=0,o=i.length;a<o;a++){const o=i[a],s=r[o.materialIndex];s&&s.visible&&h.push(e,t,s,n,G.z,o)}}else r.visible&&h.push(e,t,r,n,G.z,null)}const r=e.children;for(let e=0,a=r.length;e<a;e++)Pe(r[e],t,n,i)}function De(e,t,n,i){const r=e.opaque,a=e.transmissive,s=e.transparent;d.setupLightsView(n),a.length>0&&function(e,t,n){if(null===z){const e=!0===o&&!0===q.isWebGL2;z=new(e?hi:ui)(1024,1024,{generateMipmaps:!0,type:null!==me.convert(Ie)?Ie:Se,minFilter:Me,magFilter:fe,wrapS:de,wrapT:de})}const i=y.getRenderTarget();y.setRenderTarget(z),y.clear();const r=y.toneMapping;y.toneMapping=$,Ne(e,t,n),y.toneMapping=r,J.updateMultisampleRenderTarget(z),J.updateRenderTargetMipmap(z),y.setRenderTarget(i)}(r,t,n),i&&X.viewport(T.copy(i)),r.length>0&&Ne(r,t,n),a.length>0&&Ne(a,t,n),s.length>0&&Ne(s,t,n)}function Ne(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let r=0,a=e.length;r<a;r++){const a=e[r],o=a.object,s=a.geometry,l=null===i?a.material:i,u=a.group;o.layers.test(n.layers)&&ke(o,t,n,s,l,u)}}function ke(e,t,n,i,r,a){e.onBeforeRender(y,t,n,i,r,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(y,t,n,i,e,a),!0===r.transparent&&r.side===g?(r.side=m,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,a),r.side=f,r.needsUpdate=!0,y.renderBufferDirect(n,t,i,r,e,a),r.side=g):y.renderBufferDirect(n,t,i,r,e,a),e.onAfterRender(y,t,n,i,r,a)}function Oe(e,t,n){!0!==t.isScene&&(t=j);const i=Y.get(e),r=d.state.lights,a=d.state.shadowsArray,o=r.state.version,s=ie.getParameters(e,r.state,a,t,n),l=ie.getProgramCacheKey(s);let u=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?Q:Z).get(e.envMap||i.environment),void 0===u&&(e.addEventListener("dispose",Te),u=new Map,i.programs=u);let c=u.get(l);if(void 0!==c){if(i.currentProgram===c&&i.lightsStateVersion===o)return Ue(e,s),c}else s.uniforms=ie.getUniforms(e),e.onBuild(n,s,y),e.onBeforeCompile(s,y),c=ie.acquireProgram(s,l),u.set(l,c),i.uniforms=s.uniforms;const h=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=se.uniform),Ue(e,s),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(h.ambientLightColor.value=r.state.ambient,h.lightProbe.value=r.state.probe,h.directionalLights.value=r.state.directional,h.directionalLightShadows.value=r.state.directionalShadow,h.spotLights.value=r.state.spot,h.spotLightShadows.value=r.state.spotShadow,h.rectAreaLights.value=r.state.rectArea,h.ltc_1.value=r.state.rectAreaLTC1,h.ltc_2.value=r.state.rectAreaLTC2,h.pointLights.value=r.state.point,h.pointLightShadows.value=r.state.pointShadow,h.hemisphereLights.value=r.state.hemi,h.directionalShadowMap.value=r.state.directionalShadowMap,h.directionalShadowMatrix.value=r.state.directionalShadowMatrix,h.spotShadowMap.value=r.state.spotShadowMap,h.spotShadowMatrix.value=r.state.spotShadowMatrix,h.pointShadowMap.value=r.state.pointShadowMap,h.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=c.getUniforms(),f=ks.seqWithValue(p.seq,h);return i.currentProgram=c,i.uniformsList=f,c}function Ue(e,t){const n=Y.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents}Re.setAnimationLoop((function(e){Ee&&Ee(e)})),"undefined"!=typeof window&&Re.setContext(window),this.setAnimationLoop=function(e){Ee=e,be.setAnimationLoop(e),null===e?Re.stop():Re.start()},be.addEventListener("sessionstart",Ae),be.addEventListener("sessionend",Ce),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===x)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===be.enabled&&!0===be.isPresenting&&(!0===be.cameraAutoUpdate&&be.updateCamera(t),t=be.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,M),d=oe.get(e,v.length),d.init(),v.push(d),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(H),B=this.localClippingEnabled,F=se.init(this.clippingPlanes,B,t),h=ae.get(e,p.length),h.init(),p.push(h),Pe(e,t,0,y.sortObjects),h.finish(),!0===y.sortObjects&&h.sort(I,P),!0===F&&se.beginShadows();const n=d.state.shadowsArray;if(le.render(n,e,t),!0===F&&se.endShadows(),!0===this.info.autoReset&&this.info.reset(),ue.render(h,e),d.setupLights(y.physicallyCorrectLights),t.isArrayCamera){const n=t.cameras;for(let t=0,i=n.length;t<i;t++){const i=n[t];De(h,e,i,i.viewport)}}else De(h,e,t);null!==M&&(J.updateMultisampleRenderTarget(M),J.updateRenderTargetMipmap(M)),!0===e.isScene&&e.onAfterRender(y,e,t),X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1),ge.resetDefaultState(),_=-1,S=null,v.pop(),d=v.length>0?v[v.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return M},this.setRenderTarget=function(e,t=0,n=0){M=e,b=t,w=n,e&&void 0===Y.get(e).__webglFramebuffer&&J.setupRenderTarget(e);let i=null,r=!1,a=!1;if(e){const n=e.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(a=!0);const o=Y.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=o[t],r=!0):i=e.isWebGLMultisampleRenderTarget?Y.get(e).__webglMultisampledFramebuffer:o,T.copy(e.viewport),E.copy(e.scissor),A=e.scissorTest}else T.copy(D).multiplyScalar(L).floor(),E.copy(N).multiplyScalar(L).floor(),A=k;if(X.bindFramebuffer(36160,i)&&q.drawBuffers){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const n=e.texture;if(O.length!==n.length||36064!==O[0]){for(let e=0,t=n.length;e<t;e++)O[e]=36064+e;O.length=n.length,t=!0}}else 1===O.length&&36064===O[0]||(O[0]=36064,O.length=1,t=!0);else 1===O.length&&1029===O[0]||(O[0]=1029,O.length=1,t=!0);t&&(q.isWebGL2?ve.drawBuffers(O):W.get("WEBGL_draw_buffers").drawBuffersWEBGL(O))}if(X.viewport(T),X.scissor(E),X.setScissorTest(A),r){const i=Y.get(e.texture);ve.framebufferTexture2D(36160,36064,34069+t,i.__webglTexture,n)}else if(a){const i=Y.get(e.texture),r=t||0;ve.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}_=-1},this.readRenderTargetPixels=function(e,t,n,i,r,a,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let s=Y.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){X.bindFramebuffer(36160,s);try{const o=e.texture,s=o.format,l=o.type;if(s!==Fe&&me.convert(s)!==ve.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const u=l===Ie&&(W.has("EXT_color_buffer_half_float")||q.isWebGL2&&W.has("EXT_color_buffer_float"));if(!(l===Se||me.convert(l)===ve.getParameter(35738)||l===Le&&(q.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ve.checkFramebufferStatus(36160)?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&ve.readPixels(t,n,i,r,me.convert(s),me.convert(l),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==M?Y.get(M).__webglFramebuffer:null;X.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),r=Math.floor(t.image.width*i),a=Math.floor(t.image.height*i);let o=me.convert(t.format);q.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),J.setTexture2D(t,0),ve.copyTexImage2D(3553,n,o,e.x,e.y,r,a,0),X.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const r=t.image.width,a=t.image.height,o=me.convert(n.format),s=me.convert(n.type);J.setTexture2D(n,0),ve.pixelStorei(37440,n.flipY),ve.pixelStorei(37441,n.premultiplyAlpha),ve.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?ve.texSubImage2D(3553,i,e.x,e.y,r,a,o,s,t.image.data):t.isCompressedTexture?ve.compressedTexSubImage2D(3553,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ve.texSubImage2D(3553,i,e.x,e.y,o,s,t.image),0===i&&n.generateMipmaps&&ve.generateMipmap(3553),X.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,r=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const a=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,s=e.max.z-e.min.z+1,l=me.convert(i.format),u=me.convert(i.type);let c;if(i.isDataTexture3D)J.setTexture3D(i,0),c=32879;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(i,0),c=35866}ve.pixelStorei(37440,i.flipY),ve.pixelStorei(37441,i.premultiplyAlpha),ve.pixelStorei(3317,i.unpackAlignment);const h=ve.getParameter(3314),d=ve.getParameter(32878),p=ve.getParameter(3316),f=ve.getParameter(3315),m=ve.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;ve.pixelStorei(3314,g.width),ve.pixelStorei(32878,g.height),ve.pixelStorei(3316,e.min.x),ve.pixelStorei(3315,e.min.y),ve.pixelStorei(32877,e.min.z),n.isDataTexture||n.isDataTexture3D?ve.texSubImage3D(c,r,t.x,t.y,t.z,a,o,s,l,u,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ve.compressedTexSubImage3D(c,r,t.x,t.y,t.z,a,o,s,l,g.data)):ve.texSubImage3D(c,r,t.x,t.y,t.z,a,o,s,l,u,g),ve.pixelStorei(3314,h),ve.pixelStorei(32878,d),ve.pixelStorei(3316,p),ve.pixelStorei(3315,f),ve.pixelStorei(32877,m),0===r&&i.generateMipmaps&&ve.generateMipmap(c),X.unbindTexture()},this.initTexture=function(e){J.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){b=0,w=0,M=null,X.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}El.prototype.isWebGLRenderer=!0;class Al extends El{}Al.prototype.isWebGL1Renderer=!0;class Cl{constructor(e,t=25e-5){this.name="",this.color=new kr(e),this.density=t}clone(){return new Cl(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Cl.prototype.isFogExp2=!0;class Rl{constructor(e,t=1,n=1e3){this.name="",this.color=new kr(e),this.near=t,this.far=n}clone(){return new Rl(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Rl.prototype.isFog=!0;class Ll extends mr{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}Ll.prototype.isScene=!0;class Il{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Tn,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Gn()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Gn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Gn()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Il.prototype.isInterleavedBuffer=!0;const Pl=new pi;class Dl{constructor(e,t,n,i=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Pl.x=this.getX(t),Pl.y=this.getY(t),Pl.z=this.getZ(t),Pl.applyMatrix4(e),this.setXYZ(t,Pl.x,Pl.y,Pl.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Pl.x=this.getX(t),Pl.y=this.getY(t),Pl.z=this.getZ(t),Pl.applyNormalMatrix(e),this.setXYZ(t,Pl.x,Pl.y,Pl.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Pl.x=this.getX(t),Pl.y=this.getY(t),Pl.z=this.getZ(t),Pl.transformDirection(e),this.setXYZ(t,Pl.x,Pl.y,Pl.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Br(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Dl(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}Dl.prototype.isInterleavedBufferAttribute=!0;class Nl extends Cr{constructor(e){super(),this.type="SpriteMaterial",this.color=new kr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let kl;Nl.prototype.isSpriteMaterial=!0;const Ol=new pi,Ul=new pi,Fl=new pi,Bl=new Jn,zl=new Jn,Hl=new Vi,Gl=new pi,jl=new pi,Vl=new pi,Wl=new Jn,ql=new Jn,Xl=new Jn;class Kl extends mr{constructor(e){if(super(),this.type="Sprite",void 0===kl){kl=new ia;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Il(e,5);kl.setIndex([0,1,2,0,2,3]),kl.setAttribute("position",new Dl(t,3,0,!1)),kl.setAttribute("uv",new Dl(t,2,3,!1))}this.geometry=kl,this.material=void 0!==e?e:new Nl,this.center=new Jn(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ul.setFromMatrixScale(this.matrixWorld),Hl.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Fl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ul.multiplyScalar(-Fl.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const a=this.center;Yl(Gl.set(-.5,-.5,0),Fl,a,Ul,i,r),Yl(jl.set(.5,-.5,0),Fl,a,Ul,i,r),Yl(Vl.set(.5,.5,0),Fl,a,Ul,i,r),Wl.set(0,0),ql.set(1,0),Xl.set(1,1);let o=e.ray.intersectTriangle(Gl,jl,Vl,!1,Ol);if(null===o&&(Yl(jl.set(-.5,.5,0),Fl,a,Ul,i,r),ql.set(0,1),o=e.ray.intersectTriangle(Gl,Vl,jl,!1,Ol),null===o))return;const s=e.ray.origin.distanceTo(Ol);s<e.near||s>e.far||t.push({distance:s,point:Ol.clone(),uv:Er.getUV(Ol,Gl,jl,Vl,Wl,ql,Xl,new Jn),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Yl(e,t,n,i,r,a){Bl.subVectors(e,n).addScalar(.5).multiply(i),void 0!==r?(zl.x=a*Bl.x-r*Bl.y,zl.y=r*Bl.x+a*Bl.y):zl.copy(Bl),e.copy(t),e.x+=zl.x,e.y+=zl.y,e.applyMatrix4(Hl)}Kl.prototype.isSprite=!0;const Jl=new pi,Zl=new pi;class $l extends mr{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let i;for(i=0;i<n.length&&!(t<n[i].distance);i++);return n.splice(i,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Jl.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Jl);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Jl.setFromMatrixPosition(e.matrixWorld),Zl.setFromMatrixPosition(this.matrixWorld);const n=Jl.distanceTo(Zl)/e.zoom;let i,r;for(t[0].object.visible=!0,i=1,r=t.length;i<r&&n>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,i=n.length;e<i;e++){const i=n[e];t.object.levels.push({object:i.object.uuid,distance:i.distance})}return t}}const Ql=new pi,eu=new li,tu=new li,nu=new pi,iu=new Vi;class ru extends wa{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Vi,this.bindMatrixInverse=new Vi}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new li,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,i=this.geometry;eu.fromBufferAttribute(i.attributes.skinIndex,e),tu.fromBufferAttribute(i.attributes.skinWeight,e),Ql.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const i=tu.getComponent(e);if(0!==i){const r=eu.getComponent(e);iu.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),t.addScaledVector(nu.copy(Ql).applyMatrix4(iu),i)}}return t.applyMatrix4(this.bindMatrixInverse)}}ru.prototype.isSkinnedMesh=!0;class au extends mr{constructor(){super(),this.type="Bone"}}au.prototype.isBone=!0;class ou extends oi{constructor(e=null,t=1,n=1,i,r,a,o,s,l=fe,u=fe,c,h){super(null,a,o,s,l,u,i,r,c,h),this.image={data:e,width:t,height:n},this.magFilter=l,this.minFilter=u,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}ou.prototype.isDataTexture=!0;const su=new Vi,lu=new Vi;class uu{constructor(e=[],t=[]){this.uuid=Gn(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Vi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Vi;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=e.length;i<r;i++){const r=e[i]?e[i].matrixWorld:lu;su.multiplyMatrices(r,t[i]),su.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new uu(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Xn(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new ou(t,e,e,Fe,Le);return this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let r=t[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new au),this.bones.push(r),this.boneInverses.push((new Vi).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,r=t.length;i<r;i++){const r=t[i];e.bones.push(r.uuid);const a=n[i];e.boneInverses.push(a.toArray())}return e}}class cu extends Br{constructor(e,t,n,i=1){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}cu.prototype.isInstancedBufferAttribute=!0;const hu=new Vi,du=new Vi,pu=[],fu=new wa;class mu extends wa{constructor(e,t,n){super(e,t),this.instanceMatrix=new cu(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,i=this.count;if(fu.geometry=this.geometry,fu.material=this.material,void 0!==fu.material)for(let r=0;r<i;r++){this.getMatrixAt(r,hu),du.multiplyMatrices(n,hu),fu.matrixWorld=du,fu.raycast(e,pu);for(let e=0,n=pu.length;e<n;e++){const n=pu[e];n.instanceId=r,n.object=this,t.push(n)}pu.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new cu(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}mu.prototype.isInstancedMesh=!0;class gu extends Cr{constructor(e){super(),this.type="LineBasicMaterial",this.color=new kr(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}gu.prototype.isLineBasicMaterial=!0;const vu=new pi,yu=new pi,xu=new Vi,bu=new ji,wu=new ki;class Mu extends mr{constructor(e=new ia,t=new gu){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)vu.fromBufferAttribute(t,e-1),yu.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=vu.distanceTo(yu);e.setAttribute("lineDistance",new Kr(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),wu.copy(n.boundingSphere),wu.applyMatrix4(i),wu.radius+=r,!1===e.ray.intersectsSphere(wu))return;xu.copy(i).invert(),bu.copy(e.ray).applyMatrix4(xu);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,l=new pi,u=new pi,c=new pi,h=new pi,d=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position;if(null!==i)for(let n=Math.max(0,a.start),o=Math.min(i.count,a.start+a.count)-1;n<o;n+=d){const a=i.getX(n),o=i.getX(n+1);if(l.fromBufferAttribute(r,a),u.fromBufferAttribute(r,o),bu.distanceSqToSegment(l,u,h,c)>s)continue;h.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(h);d<e.near||d>e.far||t.push({distance:d,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}else for(let n=Math.max(0,a.start),i=Math.min(r.count,a.start+a.count)-1;n<i;n+=d){if(l.fromBufferAttribute(r,n),u.fromBufferAttribute(r,n+1),bu.distanceSqToSegment(l,u,h,c)>s)continue;h.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(h);i<e.near||i>e.far||t.push({distance:i,point:c.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Mu.prototype.isLine=!0;const _u=new pi,Su=new pi;class Tu extends Mu{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)_u.fromBufferAttribute(t,e),Su.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+_u.distanceTo(Su);e.setAttribute("lineDistance",new Kr(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}Tu.prototype.isLineSegments=!0;class Eu extends Mu{constructor(e,t){super(e,t),this.type="LineLoop"}}Eu.prototype.isLineLoop=!0;class Au extends Cr{constructor(e){super(),this.type="PointsMaterial",this.color=new kr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}Au.prototype.isPointsMaterial=!0;const Cu=new Vi,Ru=new ji,Lu=new ki,Iu=new pi;class Pu extends mr{constructor(e=new ia,t=new Au){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,r=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Lu.copy(n.boundingSphere),Lu.applyMatrix4(i),Lu.radius+=r,!1===e.ray.intersectsSphere(Lu))return;Cu.copy(i).invert(),Ru.copy(e.ray).applyMatrix4(Cu);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position;if(null!==r)for(let n=Math.max(0,a.start),l=Math.min(r.count,a.start+a.count);n<l;n++){const a=r.getX(n);Iu.fromBufferAttribute(o,a),Du(Iu,a,s,i,e,t,this)}else for(let n=Math.max(0,a.start),r=Math.min(o.count,a.start+a.count);n<r;n++)Iu.fromBufferAttribute(o,n),Du(Iu,n,s,i,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function Du(e,t,n,i,r,a,o){const s=Ru.distanceSqToPoint(e);if(s<n){const n=new pi;Ru.closestPointToPoint(e,n),n.applyMatrix4(i);const l=r.ray.origin.distanceTo(n);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:n,index:t,face:null,object:o})}}Pu.prototype.isPoints=!0;class Nu extends oi{constructor(e,t,n,i,r,a,o,s,l){super(e,t,n,i,r,a,o,s,l),this.format=void 0!==o?o:Ue,this.minFilter=void 0!==a?a:xe,this.magFilter=void 0!==r?r:xe,this.generateMipmaps=!1;const u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){u.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1=="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}Nu.prototype.isVideoTexture=!0;class ku extends oi{constructor(e,t,n,i,r,a,o,s,l,u,c,h){super(null,a,o,s,l,u,i,r,c,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}ku.prototype.isCompressedTexture=!0;class Ou extends oi{constructor(e,t,n,i,r,a,o,s,l){super(e,t,n,i,r,a,o,s,l),this.needsUpdate=!0}}Ou.prototype.isCanvasTexture=!0;class Uu extends oi{constructor(e,t,n,i,r,a,o,s,l,u){if((u=void 0!==u?u:Ge)!==Ge&&u!==je)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===Ge&&(n=Ae),void 0===n&&u===je&&(n=ke),super(null,i,r,a,o,s,u,n,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:fe,this.minFilter=void 0!==s?s:fe,this.flipY=!1,this.generateMipmaps=!1}}Uu.prototype.isDepthTexture=!0;class Fu extends ia{constructor(e=1,t=8,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const r=[],a=[],o=[],s=[],l=new pi,u=new Jn;a.push(0,0,0),o.push(0,0,1),s.push(.5,.5);for(let r=0,c=3;r<=t;r++,c+=3){const h=n+r/t*i;l.x=e*Math.cos(h),l.y=e*Math.sin(h),a.push(l.x,l.y,l.z),o.push(0,0,1),u.x=(a[c]/e+1)/2,u.y=(a[c+1]/e+1)/2,s.push(u.x,u.y)}for(let e=1;e<=t;e++)r.push(e,e+1,0);this.setIndex(r),this.setAttribute("position",new Kr(a,3)),this.setAttribute("normal",new Kr(o,3)),this.setAttribute("uv",new Kr(s,2))}static fromJSON(e){return new Fu(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Bu extends ia{constructor(e=1,t=1,n=1,i=8,r=1,a=!1,o=0,s=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:s};const l=this;i=Math.floor(i),r=Math.floor(r);const u=[],c=[],h=[],d=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const r=p,a=new Jn,f=new pi;let v=0;const y=!0===n?e:t,x=!0===n?1:-1;for(let e=1;e<=i;e++)c.push(0,m*x,0),h.push(0,x,0),d.push(.5,.5),p++;const b=p;for(let e=0;e<=i;e++){const t=e/i*s+o,n=Math.cos(t),r=Math.sin(t);f.x=y*r,f.y=m*x,f.z=y*n,c.push(f.x,f.y,f.z),h.push(0,x,0),a.x=.5*n+.5,a.y=.5*r*x+.5,d.push(a.x,a.y),p++}for(let e=0;e<i;e++){const t=r+e,i=b+e;!0===n?u.push(i,i+1,t):u.push(i+1,i,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const a=new pi,v=new pi;let y=0;const x=(t-e)/n;for(let l=0;l<=r;l++){const u=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=i;e++){const t=e/i,r=t*s+o,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*n+m,v.z=y*f,c.push(v.x,v.y,v.z),a.set(l,x,f).normalize(),h.push(a.x,a.y,a.z),d.push(t,1-g),u.push(p++)}f.push(u)}for(let e=0;e<i;e++)for(let t=0;t<r;t++){const n=f[t][e],i=f[t+1][e],r=f[t+1][e+1],a=f[t][e+1];u.push(n,i,a),u.push(i,r,a),y+=6}l.addGroup(g,y,0),g+=y}(),!1===a&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(u),this.setAttribute("position",new Kr(c,3)),this.setAttribute("normal",new Kr(h,3)),this.setAttribute("uv",new Kr(d,2))}static fromJSON(e){return new Bu(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class zu extends Bu{constructor(e=1,t=1,n=8,i=1,r=!1,a=0,o=2*Math.PI){super(0,e,t,n,i,r,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:a,thetaLength:o}}static fromJSON(e){return new zu(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Hu extends ia{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const r=[],a=[];function o(e,t,n,i){const r=i+1,a=[];for(let i=0;i<=r;i++){a[i]=[];const o=e.clone().lerp(n,i/r),s=t.clone().lerp(n,i/r),l=r-i;for(let e=0;e<=l;e++)a[i][e]=0===e&&i===r?o:o.clone().lerp(s,e/l)}for(let e=0;e<r;e++)for(let t=0;t<2*(r-e)-1;t++){const n=Math.floor(t/2);t%2==0?(s(a[e][n+1]),s(a[e+1][n]),s(a[e][n])):(s(a[e][n+1]),s(a[e+1][n+1]),s(a[e+1][n]))}}function s(e){r.push(e.x,e.y,e.z)}function l(t,n){const i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function u(e,t,n,i){i<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=i/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new pi,i=new pi,r=new pi;for(let a=0;a<t.length;a+=3)l(t[a+0],n),l(t[a+1],i),l(t[a+2],r),o(n,i,r,e)}(i),function(e){const t=new pi;for(let n=0;n<r.length;n+=3)t.x=r[n+0],t.y=r[n+1],t.z=r[n+2],t.normalize().multiplyScalar(e),r[n+0]=t.x,r[n+1]=t.y,r[n+2]=t.z}(n),function(){const e=new pi;for(let n=0;n<r.length;n+=3){e.x=r[n+0],e.y=r[n+1],e.z=r[n+2];const i=c(e)/2/Math.PI+.5,o=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);a.push(i,1-o)}var t;(function(){const e=new pi,t=new pi,n=new pi,i=new pi,o=new Jn,s=new Jn,l=new Jn;for(let h=0,d=0;h<r.length;h+=9,d+=6){e.set(r[h+0],r[h+1],r[h+2]),t.set(r[h+3],r[h+4],r[h+5]),n.set(r[h+6],r[h+7],r[h+8]),o.set(a[d+0],a[d+1]),s.set(a[d+2],a[d+3]),l.set(a[d+4],a[d+5]),i.copy(e).add(t).add(n).divideScalar(3);const p=c(i);u(o,d+0,e,p),u(s,d+2,t,p),u(l,d+4,n,p)}})(),function(){for(let e=0;e<a.length;e+=6){const t=a[e+0],n=a[e+2],i=a[e+4],r=Math.max(t,n,i),o=Math.min(t,n,i);r>.9&&o<.1&&(t<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),i<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new Kr(r,3)),this.setAttribute("normal",new Kr(r.slice(),3)),this.setAttribute("uv",new Kr(a,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new Hu(e.vertices,e.indices,e.radius,e.details)}}class Gu extends Hu{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Gu(e.radius,e.detail)}}const ju=new pi,Vu=new pi,Wu=new pi,qu=new Er;class Xu extends ia{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,i=Math.pow(10,n),r=Math.cos(Fn*t),a=e.getIndex(),o=e.getAttribute("position"),s=a?a.count:o.count,l=[0,0,0],u=["a","b","c"],c=new Array(3),h={},d=[];for(let e=0;e<s;e+=3){a?(l[0]=a.getX(e),l[1]=a.getX(e+1),l[2]=a.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:s}=qu;if(t.fromBufferAttribute(o,l[0]),n.fromBufferAttribute(o,l[1]),s.fromBufferAttribute(o,l[2]),qu.getNormal(Wu),c[0]=`${Math.round(t.x*i)},${Math.round(t.y*i)},${Math.round(t.z*i)}`,c[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,c[2]=`${Math.round(s.x*i)},${Math.round(s.y*i)},${Math.round(s.z*i)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=c[e],i=c[t],a=qu[u[e]],o=qu[u[t]],s=`${n}_${i}`,p=`${i}_${n}`;p in h&&h[p]?(Wu.dot(h[p].normal)<=r&&(d.push(a.x,a.y,a.z),d.push(o.x,o.y,o.z)),h[p]=null):s in h||(h[s]={index0:l[e],index1:l[t],normal:Wu.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:n}=h[e];ju.fromBufferAttribute(o,t),Vu.fromBufferAttribute(o,n),d.push(ju.x,ju.y,ju.z),d.push(Vu.x,Vu.y,Vu.z)}this.setAttribute("position",new Kr(d,3))}}}class Ku{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),r=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),r+=n.distanceTo(i),t.push(r),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const r=n.length;let a;a=t||e*n[r-1];let o,s=0,l=r-1;for(;s<=l;)if(i=Math.floor(s+(l-s)/2),o=n[i]-a,o<0)s=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,n[i]===a)return i/(r-1);const u=n[i];return(i+(a-u)/(n[i+1]-u))/(r-1)}getTangent(e,t){const n=1e-4;let i=e-n,r=e+n;i<0&&(i=0),r>1&&(r=1);const a=this.getPoint(i),o=this.getPoint(r),s=t||(a.isVector2?new Jn:new pi);return s.copy(o).sub(a).normalize(),s}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new pi,i=[],r=[],a=[],o=new pi,s=new Vi;for(let t=0;t<=e;t++){const n=t/e;i[t]=this.getTangentAt(n,new pi)}r[0]=new pi,a[0]=new pi;let l=Number.MAX_VALUE;const u=Math.abs(i[0].x),c=Math.abs(i[0].y),h=Math.abs(i[0].z);u<=l&&(l=u,n.set(1,0,0)),c<=l&&(l=c,n.set(0,1,0)),h<=l&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),a[0].crossVectors(i[0],r[0]);for(let t=1;t<=e;t++){if(r[t]=r[t-1].clone(),a[t]=a[t-1].clone(),o.crossVectors(i[t-1],i[t]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(jn(i[t-1].dot(i[t]),-1,1));r[t].applyMatrix4(s.makeRotationAxis(o,e))}a[t].crossVectors(i[t],r[t])}if(!0===t){let t=Math.acos(jn(r[0].dot(r[e]),-1,1));t/=e,i[0].dot(o.crossVectors(r[0],r[e]))>0&&(t=-t);for(let n=1;n<=e;n++)r[n].applyMatrix4(s.makeRotationAxis(i[n],t*n)),a[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Yu extends Ku{constructor(e=0,t=0,n=1,i=1,r=0,a=2*Math.PI,o=!1,s=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s}getPoint(e,t){const n=t||new Jn,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=a?0:i),!0!==this.aClockwise||a||(r===i?r=-i:r-=i);const o=this.aStartAngle+e*r;let s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=s-this.aX,i=l-this.aY;s=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(s,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Yu.prototype.isEllipseCurve=!0;class Ju extends Yu{constructor(e,t,n,i,r,a){super(e,t,n,n,i,r,a),this.type="ArcCurve"}}function Zu(){let e=0,t=0,n=0,i=0;function r(r,a,o,s){e=r,t=o,n=-3*r+3*a-2*o-s,i=2*r-2*a+o+s}return{initCatmullRom:function(e,t,n,i,a){r(t,n,a*(n-e),a*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,a,o,s){let l=(t-e)/a-(n-e)/(a+o)+(n-t)/o,u=(n-t)/o-(i-t)/(o+s)+(i-n)/s;l*=o,u*=o,r(t,n,l,u)},calc:function(r){const a=r*r;return e+t*r+n*a+i*(a*r)}}}Ju.prototype.isArcCurve=!0;const $u=new pi,Qu=new Zu,ec=new Zu,tc=new Zu;class nc extends Ku{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new pi){const n=t,i=this.points,r=i.length,a=(r-(this.closed?0:1))*e;let o,s,l=Math.floor(a),u=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===u&&l===r-1&&(l=r-2,u=1),this.closed||l>0?o=i[(l-1)%r]:($u.subVectors(i[0],i[1]).add(i[0]),o=$u);const c=i[l%r],h=i[(l+1)%r];if(this.closed||l+2<r?s=i[(l+2)%r]:($u.subVectors(i[r-1],i[r-2]).add(i[r-1]),s=$u),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(h),e),i=Math.pow(h.distanceToSquared(s),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),Qu.initNonuniformCatmullRom(o.x,c.x,h.x,s.x,t,n,i),ec.initNonuniformCatmullRom(o.y,c.y,h.y,s.y,t,n,i),tc.initNonuniformCatmullRom(o.z,c.z,h.z,s.z,t,n,i)}else"catmullrom"===this.curveType&&(Qu.initCatmullRom(o.x,c.x,h.x,s.x,this.tension),ec.initCatmullRom(o.y,c.y,h.y,s.y,this.tension),tc.initCatmullRom(o.z,c.z,h.z,s.z,this.tension));return n.set(Qu.calc(u),ec.calc(u),tc.calc(u)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new pi).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function ic(e,t,n,i,r){const a=.5*(i-t),o=.5*(r-n),s=e*e;return(2*n-2*i+a+o)*(e*s)+(-3*n+3*i-2*a-o)*s+a*e+n}function rc(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function ac(e,t,n,i,r){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,r)}nc.prototype.isCatmullRomCurve3=!0;class oc extends Ku{constructor(e=new Jn,t=new Jn,n=new Jn,i=new Jn){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Jn){const n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(ac(e,i.x,r.x,a.x,o.x),ac(e,i.y,r.y,a.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}oc.prototype.isCubicBezierCurve=!0;class sc extends Ku{constructor(e=new pi,t=new pi,n=new pi,i=new pi){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new pi){const n=t,i=this.v0,r=this.v1,a=this.v2,o=this.v3;return n.set(ac(e,i.x,r.x,a.x,o.x),ac(e,i.y,r.y,a.y,o.y),ac(e,i.z,r.z,a.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}sc.prototype.isCubicBezierCurve3=!0;class lc extends Ku{constructor(e=new Jn,t=new Jn){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Jn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Jn;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}lc.prototype.isLineCurve=!0;class uc extends Ku{constructor(e=new pi,t=new pi){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new pi){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class cc extends Ku{constructor(e=new Jn,t=new Jn,n=new Jn){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Jn){const n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(rc(e,i.x,r.x,a.x),rc(e,i.y,r.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}cc.prototype.isQuadraticBezierCurve=!0;class hc extends Ku{constructor(e=new pi,t=new pi,n=new pi){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new pi){const n=t,i=this.v0,r=this.v1,a=this.v2;return n.set(rc(e,i.x,r.x,a.x),rc(e,i.y,r.y,a.y),rc(e,i.z,r.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}hc.prototype.isQuadraticBezierCurve3=!0;class dc extends Ku{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Jn){const n=t,i=this.points,r=(i.length-1)*e,a=Math.floor(r),o=r-a,s=i[0===a?a:a-1],l=i[a],u=i[a>i.length-2?i.length-1:a+1],c=i[a>i.length-3?i.length-1:a+2];return n.set(ic(o,s.x,l.x,u.x,c.x),ic(o,s.y,l.y,u.y,c.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Jn).fromArray(n))}return this}}dc.prototype.isSplineCurve=!0;var pc=Object.freeze({__proto__:null,ArcCurve:Ju,CatmullRomCurve3:nc,CubicBezierCurve:oc,CubicBezierCurve3:sc,EllipseCurve:Yu,LineCurve:lc,LineCurve3:uc,QuadraticBezierCurve:cc,QuadraticBezierCurve3:hc,SplineCurve:dc});class fc extends Ku{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new lc(t,e))}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const e=i[r]-n,a=this.curves[r],o=a.getLength(),s=0===o?0:1-e/o;return a.getPointAt(s,t)}r++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const a=r[i],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o);for(let e=0;e<s.length;e++){const i=s[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new pc[n.type]).fromJSON(n))}return this}}class mc extends fc{constructor(e){super(),this.type="Path",this.currentPoint=new Jn,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new lc(this.currentPoint.clone(),new Jn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const r=new cc(this.currentPoint.clone(),new Jn(e,t),new Jn(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,r,a){const o=new oc(this.currentPoint.clone(),new Jn(e,t),new Jn(n,i),new Jn(r,a));return this.curves.push(o),this.currentPoint.set(r,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new dc(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,r,a){const o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,i,r,a),this}absarc(e,t,n,i,r,a){return this.absellipse(e,t,n,n,i,r,a),this}ellipse(e,t,n,i,r,a,o,s){const l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,i,r,a,o,s),this}absellipse(e,t,n,i,r,a,o,s){const l=new Yu(e,t,n,i,r,a,o,s);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class gc extends mc{constructor(e){super(e),this.uuid=Gn(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new mc).fromJSON(n))}return this}}function vc(e,t,n,i,r){let a,o;if(r===function(e,t,n,i){let r=0;for(let a=t,o=n-i;a<n;a+=i)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}(e,t,n,i)>0)for(a=t;a<n;a+=i)o=Fc(a,e[a],e[a+1],o);else for(a=n-i;a>=t;a-=i)o=Fc(a,e[a],e[a+1],o);return o&&Pc(o,o.next)&&(Bc(o),o=o.next),o}function yc(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!Pc(i,i.next)&&0!==Ic(i.prev,i,i.next))i=i.next;else{if(Bc(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function xc(e,t,n,i,r,a,o){if(!e)return;!o&&a&&function(e,t,n,i){let r=e;do{null===r.z&&(r.z=Ac(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,n,i,r,a,o,s,l,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,i=n,s=0,t=0;t<u&&(s++,i=i.nextZ,i);t++);for(l=u;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;n=i}a.nextZ=null,u*=2}while(o>1)}(r)}(e,i,r,a);let s,l,u=e;for(;e.prev!==e.next;)if(s=e.prev,l=e.next,a?wc(e,i,r,a):bc(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),Bc(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?xc(e=Mc(yc(e),t,n),t,n,i,r,a,2):2===o&&_c(e,t,n,i,r,a):xc(yc(e),t,n,i,r,a,1);break}}function bc(e){const t=e.prev,n=e,i=e.next;if(Ic(t,n,i)>=0)return!1;let r=e.next.next;for(;r!==e.prev;){if(Rc(t.x,t.y,n.x,n.y,i.x,i.y,r.x,r.y)&&Ic(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function wc(e,t,n,i){const r=e.prev,a=e,o=e.next;if(Ic(r,a,o)>=0)return!1;const s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,l=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,u=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,c=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=Ac(s,l,t,n,i),d=Ac(u,c,t,n,i);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&Rc(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Ic(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&Rc(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Ic(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&Rc(r.x,r.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Ic(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&Rc(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&Ic(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Mc(e,t,n){let i=e;do{const r=i.prev,a=i.next.next;!Pc(r,a)&&Dc(r,i,i.next,a)&&Oc(r,a)&&Oc(a,r)&&(t.push(r.i/n),t.push(i.i/n),t.push(a.i/n),Bc(i),Bc(i.next),i=e=a),i=i.next}while(i!==e);return yc(i)}function _c(e,t,n,i,r,a){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&Lc(o,e)){let s=Uc(o,e);return o=yc(o,o.next),s=yc(s,s.next),xc(o,t,n,i,r,a),void xc(s,t,n,i,r,a)}e=e.next}o=o.next}while(o!==e)}function Sc(e,t){return e.x-t.x}function Tc(e,t){if(t=function(e,t){let n=t;const i=e.x,r=e.y;let a,o=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const e=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>o){if(o=e,e===i){if(r===n.y)return n;if(r===n.next.y)return n.next}a=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!a)return null;if(i===o)return a;const s=a,l=a.x,u=a.y;let c,h=1/0;n=a;do{i>=n.x&&n.x>=l&&i!==n.x&&Rc(r<u?i:o,r,l,u,r<u?o:i,r,n.x,n.y)&&(c=Math.abs(r-n.y)/(i-n.x),Oc(n,e)&&(c<h||c===h&&(n.x>a.x||n.x===a.x&&Ec(a,n)))&&(a=n,h=c)),n=n.next}while(n!==s);return a}(e,t)){const n=Uc(t,e);yc(t,t.next),yc(n,n.next)}}function Ec(e,t){return Ic(e.prev,e,t.prev)<0&&Ic(t.next,e,e.next)<0}function Ac(e,t,n,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Cc(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Rc(e,t,n,i,r,a,o,s){return(r-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(i-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function Lc(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Dc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Oc(e,t)&&Oc(t,e)&&function(e,t){let n=e,i=!1;const r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(Ic(e.prev,e,t.prev)||Ic(e,t.prev,t))||Pc(e,t)&&Ic(e.prev,e,e.next)>0&&Ic(t.prev,t,t.next)>0)}function Ic(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Pc(e,t){return e.x===t.x&&e.y===t.y}function Dc(e,t,n,i){const r=kc(Ic(e,t,n)),a=kc(Ic(e,t,i)),o=kc(Ic(n,i,e)),s=kc(Ic(n,i,t));return r!==a&&o!==s||!(0!==r||!Nc(e,n,t))||!(0!==a||!Nc(e,i,t))||!(0!==o||!Nc(n,e,i))||!(0!==s||!Nc(n,t,i))}function Nc(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function kc(e){return e>0?1:e<0?-1:0}function Oc(e,t){return Ic(e.prev,e,e.next)<0?Ic(e,t,e.next)>=0&&Ic(e,e.prev,t)>=0:Ic(e,t,e.prev)<0||Ic(e,e.next,t)<0}function Uc(e,t){const n=new zc(e.i,e.x,e.y),i=new zc(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function Fc(e,t,n,i){const r=new zc(e,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Bc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function zc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Hc{static area(e){const t=e.length;let n=0;for(let i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n}static isClockWise(e){return Hc.area(e)<0}static triangulateShape(e,t){const n=[],i=[],r=[];Gc(e),jc(n,e);let a=e.length;t.forEach(Gc);for(let e=0;e<t.length;e++)i.push(a),a+=t[e].length,jc(n,t[e]);const o=function(e,t,n=2){const i=t&&t.length,r=i?t[0]*n:e.length;let a=vc(e,0,r,n,!0);const o=[];if(!a||a.next===a.prev)return o;let s,l,u,c,h,d,p;if(i&&(a=function(e,t,n,i){const r=[];let a,o,s,l,u;for(a=0,o=t.length;a<o;a++)s=t[a]*i,l=a<o-1?t[a+1]*i:e.length,u=vc(e,s,l,i,!1),u===u.next&&(u.steiner=!0),r.push(Cc(u));for(r.sort(Sc),a=0;a<r.length;a++)Tc(r[a],n),n=yc(n,n.next);return n}(e,t,a,n)),e.length>80*n){s=u=e[0],l=c=e[1];for(let t=n;t<r;t+=n)h=e[t],d=e[t+1],h<s&&(s=h),d<l&&(l=d),h>u&&(u=h),d>c&&(c=d);p=Math.max(u-s,c-l),p=0!==p?1/p:0}return xc(a,o,n,s,l,p),o}(n,i);for(let e=0;e<o.length;e+=3)r.push(o.slice(e,e+3));return r}}function Gc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function jc(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Vc extends ia{constructor(e=new gc([new Jn(.5,.5),new Jn(-.5,.5),new Jn(-.5,-.5),new Jn(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],r=[];for(let t=0,n=e.length;t<n;t++)a(e[t]);function a(e){const a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:1,u=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:c-.1,d=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Wc;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let g,v,y,x,b,w=!1;f&&(g=f.getSpacedPoints(s),w=!0,u=!1,v=f.computeFrenetFrames(s,!1),y=new pi,x=new pi,b=new pi),u||(p=0,c=0,h=0,d=0);const M=e.extractPoints(o);let _=M.shape;const S=M.holes;if(!Hc.isClockWise(_)){_=_.reverse();for(let e=0,t=S.length;e<t;e++){const t=S[e];Hc.isClockWise(t)&&(S[e]=t.reverse())}}const T=Hc.triangulateShape(_,S),E=_;for(let e=0,t=S.length;e<t;e++){const t=S[e];_=_.concat(t)}function A(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const C=_.length,R=T.length;function L(e,t,n){let i,r,a;const o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,u=n.y-e.y,c=o*o+s*s,h=o*u-s*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(c),d=Math.sqrt(l*l+u*u),p=t.x-s/h,f=t.y+o/h,m=((n.x-u/d-p)*u-(n.y+l/d-f)*l)/(o*u-s*l);i=p+o*m-e.x,r=f+s*m-e.y;const g=i*i+r*r;if(g<=2)return new Jn(i,r);a=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(s)===Math.sign(u)&&(e=!0),e?(i=-s,r=o,a=Math.sqrt(c)):(i=o,r=s,a=Math.sqrt(c/2))}return new Jn(i/a,r/a)}const I=[];for(let e=0,t=E.length,n=t-1,i=e+1;e<t;e++,n++,i++)n===t&&(n=0),i===t&&(i=0),I[e]=L(E[e],E[n],E[i]);const P=[];let D,N=I.concat();for(let e=0,t=S.length;e<t;e++){const t=S[e];D=[];for(let e=0,n=t.length,i=n-1,r=e+1;e<n;e++,i++,r++)i===n&&(i=0),r===n&&(r=0),D[e]=L(t[e],t[i],t[r]);P.push(D),N=N.concat(D)}for(let e=0;e<p;e++){const t=e/p,n=c*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],I[e],i);U(t.x,t.y,-n)}for(let e=0,t=S.length;e<t;e++){const t=S[e];D=P[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],D[e],i);U(r.x,r.y,-n)}}}const k=h+d;for(let e=0;e<C;e++){const t=u?A(_[e],N[e],k):_[e];w?(x.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),b.copy(g[0]).add(x).add(y),U(b.x,b.y,b.z)):U(t.x,t.y,0)}for(let e=1;e<=s;e++)for(let t=0;t<C;t++){const n=u?A(_[t],N[t],k):_[t];w?(x.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),b.copy(g[e]).add(x).add(y),U(b.x,b.y,b.z)):U(n.x,n.y,l/s*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=c*Math.cos(t*Math.PI/2),i=h*Math.sin(t*Math.PI/2)+d;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],I[e],i);U(t.x,t.y,l+n)}for(let e=0,t=S.length;e<t;e++){const t=S[e];D=P[e];for(let e=0,r=t.length;e<r;e++){const r=A(t[e],D[e],i);w?U(r.x,r.y+g[s-1].y,g[s-1].x+n):U(r.x,r.y,l+n)}}}function O(e,t){let n=e.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=e.length-1);for(let e=0,n=s+2*p;e<n;e++){const n=C*e,a=C*(e+1);B(t+i+n,t+r+n,t+r+a,t+i+a)}}}function U(e,t,n){a.push(e),a.push(t),a.push(n)}function F(e,t,r){z(e),z(t),z(r);const a=i.length/3,o=m.generateTopUV(n,i,a-3,a-2,a-1);H(o[0]),H(o[1]),H(o[2])}function B(e,t,r,a){z(e),z(t),z(a),z(t),z(r),z(a);const o=i.length/3,s=m.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);H(s[0]),H(s[1]),H(s[3]),H(s[1]),H(s[2]),H(s[3])}function z(e){i.push(a[3*e+0]),i.push(a[3*e+1]),i.push(a[3*e+2])}function H(e){r.push(e.x),r.push(e.y)}!function(){const e=i.length/3;if(u){let e=0,t=C*e;for(let e=0;e<R;e++){const n=T[e];F(n[2]+t,n[1]+t,n[0]+t)}e=s+2*p,t=C*e;for(let e=0;e<R;e++){const n=T[e];F(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<R;e++){const t=T[e];F(t[2],t[1],t[0])}for(let e=0;e<R;e++){const t=T[e];F(t[0]+C*s,t[1]+C*s,t[2]+C*s)}}n.addGroup(e,i.length/3-e,0)}(),function(){const e=i.length/3;let t=0;O(E,t),t+=E.length;for(let e=0,n=S.length;e<n;e++){const n=S[e];O(n,t),t+=n.length}n.addGroup(e,i.length/3-e,1)}()}this.setAttribute("position",new Kr(i,3)),this.setAttribute("uv",new Kr(r,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,i=e.length;t<i;t++){const i=e[t];n.shapes.push(i.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new pc[i.type]).fromJSON(i)),new Vc(n,e.options)}}const Wc={generateTopUV:function(e,t,n,i,r){const a=t[3*n],o=t[3*n+1],s=t[3*i],l=t[3*i+1],u=t[3*r],c=t[3*r+1];return[new Jn(a,o),new Jn(s,l),new Jn(u,c)]},generateSideWallUV:function(e,t,n,i,r,a){const o=t[3*n],s=t[3*n+1],l=t[3*n+2],u=t[3*i],c=t[3*i+1],h=t[3*i+2],d=t[3*r],p=t[3*r+1],f=t[3*r+2],m=t[3*a],g=t[3*a+1],v=t[3*a+2];return Math.abs(s-c)<Math.abs(o-u)?[new Jn(o,1-l),new Jn(u,1-h),new Jn(d,1-f),new Jn(m,1-v)]:[new Jn(s,1-l),new Jn(c,1-h),new Jn(p,1-f),new Jn(g,1-v)]}};class qc extends Hu{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new qc(e.radius,e.detail)}}class Xc extends ia{constructor(e=[new Jn(0,.5),new Jn(.5,0),new Jn(0,-.5)],t=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=jn(i,0,2*Math.PI);const r=[],a=[],o=[],s=1/t,l=new pi,u=new Jn;for(let r=0;r<=t;r++){const c=n+r*s*i,h=Math.sin(c),d=Math.cos(c);for(let n=0;n<=e.length-1;n++)l.x=e[n].x*h,l.y=e[n].y,l.z=e[n].x*d,a.push(l.x,l.y,l.z),u.x=r/t,u.y=n/(e.length-1),o.push(u.x,u.y)}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const i=t+n*e.length,a=i,o=i+e.length,s=i+e.length+1,l=i+1;r.push(a,o,l),r.push(o,s,l)}if(this.setIndex(r),this.setAttribute("position",new Kr(a,3)),this.setAttribute("uv",new Kr(o,2)),this.computeVertexNormals(),i===2*Math.PI){const n=this.attributes.normal.array,i=new pi,r=new pi,a=new pi,o=t*e.length*3;for(let t=0,s=0;t<e.length;t++,s+=3)i.x=n[s+0],i.y=n[s+1],i.z=n[s+2],r.x=n[o+s+0],r.y=n[o+s+1],r.z=n[o+s+2],a.addVectors(i,r).normalize(),n[s+0]=n[o+s+0]=a.x,n[s+1]=n[o+s+1]=a.y,n[s+2]=n[o+s+2]=a.z}}static fromJSON(e){return new Xc(e.points,e.segments,e.phiStart,e.phiLength)}}class Kc extends Hu{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Kc(e.radius,e.detail)}}class Yc extends ia{constructor(e=.5,t=1,n=8,i=1,r=0,a=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:a},n=Math.max(3,n);const o=[],s=[],l=[],u=[];let c=e;const h=(t-e)/(i=Math.max(1,i)),d=new pi,p=new Jn;for(let e=0;e<=i;e++){for(let e=0;e<=n;e++){const i=r+e/n*a;d.x=c*Math.cos(i),d.y=c*Math.sin(i),s.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,u.push(p.x,p.y)}c+=h}for(let e=0;e<i;e++){const t=e*(n+1);for(let e=0;e<n;e++){const i=e+t,r=i,a=i+n+1,s=i+n+2,l=i+1;o.push(r,a,l),o.push(a,s,l)}}this.setIndex(o),this.setAttribute("position",new Kr(s,3)),this.setAttribute("normal",new Kr(l,3)),this.setAttribute("uv",new Kr(u,2))}static fromJSON(e){return new Yc(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Jc extends ia{constructor(e=new gc([new Jn(0,.5),new Jn(-.5,-.5),new Jn(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],r=[],a=[];let o=0,s=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(o,s,t),o+=s,s=0;function l(e){const o=i.length/3,l=e.extractPoints(t);let u=l.shape;const c=l.holes;!1===Hc.isClockWise(u)&&(u=u.reverse());for(let e=0,t=c.length;e<t;e++){const t=c[e];!0===Hc.isClockWise(t)&&(c[e]=t.reverse())}const h=Hc.triangulateShape(u,c);for(let e=0,t=c.length;e<t;e++){const t=c[e];u=u.concat(t)}for(let e=0,t=u.length;e<t;e++){const t=u[e];i.push(t.x,t.y,0),r.push(0,0,1),a.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],i=t[0]+o,r=t[1]+o,a=t[2]+o;n.push(i,r,a),s+=3}}this.setIndex(n),this.setAttribute("position",new Kr(i,3)),this.setAttribute("normal",new Kr(r,3)),this.setAttribute("uv",new Kr(a,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let i=0,r=e.shapes.length;i<r;i++){const r=t[e.shapes[i]];n.push(r)}return new Jc(n,e.curveSegments)}}class Zc extends ia{constructor(e=1,t=32,n=16,i=0,r=2*Math.PI,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const s=Math.min(a+o,Math.PI);let l=0;const u=[],c=new pi,h=new pi,d=[],p=[],f=[],m=[];for(let d=0;d<=n;d++){const g=[],v=d/n;let y=0;0==d&&0==a?y=.5/t:d==n&&s==Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const s=n/t;c.x=-e*Math.cos(i+s*r)*Math.sin(a+v*o),c.y=e*Math.cos(a+v*o),c.z=e*Math.sin(i+s*r)*Math.sin(a+v*o),p.push(c.x,c.y,c.z),h.copy(c).normalize(),f.push(h.x,h.y,h.z),m.push(s+y,1-v),g.push(l++)}u.push(g)}for(let e=0;e<n;e++)for(let i=0;i<t;i++){const t=u[e][i+1],r=u[e][i],o=u[e+1][i],l=u[e+1][i+1];(0!==e||a>0)&&d.push(t,r,l),(e!==n-1||s<Math.PI)&&d.push(r,o,l)}this.setIndex(d),this.setAttribute("position",new Kr(p,3)),this.setAttribute("normal",new Kr(f,3)),this.setAttribute("uv",new Kr(m,2))}static fromJSON(e){return new Zc(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class $c extends Hu{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new $c(e.radius,e.detail)}}class Qc extends ia{constructor(e=1,t=.4,n=8,i=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const a=[],o=[],s=[],l=[],u=new pi,c=new pi,h=new pi;for(let a=0;a<=n;a++)for(let d=0;d<=i;d++){const p=d/i*r,f=a/n*Math.PI*2;c.x=(e+t*Math.cos(f))*Math.cos(p),c.y=(e+t*Math.cos(f))*Math.sin(p),c.z=t*Math.sin(f),o.push(c.x,c.y,c.z),u.x=e*Math.cos(p),u.y=e*Math.sin(p),h.subVectors(c,u).normalize(),s.push(h.x,h.y,h.z),l.push(d/i),l.push(a/n)}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*e+t-1,r=(i+1)*(e-1)+t-1,o=(i+1)*(e-1)+t,s=(i+1)*e+t;a.push(n,r,s),a.push(r,o,s)}this.setIndex(a),this.setAttribute("position",new Kr(o,3)),this.setAttribute("normal",new Kr(s,3)),this.setAttribute("uv",new Kr(l,2))}static fromJSON(e){return new Qc(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class eh extends ia{constructor(e=1,t=.4,n=64,i=8,r=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:a},n=Math.floor(n),i=Math.floor(i);const o=[],s=[],l=[],u=[],c=new pi,h=new pi,d=new pi,p=new pi,f=new pi,m=new pi,g=new pi;for(let o=0;o<=n;++o){const y=o/n*r*Math.PI*2;v(y,r,a,e,d),v(y+.01,r,a,e,p),m.subVectors(p,d),g.addVectors(p,d),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=i;++e){const r=e/i*Math.PI*2,a=-t*Math.cos(r),p=t*Math.sin(r);c.x=d.x+(a*g.x+p*f.x),c.y=d.y+(a*g.y+p*f.y),c.z=d.z+(a*g.z+p*f.z),s.push(c.x,c.y,c.z),h.subVectors(c,d).normalize(),l.push(h.x,h.y,h.z),u.push(o/n),u.push(e/i)}}for(let e=1;e<=n;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),a=(i+1)*e+t,s=(i+1)*(e-1)+t;o.push(n,r,s),o.push(r,a,s)}function v(e,t,n,i,r){const a=Math.cos(e),o=Math.sin(e),s=n/t*e,l=Math.cos(s);r.x=i*(2+l)*.5*a,r.y=i*(2+l)*o*.5,r.z=i*Math.sin(s)*.5}this.setIndex(o),this.setAttribute("position",new Kr(s,3)),this.setAttribute("normal",new Kr(l,3)),this.setAttribute("uv",new Kr(u,2))}static fromJSON(e){return new eh(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class th extends ia{constructor(e=new hc(new pi(-1,-1,0),new pi(-1,1,0),new pi(1,1,0)),t=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r};const a=e.computeFrenetFrames(t,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new pi,s=new pi,l=new Jn;let u=new pi;const c=[],h=[],d=[],p=[];function f(r){u=e.getPointAt(r/t,u);const l=a.normals[r],d=a.binormals[r];for(let e=0;e<=i;e++){const t=e/i*Math.PI*2,r=Math.sin(t),a=-Math.cos(t);s.x=a*l.x+r*d.x,s.y=a*l.y+r*d.y,s.z=a*l.z+r*d.z,s.normalize(),h.push(s.x,s.y,s.z),o.x=u.x+n*s.x,o.y=u.y+n*s.y,o.z=u.z+n*s.z,c.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===r?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=i;n++)l.x=e/t,l.y=n/i,d.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=i;t++){const n=(i+1)*(e-1)+(t-1),r=(i+1)*e+(t-1),a=(i+1)*e+t,o=(i+1)*(e-1)+t;p.push(n,r,o),p.push(r,a,o)}}()}(),this.setIndex(p),this.setAttribute("position",new Kr(c,3)),this.setAttribute("normal",new Kr(h,3)),this.setAttribute("uv",new Kr(d,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new th((new pc[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class nh extends ia{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,i=new pi,r=new pi;if(null!==e.index){const a=e.attributes.position,o=e.index;let s=e.groups;0===s.length&&(s=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,l=s.length;e<l;++e){const l=s[e],u=l.start;for(let e=u,s=u+l.count;e<s;e+=3)for(let s=0;s<3;s++){const l=o.getX(e+s),u=o.getX(e+(s+1)%3);i.fromBufferAttribute(a,l),r.fromBufferAttribute(a,u),!0===ih(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}}else{const a=e.attributes.position;for(let e=0,o=a.count/3;e<o;e++)for(let o=0;o<3;o++){const s=3*e+o,l=3*e+(o+1)%3;i.fromBufferAttribute(a,s),r.fromBufferAttribute(a,l),!0===ih(i,r,n)&&(t.push(i.x,i.y,i.z),t.push(r.x,r.y,r.z))}}this.setAttribute("position",new Kr(t,3))}}}function ih(e,t,n){const i=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i,r),!0)}var rh=Object.freeze({__proto__:null,BoxGeometry:_a,BoxBufferGeometry:_a,CircleGeometry:Fu,CircleBufferGeometry:Fu,ConeGeometry:zu,ConeBufferGeometry:zu,CylinderGeometry:Bu,CylinderBufferGeometry:Bu,DodecahedronGeometry:Gu,DodecahedronBufferGeometry:Gu,EdgesGeometry:Xu,ExtrudeGeometry:Vc,ExtrudeBufferGeometry:Vc,IcosahedronGeometry:qc,IcosahedronBufferGeometry:qc,LatheGeometry:Xc,LatheBufferGeometry:Xc,OctahedronGeometry:Kc,OctahedronBufferGeometry:Kc,PlaneGeometry:ja,PlaneBufferGeometry:ja,PolyhedronGeometry:Hu,PolyhedronBufferGeometry:Hu,RingGeometry:Yc,RingBufferGeometry:Yc,ShapeGeometry:Jc,ShapeBufferGeometry:Jc,SphereGeometry:Zc,SphereBufferGeometry:Zc,TetrahedronGeometry:$c,TetrahedronBufferGeometry:$c,TorusGeometry:Qc,TorusBufferGeometry:Qc,TorusKnotGeometry:eh,TorusKnotBufferGeometry:eh,TubeGeometry:th,TubeBufferGeometry:th,WireframeGeometry:nh});class ah extends Cr{constructor(e){super(),this.type="ShadowMaterial",this.color=new kr(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}ah.prototype.isShadowMaterial=!0;class oh extends Cr{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new kr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Jn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}oh.prototype.isMeshStandardMaterial=!0;class sh extends oh{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Jn(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return jn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new kr(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new kr(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new kr(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}sh.prototype.isMeshPhysicalMaterial=!0;class lh extends Cr{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new kr(16777215),this.specular=new kr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Jn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}lh.prototype.isMeshPhongMaterial=!0;class uh extends Cr{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new kr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Jn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}uh.prototype.isMeshToonMaterial=!0;class ch extends Cr{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Jn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}ch.prototype.isMeshNormalMaterial=!0;class hh extends Cr{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new kr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new kr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Y,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}hh.prototype.isMeshLambertMaterial=!0;class dh extends Cr{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new kr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=sn,this.normalScale=new Jn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}dh.prototype.isMeshMatcapMaterial=!0;class ph extends gu{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}ph.prototype.isLineDashedMaterial=!0;var fh=Object.freeze({__proto__:null,ShadowMaterial:ah,SpriteMaterial:Nl,RawShaderMaterial:eo,ShaderMaterial:Aa,PointsMaterial:Au,MeshPhysicalMaterial:sh,MeshStandardMaterial:oh,MeshPhongMaterial:lh,MeshToonMaterial:uh,MeshNormalMaterial:ch,MeshLambertMaterial:hh,MeshDepthMaterial:fl,MeshDistanceMaterial:ml,MeshBasicMaterial:Or,MeshMatcapMaterial:dh,LineDashedMaterial:ph,LineBasicMaterial:gu,Material:Cr});const mh={arraySlice:function(e,t,n){return mh.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const i=e.length,r=new e.constructor(i);for(let a=0,o=0;o!==i;++a){const i=n[a]*t;for(let n=0;n!==t;++n)r[o++]=e[i+n]}return r},flattenJSON:function(e,t,n,i){let r=1,a=e[0];for(;void 0!==a&&void 0===a[i];)a=e[r++];if(void 0===a)return;let o=a[i];if(void 0!==o)if(Array.isArray(o))do{o=a[i],void 0!==o&&(t.push(a.time),n.push.apply(n,o)),a=e[r++]}while(void 0!==a);else if(void 0!==o.toArray)do{o=a[i],void 0!==o&&(t.push(a.time),o.toArray(n,n.length)),a=e[r++]}while(void 0!==a);else do{o=a[i],void 0!==o&&(t.push(a.time),n.push(o)),a=e[r++]}while(void 0!==a)},subclip:function(e,t,n,i,r=30){const a=e.clone();a.name=t;const o=[];for(let e=0;e<a.tracks.length;++e){const t=a.tracks[e],s=t.getValueSize(),l=[],u=[];for(let e=0;e<t.times.length;++e){const a=t.times[e]*r;if(!(a<n||a>=i)){l.push(t.times[e]);for(let n=0;n<s;++n)u.push(t.values[e*s+n])}}0!==l.length&&(t.times=mh.convertArray(l,t.times.constructor),t.values=mh.convertArray(u,t.values.constructor),o.push(t))}a.tracks=o;let s=1/0;for(let e=0;e<a.tracks.length;++e)s>a.tracks[e].times[0]&&(s=a.tracks[e].times[0]);for(let e=0;e<a.tracks.length;++e)a.tracks[e].shift(-1*s);return a.resetDuration(),a},makeClipAdditive:function(e,t=0,n=e,i=30){i<=0&&(i=30);const r=n.tracks.length,a=t/i;for(let t=0;t<r;++t){const i=n.tracks[t],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const o=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===r}));if(void 0===o)continue;let s=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);let u=0;const c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=c/3);const h=i.times.length-1;let d;if(a<=i.times[0]){const e=s,t=l-s;d=mh.arraySlice(i.values,e,t)}else if(a>=i.times[h]){const e=h*l+s,t=e+l-s;d=mh.arraySlice(i.values,e,t)}else{const e=i.createInterpolant(),t=s,n=l-s;e.evaluate(a),d=mh.arraySlice(e.resultBuffer,t,n)}"quaternion"===r&&(new di).fromArray(d).normalize().conjugate().toArray(d);const p=o.times.length;for(let e=0;e<p;++e){const t=e*c+u;if("quaternion"===r)di.multiplyQuaternionsFlat(o.values,t,d,0,o.values,t);else{const e=c-2*u;for(let n=0;n<e;++n)o.values[t+n]-=d[n]}}}return e.blendMode=qt,e}};class gh{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{let a;n:{i:if(!(e<i)){for(let a=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===a)break;if(r=i,i=t[++n],e<i)break t}a=t.length;break n}if(e>=r)break e;{const o=t[1];e<o&&(n=2,r=o);for(let a=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===a)break;if(i=r,r=t[--n-1],e>=r)break t}a=n,n=0}}for(;n<a;){const i=n+a>>>1;e<t[i]?a=i:n=i+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i;for(let e=0;e!==i;++e)t[e]=n[r+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}gh.prototype.beforeStart_=gh.prototype.copySampleValue_,gh.prototype.afterEnd_=gh.prototype.copySampleValue_;class vh extends gh{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Gt,endingEnd:Gt}}intervalChanged_(e,t,n){const i=this.parameterPositions;let r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case jt:r=e,o=2*t-n;break;case Vt:r=i.length-2,o=t+i[r]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case jt:a=e,s=2*n-t;break;case Vt:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}const l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=r*u,this._offsetNext=a*u}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-h*m+2*h*f-h*p,v=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f;for(let e=0;e!==o;++e)r[e]=g*a[u+e]+v*a[l+e]+y*a[s+e]+x*a[c+e];return r}}class yh extends gh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=(n-t)/(i-t),c=1-u;for(let e=0;e!==o;++e)r[e]=a[l+e]*c+a[s+e]*u;return r}}class xh extends gh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class bh{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=mh.convertArray(t,this.TimeBufferType),this.values=mh.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:mh.convertArray(e.times,Array),values:mh.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new xh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new yh(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new vh(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Bt:t=this.InterpolantFactoryMethodDiscrete;break;case zt:t=this.InterpolantFactoryMethodLinear;break;case Ht:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Bt;case this.InterpolantFactoryMethodLinear:return zt;case this.InterpolantFactoryMethodSmooth:return Ht}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let r=0,a=i-1;for(;r!==i&&n[r]<e;)++r;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(a=Math.max(a,1),r=a-1);const e=this.getValueSize();this.times=mh.arraySlice(n,r,a),this.values=mh.arraySlice(this.values,r*e,a*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let t=0;t!==r;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==a&&a>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,a),e=!1;break}a=i}if(void 0!==i&&mh.isTypedArray(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=mh.arraySlice(this.times),t=mh.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===Ht,r=e.length-1;let a=1;for(let o=1;o<r;++o){let r=!1;const s=e[o];if(s!==e[o+1]&&(1!==o||s!==e[0]))if(i)r=!0;else{const e=o*n,i=e-n,a=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[i+o]||n!==t[a+o]){r=!0;break}}}if(r){if(o!==a){e[a]=e[o];const i=o*n,r=a*n;for(let e=0;e!==n;++e)t[r+e]=t[i+e]}++a}}if(r>0){e[a]=e[r];for(let e=r*n,i=a*n,o=0;o!==n;++o)t[i+o]=t[e+o];++a}return a!==e.length?(this.times=mh.arraySlice(e,0,a),this.values=mh.arraySlice(t,0,a*n)):(this.times=e,this.values=t),this}clone(){const e=mh.arraySlice(this.times,0),t=mh.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}bh.prototype.TimeBufferType=Float32Array,bh.prototype.ValueBufferType=Float32Array,bh.prototype.DefaultInterpolation=zt;class wh extends bh{}wh.prototype.ValueTypeName="bool",wh.prototype.ValueBufferType=Array,wh.prototype.DefaultInterpolation=Bt,wh.prototype.InterpolantFactoryMethodLinear=void 0,wh.prototype.InterpolantFactoryMethodSmooth=void 0;class Mh extends bh{}Mh.prototype.ValueTypeName="color";class _h extends bh{}_h.prototype.ValueTypeName="number";class Sh extends gh{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(i-t);let l=e*o;for(let e=l+o;l!==e;l+=4)di.slerpFlat(r,0,a,l-o,a,l,s);return r}}class Th extends bh{InterpolantFactoryMethodLinear(e){return new Sh(this.times,this.values,this.getValueSize(),e)}}Th.prototype.ValueTypeName="quaternion",Th.prototype.DefaultInterpolation=zt,Th.prototype.InterpolantFactoryMethodSmooth=void 0;class Eh extends bh{}Eh.prototype.ValueTypeName="string",Eh.prototype.ValueBufferType=Array,Eh.prototype.DefaultInterpolation=Bt,Eh.prototype.InterpolantFactoryMethodLinear=void 0,Eh.prototype.InterpolantFactoryMethodSmooth=void 0;class Ah extends bh{}Ah.prototype.ValueTypeName="vector";class Ch{constructor(e,t=-1,n,i=Wt){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Gn(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,r=n.length;e!==r;++e)t.push(Rh(n[e]).scale(i));const r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=n.length;e!==i;++e)t.push(bh.toJSON(n[e]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const r=t.length,a=[];for(let e=0;e<r;e++){let o=[],s=[];o.push((e+r-1)%r,e,(e+1)%r),s.push(0,1,0);const l=mh.getKeyframeOrder(o);o=mh.sortedArray(o,1,l),s=mh.sortedArray(s,1,l),i||0!==o[0]||(o.push(r),s.push(s[0])),a.push(new _h(".morphTargetInfluences["+t[e].name+"]",o,s).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],a=n.name.match(r);if(a&&a.length>1){const e=a[1];let t=i[e];t||(i[e]=t=[]),t.push(n)}}const a=[];for(const e in i)a.push(this.CreateFromMorphTargetSequence(e,i[e],t,n));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,r){if(0!==n.length){const a=[],o=[];mh.flattenJSON(n,a,o,i),0!==a.length&&r.push(new e(t,a,o))}},i=[],r=e.name||"default",a=e.fps||30,o=e.blendMode;let s=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const r=l[e].keys;if(r&&0!==r.length)if(r[0].morphTargets){const e={};let t;for(t=0;t<r.length;t++)if(r[t].morphTargets)for(let n=0;n<r[t].morphTargets.length;n++)e[r[t].morphTargets[n]]=-1;for(const n in e){const e=[],a=[];for(let i=0;i!==r[t].morphTargets.length;++i){const i=r[t];e.push(i.time),a.push(i.morphTarget===n?1:0)}i.push(new _h(".morphTargetInfluence["+n+"]",e,a))}s=e.length*(a||1)}else{const a=".bones["+t[e].name+"]";n(Ah,a+".position",r,"pos",i),n(Th,a+".quaternion",r,"rot",i),n(Ah,a+".scale",r,"scl",i)}}return 0===i.length?null:new this(r,s,i,o)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Rh(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return _h;case"vector":case"vector2":case"vector3":case"vector4":return Ah;case"color":return Mh;case"quaternion":return Th;case"bool":case"boolean":return wh;case"string":return Eh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];mh.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Lh={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Ih{constructor(e,t,n){const i=this;let r,a=!1,o=0,s=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++,!1===a&&void 0!==i.onStart&&i.onStart(e,o,s),a=!0},this.itemEnd=function(e){o++,void 0!==i.onProgress&&i.onProgress(e,o,s),o===s&&(a=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return r?r(e):e},this.setURLModifier=function(e){return r=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}}const Ph=new Ih;class Dh{constructor(e){this.manager=void 0!==e?e:Ph,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(i,r){n.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Nh={};class kh extends Dh{constructor(e){super(e)}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Lh.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==Nh[e])return void Nh[e].push({onLoad:t,onProgress:n,onError:i});Nh[e]=[],Nh[e].push({onLoad:t,onProgress:n,onError:i});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(a).then((t=>{if(200===t.status||0===t.status){0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const n=Nh[e],i=t.body.getReader(),r=t.headers.get("Content-Length"),a=r?parseInt(r):0,o=0!==a;let s=0;return new ReadableStream({start(e){!function t(){i.read().then((({done:i,value:r})=>{if(i)e.close();else{s+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(i)}e.enqueue(r),t()}}))}()}})}throw Error(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`)})).then((e=>{const t=new Response(e);switch(this.responseType){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((e=>(new DOMParser).parseFromString(e,this.mimeType)));case"json":return t.json();default:return t.text()}})).then((t=>{Lh.add(e,t);const n=Nh[e];delete Nh[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onLoad&&i.onLoad(t)}this.manager.itemEnd(e)})).catch((t=>{const n=Nh[e];delete Nh[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}this.manager.itemError(e),this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Oh extends Dh{constructor(e){super(e)}load(e,t,n,i){const r=this,a=new kh(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=Ch.parse(e[n]);t.push(i)}return t}}class Uh extends Dh{constructor(e){super(e)}load(e,t,n,i){const r=this,a=[],o=new ku,s=new kh(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(r.withCredentials);let l=0;function u(u){s.load(e[u],(function(e){const n=r.parse(e,!0);a[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(o.minFilter=xe),o.image=a,o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,i)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)u(t);else s.load(e,(function(e){const n=r.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){a[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)a[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),a[t].format=n.format,a[t].width=n.width,a[t].height=n.height}o.image=a}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=xe),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,i);return o}}class Fh extends Dh{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Lh.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;const o=ti("img");function s(){u(),Lh.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){u(),i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)}function u(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o}}class Bh extends Dh{constructor(e){super(e)}load(e,t,n,i){const r=new Pa,a=new Fh(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function s(n){a.load(e[n],(function(e){r.images[n]=e,o++,6===o&&(r.needsUpdate=!0,t&&t(r))}),void 0,i)}for(let t=0;t<e.length;++t)s(t);return r}}class zh extends Dh{constructor(e){super(e)}load(e,t,n,i){const r=this,a=new ou,o=new kh(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(e,(function(e){const n=r.parse(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:de,a.wrapT=void 0!==n.wrapT?n.wrapT:de,a.magFilter=void 0!==n.magFilter?n.magFilter:xe,a.minFilter=void 0!==n.minFilter?n.minFilter:xe,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(a.encoding=n.encoding),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=Me),1===n.mipmapCount&&(a.minFilter=xe),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,t&&t(a,n))}),n,i),a}}class Hh extends Dh{constructor(e){super(e)}load(e,t,n,i){const r=new oi,a=new Fh(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),n,i),r}}class Gh extends mr{constructor(e,t=1){super(),this.type="Light",this.color=new kr(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}Gh.prototype.isLight=!0;class jh extends Gh{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(mr.DefaultUp),this.updateMatrix(),this.groundColor=new kr(t)}copy(e){return Gh.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}jh.prototype.isHemisphereLight=!0;const Vh=new Vi,Wh=new pi,qh=new pi;class Xh{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Jn(512,512),this.map=null,this.mapPass=null,this.matrix=new Vi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new za,this._frameExtents=new Jn(1,1),this._viewportCount=1,this._viewports=[new li(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Wh.setFromMatrixPosition(e.matrixWorld),t.position.copy(Wh),qh.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(qh),t.updateMatrixWorld(),Vh.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Vh),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Kh extends Xh{constructor(){super(new Ra(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*Bn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Kh.prototype.isSpotLightShadow=!0;class Yh extends Gh{constructor(e,t,n=0,i=Math.PI/3,r=0,a=1){super(e,t),this.type="SpotLight",this.position.copy(mr.DefaultUp),this.updateMatrix(),this.target=new mr,this.distance=n,this.angle=i,this.penumbra=r,this.decay=a,this.shadow=new Kh}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Yh.prototype.isSpotLight=!0;const Jh=new Vi,Zh=new pi,$h=new pi;class Qh extends Xh{constructor(){super(new Ra(90,1,.5,500)),this._frameExtents=new Jn(4,2),this._viewportCount=6,this._viewports=[new li(2,1,1,1),new li(0,1,1,1),new li(3,1,1,1),new li(1,1,1,1),new li(3,0,1,1),new li(1,0,1,1)],this._cubeDirections=[new pi(1,0,0),new pi(-1,0,0),new pi(0,0,1),new pi(0,0,-1),new pi(0,1,0),new pi(0,-1,0)],this._cubeUps=[new pi(0,1,0),new pi(0,1,0),new pi(0,1,0),new pi(0,1,0),new pi(0,0,1),new pi(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,r=e.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Zh.setFromMatrixPosition(e.matrixWorld),n.position.copy(Zh),$h.copy(n.position),$h.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt($h),n.updateMatrixWorld(),i.makeTranslation(-Zh.x,-Zh.y,-Zh.z),Jh.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jh)}}Qh.prototype.isPointLightShadow=!0;class ed extends Gh{constructor(e,t,n=0,i=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Qh}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}ed.prototype.isPointLight=!0;class td extends Xh{constructor(){super(new Qa(-5,5,5,-5,.5,500))}}td.prototype.isDirectionalLightShadow=!0;class nd extends Gh{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(mr.DefaultUp),this.updateMatrix(),this.target=new mr,this.shadow=new td}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}nd.prototype.isDirectionalLight=!0;class id extends Gh{constructor(e,t){super(e,t),this.type="AmbientLight"}}id.prototype.isAmbientLight=!0;class rd extends Gh{constructor(e,t,n=10,i=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}rd.prototype.isRectAreaLight=!0;class ad{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new pi)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*r),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*i*1.092548),t.addScaledVector(a[5],i*r*1.092548),t.addScaledVector(a[6],.315392*(3*r*r-1)),t.addScaledVector(a[7],n*r*1.092548),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,r=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*i),t.addScaledVector(a[2],1.023328*r),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*i),t.addScaledVector(a[5],.858086*i*r),t.addScaledVector(a[6],.743125*r*r-.247708),t.addScaledVector(a[7],.858086*n*r),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const n=e.x,i=e.y,r=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*r,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*r,t[6]=.315392*(3*r*r-1),t[7]=1.092548*n*r,t[8]=.546274*(n*n-i*i)}}ad.prototype.isSphericalHarmonics3=!0;class od extends Gh{constructor(e=new ad,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}od.prototype.isLightProbe=!0;class sd extends Dh{constructor(e){super(e),this.textures={}}load(e,t,n,i){const r=this,a=new kh(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const i=new fh[e.type];if(void 0!==e.uuid&&(i.uuid=e.uuid),void 0!==e.name&&(i.name=e.name),void 0!==e.color&&void 0!==i.color&&i.color.setHex(e.color),void 0!==e.roughness&&(i.roughness=e.roughness),void 0!==e.metalness&&(i.metalness=e.metalness),void 0!==e.sheen&&(i.sheen=e.sheen),void 0!==e.sheenColor&&(i.sheenColor=(new kr).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(i.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==i.emissive&&i.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==i.specular&&i.specular.setHex(e.specular),void 0!==e.specularIntensity&&(i.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(i.shininess=e.shininess),void 0!==e.clearcoat&&(i.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(i.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(i.transmission=e.transmission),void 0!==e.thickness&&(i.thickness=e.thickness),void 0!==e.attenuationDistance&&(i.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(i.fog=e.fog),void 0!==e.flatShading&&(i.flatShading=e.flatShading),void 0!==e.blending&&(i.blending=e.blending),void 0!==e.combine&&(i.combine=e.combine),void 0!==e.side&&(i.side=e.side),void 0!==e.shadowSide&&(i.shadowSide=e.shadowSide),void 0!==e.opacity&&(i.opacity=e.opacity),void 0!==e.format&&(i.format=e.format),void 0!==e.transparent&&(i.transparent=e.transparent),void 0!==e.alphaTest&&(i.alphaTest=e.alphaTest),void 0!==e.depthTest&&(i.depthTest=e.depthTest),void 0!==e.depthWrite&&(i.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(i.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(i.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(i.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(i.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(i.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(i.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(i.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(i.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(i.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(i.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(i.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(i.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(i.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(i.rotation=e.rotation),1!==e.linewidth&&(i.linewidth=e.linewidth),void 0!==e.dashSize&&(i.dashSize=e.dashSize),void 0!==e.gapSize&&(i.gapSize=e.gapSize),void 0!==e.scale&&(i.scale=e.scale),void 0!==e.polygonOffset&&(i.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(i.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(i.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(i.dithering=e.dithering),void 0!==e.alphaToCoverage&&(i.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(i.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.toneMapped&&(i.toneMapped=e.toneMapped),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const r=e.uniforms[t];switch(i.uniforms[t]={},r.type){case"t":i.uniforms[t].value=n(r.value);break;case"c":i.uniforms[t].value=(new kr).setHex(r.value);break;case"v2":i.uniforms[t].value=(new Jn).fromArray(r.value);break;case"v3":i.uniforms[t].value=(new pi).fromArray(r.value);break;case"v4":i.uniforms[t].value=(new li).fromArray(r.value);break;case"m3":i.uniforms[t].value=(new Zn).fromArray(r.value);break;case"m4":i.uniforms[t].value=(new Vi).fromArray(r.value);break;default:i.uniforms[t].value=r.value}}if(void 0!==e.defines&&(i.defines=e.defines),void 0!==e.vertexShader&&(i.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(i.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)i.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(i.flatShading=1===e.shading),void 0!==e.size&&(i.size=e.size),void 0!==e.sizeAttenuation&&(i.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(i.map=n(e.map)),void 0!==e.matcap&&(i.matcap=n(e.matcap)),void 0!==e.alphaMap&&(i.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(i.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(i.bumpScale=e.bumpScale),void 0!==e.normalMap&&(i.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(i.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),i.normalScale=(new Jn).fromArray(t)}return void 0!==e.displacementMap&&(i.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(i.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(i.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(i.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(i.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(i.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(i.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(i.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(i.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(i.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(i.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(i.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(i.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(i.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(i.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(i.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(i.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(i.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(i.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(i.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Jn).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(i.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(i.thicknessMap=n(e.thicknessMap)),void 0!==e.sheenColorMap&&(i.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}}class ld{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class ud extends ia{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}ud.prototype.isInstancedBufferGeometry=!0;class cd extends Dh{constructor(e){super(e)}load(e,t,n,i){const r=this,a=new kh(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(n){try{t(r.parse(JSON.parse(n)))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}parse(e){const t={},n={};function i(e,i){if(void 0!==t[i])return t[i];const r=e.interleavedBuffers[i],a=function(e,t){if(void 0!==n[t])return n[t];const i=e.arrayBuffers[t],r=new Uint32Array(i).buffer;return n[t]=r,r}(e,r.buffer),o=ei(r.type,a),s=new Il(o,r.stride);return s.uuid=r.uuid,t[i]=s,s}const r=e.isInstancedBufferGeometry?new ud:new ia,a=e.data.index;if(void 0!==a){const e=ei(a.type,a.array);r.setIndex(new Br(e,1))}const o=e.data.attributes;for(const t in o){const n=o[t];let a;if(n.isInterleavedBufferAttribute){const t=i(e.data,n.data);a=new Dl(t,n.itemSize,n.offset,n.normalized)}else{const e=ei(n.type,n.array);a=new(n.isInstancedBufferAttribute?cu:Br)(e,n.itemSize,n.normalized)}void 0!==n.name&&(a.name=n.name),void 0!==n.usage&&a.setUsage(n.usage),void 0!==n.updateRange&&(a.updateRange.offset=n.updateRange.offset,a.updateRange.count=n.updateRange.count),r.setAttribute(t,a)}const s=e.data.morphAttributes;if(s)for(const t in s){const n=s[t],a=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];let o;if(r.isInterleavedBufferAttribute){const t=i(e.data,r.data);o=new Dl(t,r.itemSize,r.offset,r.normalized)}else{const e=ei(r.type,r.array);o=new Br(e,r.itemSize,r.normalized)}void 0!==r.name&&(o.name=r.name),a.push(o)}r.morphAttributes[t]=a}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];r.addGroup(t.start,t.count,t.materialIndex)}const u=e.data.boundingSphere;if(void 0!==u){const e=new pi;void 0!==u.center&&e.fromArray(u.center),r.boundingSphere=new ki(e,u.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class hd extends Dh{constructor(e){super(e)}load(e,t,n,i){const r=this,a=""===this.path?ld.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new kh(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){let a=null;try{a=JSON.parse(n)}catch(t){return void 0!==i&&i(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?r.parse(a,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,i)}async loadAsync(e,t){const n=""===this.path?ld.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const i=new kh(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(e,t),a=JSON.parse(r),o=a.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(a)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),o=this.parseTextures(e.textures,a),s=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,s,o,n),u=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,u),void 0!==t){let e=!1;for(const t in a)if(a[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),r=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,r),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,i,o,a,t),l=this.parseSkeletons(e.skeletons,s);return this.bindSkeletons(s,l),s}parseShapes(e){const t={};if(void 0!==e)for(let n=0,i=e.length;n<i;n++){const i=(new gc).fromJSON(e[n]);t[i.uuid]=i}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse((function(e){e.isBone&&(i[e.uuid]=e)})),void 0!==e)for(let t=0,r=e.length;t<r;t++){const r=(new uu).fromJSON(e[t],i);n[r.uuid]=r}return n}parseGeometries(e,t){const n={};if(void 0!==e){const i=new cd;for(let r=0,a=e.length;r<a;r++){let a;const o=e[r];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(o);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:o.type in rh?a=rh[o.type].fromJSON(o,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}a.uuid=o.uuid,void 0!==o.name&&(a.name=o.name),!0===a.isBufferGeometry&&void 0!==o.userData&&(a.userData=o.userData),n[o.uuid]=a}}return n}parseMaterials(e,t){const n={},i={};if(void 0!==e){const r=new sd;r.setTextures(t);for(let t=0,a=e.length;t<a;t++){const a=e[t];if("MultiMaterial"===a.type){const e=[];for(let t=0;t<a.materials.length;t++){const i=a.materials[t];void 0===n[i.uuid]&&(n[i.uuid]=r.parse(i)),e.push(n[i.uuid])}i[a.uuid]=e}else void 0===n[a.uuid]&&(n[a.uuid]=r.parse(a)),i[a.uuid]=n[a.uuid]}}return i}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const i=e[n],r=Ch.parse(i);t[r.uuid]=r}return t}parseImages(e,t){const n=this,i={};let r;function a(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),r.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:ei(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Ih(t);r=new Fh(n),r.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],r=n.url;if(Array.isArray(r)){i[n.uuid]=[];for(let e=0,t=r.length;e<t;e++){const t=a(r[e]);null!==t&&(t instanceof HTMLImageElement?i[n.uuid].push(t):i[n.uuid].push(new ou(t.data,t.width,t.height)))}}else{const e=a(n.url);null!==e&&(i[n.uuid]=e)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function r(e){if("string"==typeof e){const n=e,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await i.loadAsync(r)}return e.data?{data:ei(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){i=new Fh(this.manager),i.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],a=i.url;if(Array.isArray(a)){n[i.uuid]=[];for(let e=0,t=a.length;e<t;e++){const t=a[e],o=await r(t);null!==o&&(o instanceof HTMLImageElement?n[i.uuid].push(o):n[i.uuid].push(new ou(o.data,o.width,o.height)))}}else{const e=await r(i.url);null!==e&&(n[i.uuid]=e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const i={};if(void 0!==e)for(let r=0,a=e.length;r<a;r++){const a=e[r];let o;void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===t[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const s=t[a.image];Array.isArray(s)?(o=new Pa(s),6===s.length&&(o.needsUpdate=!0)):(o=s&&s.data?new ou(s.data,s.width,s.height):new oi(s),s&&(o.needsUpdate=!0)),o.uuid=a.uuid,void 0!==a.name&&(o.name=a.name),void 0!==a.mapping&&(o.mapping=n(a.mapping,dd)),void 0!==a.offset&&o.offset.fromArray(a.offset),void 0!==a.repeat&&o.repeat.fromArray(a.repeat),void 0!==a.center&&o.center.fromArray(a.center),void 0!==a.rotation&&(o.rotation=a.rotation),void 0!==a.wrap&&(o.wrapS=n(a.wrap[0],pd),o.wrapT=n(a.wrap[1],pd)),void 0!==a.format&&(o.format=a.format),void 0!==a.type&&(o.type=a.type),void 0!==a.encoding&&(o.encoding=a.encoding),void 0!==a.minFilter&&(o.minFilter=n(a.minFilter,fd)),void 0!==a.magFilter&&(o.magFilter=n(a.magFilter,fd)),void 0!==a.anisotropy&&(o.anisotropy=a.anisotropy),void 0!==a.flipY&&(o.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(o.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(o.unpackAlignment=a.unpackAlignment),void 0!==a.userData&&(o.userData=a.userData),i[a.uuid]=o}return i}parseObject(e,t,n,i,r){let a,o,s;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function u(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let i=0,r=e.length;i<r;i++){const r=e[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),t.push(n[r])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function c(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),i[e]}switch(e.type){case"Scene":a=new Ll,void 0!==e.background&&(Number.isInteger(e.background)?a.background=new kr(e.background):a.background=c(e.background)),void 0!==e.environment&&(a.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?a.fog=new Rl(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(a.fog=new Cl(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":a=new Ra(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(a.focus=e.focus),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.filmGauge&&(a.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(a.filmOffset=e.filmOffset),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Qa(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(a.zoom=e.zoom),void 0!==e.view&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new id(e.color,e.intensity);break;case"DirectionalLight":a=new nd(e.color,e.intensity);break;case"PointLight":a=new ed(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new rd(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Yh(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":a=new jh(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=(new od).fromJSON(e);break;case"SkinnedMesh":o=l(e.geometry),s=u(e.material),a=new ru(o,s),void 0!==e.bindMode&&(a.bindMode=e.bindMode),void 0!==e.bindMatrix&&a.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(a.skeleton=e.skeleton);break;case"Mesh":o=l(e.geometry),s=u(e.material),a=new wa(o,s);break;case"InstancedMesh":o=l(e.geometry),s=u(e.material);const t=e.count,n=e.instanceMatrix,i=e.instanceColor;a=new mu(o,s,t),a.instanceMatrix=new cu(new Float32Array(n.array),16),void 0!==i&&(a.instanceColor=new cu(new Float32Array(i.array),i.itemSize));break;case"LOD":a=new $l;break;case"Line":a=new Mu(l(e.geometry),u(e.material));break;case"LineLoop":a=new Eu(l(e.geometry),u(e.material));break;case"LineSegments":a=new Tu(l(e.geometry),u(e.material));break;case"PointCloud":case"Points":a=new Pu(l(e.geometry),u(e.material));break;case"Sprite":a=new Kl(u(e.material));break;case"Group":a=new wl;break;case"Bone":a=new au;break;default:a=new mr}if(a.uuid=e.uuid,void 0!==e.name&&(a.name=e.name),void 0!==e.matrix?(a.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(void 0!==e.position&&a.position.fromArray(e.position),void 0!==e.rotation&&a.rotation.fromArray(e.rotation),void 0!==e.quaternion&&a.quaternion.fromArray(e.quaternion),void 0!==e.scale&&a.scale.fromArray(e.scale)),void 0!==e.castShadow&&(a.castShadow=e.castShadow),void 0!==e.receiveShadow&&(a.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(a.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(a.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(a.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&a.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(a.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.frustumCulled&&(a.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(a.renderOrder=e.renderOrder),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.layers&&(a.layers.mask=e.layers),void 0!==e.children){const o=e.children;for(let e=0;e<o.length;e++)a.add(this.parseObject(o[e],t,n,i,r))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];a.animations.push(r[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(a.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],i=a.getObjectByProperty("uuid",n.object);void 0!==i&&a.addLevel(i,n.distance)}}return a}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const dd={UVMapping:re,CubeReflectionMapping:ae,CubeRefractionMapping:oe,EquirectangularReflectionMapping:se,EquirectangularRefractionMapping:le,CubeUVReflectionMapping:ue,CubeUVRefractionMapping:ce},pd={RepeatWrapping:he,ClampToEdgeWrapping:de,MirroredRepeatWrapping:pe},fd={NearestFilter:fe,NearestMipmapNearestFilter:me,NearestMipmapLinearFilter:ve,LinearFilter:xe,LinearMipmapNearestFilter:be,LinearMipmapLinearFilter:Me};class md extends Dh{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=this,a=Lh.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){Lh.add(e,n),t&&t(n),r.manager.itemEnd(e)})).catch((function(t){i&&i(t),r.manager.itemError(e),r.manager.itemEnd(e)})),r.manager.itemStart(e)}}let gd;md.prototype.isImageBitmapLoader=!0;const vd={getContext:function(){return void 0===gd&&(gd=new(window.AudioContext||window.webkitAudioContext)),gd},setContext:function(e){gd=e}};class yd extends Dh{constructor(e){super(e)}load(e,t,n,i){const r=this,a=new kh(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{const e=n.slice(0);vd.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){i?i(t):console.error(t),r.manager.itemError(e)}}),n,i)}}class xd extends od{constructor(e,t,n=1){super(void 0,n);const i=(new kr).set(e),r=(new kr).set(t),a=new pi(i.r,i.g,i.b),o=new pi(r.r,r.g,r.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}}xd.prototype.isHemisphereLightProbe=!0;class bd extends od{constructor(e,t=1){super(void 0,t);const n=(new kr).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}bd.prototype.isAmbientLightProbe=!0;const wd=new Vi,Md=new Vi;class _d{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ra,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ra,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const n=e.projectionMatrix.clone(),i=t.eyeSep/2,r=i*t.near/t.focus,a=t.near*Math.tan(Fn*t.fov*.5)/t.zoom;let o,s;Md.elements[12]=-i,wd.elements[12]=i,o=-a*t.aspect+r,s=a*t.aspect+r,n.elements[0]=2*t.near/(s-o),n.elements[8]=(s+o)/(s-o),this.cameraL.projectionMatrix.copy(n),o=-a*t.aspect-r,s=a*t.aspect-r,n.elements[0]=2*t.near/(s-o),n.elements[8]=(s+o)/(s-o),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Md),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(wd)}}class Sd{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Td(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Td();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Td(){return("undefined"==typeof performance?Date:performance).now()}const Ed=new pi,Ad=new di,Cd=new pi,Rd=new pi;class Ld extends mr{constructor(){super(),this.type="AudioListener",this.context=vd.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Sd}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Ed,Ad,Cd),Rd.set(0,0,-1).applyQuaternion(Ad),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Ed.x,e),t.positionY.linearRampToValueAtTime(Ed.y,e),t.positionZ.linearRampToValueAtTime(Ed.z,e),t.forwardX.linearRampToValueAtTime(Rd.x,e),t.forwardY.linearRampToValueAtTime(Rd.y,e),t.forwardZ.linearRampToValueAtTime(Rd.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(Ed.x,Ed.y,Ed.z),t.setOrientation(Rd.x,Rd.y,Rd.z,n.x,n.y,n.z)}}class Id extends mr{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Pd=new pi,Dd=new di,Nd=new pi,kd=new pi;class Od extends Id{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Pd,Dd,Nd),kd.set(0,0,1).applyQuaternion(Dd);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Pd.x,e),t.positionY.linearRampToValueAtTime(Pd.y,e),t.positionZ.linearRampToValueAtTime(Pd.z,e),t.orientationX.linearRampToValueAtTime(kd.x,e),t.orientationY.linearRampToValueAtTime(kd.y,e),t.orientationZ.linearRampToValueAtTime(kd.z,e)}else t.setPosition(Pd.x,Pd.y,Pd.z),t.setOrientation(kd.x,kd.y,kd.z)}}class Ud{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class Fd{constructor(e,t,n){let i,r,a;switch(this.binding=e,this.valueSize=n,t){case"quaternion":i=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,r=e*i+i;let a=this.cumulativeWeight;if(0===a){for(let e=0;e!==i;++e)n[r+e]=n[e];a=t}else{a+=t;const e=t/a;this._mixBufferRegion(n,r,0,e,i)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const e=t*this._origIndex;this._mixBufferRegion(n,i,e,1-r,t)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let e=t,r=t+t;e!==r;++e)if(n[e]!==n[e+t]){o.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let e=n,r=i;e!==r;++e)t[e]=t[i+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)e[t+i]=e[n+i]}_slerp(e,t,n,i){di.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,r){const a=this._workIndex*r;di.multiplyQuaternionsFlat(e,a,e,t,e,n),di.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,n,i,r){const a=1-i;for(let o=0;o!==r;++o){const r=t+o;e[r]=e[r]*a+e[n+o]*i}}_lerpAdditive(e,t,n,i,r){for(let a=0;a!==r;++a){const r=t+a;e[r]=e[r]+e[n+a]*i}}}const Bd=new RegExp("[\\[\\]\\.:\\/]","g"),zd="[^\\[\\]\\.:\\/]",Hd="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Gd=/((?:WC+[\/:])*)/.source.replace("WC",zd),jd=/(WCOD+)?/.source.replace("WCOD",Hd),Vd=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",zd),Wd=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",zd),qd=new RegExp("^"+Gd+jd+Vd+Wd+"$"),Xd=["material","materials","bones"];class Kd{constructor(e,t,n){this.path=t,this.parsedPath=n||Kd.parseTrackName(t),this.node=Kd.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new Kd.Composite(e,t,n):new Kd(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Bd,"")}static parseTrackName(e){const t=qd.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==Xd.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const r=e[i];if(r.name===t||r.uuid===t)return r;const a=n(r.children);if(a)return a}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let r=t.propertyIndex;if(e||(e=Kd.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const a=e[i];if(void 0===a){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let s=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}s=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(s=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(s=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[s],this.setValue=this.SetterByBindingTypeAndVersioning[s][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Kd.Composite=class{constructor(e,t,n){const i=n||Kd.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},Kd.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Kd.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Kd.prototype.GetterByBindingType=[Kd.prototype._getValue_direct,Kd.prototype._getValue_array,Kd.prototype._getValue_arrayElement,Kd.prototype._getValue_toArray],Kd.prototype.SetterByBindingTypeAndVersioning=[[Kd.prototype._setValue_direct,Kd.prototype._setValue_direct_setNeedsUpdate,Kd.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Kd.prototype._setValue_array,Kd.prototype._setValue_array_setNeedsUpdate,Kd.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Kd.prototype._setValue_arrayElement,Kd.prototype._setValue_arrayElement_setNeedsUpdate,Kd.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Kd.prototype._setValue_fromArray,Kd.prototype._setValue_fromArray_setNeedsUpdate,Kd.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Yd{constructor(){this.uuid=Gn(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,a=r.length;let o,s=e.length,l=this.nCachedObjects_;for(let u=0,c=arguments.length;u!==c;++u){const c=arguments[u],h=c.uuid;let d=t[h];if(void 0===d){d=s++,t[h]=d,e.push(c);for(let e=0,t=a;e!==t;++e)r[e].push(new Kd(c,n[e],i[e]))}else if(d<l){o=e[d];const s=--l,u=e[s];t[u.uuid]=d,e[d]=u,t[h]=s,e[s]=c;for(let e=0,t=a;e!==t;++e){const t=r[e],a=t[s];let o=t[d];t[d]=a,void 0===o&&(o=new Kd(c,n[e],i[e])),t[s]=o}}else e[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a],s=o.uuid,l=t[s];if(void 0!==l&&l>=r){const a=r++,u=e[a];t[u.uuid]=l,e[l]=u,t[s]=a,e[a]=o;for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[a],r=t[l];t[l]=i,t[a]=r}}}this.nCachedObjects_=r}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,a=e.length;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o].uuid,l=t[s];if(void 0!==l)if(delete t[s],l<r){const o=--r,s=e[o],u=--a,c=e[u];t[s.uuid]=l,e[l]=s,t[c.uuid]=o,e[o]=c,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e],i=t[o],r=t[u];t[l]=i,t[o]=r,t.pop()}}else{const r=--a,o=e[r];r>0&&(t[o.uuid]=l),e[l]=o,e.pop();for(let e=0,t=i;e!==t;++e){const t=n[e];t[l]=t[r],t.pop()}}}this.nCachedObjects_=r}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const r=this._bindings;if(void 0!==i)return r[i];const a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);i=r.length,n[e]=i,a.push(e),o.push(t),r.push(c);for(let n=u,i=s.length;n!==i;++n){const i=s[n];c[n]=new Kd(i,e,t)}return c}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const i=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}Yd.prototype.isAnimationObjectGroup=!0;class Jd{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const r=t.tracks,a=r.length,o=new Array(a),s={endingStart:Gt,endingEnd:Gt};for(let e=0;e!==a;++e){const t=r[e].createInterpolant(null);o[e]=t,t.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ut,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,i=e._clip.duration,r=i/n,a=n/i;e.warp(1,r,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,r=i.time,a=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const s=o.parameterPositions,l=o.sampleValues;return s[0]=r,s[1]=r+n,l[0]=e/a,l[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);const r=this._startTime;if(null!==r){const i=(e-r)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);const a=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case qt:for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(a),t[n].accumulateAdditive(o);break;case Wt:default:for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(a),t[n].accumulate(i,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;null!==n&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,r=this._loopCount;const a=n===Ft;if(0===e)return-1===r?i:a&&1==(1&r)?t-i:i;if(n===Ot){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),i>=t||i<0){const n=Math.floor(i/t);i-=t*n,r+=Math.abs(n);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(a&&1==(1&r))return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=jt,i.endingEnd=jt):(i.endingStart=e?this.zeroSlopeAtStart?jt:Gt:Vt,i.endingEnd=t?this.zeroSlopeAtEnd?jt:Gt:Vt)}_scheduleFading(e,t,n){const i=this._mixer,r=i.time;let a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=t,o[1]=r+e,s[1]=n,this}}class Zd extends On{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName;let u=l[s];void 0===u&&(u={},l[s]=u);for(let e=0;e!==r;++e){const r=i[e],l=r.name;let c=u[l];if(void 0!==c)a[e]=c;else{if(c=a[e],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,s,l));continue}const i=t&&t._propertyBindings[e].binding.parsedPath;c=new Fd(Kd.create(n,l,i),r.ValueTypeName,r.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,s,l),a[e]=c}o[e].resultBuffer=c.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,r=this._actionsByClip;let a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{const t=a.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const r=e._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,r=this._bindings;let a=i[t];void 0===a&&(a={},i[t]=a),a[n]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[r],0===Object.keys(o).length&&delete a[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new yh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r}clipAction(e,t,n){const i=t||this._root,r=i.uuid;let a="string"==typeof e?Ch.findByName(i,e):e;const o=null!==a?a.uuid:e,s=this._actionsByClip[o];let l=null;if(void 0===n&&(n=null!==a?a.blendMode:Wt),void 0!==s){const e=s.actionByRoot[r];if(void 0!==e&&e.blendMode===n)return e;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;const u=new Jd(this,a,t,n);return this._bindAction(u,l),this._addInactiveAction(u,o,r),u}existingAction(e,t){const n=t||this._root,i=n.uuid,r="string"==typeof e?Ch.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1;for(let o=0;o!==n;++o)t[o]._update(i,e,r,a);const o=this._bindings,s=this._nActiveBindings;for(let e=0;e!==s;++e)o[e].apply(a);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const e=r.knownActions;for(let n=0,i=e.length;n!==i;++n){const i=e[n];this._deactivateAction(i);const r=i._cacheIndex,a=t[t.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,a._cacheIndex=r,t[r]=a,t.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const i=n[e].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[t];if(void 0!==i)for(const e in i){const t=i[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}Zd.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class $d{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new $d(void 0===this.value.clone?this.value:this.value.clone())}}class Qd extends Il{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}Qd.prototype.isInstancedInterleavedBuffer=!0;class ep{constructor(e,t,n,i,r){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}ep.prototype.isGLBufferAttribute=!0;class tp{constructor(e,t,n=0,i=1/0){this.ray=new ji(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new tr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return ip(e,this,n,t),n.sort(np),n}intersectObjects(e,t=!0,n=[]){for(let i=0,r=e.length;i<r;i++)ip(e[i],this,n,t);return n.sort(np),n}}function np(e,t){return e.distance-t.distance}function ip(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,r=i.length;e<r;e++)ip(i[e],t,n,!0)}}class rp{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(jn(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class ap{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const op=new Jn;class sp{constructor(e=new Jn(1/0,1/0),t=new Jn(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=op.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return op.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}sp.prototype.isBox2=!0;const lp=new pi,up=new pi;class cp{constructor(e=new pi,t=new pi){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){lp.subVectors(e,this.start),up.subVectors(this.end,this.start);const n=up.dot(up);let i=up.dot(lp)/n;return t&&(i=jn(i,0,1)),i}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const hp=new pi;class dp extends mr{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new ia,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const r=e/n*Math.PI*2,a=t/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(a),Math.sin(a),1)}n.setAttribute("position",new Kr(i,3));const r=new gu({fog:!1,toneMapped:!1});this.cone=new Tu(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),hp.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(hp),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const pp=new pi,fp=new Vi,mp=new Vi;class gp extends Tu{constructor(e){const t=vp(e),n=new ia,i=[],r=[],a=new kr(0,0,1),o=new kr(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(a.r,a.g,a.b),r.push(o.r,o.g,o.b))}n.setAttribute("position",new Kr(i,3)),n.setAttribute("color",new Kr(r,3)),super(n,new gu({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");mp.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const r=t[e];r.parent&&r.parent.isBone&&(fp.multiplyMatrices(mp,r.matrixWorld),pp.setFromMatrixPosition(fp),i.setXYZ(n,pp.x,pp.y,pp.z),fp.multiplyMatrices(mp,r.parent.matrixWorld),pp.setFromMatrixPosition(fp),i.setXYZ(n+1,pp.x,pp.y,pp.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function vp(e){const t=[];e&&e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,vp(e.children[n]));return t}class yp extends wa{constructor(e,t,n){super(new Zc(t,4,2),new Or({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const xp=new pi,bp=new kr,wp=new kr;class Mp extends mr{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Kc(t);i.rotateY(.5*Math.PI),this.material=new Or({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),a=new Float32Array(3*r.count);i.setAttribute("color",new Br(a,3)),this.add(new wa(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");bp.copy(this.light.color),wp.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const i=e<n/2?bp:wp;t.setXYZ(e,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(xp.setFromMatrixPosition(this.light.matrixWorld).negate())}}class _p extends Tu{constructor(e=10,t=10,n=4473924,i=8947848){n=new kr(n),i=new kr(i);const r=t/2,a=e/t,o=e/2,s=[],l=[];for(let e=0,u=0,c=-o;e<=t;e++,c+=a){s.push(-o,0,c,o,0,c),s.push(c,0,-o,c,0,o);const t=e===r?n:i;t.toArray(l,u),u+=3,t.toArray(l,u),u+=3,t.toArray(l,u),u+=3,t.toArray(l,u),u+=3}const u=new ia;u.setAttribute("position",new Kr(s,3)),u.setAttribute("color",new Kr(l,3)),super(u,new gu({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class Sp extends Tu{constructor(e=10,t=16,n=8,i=64,r=4473924,a=8947848){r=new kr(r),a=new kr(a);const o=[],s=[];for(let n=0;n<=t;n++){const i=n/t*(2*Math.PI),l=Math.sin(i)*e,u=Math.cos(i)*e;o.push(0,0,0),o.push(l,0,u);const c=1&n?r:a;s.push(c.r,c.g,c.b),s.push(c.r,c.g,c.b)}for(let t=0;t<=n;t++){const l=1&t?r:a,u=e-e/n*t;for(let e=0;e<i;e++){let t=e/i*(2*Math.PI),n=Math.sin(t)*u,r=Math.cos(t)*u;o.push(n,0,r),s.push(l.r,l.g,l.b),t=(e+1)/i*(2*Math.PI),n=Math.sin(t)*u,r=Math.cos(t)*u,o.push(n,0,r),s.push(l.r,l.g,l.b)}}const l=new ia;l.setAttribute("position",new Kr(o,3)),l.setAttribute("color",new Kr(s,3)),super(l,new gu({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const Tp=new pi,Ep=new pi,Ap=new pi;class Cp extends mr{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let i=new ia;i.setAttribute("position",new Kr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const r=new gu({fog:!1,toneMapped:!1});this.lightPlane=new Mu(i,r),this.add(this.lightPlane),i=new ia,i.setAttribute("position",new Kr([0,0,0,0,0,1],3)),this.targetLine=new Mu(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Tp.setFromMatrixPosition(this.light.matrixWorld),Ep.setFromMatrixPosition(this.light.target.matrixWorld),Ap.subVectors(Ep,Tp),this.lightPlane.lookAt(Ep),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ep),this.targetLine.scale.z=Ap.length()}}const Rp=new pi,Lp=new Ca;class Ip extends Tu{constructor(e){const t=new ia,n=new gu({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],a={},o=new kr(16755200),s=new kr(16711680),l=new kr(43775),u=new kr(16777215),c=new kr(3355443);function h(e,t,n){d(e,n),d(t,n)}function d(e,t){i.push(0,0,0),r.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(i.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",u),h("p","c",c),h("cn1","cn2",c),h("cn3","cn4",c),h("cf1","cf2",c),h("cf3","cf4",c),t.setAttribute("position",new Kr(i,3)),t.setAttribute("color",new Kr(r,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){const e=this.geometry,t=this.pointMap;Lp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Pp("c",t,e,Lp,0,0,-1),Pp("t",t,e,Lp,0,0,1),Pp("n1",t,e,Lp,-1,-1,-1),Pp("n2",t,e,Lp,1,-1,-1),Pp("n3",t,e,Lp,-1,1,-1),Pp("n4",t,e,Lp,1,1,-1),Pp("f1",t,e,Lp,-1,-1,1),Pp("f2",t,e,Lp,1,-1,1),Pp("f3",t,e,Lp,-1,1,1),Pp("f4",t,e,Lp,1,1,1),Pp("u1",t,e,Lp,.7,1.1,-1),Pp("u2",t,e,Lp,-.7,1.1,-1),Pp("u3",t,e,Lp,0,2,-1),Pp("cf1",t,e,Lp,-1,0,1),Pp("cf2",t,e,Lp,1,0,1),Pp("cf3",t,e,Lp,0,-1,1),Pp("cf4",t,e,Lp,0,1,1),Pp("cn1",t,e,Lp,-1,0,-1),Pp("cn2",t,e,Lp,1,0,-1),Pp("cn3",t,e,Lp,0,-1,-1),Pp("cn4",t,e,Lp,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Pp(e,t,n,i,r,a,o){Rp.set(r,a,o).unproject(i);const s=t[e];if(void 0!==s){const e=n.getAttribute("position");for(let t=0,n=s.length;t<n;t++)e.setXYZ(s[t],Rp.x,Rp.y,Rp.z)}}const Dp=new gi;class Np extends Tu{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new ia;r.setIndex(new Br(n,1)),r.setAttribute("position",new Br(i,3)),super(r,new gu({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Dp.setFromObject(this.object),Dp.isEmpty())return;const t=Dp.min,n=Dp.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=t.x,r[4]=n.y,r[5]=n.z,r[6]=t.x,r[7]=t.y,r[8]=n.z,r[9]=n.x,r[10]=t.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=t.z,r[15]=t.x,r[16]=n.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=n.x,r[22]=t.y,r[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return Tu.prototype.copy.call(this,e),this.object=e.object,this}}class kp extends Tu{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new ia;i.setIndex(new Br(n,1)),i.setAttribute("position",new Kr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new gu({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class Op extends Mu{constructor(e,t=1,n=16776960){const i=n,r=new ia;r.setAttribute("position",new Kr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new gu({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=new ia;a.setAttribute("position",new Kr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new wa(a,new Or({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?m:f,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const Up=new pi;let Fp,Bp;class zp extends mr{constructor(e=new pi(0,0,1),t=new pi(0,0,0),n=1,i=16776960,r=.2*n,a=.2*r){super(),this.type="ArrowHelper",void 0===Fp&&(Fp=new ia,Fp.setAttribute("position",new Kr([0,0,0,0,1,0],3)),Bp=new Bu(0,.5,1,5,1),Bp.translate(0,-.5,0)),this.position.copy(t),this.line=new Mu(Fp,new gu({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new wa(Bp,new Or({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Up.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Up,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class Hp extends Tu{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new ia;n.setAttribute("position",new Kr(t,3)),n.setAttribute("color",new Kr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(n,new gu({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const i=new kr,r=this.geometry.attributes.color.array;return i.set(e),i.toArray(r,0),i.toArray(r,3),i.set(t),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Gp{constructor(){this.type="ShapePath",this.color=new kr,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new mc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,r,a){return this.currentPath.bezierCurveTo(e,t,n,i,r,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n],r=new gc;r.curves=i.curves,t.push(r)}return t}function i(e,t){const n=t.length;let i=!1;for(let r=n-1,a=0;a<n;r=a++){let n=t[r],o=t[a],s=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[a],s=-s,o=t[r],l=-l),e.y<n.y||e.y>o.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-s*(e.y-n.y);if(0===t)return!0;if(t<0)continue;i=!i}}else{if(e.y!==n.y)continue;if(o.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=o.x)return!0}}return i}const r=Hc.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return n(a);let o,s,l;const u=[];if(1===a.length)return s=a[0],l=new gc,l.curves=s.curves,u.push(l),u;let c=!r(a[0].getPoints());c=e?!c:c;const h=[],d=[];let p,f,m=[],g=0;d[g]=void 0,m[g]=[];for(let t=0,n=a.length;t<n;t++)s=a[t],p=s.getPoints(),o=r(p),o=e?!o:o,o?(!c&&d[g]&&g++,d[g]={s:new gc,p},d[g].s.curves=s.curves,c&&g++,m[g]=[]):m[g].push({h:s,p:p[0]});if(!d[0])return n(a);if(d.length>1){let e=!1;const t=[];for(let e=0,t=d.length;e<t;e++)h[e]=[];for(let n=0,r=d.length;n<r;n++){const r=m[n];for(let a=0;a<r.length;a++){const o=r[a];let s=!0;for(let r=0;r<d.length;r++)i(o.p,d[r].p)&&(n!==r&&t.push({froms:n,tos:r,hole:a}),s?(s=!1,h[r].push(o)):e=!0);s&&h[n].push(o)}}t.length>0&&(e||(m=h))}for(let e=0,t=d.length;e<t;e++){l=d[e].s,u.push(l),f=m[e];for(let e=0,t=f.length;e<t;e++)l.holes.push(f[e].h)}return u}}const jp=new Float32Array(1),Vp=new Int32Array(jp.buffer);class Wp{static toHalfFloat(e){e>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),jp[0]=e;const t=Vp[0];let n=t>>16&32768,i=t>>12&2047;const r=t>>23&255;return r<103?n:r>142?(n|=31744,n|=(255==r?0:1)&&8388607&t,n):r<113?(i|=2048,n|=(i>>114-r)+(i>>113-r&1),n):(n|=r-112<<10|i>>1,n+=1&i,n)}}const qp=0,Xp=1,Kp=0,Yp=1,Jp=2;function Zp(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function $p(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function Qp(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Pu(e,t)}function ef(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Kl(e)}function tf(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Pu(e,t)}function nf(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Au(e)}function rf(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Au(e)}function af(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Au(e)}function of(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new pi(e,t,n)}function sf(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Br(e,t).setUsage(En)}function lf(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new zr(e,t)}function uf(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Hr(e,t)}function cf(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Gr(e,t)}function hf(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new jr(e,t)}function df(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Vr(e,t)}function pf(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Wr(e,t)}function ff(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new qr(e,t)}function mf(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Kr(e,t)}function gf(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Yr(e,t)}function vf(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Hp(e)}function yf(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Np(e,t)}function xf(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Tu(new Xu(e.geometry),new gu({color:void 0!==t?t:16777215}))}function bf(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Tu(new nh(e.geometry),new gu({color:void 0!==t?t:16777215}))}function wf(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new kh(e)}function Mf(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new zh(e)}function _f(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Da(e,n)}function Sf(){console.error("THREE.CanvasRenderer has been removed")}function Tf(){console.error("THREE.JSONLoader has been removed.")}Ku.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Ku.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},mc.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},_p.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},gp.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Dh.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ld.extractUrlBase(e)},Dh.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},sp.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},sp.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},sp.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},sp.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},gi.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},gi.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},gi.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},gi.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},gi.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},ki.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},za.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},cp.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Zn.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Zn.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Zn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Zn.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Zn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Zn.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Vi.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Vi.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Vi.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new pi).setFromMatrixColumn(this,3)},Vi.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Vi.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Vi.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Vi.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Vi.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Vi.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Vi.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Vi.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Vi.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Vi.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Vi.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Vi.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Vi.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Vi.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Vi.prototype.makeFrustum=function(e,t,n,i,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,a)},Vi.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Ua.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},di.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},di.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},ji.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},ji.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},ji.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Er.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Er.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Er.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Er.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Er.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Er.barycoordFromPoint=function(e,t,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Er.getBarycoord(e,t,n,i,r)},Er.normal=function(e,t,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Er.getNormal(e,t,n,i)},gc.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},gc.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Vc(this,e)},gc.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Jc(this,e)},Jn.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Jn.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Jn.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},pi.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},pi.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},pi.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},pi.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},pi.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},pi.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},pi.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},pi.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},pi.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},li.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},li.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},mr.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},mr.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},mr.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},mr.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},mr.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(mr.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),wa.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(wa.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Xt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),ru.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Ra.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Gh.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Br.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===En},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(En)}}}),Br.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?En:Tn),this},Br.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Br.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ia.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},ia.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Br(arguments[1],arguments[2])))},ia.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},ia.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},ia.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},ia.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},ia.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(ia.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Il.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?En:Tn),this},Il.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Vc.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Vc.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Vc.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Ll.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},$d.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Cr.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new kr}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===v}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(Aa.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),El.prototype.clearTarget=function(e,t,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,i)},El.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},El.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},El.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},El.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},El.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},El.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},El.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},El.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},El.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},El.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},El.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},El.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},El.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},El.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},El.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},El.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},El.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},El.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},El.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},El.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},El.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},El.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},El.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},El.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(El.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Zt:Jt}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(gl.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ui.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Id.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new yd).load(e,(function(e){t.setBuffer(e)})),this},Ud.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Ia.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Ia.prototype.clear=function(e,t,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,i)},ri.crossOrigin=void 0,ri.loadTexture=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new Hh;r.setCrossOrigin(this.crossOrigin);const a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},ri.loadTextureCube=function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new Bh;r.setCrossOrigin(this.crossOrigin);const a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},ri.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ri.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Ef={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Af(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}function Cf(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new ia}function Rf(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new ia}function Lf(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function If(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}function Pf(){console.error("THREE.ImmediateRenderObject has been removed.")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:i}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=i)},47:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GLTFLoader:()=>r});var i=n(212);class r extends i.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new u(e)})),this.register((function(e){return new m(e)})),this.register((function(e){return new g(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new h(e)})),this.register((function(e){return new d(e)})),this.register((function(e){return new p(e)})),this.register((function(e){return new f(e)})),this.register((function(e){return new s(e)})),this.register((function(e){return new v(e)}))}load(e,t,n,r){const a=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:i.LoaderUtils.extractUrlBase(e),this.manager.itemStart(e);const s=function(t){r?r(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},l=new i.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(n){try{a.parse(n,o,(function(n){t(n),a.manager.itemEnd(e)}),s)}catch(e){s(e)}}),n,s)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let a;const s={},u={};if("string"==typeof e)a=e;else if(i.LoaderUtils.decodeText(new Uint8Array(e,0,4))===y){try{s[o.KHR_BINARY_GLTF]=new x(e)}catch(e){return void(r&&r(e))}a=s[o.KHR_BINARY_GLTF].content}else a=i.LoaderUtils.decodeText(new Uint8Array(e));const c=JSON.parse(a);if(void 0===c.asset||c.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const h=new H(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](h);u[t.name]=t,s[t.name]=!0}if(c.extensionsUsed)for(let e=0;e<c.extensionsUsed.length;++e){const t=c.extensionsUsed[e],n=c.extensionsRequired||[];switch(t){case o.KHR_MATERIALS_UNLIT:s[t]=new l;break;case o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:s[t]=new _;break;case o.KHR_DRACO_MESH_COMPRESSION:s[t]=new b(c,this.dracoLoader);break;case o.KHR_TEXTURE_TRANSFORM:s[t]=new w;break;case o.KHR_MESH_QUANTIZATION:s[t]=new S;break;default:n.indexOf(t)>=0&&void 0===u[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}h.setExtensions(s),h.setPlugins(u),h.parse(n,r)}}function a(){let e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const o={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class s{constructor(e){this.parser=e,this.name=o.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const a=t.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e];let s;const l=new i.Color(16777215);void 0!==o.color&&l.fromArray(o.color);const u=void 0!==o.range?o.range:0;switch(o.type){case"directional":s=new i.DirectionalLight(l),s.target.position.set(0,0,-1),s.add(s.target);break;case"point":s=new i.PointLight(l),s.distance=u;break;case"spot":s=new i.SpotLight(l),s.distance=u,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,s.angle=o.spot.outerConeAngle,s.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return s.position.set(0,0,0),s.decay=2,void 0!==o.intensity&&(s.intensity=o.intensity),s.name=t.createUniqueName(o.name||"light_"+e),r=Promise.resolve(s),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser,i=n.json.nodes[e],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(e){return n._getNodeRef(t.cache,r,e)}))}}class l{constructor(){this.name=o.KHR_MATERIALS_UNLIT}getMaterialType(){return i.MeshBasicMaterial}extendParams(e,t,n){const r=[];e.color=new i.Color(1,1,1),e.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const t=a.baseColorFactor;e.color.fromArray(t),e.opacity=t[3]}void 0!==a.baseColorTexture&&r.push(n.assignTexture(e,"map",a.baseColorTexture))}return Promise.all(r)}}class u{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],o=r.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&a.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&a.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(a.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new i.Vector2(e,e)}return Promise.all(a)}}class c{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new i.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=r.extensions[this.name];return void 0!==o.sheenColorFactor&&t.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&a.push(n.assignTexture(t,"sheenColorMap",o.sheenColorTexture)),void 0!==o.sheenRoughnessTexture&&a.push(n.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(a)}}class h{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&r.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(r)}}class d{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],o=r.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&a.push(n.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||0;const s=o.attenuationColor||[1,1,1];return t.attenuationColor=new i.Color(s[0],s[1],s[2]),Promise.all(a)}}class p{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class f{constructor(e){this.parser=e,this.name=o.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?i.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const a=[],o=r.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&a.push(n.assignTexture(t,"specularIntensityMap",o.specularTexture));const s=o.specularColorFactor||[1,1,1];return t.specularColor=new i.Color(s[0],s[1],s[2]),void 0!==o.specularColorTexture&&a.push(n.assignTexture(t,"specularColorMap",o.specularColorTexture).then((function(e){e.encoding=i.sRGBEncoding}))),Promise.all(a)}}class m{constructor(e){this.parser=e,this.name=o.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],a=n.images[r.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a,o)}}class g{constructor(e){this.parser=e,this.name=o.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[t])return null;const a=r.extensions[t],o=i.images[a.source];let s=n.textureLoader;if(o.uri){const e=n.options.manager.getHandler(o.uri);null!==e&&(s=e)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(e,o,s);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class v{constructor(e){this.name=o.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const e=n.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,r.ready]).then((function(t){const n=e.byteOffset||0,i=e.byteLength||0,a=e.count,o=e.byteStride,s=new ArrayBuffer(a*o),l=new Uint8Array(t[0],n,i);return r.decodeGltfBuffer(new Uint8Array(s),a,o,l,e.mode,e.filter),s}))}return null}}const y="glTF";class x{constructor(e){this.name=o.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:i.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==y)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,r=new DataView(e,12);let a=0;for(;a<n;){const t=r.getUint32(a,!0);a+=4;const n=r.getUint32(a,!0);if(a+=4,1313821514===n){const n=new Uint8Array(e,12+a,t);this.content=i.LoaderUtils.decodeText(n)}else if(5130562===n){const n=12+a;this.body=e.slice(n,n+t)}a+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class b{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=o.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(const e in a){const t=P[e]||e.toLowerCase();o[t]=a[e]}for(const t in e.attributes){const i=P[t]||t.toLowerCase();if(void 0!==a[t]){const r=n.accessors[e.attributes[t]],a=C[r.componentType];l[i]=a,s[i]=!0===r.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(const t in e.attributes){const n=e.attributes[t],i=s[t];void 0!==i&&(n.normalized=i)}t(e)}),o,l)}))}))}}class w{constructor(){this.name=o.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class M extends i.MeshStandardMaterial{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new i.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(const t in s)e.uniforms[t]=s[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class _{constructor(){this.name=o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return M}extendParams(e,t,n){const r=t.extensions[this.name];e.color=new i.Color(1,1,1),e.opacity=1;const a=[];if(Array.isArray(r.diffuseFactor)){const t=r.diffuseFactor;e.color.fromArray(t),e.opacity=t[3]}if(void 0!==r.diffuseTexture&&a.push(n.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new i.Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new i.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){const t=r.specularGlossinessTexture;a.push(n.assignTexture(e,"glossinessMap",t)),a.push(n.assignTexture(e,"specularMap",t))}return Promise.all(a)}createMaterial(e){const t=new M(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=i.TangentSpaceNormalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}class S{constructor(){this.name=o.KHR_MESH_QUANTIZATION}}class T extends i.Interpolant{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i*3+i;for(let e=0;e!==i;e++)t[e]=n[r+e];return t}}T.prototype.beforeStart_=T.prototype.copySampleValue_,T.prototype.afterEnd_=T.prototype.copySampleValue_,T.prototype.interpolate_=function(e,t,n,i){const r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=i-t,c=(n-t)/u,h=c*c,d=h*c,p=e*l,f=p-l,m=-2*d+3*h,g=d-h,v=1-m,y=g-h+c;for(let e=0;e!==o;e++){const t=a[f+e+o],n=a[f+e+s]*u,i=a[p+e+o],l=a[p+e]*u;r[e]=v*t+y*n+m*i+g*l}return r};const E=new i.Quaternion;class A extends T{interpolate_(e,t,n,i){const r=super.interpolate_(e,t,n,i);return E.fromArray(r).normalize().toArray(r),r}}const C={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},R={9728:i.NearestFilter,9729:i.LinearFilter,9984:i.NearestMipmapNearestFilter,9985:i.LinearMipmapNearestFilter,9986:i.NearestMipmapLinearFilter,9987:i.LinearMipmapLinearFilter},L={33071:i.ClampToEdgeWrapping,33648:i.MirroredRepeatWrapping,10497:i.RepeatWrapping},I={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},P={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},D={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},N={CUBICSPLINE:void 0,LINEAR:i.InterpolateLinear,STEP:i.InterpolateDiscrete};function k(e,t,n){for(const i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function O(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function U(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(e.morphTargetInfluences.length===n.length){e.morphTargetDictionary={};for(let t=0,i=n.length;t<i;t++)e.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function F(e){const t=e.extensions&&e.extensions[o.KHR_DRACO_MESH_COMPRESSION];let n;return n=t?"draco:"+t.bufferView+":"+t.indices+":"+B(t.attributes):e.indices+":"+B(e.attributes)+":"+e.mode,n}function B(e){let t="";const n=Object.keys(e).sort();for(let i=0,r=n.length;i<r;i++)t+=n[i]+":"+e[n[i]]+";";return t}function z(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class H{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new a,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new i.ImageBitmapLoader(this.options.manager):this.textureLoader=new i.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new i.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){const a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};k(r,a,i),O(a,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(a)}))).then((function(){e(a)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const i=t[n].joints;for(let t=0,n=i.length;t<n;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){const i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(n[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),r=(e,t)=>{const n=this.associations.get(e);null!=n&&this.associations.set(t,n);for(const[n,i]of e.children.entries())r(i,t.children[n])};return r(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const r=e(t[i]);r&&n.push(r)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[o.KHR_BINARY_GLTF].body);const r=this.options;return new Promise((function(e,a){n.load(i.LoaderUtils.resolveURL(t.uri,r.path),e,void 0,(function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);const a=[];return void 0!==r.bufferView?a.push(this.getDependency("bufferView",r.bufferView)):a.push(null),void 0!==r.sparse&&(a.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(a).then((function(e){const a=e[0],o=I[r.type],s=C[r.componentType],l=s.BYTES_PER_ELEMENT,u=l*o,c=r.byteOffset||0,h=void 0!==r.bufferView?n.bufferViews[r.bufferView].byteStride:void 0,d=!0===r.normalized;let p,f;if(h&&h!==u){const e=Math.floor(c/h),n="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+e+":"+r.count;let u=t.cache.get(n);u||(p=new s(a,e*h,r.count*h/l),u=new i.InterleavedBuffer(p,h/l),t.cache.add(n,u)),f=new i.InterleavedBufferAttribute(u,o,c%h/l,d)}else p=null===a?new s(r.count*o):new s(a,c,r.count*o),f=new i.BufferAttribute(p,o,d);if(void 0!==r.sparse){const t=I.SCALAR,n=C[r.sparse.indices.componentType],l=r.sparse.indices.byteOffset||0,u=r.sparse.values.byteOffset||0,c=new n(e[1],l,r.sparse.count*t),h=new s(e[2],u,r.sparse.count*o);null!==a&&(f=new i.BufferAttribute(f.array.slice(),f.itemSize,f.normalized));for(let e=0,t=c.length;e<t;e++){const t=c[e];if(f.setX(t,h[e*o]),o>=2&&f.setY(t,h[e*o+1]),o>=3&&f.setZ(t,h[e*o+2]),o>=4&&f.setW(t,h[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return f}))}loadTexture(e){const t=this.json,n=this.options,i=t.textures[e],r=t.images[i.source];let a=this.textureLoader;if(r.uri){const e=n.manager.getHandler(r.uri);null!==e&&(a=e)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,n){const r=this,a=this.json,o=this.options,s=a.textures[e],l=(t.uri||t.bufferView)+":"+s.sampler;if(this.textureCache[l])return this.textureCache[l];const u=self.URL||self.webkitURL;let c=t.uri||"",h=!1;if(void 0!==t.bufferView)c=r.getDependency("bufferView",t.bufferView).then((function(e){h=!0;const n=new Blob([e],{type:t.mimeType});return c=u.createObjectURL(n),c}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(c).then((function(e){return new Promise((function(t,r){let a=t;!0===n.isImageBitmapLoader&&(a=function(e){const n=new i.Texture(e);n.needsUpdate=!0,t(n)}),n.load(i.LoaderUtils.resolveURL(e,o.path),a,void 0,r)}))})).then((function(t){!0===h&&u.revokeObjectURL(c),t.flipY=!1,s.name&&(t.name=s.name);const n=(a.samplers||{})[s.sampler]||{};return t.magFilter=R[n.magFilter]||i.LinearFilter,t.minFilter=R[n.minFilter]||i.LinearMipmapLinearFilter,t.wrapS=L[n.wrapS]||i.RepeatWrapping,t.wrapT=L[n.wrapT]||i.RepeatWrapping,r.associations.set(t,{textures:e}),t})).catch((function(){return console.error("THREE.GLTFLoader: Couldn't load texture",c),null}));return this.textureCache[l]=d,d}assignTexture(e,t,n){const i=this;return this.getDependency("texture",n.index).then((function(r){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[o.KHR_TEXTURE_TRANSFORM]){const e=void 0!==n.extensions?n.extensions[o.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(r);r=i.extensions[o.KHR_TEXTURE_TRANSFORM].extendTexture(r,e),i.associations.set(r,t)}}return e[t]=r,r}))}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=void 0===t.attributes.tangent,a=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new i.PointsMaterial,i.Material.prototype.copy.call(t,n),t.color.copy(n.color),t.map=n.map,t.sizeAttenuation=!1,this.cache.add(e,t)),n=t}else if(e.isLine){const e="LineBasicMaterial:"+n.uuid;let t=this.cache.get(e);t||(t=new i.LineBasicMaterial,i.Material.prototype.copy.call(t,n),t.color.copy(n.color),this.cache.add(e,t)),n=t}if(r||a||o){let e="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(e+="specular-glossiness:"),r&&(e+="derivative-tangents:"),a&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=n.clone(),a&&(t.vertexColors=!0),o&&(t.flatShading=!0),r&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(n))),n=t}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return i.MeshStandardMaterial}loadMaterial(e){const t=this,n=this.json,r=this.extensions,a=n.materials[e];let s;const l={},u=a.extensions||{},c=[];if(u[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const e=r[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=e.getMaterialType(),c.push(e.extendParams(l,a,t))}else if(u[o.KHR_MATERIALS_UNLIT]){const e=r[o.KHR_MATERIALS_UNLIT];s=e.getMaterialType(),c.push(e.extendParams(l,a,t))}else{const n=a.pbrMetallicRoughness||{};if(l.color=new i.Color(1,1,1),l.opacity=1,Array.isArray(n.baseColorFactor)){const e=n.baseColorFactor;l.color.fromArray(e),l.opacity=e[3]}void 0!==n.baseColorTexture&&c.push(t.assignTexture(l,"map",n.baseColorTexture)),l.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,l.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(c.push(t.assignTexture(l,"metalnessMap",n.metallicRoughnessTexture)),c.push(t.assignTexture(l,"roughnessMap",n.metallicRoughnessTexture))),s=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))))}!0===a.doubleSided&&(l.side=i.DoubleSide);const h=a.alphaMode||"OPAQUE";if("BLEND"===h?(l.transparent=!0,l.depthWrite=!1):(l.format=i.RGBFormat,l.transparent=!1,"MASK"===h&&(l.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&s!==i.MeshBasicMaterial&&(c.push(t.assignTexture(l,"normalMap",a.normalTexture)),l.normalScale=new i.Vector2(1,1),void 0!==a.normalTexture.scale)){const e=a.normalTexture.scale;l.normalScale.set(e,e)}return void 0!==a.occlusionTexture&&s!==i.MeshBasicMaterial&&(c.push(t.assignTexture(l,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(l.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&s!==i.MeshBasicMaterial&&(l.emissive=(new i.Color).fromArray(a.emissiveFactor)),void 0!==a.emissiveTexture&&s!==i.MeshBasicMaterial&&c.push(t.assignTexture(l,"emissiveMap",a.emissiveTexture)),Promise.all(c).then((function(){let n;return n=s===M?r[o.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new s(l),a.name&&(n.name=a.name),n.map&&(n.map.encoding=i.sRGBEncoding),n.emissiveMap&&(n.emissiveMap.encoding=i.sRGBEncoding),O(n,a),t.associations.set(n,{materials:e}),a.extensions&&k(r,n,a),n}))}createUniqueName(e){const t=i.PropertyBinding.sanitizeNodeName(e||"");let n=t;for(let e=1;this.nodeNamesUsed[n];++e)n=t+"_"+e;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function a(e){return n[o.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return j(n,e,t)}))}const s=[];for(let n=0,l=e.length;n<l;n++){const l=e[n],u=F(l),c=r[u];if(c)s.push(c.promise);else{let e;e=l.extensions&&l.extensions[o.KHR_DRACO_MESH_COMPRESSION]?a(l):j(new i.BufferGeometry,l,t),r[u]={primitive:l,promise:e},s.push(e)}}return Promise.all(s)}loadMesh(e){const t=this,n=this.json,r=this.extensions,a=n.meshes[e],o=a.primitives,s=[];for(let e=0,t=o.length;e<t;e++){const t=void 0===o[e].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new i.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:i.FrontSide})),l.DefaultMaterial):this.getDependency("material",o[e].material);s.push(t)}var l;return s.push(t.loadGeometries(o)),Promise.all(s).then((function(n){const s=n.slice(0,n.length-1),l=n[n.length-1],u=[];for(let n=0,c=l.length;n<c;n++){const c=l[n],h=o[n];let d;const p=s[n];if(4===h.mode||5===h.mode||6===h.mode||void 0===h.mode)d=!0===a.isSkinnedMesh?new i.SkinnedMesh(c,p):new i.Mesh(c,p),!0!==d.isSkinnedMesh||d.geometry.attributes.skinWeight.normalized||d.normalizeSkinWeights(),5===h.mode?d.geometry=V(d.geometry,i.TriangleStripDrawMode):6===h.mode&&(d.geometry=V(d.geometry,i.TriangleFanDrawMode));else if(1===h.mode)d=new i.LineSegments(c,p);else if(3===h.mode)d=new i.Line(c,p);else if(2===h.mode)d=new i.LineLoop(c,p);else{if(0!==h.mode)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);d=new i.Points(c,p)}Object.keys(d.geometry.morphAttributes).length>0&&U(d,a),d.name=t.createUniqueName(a.name||"mesh_"+e),O(d,a),h.extensions&&k(r,d,h),t.assignFinalMaterial(d),u.push(d)}for(let n=0,i=u.length;n<i;n++)t.associations.set(u[n],{meshes:e,primitives:n});if(1===u.length)return u[0];const c=new i.Group;t.associations.set(c,{meshes:e});for(let e=0,t=u.length;e<t;e++)c.add(u[e]);return c}))}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return"perspective"===n.type?t=new i.PerspectiveCamera(i.MathUtils.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===n.type&&(t=new i.OrthographicCamera(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),O(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))}loadAnimation(e){const t=this.json.animations[e],n=[],r=[],a=[],o=[],s=[];for(let e=0,i=t.channels.length;e<i;e++){const i=t.channels[e],l=t.samplers[i.sampler],u=i.target,c=void 0!==u.node?u.node:u.id,h=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output;n.push(this.getDependency("node",c)),r.push(this.getDependency("accessor",h)),a.push(this.getDependency("accessor",d)),o.push(l),s.push(u)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(a),Promise.all(o),Promise.all(s)]).then((function(n){const r=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=[];for(let e=0,t=r.length;e<t;e++){const t=r[e],n=a[e],c=o[e],h=s[e],d=l[e];if(void 0===t)continue;let p;switch(t.updateMatrix(),t.matrixAutoUpdate=!0,D[d.path]){case D.weights:p=i.NumberKeyframeTrack;break;case D.rotation:p=i.QuaternionKeyframeTrack;break;case D.position:case D.scale:default:p=i.VectorKeyframeTrack}const f=t.name?t.name:t.uuid,m=void 0!==h.interpolation?N[h.interpolation]:i.InterpolateLinear,g=[];D[d.path]===D.weights?t.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&g.push(e.name?e.name:e.uuid)})):g.push(f);let v=c.array;if(c.normalized){const e=z(v.constructor),t=new Float32Array(v.length);for(let n=0,i=v.length;n<i;n++)t[n]=v[n]*e;v=t}for(let e=0,t=g.length;e<t;e++){const t=new p(g[e]+"."+D[d.path],n.array,v,m);"CUBICSPLINE"===h.interpolation&&(t.createInterpolant=function(e){return new(this instanceof i.QuaternionKeyframeTrack?A:T)(this.times,this.values,this.getValueSize()/3,e)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(t)}}const c=t.name?t.name:"animation_"+e;return new i.AnimationClip(c,void 0,u)}))}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(e){const t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))}loadNode(e){const t=this.json,n=this.extensions,r=this,a=t.nodes[e],o=a.name?r.createUniqueName(a.name):"";return function(){const t=[],n=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return n&&t.push(n),void 0!==a.camera&&t.push(r.getDependency("camera",a.camera).then((function(e){return r._getNodeRef(r.cameraCache,a.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){let s;if(s=!0===a.isBone?new i.Bone:t.length>1?new i.Group:1===t.length?t[0]:new i.Object3D,s!==t[0])for(let e=0,n=t.length;e<n;e++)s.add(t[e]);if(a.name&&(s.userData.name=a.name,s.name=o),O(s,a),a.extensions&&k(n,s,a),void 0!==a.matrix){const e=new i.Matrix4;e.fromArray(a.matrix),s.applyMatrix4(e)}else void 0!==a.translation&&s.position.fromArray(a.translation),void 0!==a.rotation&&s.quaternion.fromArray(a.rotation),void 0!==a.scale&&s.scale.fromArray(a.scale);return r.associations.has(s)||r.associations.set(s,{}),r.associations.get(s).nodes=e,s}))}loadScene(e){const t=this.json,n=this.extensions,r=this.json.scenes[e],a=this,o=new i.Group;r.name&&(o.name=a.createUniqueName(r.name)),O(o,r),r.extensions&&k(n,o,r);const s=r.nodes||[],l=[];for(let e=0,n=s.length;e<n;e++)l.push(G(s[e],o,t,a));return Promise.all(l).then((function(){return a.associations=(e=>{const t=new Map;for(const[e,n]of a.associations)(e instanceof i.Material||e instanceof i.Texture)&&t.set(e,n);return e.traverse((e=>{const n=a.associations.get(e);null!=n&&t.set(e,n)})),t})(o),o}))}}function G(e,t,n,r){const a=n.nodes[e];return r.getDependency("node",e).then((function(e){if(void 0===a.skin)return e;let t;return r.getDependency("skin",a.skin).then((function(e){t=e;const n=[];for(let e=0,i=t.joints.length;e<i;e++)n.push(r.getDependency("node",t.joints[e]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(!e.isMesh)return;const r=[],a=[];for(let e=0,o=n.length;e<o;e++){const o=n[e];if(o){r.push(o);const n=new i.Matrix4;void 0!==t.inverseBindMatrices&&n.fromArray(t.inverseBindMatrices.array,16*e),a.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}e.bind(new i.Skeleton(r,a),e.matrixWorld)})),e}))})).then((function(e){t.add(e);const i=[];if(a.children){const t=a.children;for(let a=0,o=t.length;a<o;a++){const o=t[a];i.push(G(o,e,n,r))}}return Promise.all(i)}))}function j(e,t,n){const r=t.attributes,a=[];function o(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(const t in r){const n=P[t]||t.toLowerCase();n in e.attributes||a.push(o(r[t],n))}if(void 0!==t.indices&&!e.index){const i=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(i)}return O(e,t),function(e,t,n){const r=t.attributes,a=new i.Box3;if(void 0===r.POSITION)return;{const e=n.json.accessors[r.POSITION],t=e.min,o=e.max;if(void 0===t||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(a.set(new i.Vector3(t[0],t[1],t[2]),new i.Vector3(o[0],o[1],o[2])),e.normalized){const t=z(C[e.componentType]);a.min.multiplyScalar(t),a.max.multiplyScalar(t)}}const o=t.targets;if(void 0!==o){const e=new i.Vector3,t=new i.Vector3;for(let i=0,r=o.length;i<r;i++){const r=o[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],a=i.min,o=i.max;if(void 0!==a&&void 0!==o){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),i.normalized){const e=z(C[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}a.expandByVector(e)}e.boundingBox=a;const s=new i.Sphere;a.getCenter(s.center),s.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=s}(e,t,n),Promise.all(a).then((function(){return void 0!==t.targets?function(e,t,n){let i=!1,r=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e];if(void 0!==n.POSITION&&(i=!0),void 0!==n.NORMAL&&(r=!0),i&&r)break}if(!i&&!r)return Promise.resolve(e);const a=[],o=[];for(let s=0,l=t.length;s<l;s++){const l=t[s];if(i){const t=void 0!==l.POSITION?n.getDependency("accessor",l.POSITION):e.attributes.position;a.push(t)}if(r){const t=void 0!==l.NORMAL?n.getDependency("accessor",l.NORMAL):e.attributes.normal;o.push(t)}}return Promise.all([Promise.all(a),Promise.all(o)]).then((function(t){const n=t[0],a=t[1];return i&&(e.morphAttributes.position=n),r&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function V(e,t){let n=e.getIndex();if(null===n){const t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),n=e.getIndex()}const r=n.count-2,a=[];if(t===i.TriangleFanDrawMode)for(let e=1;e<=r;e++)a.push(n.getX(0)),a.push(n.getX(e)),a.push(n.getX(e+1));else for(let e=0;e<r;e++)e%2==0?(a.push(n.getX(e)),a.push(n.getX(e+1)),a.push(n.getX(e+2))):(a.push(n.getX(e+2)),a.push(n.getX(e+1)),a.push(n.getX(e)));a.length/3!==r&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(a),o}},356:(e,t,n)=>{"use strict";n.r(t),n.d(t,{XRControllerModelFactory:()=>p});var i=n(212),r=n(47);const a={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function o(e){const t=await fetch(e);if(t.ok)return t.json();throw new Error(t.statusText)}const s={xAxis:0,yAxis:0,button:0,state:a.ComponentState.DEFAULT};class l{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===a.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(s)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:i}){const{normalizedXAxis:r,normalizedYAxis:o}=function(e=0,t=0){let n=e,i=t;if(Math.sqrt(e*e+t*t)>1){const r=Math.atan2(t,e);n=Math.cos(r),i=Math.sin(r)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*i+.5}}(e,t);switch(this.componentProperty){case a.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?r:.5;break;case a.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?o:.5;break;case a.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case a.ComponentProperty.STATE:this.valueNodeProperty===a.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class u{constructor(e,t){if(!(e&&t&&t.visualResponses&&t.gamepadIndices&&0!==Object.keys(t.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach((e=>{const n=new l(t.visualResponses[e]);this.visualResponses[e]=n})),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:a.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=a.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=a.ComponentState.PRESSED:(t.touched||this.values.button>a.ButtonTouchThreshold)&&(this.values.state=a.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===a.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>a.AxisTouchThreshold&&(this.values.state=a.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===a.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>a.AxisTouchThreshold&&(this.values.state=a.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((e=>{e.updateFromComponent(this.values)}))}}class c{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((e=>{const t=this.layoutDescription.components[e];this.components[e]=new u(e,t)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach((t=>{e.push(t.data)})),e}updateFromGamepad(){Object.values(this.components).forEach((e=>{e.updateFromGamepad(this.xrInputSource.gamepad)}))}}class h extends i.Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e||(this.envMap=e,this.traverse((e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}))),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((e=>{Object.values(e.visualResponses).forEach((e=>{const{valueNode:t,minNode:n,maxNode:i,value:r,valueNodeProperty:o}=e;t&&(o===a.VisualResponseProperty.VISIBILITY?t.visible=r:o===a.VisualResponseProperty.TRANSFORM&&(t.quaternion.slerpQuaternions(n.quaternion,i.quaternion,r),t.position.lerpVectors(n.position,i.position,r)))}))})))}}function d(e,t){!function(e,t){Object.values(e.components).forEach((e=>{const{type:n,touchPointNodeName:r,visualResponses:o}=e;if(n===a.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(r),e.touchPointNode){const t=new i.SphereGeometry(.001),n=new i.MeshBasicMaterial({color:255}),r=new i.Mesh(t,n);e.touchPointNode.add(r)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(o).forEach((e=>{const{valueNodeName:n,minNodeName:i,maxNodeName:r,valueNodeProperty:o}=e;if(o===a.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(i),e.maxNode=t.getObjectByName(r),!e.minNode)return void console.warn(`Could not find ${i} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${r} in the model`)}e.valueNode=t.getObjectByName(n),e.valueNode||console.warn(`Could not find ${n} in the model`)}))}))}(e.motionController,t),e.envMap&&t.traverse((t=>{t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)})),e.add(t)}class p{constructor(e=null){this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new r.GLTFLoader)}createControllerModel(e){const t=new h;let n=null;return e.addEventListener("connected",(e=>{const i=e.data;"tracked-pointer"===i.targetRayMode&&i.gamepad&&async function(e,t,n=null,i=!0){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const r=await async function(e){if(!e)throw new Error("No basePath supplied");return await o(`${e}/profilesList.json`)}(t);let a;if(e.profiles.some((e=>{const n=r[e];return n&&(a={profileId:e,profilePath:`${t}/${n.path}`,deprecated:!!n.deprecated}),!!a})),!a){if(!n)throw new Error("No matching profile name found");const e=r[n];if(!e)throw new Error(`No matching profile name found and default profile "${n}" missing.`);a={profileId:n,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const s=await o(a.profilePath);let l;if(i){let t;if(t="any"===e.handedness?s.layouts[Object.keys(s.layouts)[0]]:s.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${a.profileId}`);t.assetPath&&(l=a.profilePath.replace("profile.json",t.assetPath))}return{profile:s,assetPath:l}}(i,this.path,"generic-trigger").then((({profile:e,assetPath:r})=>{t.motionController=new c(i,e,r);const a=this._assetCache[t.motionController.assetUrl];if(a)n=a.scene.clone(),d(t,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,(e=>{this._assetCache[t.motionController.assetUrl]=e,n=e.scene.clone(),d(t,n)}),null,(()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)}))}})).catch((e=>{console.warn(e)}))})),e.addEventListener("disconnected",(()=>{t.motionController=null,t.remove(n),n=null})),t}}},429:(e,t,n)=>{"use strict";n.r(t),n.d(t,{XRHandModelFactory:()=>c});var i=n(212);const r=new i.Matrix4,a=new i.Vector3;class o{constructor(e,t,n,r,a){let o;this.controller=t,this.handModel=e,this.envMap=null,a&&a.primitive&&"sphere"!==a.primitive?"box"===a.primitive&&(o=new i.BoxGeometry(1,1,1)):o=new i.SphereGeometry(1,10,10);const s=new i.MeshStandardMaterial;this.handMesh=new i.InstancedMesh(o,s,30),this.handMesh.instanceMatrix.setUsage(i.DynamicDrawUsage),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){const e=this.controller.joints;let t=0;for(let n=0;n<this.joints.length;n++){const i=e[this.joints[n]];i.visible&&(a.setScalar(i.jointRadius||.008),r.compose(i.position,i.quaternion,a),this.handMesh.setMatrixAt(n,r),t++)}this.handMesh.count=t,this.handMesh.instanceMatrix.needsUpdate=!0}}var s=n(47);class l{constructor(e,t,n,i){this.controller=t,this.handModel=e,this.bones=[];const r=new s.GLTFLoader;r.setPath(n||"https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/"),r.load(`${i}.glb`,(e=>{const t=e.scene.children[0];this.handModel.add(t);const n=t.getObjectByProperty("type","SkinnedMesh");n.frustumCulled=!1,n.castShadow=!0,n.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach((e=>{const n=t.getObjectByName(e);void 0!==n?n.jointName=e:console.warn(`Couldn't find ${e} in ${i} hand mesh`),this.bones.push(n)}))}))}updateMesh(){const e=this.controller.joints;for(let t=0;t<this.bones.length;t++){const n=this.bones[t];if(n){const t=e[n.jointName];if(t.visible){const e=t.position;n&&(n.position.copy(e),n.quaternion.copy(t.quaternion))}}}}}class u extends i.Object3D{constructor(e){super(),this.controller=e,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&this.motionController.updateMesh()}}class c{constructor(){this.path=null}setPath(e){return this.path=e,this}createHandModel(e,t){const n=new u(e);return e.addEventListener("connected",(i=>{const r=i.data;r.hand&&!n.motionController&&(n.xrInputSource=r,void 0===t||"spheres"===t?n.motionController=new o(n,e,this.path,r.handedness,{primitive:"sphere"}):"boxes"===t?n.motionController=new o(n,e,this.path,r.handedness,{primitive:"box"}):"mesh"===t&&(n.motionController=new l(n,e,this.path,r.handedness)))})),e.addEventListener("disconnected",(()=>{})),n}}},302:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VRButton=void 0,t.VRButton=class{static createButton(e,t){const n=document.createElement("button");function i(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return n.id="VRButton",n.style.display="none",i(n),navigator.xr.isSessionSupported("immersive-vr").then((function(i){i?function(){let i=null;async function r(e){e.addEventListener("end",a),t(e),n.textContent="EXIT VR",i=e}function a(){i.removeEventListener("end",a),n.textContent="ENTER VR",i=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=function(){n.style.opacity="1.0"},n.onmouseleave=function(){n.style.opacity="0.5"},n.onclick=async()=>{if(null===i){await e();const t={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",t).then(r)}else i.end()}}():(n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null,n.textContent="VR NOT SUPPORTED")})),n;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",i(e),e}}}},335:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CanvasUI:()=>r});var i=n(212);class r{constructor(e,t){this.config=void 0===t?{panelSize:{width:.25,height:.125},width:256,height:128,opacity:.7,body:{fontFamily:"Arial",fontSize:30,padding:20,backgroundColor:"#000",fontColor:"#fff",borderRadius:6}}:t;const n=this.config.keyboard;void 0===this.config.width&&(this.config.width=512),void 0===this.config.height&&(this.config.height=512),void 0===this.config.body&&(this.config.body={fontFamily:"Arial",size:30,padding:20,backgroundColor:"#000",fontColor:"#fff",borderRadius:6});const r=this.config.body;void 0===r.borderRadius&&(r.borderRadius=6),void 0===r.fontFamily&&(r.fontFamily="Arial"),void 0===r.padding&&(r.padding=20),void 0===r.fontSize&&(r.fontSize=30),void 0===r.backgroundColor&&(r.backgroundColor="#000"),void 0===r.fontColor&&(r.fontColor="#fff"),Object.entries(this.config).forEach((([e,t])=>{if(!("object"!=typeof t||"panelSize"===e||t instanceof i.WebGLRenderer||t instanceof i.Scene)){const e=void 0!==t.position?t.position:{x:0,y:0};void 0!==e.left&&void 0===e.x&&(e.x=e.left),void 0!==e.top&&void 0===e.y&&(e.y=e.top);const n=void 0!==t.width?t.width:this.config.width,i=void 0!==t.height?t.height:this.config.height;void 0!==e.right&&void 0===e.x&&(e.x=this.config.width-e.right-n),void 0!==e.bottom&&void 0===e.y&&(e.y=this.config.height-e.bottom-i),void 0===e.x&&(e.x=0),void 0===e.y&&(e.y=0),t.position=e,void 0===t.type&&(t.type="text")}}));const a=this.createOffscreenCanvas(this.config.width,this.config.height);this.context=a.getContext("2d"),this.context.save();const o=void 0!==this.config.opacity?this.config.opacity:.7,s=new i.MeshBasicMaterial({transparent:!0,opacity:o});this.panelSize=void 0!==this.config.panelSize?this.config.panelSize:{width:1,height:1};const l=new i.PlaneGeometry(this.panelSize.width,this.panelSize.height);this.mesh=new i.Mesh(l,s),this.texture=new i.CanvasTexture(a),this.mesh.material.map=this.texture,this.scene=this.config.scene,Object.values(this.config).filter((e=>"input-text"===e.type)).length>0&&n&&(this.keyboard=new n(this.panelSize.width,this.config.renderer),this.keyboard.mesh.position.set(0,-.3,.2),this.mesh.add(this.keyboard.mesh)),void 0===e?(this.content={body:""},this.config.body.type="text"):(this.content=e,Object.values(this.config).filter((e=>"button"===e.type||"scroll"===e.overflow||"input-text"===e.type)).length>0&&(void 0===t||void 0===t.renderer?console.warn("CanvasUI: button, scroll or input-text in the config but no renderer"):(this.renderer=t.renderer,this.initControllers()))),this.selectedElements=[void 0,void 0],this.selectPressed=[!1,!1],this.scrollData=[void 0,void 0],this.intersects=[void 0,void 0],this.needsUpdate=!0,this.update()}getIntersectY(e){const t=this.config.height||512,n=this.intersects[e];return void 0===n||void 0===n.uv?0:(1-n.uv.y)*t}initControllers(){this.vec3=new i.Vector3,this.mat4=new i.Matrix4,this.raycaster=new i.Raycaster;const e=this;function t(t){const n=t.target===e.controller?0:1,i=e.selectedElements[n];if(void 0!==i)if("button"==i.type)e.select(n);else if("input-text"==i.type&&e.keyboard)if(e.keyboard.visible)e.keyboard.linkedUI=void 0,e.keyboard.linkedText=void 0,e.keyboard.linkedElement=void 0,e.keyboard.visible=!1;else{let t;e.keyboard.linkedUI=e,Object.entries(e.config).forEach((([e,n])=>{n==i&&(t=e)}));const n=(.5-(i.position.y+i.height+e.config.body.padding)/e.config.height)*e.panelSize.height,r=Math.max(e.panelSize.width,e.panelSize.height)/2;e.keyboard.position.set(0,-r/1.5-n,.1),e.keyboard.linkedText=e.content[t],e.keyboard.linkedName=t,e.keyboard.linkedElement=i,e.keyboard.visible=!0}}function n(t){const n=t.target===e.controller?0:1;if(e.selectPressed[n]=!0,void 0!==e.selectedElements[n]&&"scroll"==e.selectedElements[n].overflow){const t=e.selectedElements[n];e.scrollData[n]={scrollY:t.scrollY,rayY:e.getIntersectY(n)}}}function r(t){const n=t.target===e.controller?0:1;e.selectPressed[n]=!1,void 0!==e.selectedElements[n]&&"scroll"==e.selectedElements[n].overflow&&(e.scrollData[n]=void 0)}if(this.controller=this.renderer.xr.getController(0),this.controller.addEventListener("select",t),this.controller.addEventListener("selectstart",n),this.controller.addEventListener("selectend",r),this.controller1=this.renderer.xr.getController(1),this.controller1.addEventListener("select",t),this.controller1.addEventListener("selectstart",n),this.controller1.addEventListener("selectend",r),this.scene){const e=.015,t=new i.IcosahedronBufferGeometry(e),n=new i.MeshBasicMaterial({color:170}),r=new i.Mesh(t,n);r.visible=!1,this.scene.add(r);const a=new i.Mesh(t,n);a.visible=!1,this.scene.add(a),this.intersectMesh=[r,a]}}setClip(e){const t=this.context;if(t.restore(),t.save(),void 0!==e.clipPath){const n=new Path2D(e.clipPath);t.clip(n)}else{const n=void 0!==e.position?e.position:{x:0,y:0},i=e.borderRadius||0,r=e.width||this.config.width,a=e.height||this.config.height;if(t.beginPath(),0!==i){const e=Math.PI/2;t.moveTo(n.x+i,n.y),t.arc(n.x+i,n.y+i,i,e,2*e,!0),t.lineTo(n.x,n.y+a-i),t.arc(n.x+i,n.y+a-i,i,0,e,!0),t.lineTo(n.x+r-i,n.y+a),t.arc(n.x+r-i,n.y+a-i,i,3*e,4*e,!0),t.lineTo(n.x+r,n.y+i),t.arc(n.x+r-i,n.y+i,i,2*e,3*e,!0),t.closePath(),t.clip()}else t.rect(n.x,n.y,r,a),t.clip()}}setPosition(e,t,n){void 0!==this.mesh&&this.mesh.position.set(e,t,n)}setRotation(e,t,n){void 0!==this.mesh&&this.mesh.rotation.set(e,t,n)}updateElement(e,t){let n=this.content[e];void 0!==n?("object"==typeof n?n.content=t:n=t,this.content[e]=n,this.needsUpdate=!0):console.warn(`CanvasGUI.updateElement: No ${e} found`)}get panel(){return this.mesh}getElementAtLocation(e,t){const n=this,r=Object.entries(this.config).filter((([r,a])=>{if(!("object"!=typeof a||"panelSize"===r||"body"===r||a instanceof i.WebGLRenderer||a instanceof i.Scene)){const i=a.position,r=void 0!==a.width?a.width:n.config.width,o=void 0!==a.height?a.height:n.config.height;return e>=i.x&&e<i.x+r&&t>=i.y&&t<i.y+o}}));return 0==r.length?null:this.config[r[0][0]]}updateConfig(e,t,n){let i=this.config[e];void 0!==i?(i[t]=n,this.needsUpdate=!0):console.warn(`CanvasUI.updateconfig: No ${e} found`)}hover(e=0,t){if(void 0===t)void 0!==this.selectedElements[e]&&(this.selectedElements[e]=void 0,this.needsUpdate=!0);else{const n=t.x*(this.config.width||512),i=(1-t.y)*(this.config.height||512),r=this.getElementAtLocation(n,i);null===r?void 0!==this.selectedElements[e]&&(this.selectedElements[e]=void 0,this.needsUpdate=!0):this.selectedElements[e]!==r&&(this.selectedElements[e]=r,this.needsUpdate=!0)}}select(e=0){if(void 0!==this.selectedElements[e]){const t=this.selectedElements[e];t.onSelect&&t.onSelect(),"input-text"===t.type?this.keyboard.mesh.visible=!0:this.selectedElements[e]=void 0}}scroll(e){if(void 0===this.selectedElements[e])return void(this.intersectMesh&&(this.intersectMesh[e].visible=!1));if("scroll"!==this.selectedElements[e].overflow)return;const t=this.selectedElements[e];if(this.selectPressed[e]){const n=this.scrollData[e];if(void 0!==n){this.intersectMesh&&(this.intersectMesh[e].visible=!0,this.intersectMesh[e].position.copy(this.intersects[e].point));const i=this.getIntersectY(e)-n.rayY;t.scrollY=Math.min(Math.max(t.minScrollY,n.scrollY+i),0),this.needsUpdate=!0}}else this.intersectMesh&&(this.intersectMesh[e].visible=!1)}handleController(e,t){this.mat4.identity().extractRotation(e.matrixWorld),this.raycaster.ray.origin.setFromMatrixPosition(e.matrixWorld),this.raycaster.ray.direction.set(0,0,-1).applyMatrix4(this.mat4);const n=this.raycaster.intersectObject(this.mesh);n.length>0?(this.hover(t,n[0].uv),this.intersects[t]=n[0],this.scroll(t)):(this.hover(t),this.intersects[t]=void 0,this.scroll(t))}update(){if(void 0===this.mesh)return;if(this.controller&&this.handleController(this.controller,0),this.controller1&&this.handleController(this.controller1,1),this.keyboard&&this.keyboard.visible&&this.keyboard.update(),!this.needsUpdate)return;let e=this.context;e.clearRect(0,0,this.config.width,this.config.height);const t=this.config.body.backgroundColor?this.config.body.backgroundColor:"#000",n=(this.config.body.fontFamily&&this.config.body.fontFamily,this.config.body.fontColor?this.config.body.fontColor:"#fff");this.config.body.fontSize&&this.config.body.fontSize,this.setClip(this.config.body),e.fillStyle=t,e.fillRect(0,0,this.config.width,this.config.height);const i=this;Object.entries(this.content).forEach((([t,r])=>{const a=void 0!==i.config[t]?i.config[t]:i.config.body;if("none"!==(void 0!==a.display?a.display:"block")){const o=void 0!==a.position?a.position:{x:0,y:0},s=void 0!==a.width?a.width:i.config.width,l=void 0!==a.height?a.height:i.config.height;"button"!=a.type||r.toLowerCase().startsWith("<path>")||(void 0===a.borderRadius&&(a.borderRadius=6),void 0===a.textAlign&&(a.textAlign="center")),i.setClip(a);const u=r.toLowerCase().startsWith("<path>"),c=void 0!==i.selectedElements[0]&&this.selectedElements[0]===a||void 0!==i.selectedElements[1]&&this.selectedElements[1]===a;if(void 0!==a.backgroundColor&&(c&&"button"==a.type&&void 0!==a.hover?e.fillStyle=a.hover:e.fillStyle=a.backgroundColor,e.fillRect(o.x,o.y,s,l)),"text"==a.type||"button"==a.type||"input-text"==a.type){let h=!1;if(c?(u||"button"!=a.type?e.fillStyle=void 0!==a.hover?a.hover:void 0!==a.fontColor?a.fontColor:n:e.fillStyle=void 0!==a.fontColor?a.fontColor:n,h=void 0===a.hover):e.fillStyle=void 0!==a.fontColor?a.fontColor:n,u){const t=r.toUpperCase().substring(6,r.length-7);e.save(),e.translate(o.x,o.y);const n=new Path2D(t);e.fillStyle=a.fontColor,e.fill(n),e.restore()}else i.wrapText(t,r);h&&(e.beginPath(),e.strokeStyle="#fff",e.lineWidth=2,e.rect(o.x,o.y,s,l),e.stroke())}else if("img"==a.type)if(void 0===a.img)this.loadImage(r).then((e=>{console.log(`w: ${e.width} | h: ${e.height}`),a.img=e,i.needsUpdate=!0,i.update()})).catch((e=>console.error(e)));else{const t=s/(a.img.width/a.img.height);e.drawImage(a.img,o.x,o.y,s,t)}}})),this.needsUpdate=!1,this.texture.needsUpdate=!0}loadImage(e){return new Promise(((t,n)=>{const i=new Image;i.addEventListener("load",(()=>t(i))),i.addEventListener("error",(e=>n(e))),i.src=e}))}createOffscreenCanvas(e,t){const n=document.createElement("canvas");return n.width=e,n.height=t,n}fillRoundedRect(e,t,n,i,r){const a=this.context;a.beginPath(),a.moveTo(e+r,t),a.lineTo(e+n-r,t),a.quadraticCurveTo(e+n,t,e+n,t+r),a.lineTo(e+n,t+i-r),a.quadraticCurveTo(e+n,t+i,e+n-r,t+i),a.lineTo(e+r,t+i),a.quadraticCurveTo(e,t+i,e,t+i-r),a.lineTo(e,t+r),a.quadraticCurveTo(e,t,e+r,t),a.closePath(),a.fill()}wrapText(e,t){const n=t.split(" ");let i="";const r=[],a=void 0!==this.config[e]?this.config[e]:this.config.body,o=void 0!==a.width?a.width:this.config.width,s=void 0!==a.height?a.height:this.config.height,l=void 0!==a.position?a.position:{x:0,y:0},u=void 0!==a.padding?a.padding:void 0!==this.config.body.padding?this.config.body.padding:10,c=void 0!==a.paddingTop?a.paddingTop:u,h=void 0!==a.paddingLeft?a.paddingLeft:u,d=void 0!==a.paddingBottom?a.paddingBottom:u,p=void 0!==a.paddingRight?a.paddingRight:u,f={x:l.x+h,y:l.y+c,width:o-h-p,height:s-c-d},m=void 0!==a.textAlign?a.textAlign:void 0!==this.config.body.textAlign?this.config.body.textAlign:"left",g=void 0!==a.fontSize?a.fontSize:void 0!==this.config.body.fontSize?this.config.body.fontSize:30,v=void 0!==a.fontFamily?a.fontFamily:void 0!==this.config.body.fontFamily?this.config.body.fontFamily:"Arial",y=g+(void 0!==a.leading?a.leading:void 0!==this.config.body.leading?this.config.body.leading:8),x=this.context;x.textAlign=m,x.font=`${g}px '${v}'`,n.forEach((function(e){let t=n.length>1?`${i}${e} `:e,a=x.measureText(t);if(a.width>f.width&&e.length>1)if(0==i.length&&a.width>f.width){for(;a.width>f.width;){let n=0;do{n++,t=e.substr(0,n),a=x.measureText(t)}while(a.width<f.width&&n<e.length-1);if(n--,t=e.substr(0,n),r.push(t),e=e.substr(n),n<=1)break;a=x.measureText(e)}""!=e&&r.push(e)}else r.push(i),i=`${e} `;else i=t})),""!=i&&r.push(i);const b=r.length*y;let w=0;if(b>f.height&&"scroll"===a.overflow){void 0===a.scrollY&&(a.scrollY=0);const e=void 0!==a.fontColor?a.fontColor:this.config.body.fontColor;x.fillStyle="#aaa",this.fillRoundedRect(l.x+o-12,l.y,12,s,6),x.fillStyle="#666";const t=f.height/b,n=t*s,i=-a.scrollY*t;this.fillRoundedRect(l.x+o-12,l.y+i,12,n,6),x.fillStyle=e,w=a.scrollY,a.minScrollY=f.height-b}let M,_=w+f.y+g/2;switch(m){case"center":M=f.x+f.width/2;break;case"right":M=f.x+f.width;break;default:M=f.x}r.forEach((e=>{_+y>0&&x.fillText(e,M,_),_+=y}))}}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";const e=n(212),t=n(47),i=n(356),r=n(429),a=n(123),o=n(302),s=n(212),l=n(335);var u;!function(e){e[e.play=0]="play",e[e.pause=1]="pause",e[e.exit=2]="exit"}(u||(u={}));class c{constructor(e,t,n){this.renderer=e,this.scene=t,this.evtHandler=n,this.update=()=>{if(this.renderer.xr.isPresenting&&this.leftController&&this.leftController.visible&&this.ui.mesh.visible){const e=this.leftController.position;this.ui.mesh.position.set(e.x+.2,e.y,e.z),this.ui.update()}},this.controller1=this.renderer.xr.getController(0),this.handleControllerEvents(this.controller1),this.scene.add(this.controller1),this.controller2=this.renderer.xr.getController(1),this.handleControllerEvents(this.controller2),this.scene.add(this.controller2);const a=new i.XRControllerModelFactory,o=(new r.XRHandModelFactory).setPath("./models/fbx/");this.controllerGrip1=this.renderer.xr.getControllerGrip(0),this.controllerGrip1.add(a.createControllerModel(this.controllerGrip1)),this.scene.add(this.controllerGrip1),this.hand1=this.renderer.xr.getHand(0),this.hand1.add(o.createHandModel(this.hand1)),this.scene.add(this.hand1),this.controllerGrip2=this.renderer.xr.getControllerGrip(1),this.controllerGrip2.add(a.createControllerModel(this.controllerGrip2)),this.scene.add(this.controllerGrip2),this.hand2=this.renderer.xr.getHand(1),this.hand2.add(o.createHandModel(this.hand2)),this.scene.add(this.hand2);const s={panelSize:{width:.25,height:.125},width:256,height:128,opacity:.7,info:{type:"text",position:{left:6,top:6},width:244,height:58,backgroundColor:"#aaa",fontColor:"#000",fontSize:20},pause:{type:"button",position:{top:70,left:6},width:40,height:52,backgroundColor:"#bbb",fontColor:"#bb0",hover:"#fff",onSelect:()=>this.evtHandler(u.pause)},play:{type:"button",position:{top:70,left:60},width:40,height:52,backgroundColor:"#bbb",fontColor:"#bb0",hover:"#fff",onSelect:()=>this.evtHandler(u.play)},stop:{type:"button",position:{top:70,left:114},width:40,height:52,backgroundColor:"#bbb",fontColor:"#bb0",hover:"#fff",onSelect:()=>this.evtHandler(u.exit)},renderer:this.renderer};this.ui=new l.CanvasUI({info:"loading",pause:"<path>M 17 10 L 7 10 L 7 40 L 17 40 Z M 32 10 L 22 10 L 22 40 L 32 40 Z</path>",stop:"<path>M 7 10 L 32 10 L 32 40 L 7 40 Z</path>",play:"<path>M 32 25 L 12 10 L 12 40 Z</path>"},s),this.ui.mesh.visible=!1,this.scene.add(this.ui.mesh)}updateInfoText(e){this.ui.updateElement("info",e)}handleControllerEvents(e){e.addEventListener("connected",(t=>{"left"===t.data.handedness&&(console.log("left hand detected"),this.leftController=e,e.addEventListener("pinchstart",(e=>{this.ui.mesh.visible=!0})),e.addEventListener("pinchend",(e=>{this.ui.mesh.visible=!1}))),"right"===t.data.handedness&&(console.log("right hand detected"),this.rightController=e)}))}}class h{constructor(t,n){this.video=n,this.isPlaying=!1,this.roomLight=new e.HemisphereLight(8421504,6316128),this.handleControllerEvent=e=>{var t,n,i;switch(e){case u.pause:null===(t=this.video)||void 0===t||t.pause();break;case u.play:null===(n=this.video)||void 0===n||n.play();break;case u.exit:this.video.pause(),null===(i=this.xrSession)||void 0===i||i.end()}},this.resize=()=>{this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},this.render=()=>{var e;this.renderer.xr.isPresenting&&(this.renderer.render(this.scene,this.camera),null===(e=this.controllers)||void 0===e||e.update())},this.xrSession=t,this.scene=new e.Scene,this.camera=new e.PerspectiveCamera(50,window.innerWidth/window.innerHeight,.1,10),this.camera.position.set(0,0,0),this.renderer=new s.WebGLRenderer({antialias:!0,alpha:!1}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.outputEncoding=e.sRGBEncoding,this.renderer.xr.enabled=!0,this.renderer.setAnimationLoop(this.render),this.scene.add(this.roomLight),this.controllers=new c(this.renderer,this.scene,this.handleControllerEvent),window.addEventListener("resize",this.resize),t.addEventListener("end",(()=>{this.destroy()}))}async run(){if(!this.xrSession)throw new Error("expected xrSession");const e=this.xrSession;if(await Promise.all([this.renderer.xr.setSession(e),this.loadScene()]),this.xrLayer=this.renderer.xr.getBaseLayer(),this.xrLayer.fixedFoveation=1,this.tvPosition={x:0,y:0,z:1},!this.tvPosition)throw new Error("expected tvPosition");if(!this.video)throw new Error("expected video");const t=this.video;t.addEventListener("play",(()=>{var e;this.isPlaying=!0,null===(e=this.controllers)||void 0===e||e.updateInfoText("playing"),this.roomLight.intensity=.2})),t.addEventListener("pause",(()=>{var e;this.isPlaying=!1,null===(e=this.controllers)||void 0===e||e.updateInfoText("paused"),this.roomLight.intensity=1})),await t.play();const n=this.tvPosition,i=this.renderer.xr.getReferenceSpace(),r=new XRMediaBinding(e),a=await r.createQuadLayer(t,{space:i,layout:"mono",transform:new XRRigidTransform({x:n.x-.355,y:n.y+1.15,z:-n.z-2.5,w:1}),width:2.35,height:1});e.updateRenderState({layers:[a,this.xrLayer]}),this.videoQualityInterval=window.setInterval((()=>{if(this.controllers&&this.video&&!this.video.paused&&this.isPlaying){const e=this.video.getVideoPlaybackQuality();this.controllers.updateInfoText(`playing-${e.totalVideoFrames}/${e.droppedVideoFrames}`)}}),1e3)}destroy(){window.clearInterval(this.videoQualityInterval),window.removeEventListener("resize",this.resize),this.xrSession=null,this.controllers=null}async loadScene(){var e;const n=new t.GLTFLoader,i=await n.loadAsync("assets/home-cinema.glb");i.scene.translateZ(.2),this.scene.add(i.scene),this.tvPosition=null===(e=this.scene.getObjectByName("TV"))||void 0===e?void 0:e.position}}async function d(){m.pause(),null==f||f.removeChild(m),await new Promise((e=>window.setTimeout(e,100)))}function p(e){e.updateTargetFrameRate(72),g=new h(e,m),g.run(),e.addEventListener("end",(()=>{window.setTimeout((()=>{g=null,null==f||f.appendChild(m),m.play()}),100)}))}const f=document.getElementById("container");if(!f)throw new Error("invalid container element");const m=document.createElement("video");let g;m.crossOrigin="anonymous",m.preload="auto",m.autoplay=!0,m.controls=!0,f.appendChild(m),async function(e){const t=new a.Player(e);t.configure({drm:{servers:{"com.widevine.alpha":"https://cwip-shaka-proxy.appspot.com/no_auth"}}}),await t.load("https://storage.googleapis.com/shaka-demo-assets/sintel-widevine/dash.mpd")}(m).then((()=>{const e=o.VRButton.createButton(d,p);document.body.appendChild(e)}))})()})();